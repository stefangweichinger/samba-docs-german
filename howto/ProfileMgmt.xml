<?xml version="1.0" encoding="ISO-8859-1"?>
<chapter id="ProfileMgmt">
<chapterinfo>
	&author.jht;
    <pubdate>April 3 2003</pubdate>
<author>&person.sgw;<contrib>Deutsche Übersetzung</contrib></author>
</chapterinfo>

<title>Das Management von Desktop-Profilen</title>

<sect1>
<title>Eigenschaften und Vorzüge</title>

<para>
So genannte <quote>Roaming Profiles</quote> (zu Deutsch etwa <quote>servergespeicherte Benutzerprofile</quote>) 
werden von manchen gefürchtet, von einigen gehasst, von vielen geliebt
und sind ein Geschenk des Himmels für so manchen Administrator.
</para>

<para>
Roaming Profiles erlauben es einem Administrator, dem Benutzer einen konsistenten Desktop
zur Verfügung stellen, wenn er sich von einer Maschine zu einer anderen bewegt. Dieses
Kapitel stellt Informationen darüber zur Verfügung, wie man Roaming Profiles konfiguriert und
verwaltet.
</para>

<para>
Während Roaming Profiles für manche wie das Nirvana klingen mögen, sind sie für andere ein
reales und konkretes Problem. Im Speziellen die Nutzer mobiler Computer, die oft
keine dauerhafte Netzwerk-Verbindung haben, sind oft besser mit rein lokalen Profilen beraten.
Dieses Kapitel bietet Informationen, um dem Samba-Administrator zu helfen, mit diesen Situationen
umzugehen.
</para>

</sect1>

<sect1>
<title>Roaming Profiles</title>

<warning>
<para>
Die Unterstützung für Roaming Profiles ist für Windows 9x/Me und Windows NT4/200x unterschiedlich.
</para>
</warning>

<para>
Bevor wir die Konfiguration von Roaming Profiles beschreiben, ist es sinnvoll zu sehen, wie
Windows 9x/Me- und Windows NT4/200x-Clients diese Eigenschaften implementieren.
</para>

<para>
Windows 9x/Me-Clients senden einen <quote>NetUserGetInfo</quote>-Request an den Server, um den Pfad zu den
Profilen des Benutzers zu erhalten. Die Antwort hat jedoch nicht genug Platz für ein separates
Feld für den Pfad der Profile, nur für die home-Freigabe des Benutzers. Das bedeutet, dass
Windows 9x/Me-Profile darauf beschränkt sind, im Home-Verzeichnis des Benutzers gespeichert zu werden.
</para>

<para>
Windows NT4/200x-Clients senden einen NetSAMLogon-RPC-Request, der viele Felder enthält, inklusive
eines Feldes für den Pfad der Profile des Benutzers.
</para>

<sect2>
<title>Die Konfiguration von Samba für den Umgang mit Profilen</title>

<para>
Dieser Abschnitt dokumentiert, wie man Samba konfiguriert, um MS Windows-Client-Profile zu
unterstützen.
</para>

<sect3>
<title>NT4/200x-Benutzer-Profile</title>

<para>
Um zum Beispiel Windows NT4/200x-Clients zu unterstützen, setzen Sie Folgendes im Abschnitt [global] der Datei &smb.conf;:
</para>

<para>
<smbconfblock>
<smbconfoption><name>logon path</name><value>\\profileserver\profileshare\profilepath\%U\moreprofilepath</value></smbconfoption>
</smbconfblock>

Dies wird typischerweise so implementiert:

<smbconfblock>
<smbconfoption><name>logon path</name><value>\\%L\Profiles\%u</value></smbconfoption>
</smbconfblock>
wobei <quote>%L</quote> in den Namen des Samba-Servers aufgelöst wird und <quote>%u</quote> in den Benutzernamen.
</para>

<para>
Die Voreinstellung für diese Option ist <filename>\\%N\%U\profile</filename>, also
<filename>\\sambaserver\username\profile</filename>.
Der Dienst <filename>\\%N\%U</filename> wird automatisch vom [homes]-Dienst angelegt.
Wenn Sie einen Samba-Server für die Profile verwenden, müssen Sie die in <quote>logon path</quote> angegebene
Freigabe durchsuchbar (<smbconfoption>browseable</smbconfoption>) machen. Bitte lesen Sie die Manpage für &smb.conf;, um mehr über die 
unterschiedliche Semantik von <quote>%L</quote>, <quote>%N</quote>, 
<quote>%U</quote> und <quote>%u</quote> zu erfahren.
</para>

<note>
<para>
MS Windows NT/200x-Clients trennen manchmal zwischen einzelnen
Logons eine Verbindung zu einem Server nicht. 
Es wird empfohlen, den Meta-Dienst <smbconfsection>homes</smbconfsection> nicht als Teil des
Profil-Pfads zu verwenden.
</para>
</note>
</sect3>

<sect3>
<title>Windows 9x/Me-Benutzer-Profile</title>

<para>
Um Windows 9x/Me-Clients zu unterstützen, müssen Sie den Parameter 
<smbconfoption><name>logon home</name></smbconfoption> verwenden. Samba wurde repariert, so dass
<userinput>net use /home</userinput> nun auch funktioniert und auch auf dem Parameter
<command>logon home</command> beruht.
</para>

<para>
Durch die Verwendung des Parameters <command>logon home</command> sind Sie darauf beschränkt, Windows 9x/Me-Benutzer-Profile
im home-Verzeichnis des Benutzers abzulegen. Aber warten Sie! Es gibt einen Trick, den Sie
benutzen können. Wenn Sie im Abschnitt <smbconfsection>[global]</smbconfsection> Ihrer
&smb.conf;-Datei 
</para>
<para><smbconfblock>
<smbconfoption><name>logon home</name><value>\\%L\%U\.profiles</value></smbconfoption>
</smbconfblock></para>

<para>
setzen, werden Ihre Windows 9x/Me-Clients pflichtbewusst ihre Profile in ein Unterverzeichnis Ihres
home-Verzeichnisses namens <filename>.profiles</filename> ablegen (und sie damit verstecken).
</para>

<para>
Nicht nur das, <userinput>net use /home</userinput> wird aufgrund eines
Features in Windows 9x/Me genauso funktionieren. Es entfernt jegliche Verzeichnis-Angaben am Ende der Angabe
des home-Verzeichnisses und benutzt nur die Teile, die den Server und die Freigabe angeben. Daher
sieht es für den Client so aus, als ob Sie <filename>\\%L\%U</filename> für
<smbconfoption><name>logon home</name></smbconfoption> spezifiziert hätten.
</para>
</sect3>

<sect3>
<title>Gemischte Windows 9x/Me- und Windows NT4/200x-Benutzer-Profile</title>

<para>
Sie können Profile für Windows 9x/Me- und Windows NT4/200x-Clients unterstützen, indem Sie
beide Parameter, <smbconfoption><name>logon home</name></smbconfoption> und
<smbconfoption><name>logon path</name></smbconfoption>, angeben. Zum Beispiel:
</para>

<para><smbconfblock>
<smbconfoption><name>logon home</name><value>\\%L\%u\.profiles</value></smbconfoption>
<smbconfoption><name>logon path</name><value>\\%L\profiles\%u</value></smbconfoption>
</smbconfblock></para>

</sect3>
<sect3>
<title>Die Unterstützung von Roaming Profiles deaktivieren</title>

<para>
Oft wird gefragt: <quote>Wie kann ich die Verwendung lokaler Profile erzwingen?</quote> oder:
<quote>Wie kann ich Roaming Profiles deaktivieren?</quote>
</para>

<para>
<indexterm><primary>roaming profiles</primary></indexterm>
Es gibt drei Arten, dies zu tun:
<indexterm><primary>windows registry settings</primary><secondary>roaming profiles</secondary></indexterm>
</para>


<variablelist>
	<varlistentry>
		<term>In &smb.conf;</term>
		<listitem><para>
		Ändern Sie die folgenden Settings, und ALLE Clients werden dazu gezwungen,
		ein lokales Profil zu verwenden:
		<smbconfoption><name>logon home</name></smbconfoption> und <smbconfoption><name>logon path</name></smbconfoption>.
		</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>MS Windows Registry</term>
		<listitem><para>
		Verwenden Sie die Microsoft Management Console gpedit.msc, um Ihre MS Windows XP-		Maschine zu zwingen, nur ein lokales Profil zu verwenden. Dies verändert natürlich
		Registry-Settings. Der volle Pfad zu der Option ist:
<screen>
Local Computer Policy\
	Computer Configuration\
		Administrative Templates\
			System\
				User Profiles\

Disable: Nur lokale Benutzer-Profile erlauben
Disable: Verhindern, dass Änderungen des Roaming Profile an den Server weitergegeben werden 
</screen>
	</para> </listitem>
	</varlistentry>

	<varlistentry>
		<term>Ändern des Profil-Typs:</term>
		<listitem><para>Klicken Sie im Start-Menü mit der rechten Maustaste auf
		<guiicon>Arbeitsplatz</guiicon>,
		wählen Sie <guimenuitem>Properties</guimenuitem>, klicken Sie auf das Tab
		<guilabel>Benutzerprofile</guilabel>,
		wählen Sie das Profil, das Sie vom Typ
		<guimenu>Roaming</guimenu> auf <guimenu>Local</guimenu> ändern wollen, und klicken Sie auf 
		<guibutton>Typ ändern</guibutton>.
		</para></listitem>
	</varlistentry>
</variablelist>

<para>
Konsultieren Sie die Anleitung zur MS Windows Registry für Ihre spezifische Version von MS Windows,
um mehr Informationen dazu zu erhalten, welche Registrierungsschlüssel zu ändern sind, um die
Verwendung lokaler Benutzer-Profile zu erzwingen.
</para>

<note><para>
Die Besonderheiten, wie man ein lokales Profil in ein Roaming Profil umwandelt oder umgekehrt,
variieren je nach der Version von MS Windows, die Sie einsetzen. Konsultieren Sie auch das
Microsoft MS Windows Resource Kit für besondere Informationen.
</para></note>

</sect3> </sect2>

<sect2> <title>Informationen zur Konfiguration von Windows-Client-Profilen</title>

<sect3> <title>Windows 9x/Me-Profil-Setup</title>

<para>
Wenn sich ein Benutzer zum ersten Mal in Windows 9x anmeldet, werden die Datei user.DAT erstellt sowie die Verzeicnisse <filename>Startmenü</filename>, <filename>Desktop</filename>, 
<filename>Programme</filename> und <filename>Netzwerkumgebung</filename>.
Diese Verzeichnisse und ihre Inhalte werden bei jedem folgenden Login mit den lokalen Versionen in
<filename>c:\windows\profiles\username</filename> vereint, 
wobei immer die jeweils neuesten Versionen verwendet werden. Sie werden folgende
<smbconfsection>[global]</smbconfsection>-Optionen verwenden müssen:
<smbconfoption><name>preserve case</name><value>yes</value></smbconfoption>,
<smbconfoption><name>short preserve case</name><value>yes</value></smbconfoption> und
<smbconfoption><name>case sensitive</name><value>no</value></smbconfoption>,
um Großbuchstaben in Shortcuts in einem der Profil-Verzeichnisse zu erhalten.
</para>

<para>
Die Datei <filename>user.DAT</filename> enthält alle Benutzereinstellungen. Wenn Sie einen Satz von
Einstellungen erzwingen wollen, benennen Sie die Datei <filename>user.DAT</filename> in
<filename>user.MAN</filename> um und verweigern den Schreibzugriff auf diese Datei.
</para>

<orderedlist>
	<listitem> <para>
	Gehen Sie auf der Windows 9x/Me-Maschine auf <guimenu>Systemsteuerung</guimenu> ->
	<guimenuitem>Passwörter</guimenuitem>, und wählen Sie den Tab
	<guilabel>Benutzer-Profile</guilabel>.
	Wählen Sie das erforderliche Level von Roaming-Einstellungen.
	Drücken Sie <guibutton>OK</guibutton>, aber erlauben Sie keinen Reboot.
	</para> </listitem>

	<listitem> <para>
	Dann gehen Sie auf <guimenu>Systemsteuerung</guimenu> ->,
	<guimenuitem>Netzwerk</guimenuitem> -> <guimenuitem>Client for Microsoft Networks</guimenuitem>	
	<guilabel>Einstellungen</guilabel>. Wählen Sie <guilabel>An NT Domäne anmelden</guilabel>.
	Dann stellen Sie sicher, dass das Primary Logon <guilabel>Client for Microsoft Networks</guilabel>
	ist. Drücken Sie <guibutton>OK</guibutton>, und erlauben Sie diesmal den Reboot.
	</para> </listitem>
</orderedlist>

<para> 
In Windows 9x/Me werden die Profile vom Primary Logon geladen. Wenn Sie das Primary Logon auf
<quote>Client for Novell Networks</quote> gesetzt haben, werden die Profile und Logon-Skripten vom
Novell-Server geladen. Wenn Sie das Primary Logon auf <quote>Windows Logon</quote> gesetzt haben, werden die
Profile von der lokalen Maschine geladen, was ein wenig dem Prinzip der Roaming Profiles widerspricht,
wie es scheint!
</para>

<para>
Sie werden nun sehen, dass der MS-Netzwerk-Login-Dialog <constant>[Benutzer, Passwort, Domäne]</constant>
statt nur <constant>[Benutzer, Passwort]</constant> enthält. Geben Sie den Domänen-Namen des
Samba-Servers (oder den einer anderen existierenden Domäne, aber denken Sie daran, dass der Benutzer
an dieser Domäne angemeldet wird und die Profile aus dieser Domäne geladen werden, wenn dieser
Domänen-Anmelde-Server es unterstützt), den Benutzernamen und das Passwort des Benutzers ein.
</para>

<para> 
Sobald der Benutzer erfolgreich überprüft wurde, wird die Windows 9x/Me-Maschine Ihnen Folgendes anzeigen: <computeroutput>The user has not logged on before</computeroutput> und Sie Folgendes fragen:
<computeroutput>Do you wish to save the user's preferences?</computeroutput> 
Wählen Sie <guibutton>Yes</guibutton>.
</para>

<para>
Sobald der Windows 9x/Me-Client den Desktop hergestellt hat, sollte es Ihnen möglich sein, den Inhalt
des im Parameter <smbconfoption><name>logon path</name></smbconfoption> angegebenen Verzeichnisses
auf dem Samba-Server zu prüfen und festzustellen, dass die Ordner
<filename>Desktop</filename>, <filename>Startmenü</filename>, <filename>Programme</filename> und
<filename>Netzwerkumgebung</filename> angelegt worden sind.
</para>

<para>
Diese Ordner werden lokal auf dem Client gepuffert (Cache)
und erfahren ein Update, wenn sich der Benutzer
abmeldet (wenn Sie sie dann nicht schon auf read-only gesetzt haben). Sie werden sehen, dass der Client,
wenn der Benutzer weitere Ordner oder Verknüpfungen anlegt, die heruntergeladenen Profil-Inhalte
mit dem Inhalt des lokalen Profil-Ordners zusammenfügt, wozu er die neuesten Ordner und
Verknüpfungen jeden Profil-Bestands verwendet.
</para>

<para>
Wenn Sie die Ordner/Dateien auf dem Samba-Server auf read-only gesetzt haben, werden Sie Fehler von
der Windows 9x/Me-Maschine bei der An- und Abmeldung erhalten, wenn sie versucht, lokale und entfernte
Profile zu vereinigen. Grundsätzlich sollten Sie die UNIX-Dateirechte und Eigentumsverhältnisse
auf dem Samba-Server prüfen, wenn Sie irgendwelche Fehler von der Windows 9x/Me-Maschine erhalten.
</para>

<para>
Wenn Sie Probleme beim Anlegen von Benutzerprofilen haben, können Sie den lokalen Desktop-Cache des
Benutzers zurücksetzen, wie unten gezeigt. Wenn sich dieser Benutzer das nächste Mal anmeldet, wird
ihm gesagt werden, dass er/sie sich <quote>zum ersten Mal</quote> anmeldet.
	
<indexterm><primary>windows registry settings</primary><secondary>profile path</secondary></indexterm>
	</para>


<orderedlist>
	<listitem><para>
	Anstatt sich im Dialog [Benutzer, Passwort, Domäne] anzumelden, drücken Sie <guibutton>escape</guibutton>.
	</para> </listitem>

	<listitem><para>
	Führen Sie <command>regedit.exe</command> aus, und suchen Sie nach:
	</para>

	<para>
	<filename>HKEY_LOCAL_MACHINE\Windows\CurrentVersion\ProfileList</filename>
	</para>

	<para>
	Sie werden einen ProfilePath-Eintrag für jeden Benutzer finden. Notieren Sie sich die Inhalte
	dieses Schlüssels (wahrscheinlich <filename>c:\windows\profiles\username</filename>), dann
	löschen Sie den Schlüssel <parameter>ProfilePath</parameter> für den erforderlichen Benutzer.
	</para></listitem>

	<listitem><para>
	Verlassen Sie den Registry-Editor.
	</para></listitem>

	<listitem><para>
	Suchen Sie nach der .PWL-password-caching-Datei des Benutzers im Verzeichnis
	<filename>c:\windows</filename>, und löschen Sie diese Datei.
	</para></listitem>

	<listitem><para>
	Melden Sie sich vom Windows 9x/Me-Client ab.	
	</para></listitem>

	<listitem><para>
	Prüfen Sie die Inhalte des Profil-Pfads (siehe 
	<smbconfoption><name>logon path</name></smbconfoption>, wie oben beschrieben), und löschen Sie
	die Datei <filename>user.DAT</filename> oder <filename>user.MAN</filename> des Benutzers,
	nachdem Sie, falls erforderlich, eine Sicherung angelegt haben.
	</para></listitem>
</orderedlist>

<warning><para>
Bevor Sie die Inhalte des in <parameter>ProfilePath</parameter> angegebenen Verzeichnisses
(wahrscheinlich <filename>c:\windows\profiles\username</filename>) löschen, fragen Sie den Benutzer, ob er
irgendwelche wichtigen Dateien auf seinem Desktop oder im Startmenü gespeichert hat. Löschen Sie
die Inhalte des Verzeichnisses <parameter>ProfilePath</parameter> (nach einem Backup, falls Dateien
benötigt werden).
</para>

<para>
Dies wird den Effekt haben, dass die lokale (read-only, versteckte) Datei <filename>user.DAT</filename>
genauso wie die lokalen Ordner 
<quote>Desktop</quote>, <quote>Startmenü</quote>, <quote>Programme</quote> und <quote>Netzwerkumgebung</quote> aus dem Profil-Verzeichnis entfernt wird.
</para></warning>

<para>
Wenn alles scheitert, erhöhen Sie Sambas Log-Level auf einen Wert zwischen 3 und 10 und/oder
verwenden einen Packet-Sniffer wie ethereal oder <command>netmon.exe</command> und suchen nach Fehlermeldungen.
</para>

<para>
Wenn Sie Zugriff auf einen Windows NT4/200x-Server haben, installieren Sie zuerst Roaming Profiles
und/oder Netzwerk-Anmeldungen auf dem Windows NT4/200x-Server. Führen Sie eine Paketverfolgung (Trace) aus, oder prüfen Sie die Beispiel-Traces, die dem Windows NT4/200x-Server beiliegen, und stellen
Sie die Unterschiede zum Samba-Trace fest.
</para>

</sect3>

<sect3>
<title>Windows NT4 Workstation</title>

<para>
Wenn sich ein Benutzer zum ersten Mal an einer Windows NT4 Workstation anmeldet, wird das Profil
<filename>NTuser.DAT</filename> angelegt. Der Ort, an dem das Profil abgelegt wird, kann durch den Parameter
<smbconfoption><name>logon path</name></smbconfoption> angegeben werden.
</para>

<para>
Es gibt einen Parameter, der nun für die Verwendung mit NT-Profilen verfügbar ist:
<smbconfoption><name>logon drive</name></smbconfoption>.
Dieser sollte auf <filename>H:</filename> oder ein anderes Laufwerk gesetzt werden und in Verbindung
mit dem neuen Parameter <smbconfoption><name>logon home</name></smbconfoption> verwendet werden.
</para>

<para>
Der Eintrag für das NT4-Profil ist ein Verzeichnis, keine Datei. Die NT-Hilfe bezüglich Profilen
erwähnt, dass ein Verzeichnis auch mit der Endung .PDS angelegt wird. Der Benutzer muss beim Anmelden
Schreibrechte haben, um den vollen Profil-Pfad anzulegen (und den Ordner mit der Endung .PDS, in den
Fällen, in denen er angelegt wird).
</para>

<para>
Windows NT4 legt mehr Ordner im Profil-Verzeichnis an als Windows 9x/Me. So legt es
den Ordner <filename>Anwendungsdaten</filename> und andere an, sowie <filename>Desktop</filename>,
<filename>Startmenü</filename>, <filename>Programme</filename> und <filename>Netzwerkumgebung</filename>.
Das Profil selbst wird in einer Datei namens <filename>NTuser.DAT</filename> gespeichert. Scheinbar wird
nichts in dem Verzeichnis .PDS gespeichert, und sein Zweck ist uns momentan unbekannt.</para>

<para>Sie können die <application>Systemsteuerung</application> dazu verwenden, um ein lokales
Profil auf einen Samba-Server zu kopieren (sehen Sie sich dazu die NT-Hilfe zu Profilen an; diese ist sogar
dazu imstande, Sie zum richtigen Platz in der <application>Systemsteuerung</application> zu bringen).
Die NT-Hilfe-Datei erwähnt auch, dass das Umbenennen der Datei <filename>NTuser.DAT</filename> in
<filename>NTuser.MAN</filename> ein Profil in ein zwingendes Profil verwandelt.
</para>

<para>
Die Groß-/Kleinschreibung des Profils ist wichtig. Die Datei muss <filename>NTuser.DAT</filename>
heißen oder, für ein zwingendes Profil, <filename>NTuser.MAN</filename>. </para> </sect3>

<sect3> <title>Windows 2000/XP Professional</title>

<para>
Sie müssen zuerst auf der MS Windows Workstation das Profil von einem lokalen Profil in ein 
Domänen-Profil umwandeln, und zwar wie folgt:</para>

<procedure>
	<step><para>Melden Sie sich als der <emphasis>lokale</emphasis> Workstation-Administrator an. </para></step>

	<step><para>Klicken Sie mit der rechten Maustaste auf das Icon <guiicon>Arbeitsplatz</guiicon>, und wählen Sie
	<guimenuitem>Eigenschaften</guimenuitem>.</para></step>

	<step><para>Klicken Sie auf den Tab <guilabel>Erweitert</guilabel>.</para></step>

	<step><para>Klicken Sie im Abschnitt <guilabel>Benutzerprofile</guilabel> auf den Eintrag <guilabel>Einstellungen</guilabel>.</para></step>

	<step><para>Wählen Sie das Profil, das Sie umwandeln wollen (einmal darauf klicken).</para></step>

	<step><para>Klicken Sie auf den Button <guibutton>Kopieren nach</guibutton>.</para></step>

	<step><para>In der Box <guilabel>Benutzer</guilabel> klicken Sie auf
	<guibutton>Ändern</guibutton>.</para></step>

	<step><para>Klicken Sie auf den Bereich <guilabel>Pfade</guilabel>, der den Maschinen-Namen
	listet; es wird sich eine Auswahl-Box öffnen. Klicken Sie auf die Domäne, für die das Profil
	zugänglich sein muss.</para>

	<note><para>
	Sie werden sich anmelden müssen, wenn sich ein Anmelde-Dialog öffnet.
	Zum Beispiel melden Sie sich an als <replaceable>DOMÄNE</replaceable>\root,passwort:
	<replaceable>meinpasswort</replaceable>.</para></note> </step>

	<step><para>Um einem Profil zu gestatten, von jedem verwendet zu werden, wählen Sie
	<quote>Jeder</quote>. </para></step>

	<step><para>Klicken Sie auf <guibutton>OK</guibutton>; die Auswahl-Box schließt sich. </para></step>

	<step><para>Nun klicken Sie auf <guibutton>OK</guibutton>, um das Profil im angegebenen
	Pfad anzulegen.</para></step>
</procedure>

<para>Erledigt. Sie haben nun ein Profil, das mit dem Samba-Tool <command>profiles</command>
edititiert werden kann.
</para>

<note><para>
Unter Windows NT/200x erzwingt die Verwendung von zwingenden Profilen die Verwendung von
MS-Exchange für die Speicherung von Mail-Daten und hält diese außerhalb des Desktop-Profils.
Dies verhindert, dass die Desktop-Profile unbenutzbar werden.
</para> </note>

<sect4>
<title>Windows XP Service Pack 1</title>
	<para>
	Es gibt einen Sicherheits-Check, der neu für Windows XP ist (oder vielleicht nur für
	Windows XP Service Pack 1). Er kann über eine Gruppen-Richtlinie im Active Directory
	deaktiviert werden. Die Richtlinie heißt:
	</para>

	<para>
		<filename>Computer Configuration\Administrative Templates\System\User Profiles\<?latex \linebreak ?>Do not check for
	user ownership of Roaming Profile Folders</filename>
	</para>

	<para>
	Dies sollte auf <constant>Aktiviert</constant> gesetzt werden.
	</para>

	<para>
	Hat die neue Version von Samba ein Analogon zum Active Directory? Wenn ja, können Sie die
	Richtlinie eventuell durch dieses setzen.
	</para>	

	<para>
	Wenn Sie keine Gruppen-Richtlinien in Samba setzen können, dann können Sie sie vielleicht
	lokal auf jeder Maschine setzen. Wenn Sie dies versuchen wollen, machen Sie folgendes:
	</para>

<procedure>

	<step><para>Melden Sie sich auf der XP-Workstation mit einem Administrator-Konto an.</para></step>

	<step><para>Klicken Sie auf <guimenu>Start</guimenu> -> <guimenuitem>Ausführen</guimenuitem>.</para></step>
	<step><para>Geben Sie <command>mmc</command> ein.</para></step>
	<step><para>Klicken Sie auf <guibutton>OK</guibutton>.</para></step>
	<step><para>Eine Microsoft Management Console sollte erscheinen.</para></step>
	<step><para>Klicken Sie auf <guimenu>Datei</guimenu> -> <guimenuitem>Snap-In hinzufügen/entfernen</guimenuitem> -> <guimenuitem>Hinzufügen</guimenuitem>.</para></step> 
	<step><para>Einen Doppelklick auf <guiicon>Gruppenrichtlinie</guiicon>.</para></step> 
	<step><para>Klicken Sie auf <guibutton>Fertigstellen</guibutton> -> <guibutton>Schliessen</guibutton>.</para></step> 
	<step><para>Klicken Sie auf <guibutton>OK</guibutton>.</para></step>
	<step><para>In dem Fenster <quote>Konsolenstamm</quote> klappen Sie 
	<guiicon>Richtlinien für Lokaler Computer</guiicon> auf ->
		<guiicon>Computerkonfiguration</guiicon> -> <guiicon>Administrative Vorlagen</guiicon> -> <guiicon>System</guiicon> -> <guiicon>Benutzerprofile</guiicon>.</para></step>
	<step><para>Einen Doppelklick auf <guilabel>Eigentümer von servergespeicherten Profilen nicht prüfen</guilabel>.</para></step>
	<step><para>Wählen Sie <guilabel>Aktiviert</guilabel>.</para></step>
	<step><para>Klicken Sie auf <guibutton>OK</guibutton>.</para></step>
	<step><para>Schliessen Sie die gesamte Konsole. Sie müssen die Einstellungen nicht speichern (dies
	bezieht sich mehr auf die Konsolen-Einstellungen als auf die Richtlinien, die Sie geändert haben).
	</para></step>
	<step><para>Rebooten Sie den Rechner.</para></step>
</procedure>
</sect4>
</sect3>
</sect2>

<sect2>
	<title>Das gemeinsame Nutzen von Profilen mit Windows 9x/Me- und NT4/200x/XP-Workstations</title>

<para>
Das gemeinsame Nutzen von Desktop-Profilen mit verschiedenen Windows-Versionen ist nicht zu empfehlen.
Desktop-Profile sind ein Phänomen, das sich ständig weiterentwickelt, und Profile für spätere MS Windows-Versionen fügen
Eigenschaften hinzu, die mit früheren MS Windows-Clients zu Problemen führen können. Der herausragendste Grund dafür, Profile nicht zu mischen, ist vermutlich folgender: Wenn man sich von einer älteren
MS Windows-Version abmeldet, könnte das alte Format der Profil-Inhalte Informationen überschreiben, die
zur neueren Version gehören, was zum Verlust von Profil-Informationsgehalt führt, wenn sich dieser
Benutzer wieder an der neueren Version von MS Windows anmeldet.</para>

<para>
Wenn Sie dasselbe Startmenü bzw. denselben Desktop mit W9x/Me teilen wollen, müssen Sie einen gemeinsamen Ort 
für die Profile angeben. Die Parameter in &smb.conf;, die gleich sein müssen, sind
<smbconfoption><name>logon path</name></smbconfoption> und
<smbconfoption><name>logon home</name></smbconfoption>. </para>

<para>
Wenn Sie dies korrekt eingerichtet haben, werden Sie separate  <filename>user.DAT</filename>-
und <filename>NTuser.DAT</filename>-Dateien im selben Profil-Verzeichnis vorfinden.</para>

</sect2>

<sect2>
<title>Migration von Profilen von Windows NT4/200x Server zu Samba</title>

<para>
Es gibt nichts, was Sie davon abhält, jeglichen beliebigen Pfad für die Benutzer-Profile anzugeben.
Daher könnten Sie bestimmen, dass das Profil auf einem Samba-Server oder auf 
irgendeinem anderen SMB-Server gespeichert werden soll, solange dieser Server verschlüsselte Passwörter unterstützt.</para>

<sect3>
<title>Windows NT4-Werkzeuge zur Profil-Verwaltung</title>

<para>
Leider sind die Informationen zum Resource Kit für die Version von
MS Windows NT4/200x spezifisch. Das passende Resource Kit ist für jede Plattform erforderlich.</para>

<para>Hier eine Kurz-Anleitung:</para>

<procedure>
	<step><para>Klicken Sie auf Ihrem NT4-Domänencontroller mit der rechten Maustaste auf
	<guiicon>Arbeitsplatz</guiicon>, dann wählen Sie den Tab namens
	<guilabel>Benutzerprofile</guilabel>. </para></step>

	<step><para>Wählen Sie das Benutzerprofil, das Sie migrieren wollen, und klicken Sie darauf.
	</para>

	<note><para>Ich verwende den Begriff <quote>migrieren</quote> nicht sehr streng.
	Sie können ein Profil kopieren, um ein Gruppen-Profil anzulegen. Sie können dem Benutzer
	<parameter>Jeder</parameter> Rechte an dem Profil geben, auf das Sie kopieren. Dies
	müssen Sie tun, da Ihre Samba-Domäne kein Mitglied einer Vertrauensstellung mit Ihrem PDC
	ist.</para></note></step>

	<step><para>Klicken Sie auf <guibutton>Kopieren nach</guibutton>.</para></step>

	<step><para>In dem Feld namens <guilabel>Kopieren nach</guilabel> geben Sie den neuen Pfad an, z.B.,
	<filename>c:\temp\foobar</filename></para></step>

	<step><para>Klicken Sie auf <guibutton>Ändern</guibutton> im Feld <guilabel>Benutzer</guilabel>.</para></step>

	<step><para>Klicken Sie auf die Gruppe <quote>Jeder</quote>, dann auf <guibutton>OK</guibutton>.
	Dies schliesst die Box 
	<quote>Benutzer oder Gruppe wählen</quote>.</para></step>

	<step><para>Jetzt klicken Sie auf <guibutton>OK</guibutton>.</para></step>
</procedure>

<para>Befolgen Sie obige Anleitung für jedes Profil, das Sie migrieren müssen.</para>

</sect3>

<sect3>
<title>Randbemerkungen</title>


<para>
<indexterm><primary>SID</primary></indexterm>
Sie sollten sich die SID Ihrer NT4-Domäne besorgen, dazu können Sie smbpasswd verwenden.
Lesen Sie dazu die Manpage.</para>

</sect3>

<sect3> <title>moveuser.exe</title>

<para>
Das Windows 200x Professional Resource Kit enthält <command>moveuser.exe</command>.
<command>moveuser.exe</command> verschiebt die Sicherheitseinstellungen eines Profils von einem Benutzer auf einen
anderen. Dies erlaubt es, die Domäne des Kontos und/oder den Benutzernamen zu ändern.</para>

<para>
Dieser Befehl ist dem Samba-Befehl <command>profiles</command> ähnlich.
</para>

</sect3>

<sect3>
<title>Die SID erhalten</title>

<para>
<indexterm><primary>SID</primary></indexterm>
Sie können die SID bestimmen, indem Sie das Programm <command>GetSID.exe</command> aus dem
Windows NT Server 4.0 Resource Kit verwenden.</para>

<para>Windows NT 4.0 speichert die lokalen Profil-Informationen an folgender Stelle in der Registry:
<filename>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList</filename> </para>

<para>
Im Schlüssel <quote>ProfileList</quote> gibt es Sub-Schlüssel, die nach den SIDs der Benutzer benannt sind, die
sich an diesem Computer angemeldet haben. (Um die Informationen zu dem Benutzer zu finden, dessen
lokal zwischengespeichertes Profil Sie verschieben wollen, bestimmen Sie dessen SID mit dem Werkzeug
<command>GetSID.exe</command>.) Innerhalb des entsprechenden Sub-Schlüssel des Benutzers werden Sie
einen String-Wert namens <parameter>ProfileImagePath</parameter> finden.</para>

</sect3> </sect2> </sect1>

<sect1> <title>Zwingende Profile</title>

<para>
<indexterm><primary>mandatory profiles</primary></indexterm>
Ein zwingendes Profil (<quote>Mandatory Profile</quote>) ist ein Profil, 
das der Benutzer nicht überschreiben kann.
Während der einzelnen Sitzung des Benutzers sind Änderungen an der Desktop-Umgebung möglich, jedoch
sind alle diese Änderungen beim Abmelden des Benutzers verloren. Wenn es erwünscht ist, dem Benutzer
keinerlei Möglichkeit zur Veränderung der Desktop-Umgebung zu erlauben, muß dies durch Setzen von
Richtlinien erfolgen. Lesen Sie dazu das vorhergehende Kapitel. </para>

<note><para>
Das Profil-Verzeichnis (oder dessen Inhalte) sollten unter KEINEN Umständen read-only gesetzt werden,
da dies das Profil unbenutzbar machen kann. Wo es essenziell wichtig ist, ein Profil innerhalb des
UNIX-Dateisystems read-only zu setzen, kann dies gemacht werden. In diesem Fall müssen Sie jedoch
UNBEDINGT das VFS-Modul <command>fake-permissions</command> benutzen, um die MS Windows NT/200x/XP-Clients anzuweisen, dass der Benutzer Schreibberechtigung hat (siehe <link linkend="fakeperms"/>).
</para></note>

<para>
Für MS Windows NT4/200x/XP kann die obige Methode auch zum Anlegen zwingender Profile verwendet
werden. Um ein Gruppen-Profil in ein zwingendes Profil umzuwandeln, suchen Sie einfach nach der Datei
<filename>NTUser.DAT</filename> im kopierten Profil und benennen sie in 
<filename>NTUser.MAN</filename> um.</para>

<para>
Für MS Windows 9x/ME ist es die Datei <filename>User.DAT</filename>, die in
<filename>User.MAN</filename> umbenannt werden muss, um ein zwingendes Profil zu erhalten.</para>

</sect1>

<sect1>
<title>Das Anlegen und Verwalten von Gruppen-Profilen</title>

<para>
<indexterm><primary>group profiles</primary></indexterm>
Die meisten Organisationen sind in Abteilungen gegliedert. Ein angenehmer Nebeneffekt dieser Tatsache ist,
dass üblicherweise die meisten Benutzer innerhalb einer Abteilung dieselben Desktop-Anwendungen
und dasselbe Desktop-Layout benötigen. MS Windows NT4/200x/XP erlaubt die Verwendung von 
Gruppen-Profilen. Ein Gruppen-Profil ist ein Profil, das ursprünglich unter Verwendung eines
Beispiel-Anwenders angelegt wird. Danach werden unter Verwendung des Profil-Migrations-Tools
(siehe oben) dem Profil Rechte für diejenige Benutzergruppe zugewiesen, die Zugriff auf das
Gruppen-Profil benötigt.</para>

<para>
Der nächste Schritt ist wichtig: Anstatt das Gruppen-Profil Benutzern auf einer
<quote>per user</quote>-Basis zuzuweisen (mittels User Manager), wird die Gruppe selbst dem nunmehr
modifizierten Profil zugewiesen.</para>

<note>
<para>
Seien Sie vorsichtig mit Gruppen-Profilen. Wenn der Benutzer, der Mitglied der Gruppe ist, auch ein
persönliches Profil hat, wird das Ergebnis eine Vereinigung (Merge) dieser beiden Profile sein.</para>
</note>

</sect1>

<sect1>
<title>Standard-Profile für Windows-Benutzer</title>

<para>
<indexterm><primary>default profile</primary></indexterm>
MS Windows 9x/Me und NT4/200x/XP benutzen ein Standard-Profil für jeden Benutzer, für den noch kein
Profil existiert. Wenn man weiß, wo das Standard-Profil auf einer Windows-Workstation
zu finden ist und welche Registrierungs-Schlüssel den Pfad beeinflussen, aus dem heraus das
Standard-Profil angelegt wird, ist es möglich, das Standard-Profil für die jeweilige Installation
zu optimieren. Dies hat signifikante administrative Vorteile.</para>

<sect2>
<title>MS Windows 9x/Me</title>

<para>Um Standard-Benutzer-Profile in Windows 9x/ME zu aktivieren, können Sie entweder den
<application>Windows 98 System Policy Editor</application> verwenden oder die Registry direkt
ändern.</para>

<para>Um Standard-Benutzer-Profile in Windows 9x/ME zu aktivieren, öffnen Sie den
<application>System Policy Editor</application>, dann wählen Sie
<guimenu>Datei</guimenu> -> <guimenuitem>Registrierung öffnen</guimenuitem>. Als Nächstes klicken
Sie auf das Icon <guiicon>Lokaler Computer</guiicon>, klicken auf <guilabel>Windows 98 System</guilabel>,
wählen <guilabel>Benutzer-Profile</guilabel> und klicken auf die Aktivieren-Box. Vergessen Sie
nicht, die Registry-Änderungen zu speichern.</para>


<para>Zum direkten Modifizieren der Registry öffnen Sie den 
<application>Registrierungs-Editor</application> (<command>regedit.exe</command>) und wählen den Abschnitt <filename>HKEY_LOCAL_MACHINE\Network\Logon</filename>. Nun fügen Sie einen Wert vom Typ
DWORD mit dem Namen <quote>User Profiles</quote> hinzu. Um Benutzerprofile zu aktivieren, setzen Sie
ihn auf 1; um diese zu deaktivieren, setzen Sie ihn auf den Wert 0.</para>

<sect3>
<title>Behandlung von Benutzerprofilen mit Windows 9x/Me</title>

<para>Wenn sich ein Benutzer an einer Windows 9x/Me-Maschine anmeldet, wird der lokale Profilpfad
<filename>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\ProfileList</filename> daraufhin überprüft, ob ein
Eintrag für diesen Benutzer existiert.</para>

<para>Wenn der Benutzer einen Eintrag in diesem Registrierungsabschnitt hat, prüft Windows 9x/Me, ob eine
lokal gepufferte Version des Benutzerprofils vorhanden ist. Windows 9x/Me prüft auch das 
Home-Verzeichnis des Benutzers (oder ein anderes angegebenes Verzeichnis, wenn diese Angabe verändert
wurde) auf dem Server auf Vorhandensein des Profils. Wenn ein Profil an beiden Orten existiert, wird
die neuere Version verwendet. Wenn das Benutzerprofil auf dem Server existiert, aber nicht auf der
lokalen Maschine, wird das Profil vom Server geladen und verwendet. Wenn es nur auf der lokalen
Maschine existiert, wird diese Kopie verwendet.</para>

<para>Wenn an keinem der beiden Orte ein Benutzerprofil gefunden wird, wird das Standard-Benutzer-Profil
der Windows 9x/Me-Maschine verwendet und in einen neu angelegten Ordner für den angemeldeten Benutzer
kopiert. Beim Abmelden werden alle vorgenommenen Änderungen des Benutzers in sein lokales Profil
geschrieben. Wenn der Benutzer ein <quote>Roaming Profile</quote> hat, werden die Änderungen in sein Profil auf
dem Server geschrieben.</para>

</sect3> </sect2>

<sect2>
<title>MS Windows NT4 Workstation</title>

<para>Unter MS Windows NT4 wird das Standard-Benutzer-Profil aus 
<filename>%SystemRoot%\Profiles</filename> bezogen, das in einer Standard-Installation
<filename>C:\Windows NT\Profiles</filename> entspricht. Unter diesem Verzeichnis gibt es in einer
herkömmlichen sauberen Installation drei Verzeichnisse: <filename>Administrator</filename>, <filename>All Users</filename> und <filename>Default User</filename>. </para>

<para>
Das Verzeichnis <filename>All Users</filename> enthält Menü-Einstellungen, die für alle System-Benutzer
gleich sind. Das Verzeichnis <filename>Default User</filename> enthält Menü-Einträge, die - abhängig von den gewählten oder angelegten Profil-Einstellungen - an den jeweiligen Benutzer angepasst werden können.</para>

<para>Wenn sich ein neuer Benutzer zum ersten Mal an einer MS Windows NT4-Maschine anmeldet, wird
ein neues Profil angelegt, das sich wie folgt zusammensetzt:</para>

<itemizedlist>
	<listitem><para>All Users-Einstellungen</para></listitem>
	<listitem><para>Default User-Einstellungen (sie enthalten die Standard-Datei <filename>NTUser.DAT</filename>)</para></listitem>
</itemizedlist>

<para>Wenn sich ein Benutzer an einer MS Windows NT4-Maschine anmeldet, die Mitglied einer MS-Domäne ist, werden die folgenden Schritte in Bezug auf Profile durchlaufen:

<indexterm><primary>NTConfig.POL</primary></indexterm>
</para>


<procedure>
	<step> <para>
	Die Information bezüglich des Benutzerkontos, die während dem Anmelde-Vorgang erhalten wird,
	enthält den Ort, an dem das Desktop-Profil des Benutzers aufbewahrt wird. Der Profil-Pfad
	kann lokal auf der Maschine liegen oder auf einer Netzwerk-Freigabe. Wenn ein Profil in dem
	vom Benutzer-Konto angegebenen Pfad existiert, wird es auf 
	<filename>%SystemRoot%\Profiles\%USERNAME%</filename> kopiert. Dieses Profil erbt dann die
	Einstellungen im <filename>All Users</filename>-Profil in 
	<filename>%SystemRoot%\Profiles</filename>.</para> </step>

	<step> <para>
	Wenn das Benutzerkonto einen Profil-Pfad hat, aber dort kein Profil existiert, wird ein neues
	Profil in <filename>%SystemRoot%\Profiles\%USERNAME%</filename> angelegt. Dazu wird
	das Profil <filename>Default User</filename> verwendet.</para> </step>

	<step> <para>
	Wenn die Freigabe NETLOGON auf dem authentifizierenden Server (Logon-Server) eine
	Richtlinien-Datei (<filename>NTConfig.POL</filename>) enthält, werden dessen Inhalte auf die Datei
	<filename>NTUser.DAT</filename> angewandt, die wiederum auf den Abschnitt
	<filename>HKEY_CURRENT_USER</filename> der Registrierung angewandt wird.</para> </step>

	<step> <para>
	Beim Abmelden des Benutzers wird, wenn das Profil ein <quote>Roaming Profile</quote> ist, das Profil
	in den Profil-Pfad geschrieben. Die Datei <filename>NTuser.DAT</filename> wird dann neu
	aus den Inhalten von <filename>HKEY_CURRENT_USER</filename> angelegt.
	Daher wird, falls beim nächsten Anmelden
	in der NETLOGON-Freigabe keine Datei <filename>NTConfig.POL</filename> existiert, die
	Auswirkung der vorigen Datei <filename>NTConfig.POL</filename> nach wie vor im Profil behalten.
	Diesen Effekt bezeichnet man als <quote>Tattooing</quote>.</para> </step>
</procedure>

<para>
MS Windows NT4-Profile können <emphasis>lokal</emphasis> oder <emphasis>roaming</emphasis> sein.
Ein lokales Profil wird in <filename>%SystemRoot%\Profiles\%USERNAME%</filename> gespeichert. Ein
<quote>Roaming Profile</quote> wird auch in derselben Art gespeichert, es sei denn, der folgende Registrierungsschlüssel
wird wie folgt angelegt:</para>

<para><screen>HKEY_LOCAL_MACHINE\SYSTEM\Software\Microsoft\Windows NT\CurrentVersion\winlogon\"DeleteRoamingCache"=dword:0000000
</screen>
In diesem Fall wird die lokale Kopie (in <filename>%SystemRoot%\Profiles\%USERNAME%</filename>)
beim Abmelden gelöscht.</para>

<para>Unter MS Windows NT4 können Standard-Pfade für allgemeine Ressourcen wie <filename>Eigene
Dokumente</filename> auf eine Netzwerk-Freigabe umgeleitet werden, indem man die folgenden
Registrierungs-Schlüssel ändert. Diese Änderungen können durch Verwendung des System Policy Editor
vorgenommen werden. Dazu müssen Sie Ihre eigene Vorlage für den Policy Editor anlegen, um
diese Änderungen per GUI zu erlauben. Eine andere Möglichkeit, dies zu tun, besteht darin, zuerst ein
Standard-Benutzer-Profil anzulegen und dann, während man als anderer Benutzer angemeldet ist,
<command>regedt32</command> auszuführen, um die Schlüssel zu editieren.</para>

<para>
Der Registrierungsschlüssel, der das Verhalten der Ordner beeinflusst, die Teil des Standard-Benutzer-
Profils sind, lautet unter Windows NT4:
<screen>
HKEY_CURRENT_USER
	\Software
		\Microsoft
			\Windows
				\CurrentVersion
					\Explorer
						\User Shell Folders
</screen>
<indexterm><primary>windows registry settings</primary><secondary>default profile locations</secondary></indexterm>
</para>

<para>
Der obige Schlüssel enthält eine Liste von automatisch verwalteten Ordnern. Die Standard-Einträge
werde in <link linkend="ProfileLocs"/> gezeigt.</para>

<table frame="all" id="ProfileLocs">
	<title>Standard-Werte der Registrierungsschlüssel für Benutzer-Ordner</title>
	<tgroup cols="2">
		<colspec align="left"/>
		<colspec align="left"/>
	<thead>
		<row><entry>Name</entry><entry>Standard-Wert</entry></row>
	</thead>
	<tbody>
		<row><entry>AppData</entry><entry>%USERPROFILE%\Anwendungsdaten</entry></row>
		<row><entry>Desktop</entry><entry>%USERPROFILE%\Desktop</entry></row>
		<row><entry>Favorites</entry><entry>%USERPROFILE%\Favoriten</entry></row>
		<row><entry>NetHood</entry><entry>%USERPROFILE%\Netzwerkumgebung</entry></row>
		<row><entry>PrintHood</entry><entry>%USERPROFILE%\Druckumgebung</entry></row>
		<row><entry>Programs</entry><entry>%USERPROFILE%\Startmenü\Programme</entry></row>
		<row><entry>Recent</entry><entry>%USERPROFILE%\Zuletzt verwendete Dokumente</entry></row>
		<row><entry>SendTo</entry><entry>%USERPROFILE%\SendTo</entry></row>
		<row><entry>Start Menu</entry><entry>%USERPROFILE%\Startmenü</entry></row>
		<row><entry>Startup</entry><entry>%USERPROFILE%\Startmenü\Programme\Autostart</entry></row>
	</tbody>
	</tgroup>
</table>

<para>Der Registrierungsschlüssel, der den Ort der Standard-Profil-Einstellungen enthält, ist:</para>

<para> <filename>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\
User Shell Folders</filename> </para>

<para>Die Standard-Einträge werden in <link linkend="regkeys"/> gezeigt.</para>

<table frame="all" id="regkeys">
	<title>Standardwerte der Registrierungsschlüssel für Profil-Einstellungen</title>
	<tgroup cols="2">
		<colspec align="left"/>
		<colspec align="left"/>
	<tbody>
		<row><entry>Gemeinsamer Desktop</entry><entry>%SystemRoot%\Profiles\All Users\Desktop</entry></row>
		<row><entry>Gemeinsame Programme</entry><entry>%SystemRoot%\Profiles\All Users\Programme</entry></row>
		<row><entry>Gemeinsames Startmenü</entry><entry>%SystemRoot%\Profiles\All Users\Startmenü</entry></row>
		<row><entry>Gemeinsames Autostart</entry><entry>%SystemRoot%\Profiles\All Users\Startmenü\Programme\Startup</entry></row>
	</tbody>
	</tgroup>
</table>

</sect2>

<sect2> <title>MS Windows 200x/XP</title>

<note><para>
<indexterm><primary>GPOs</primary></indexterm>
MS Windows XP Home Edition verwendet standardmäßig Per-Benutzer-Profile, aber kann nicht an
Domänen teilnehmen, sich nicht an NT/ADS-Domänen anmelden und kann daher das Profil nur von sich selbst
beziehen. Während dies Vorteile hat, erlaubt es die <quote>Schönheit</quote> jener MS Windows-Clients, die an
Domänen-Anmeldevorgängen teilnehmen können, dem Administrator, ein globales Standard-Profil anzulegen und dessen Verwendung mit Hilfe von Gruppenrichtlinien (GPOs) zu erzwingen.
</para></note>

<para>Wenn sich ein neuer Benutzer zum ersten Mal an einer MS Windows 200x/XP-Maschine anmeldet, wird das
Standard-Profil aus <filename>C:\Dokumente und Einstellungen\Default User</filename> geladen. Der
Administrator kann die dortigen Inhalte modifizieren, und MS Windows 200x/XP wird diese verwenden. Dies
ist nicht gerade optimal, da es bedeutet, dass man ein neues Standard-Profil auf jede
MS Windows 200x/XP-Client-Workstation kopieren muss.</para>

<para>Wenn MS Windows 200x/XP an einem Domänen-Kontext teilnimmt und das Standard-Benutzer-Profil nicht
gefunden wird, sucht der Client nach einem Standard-Profil in der NETLOGON-Freigabe des authentifizierenden
Servers. In MS Windows-Begriffen handelt es sich um 
<?latex \linebreak ?><filename>%LOGONSERVER%\NETLOGON\Default User,</filename> und wenn ein solches
existiert, wird der Client es auf die Workstation kopieren, und zwar in das Verzeichnis
<filename>C:\Dokumente und Einstellungen\</filename> unter dem Login-Namen des Benutzers.</para>

<note><para>Dieser Pfad entspricht, in Samba-Begriffen, der Freigabe
<smbconfsection>[NETLOGON]</smbconfsection> in &smb.conf;. Das Verzeichnis sollte im Wurzelverzeichnis
dieser Freigabe angelegt werden und muss <filename>Default Profile</filename> heißen.</para></note>

<para>Wenn an diesem Ort kein Standard-Profil existiert, wird MS Windows 200x/XP das lokale
Standard-Profil verwenden.</para>

<para>Beim Abmelden wird das Desktop-Profil des Benutzers an dem Ort abgespeichert, der in den
Registrierungs-Einstellungen für diesen Benutzer gesetzt ist. Wenn keine spezifischen Richtlinien
angelegt oder während der Anmeldung an den Client weitergegeben worden sind (wie es Samba automatisch
tut), dann wird das Benutzerprofil nur auf der lokalen Maschine unter
<filename>C:\Dokumente und Einstellungen\%USERNAME%</filename> abgelegt.</para>



<para>Jene, die dieses Standard-Verhalten verändern wollen, können dies auf drei Arten tun:</para>

<itemizedlist>
	<listitem> <para>
	Manuelles Ändern der Registrierungsschlüssel auf der lokalen Maschine und das Platzieren
	des Standard-Profils im Wurzelverzeichnis der NETLOGON-Freigabe. Dies wird nicht empfohlen,
	da es sehr wartungsintensiv ist.
	</para> </listitem>

        <listitem> <para>
	Anlegen einer NT4-artigen Datei <filename>NTConfig.POL</filename>, die dieses Verhalten spezifiziert, und das
	Platzieren dieser Datei im Wurzelverzeichnis der NETLOGON-Freigabe neben dem neuen
	Standard-Profil.
	</para> </listitem>

	<listitem> <para>
	Anlegen einer Gruppenrichtline (GPO), die das Verhalten per Active Directory erzwingt,
	und das Platzieren des neuen Standard-Profils in der NETLOGON-Freigabe.
	</para> </listitem>
</itemizedlist>

<para>Der Registrierungsschlüssel, der das Verhalten der Ordner beeinflusst, die Bestandteil des
Standard-Benutzer-Profils sind, ist unter Windows 200x/XP: </para>

<para> <filename>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell
Folders\</filename> </para>

<para>Der obige Schlüssel enthält eine Liste von automatisch verwalteten Ordnern. Die Standard-Einträge
werden in <link linkend="defregpthkeys"/>
<indexterm><primary>windows registry settings</primary><secondary>default profile locations</secondary></indexterm>
gezeigt.
</para>


<table frame="all" id="defregpthkeys">
	<title>Pfade des Standard-Profils: Standard-Werte der Registrierungsschlüssel</title>
	<tgroup cols="2">
		<colspec align="left"/>
		<colspec align="left"/>
	<thead>
		<row><entry>Name</entry><entry>Standard-Wert</entry></row>
	</thead>
	<tbody>
		<row><entry>AppData</entry><entry>%USERPROFILE%\Anwendungsdaten</entry></row>
		<row><entry>Cache</entry><entry>%USERPROFILE%\Lokale Einstellungen\Temporary Internet Files</entry></row>
		<row><entry>Cookies</entry><entry>%USERPROFILE%\Cookies</entry></row>
		<row><entry>Desktop</entry><entry>%USERPROFILE%\Desktop</entry></row>
		<row><entry>Favorites</entry><entry>%USERPROFILE%\Favoriten</entry></row>
		<row><entry>History</entry><entry>%USERPROFILE%\Lokale Einstellungen\Verlauf</entry></row>
		<row><entry>Local AppData</entry><entry>%USERPROFILE%\Lokale Einstellungen\Anwendungsdaten</entry></row>
		<row><entry>Local Settings</entry><entry>%USERPROFILE%\Lokale Einstellungen</entry></row>
		<row><entry>My Pictures</entry><entry>%USERPROFILE%\Eigene Dokumente\Eigene Bilder</entry></row>
		<row><entry>NetHood</entry><entry>%USERPROFILE%\Netzwerkumgebung</entry></row>
		<row><entry>Personal</entry><entry>%USERPROFILE%\Eigene Dokumente</entry></row>
		<row><entry>PrintHood</entry><entry>%USERPROFILE%\Druckumgebung</entry></row>
		<row><entry>Programs</entry><entry>%USERPROFILE%\Startmenü\Programme</entry></row>
		<row><entry>Recent</entry><entry>%USERPROFILE%\Verlauf</entry></row>
		<row><entry>SendTo</entry><entry>%USERPROFILE%\SendTo</entry></row>
		<row><entry>Start Menu</entry><entry>%USERPROFILE%\Startmeüu</entry></row>
		<row><entry>Startup</entry><entry>%USERPROFILE%\Startmenü\Programme\Autostart</entry></row>
		<row><entry>Templates</entry><entry>%USERPROFILE%\Vorlagen</entry></row>
	</tbody>
	</tgroup>
</table>

<para>Es gibt auch einen Eintrag namens <quote>Default</quote>, der keinen Wert gesetzt hat. Der 
Standard-Eintrag ist vom Typ <constant>REG_SZ</constant>, alle anderen sind vom Typ
<constant>REG_EXPAND_SZ</constant>.</para>


<para>Es macht einen riesigen Unterschied in Bezug auf die Geschwindigkeit, mit der man 
<quote>Roaming Profiles</quote> verwenden kann, wenn all die notwendigen Ordner an einem dafür bestimmten Ort auf
einem Netzwerk-Server abgelegt werden. Das bedeutet, dass es nicht mehr notwendig ist, bei jedem
An- und Abmelden die Outlook-PST-Datei über das Netzwerk zu schreiben.</para>

<para>Um dies auf einen Netzwerk-Pfad zu ändern, könnten Sie folgende Beispiele verwenden:</para>

<para><filename>%LOGONSERVER%\%USERNAME%\Standard Ordner</filename></para>

<para>Dies würde die Ordner im Home-Verzeichnis des Benutzers ablegen, und zwar in einem Ordner namens
<filename>Standard Ordner</filename>. Sie könnten auch das verwenden:</para>

<para><filename>\\<replaceable>SambaServer</replaceable>\<replaceable>OrdnerFreigabe</replaceable>\%USERNAME%</filename></para>

<para>
In diesem Fall werden die Standard-Ordner auf dem Server namens <replaceable>SambaServer</replaceable>
 in der Freigabe <replaceable>OrdnerFreigabe</replaceable> gespeichert, und zwar unter einem Verzeichnis, das
den Namen des Windows-Benutzers hat, wie er vom Linux/UNIX-Dateisystem aus gesehen wird.</para>

<para>Bitte beachten Sie, dass Sie, sobald Sie eine Standard-Profil-Freigabe angelegt haben, das
Benutzer-Profil darauf migrieren MÜSSEN (egal ob es ein Standard- oder angepasstes Profil ist).</para>



<para>MS Windows 200x/XP-Profile können <emphasis>Local</emphasis> oder <emphasis>Roaming</emphasis>
sein. Ein <quote>Roaming Profile</quote> wird lokal gepuffert (Cache), außer der folgende Registrierungsschlüssel
wird angelegt:

<indexterm><primary>delete roaming profiles</primary></indexterm>
</para>


<para> <programlisting> HKEY_LOCAL_MACHINE\SYSTEM\Software\Microsoft\Windows NT\CurrentVersion\
	winlogon\"DeleteRoamingCache"=dword:00000001</programlisting></para>

<para>
In diesem Fall wird die lokale Cache-Kopie beim Abmelden gelöscht.
</para> 
</sect2> 
</sect1>

<sect1> <title>Gängige Fehler</title>

<para>Im Folgenden werden typische Fehler, Probleme und Fragen beschrieben, die in den Samba-Mailing-Listen gestellt wurden.</para>

<sect2>
<title>Das Konfigurieren von <quote>Roaming Profiles</quote> für einige wenige Benutzer oder Gruppen</title>

<para>
Mit Samba-2.2.x haben Sie die Wahl, die Unterstützung von Roaming Profiles zu aktivieren oder
zu deaktivieren. Die Voreinstellung ist, Roaming Profiles zu haben, und der Standard-Pfad wird
diese im Home-Verzeichnis des Benutzers suchen.</para>

<para>Falls diese global deaktiviert sind, hat kein Benutzer die Fähigkeit, Roaming Profiles zu
verwenden. Wenn diese aktiviert sind und Sie sie nur auf bestimmte Maschinen anwenden wollen, ist
es notwendig, auf jenen Maschinen, die keine Unterstützung für Roaming Profiles bieten sollen, diese
Unterstützung in der Registrierung jeder einzelnen dieser Maschinen zu deaktivieren.</para>

<para>Mit Samba-3 können Sie eine globale Profil-Einstellung in der &smb.conf; haben, und Sie können
diese aufheben, indem Sie Per-Benutzer-Einstellungen mit dem Domain User Manager setzen (wie bei
MS Windows NT4/ Win 200xx).</para>

<para>In jedem Fall können Sie nur ein Profil pro Benutzer konfigurieren. Dieses Profil kann sein:</para>

<itemizedlist>
	<listitem>Ein Profil, das einzigartig für diesen Benutzer ist</listitem>
	<listitem>Ein zwingendes Profil (eines, das der Benutzer nicht ändern kann)</listitem>
	<listitem>Ein Gruppen-Profil (es sollte wirklich zwingend sein, also unveränderbar)</listitem>
</itemizedlist>

</sect2>

<sect2> <title>Ich kann keine Roaming Profiles verwenden</title>

<para>Ein Benutzer fragte Folgendes: <quote>Ich will keine Roaming Profiles implementieren. Ich möchte
den Benutzern nur ein lokales Profil geben. Bitte helfen Sie mir, ich bin verloren ... Seit zwei Tagen
versuche ich alles, google herum, aber finde keine hilfreichen Anhaltspunkte. Bitte um Hilfe!
</quote></para>

<para>Die Möglichkeiten sind:</para>

<variablelist>
	<varlistentry>
		<term>Lokale Profile</term> <listitem><para>Ich kenne keine 
		Registrierungseinstellungen, die das automatische Löschen von LOKALEN Profilen
		beim Abmelden erlauben.</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>Roaming Profiles</term> <listitem><para>Wenn sich ein Benutzer an einem Netzwerk
		anmeldet, wird ein zentral gespeichertes Profil auf die Workstation kopiert, um ein
		lokales Profil zu bilden. Dieses lokale Profil bleibt bestehen (verbleibt auf der Platte
		der Workstation), es sei denn, ein Registrierungsschlüssel wird geändert, der das 
		automatische Löschen dieses Profils beim Abmelden veranlasst.</para></listitem>
	</varlistentry>
</variablelist>

<para>Die Möglichkeiten mit Roaming Profiles sind: </para>

<variablelist>
	<varlistentry>
		<term>Persönliche Roaming Profiles</term> <listitem><para>Diese werden üblicherweise
		in einer Profil-Freigabe auf einem zentralen (oder einem praktisch gelegenen lokalen)
		Server gespeichert.</para>

		<para>Workstations cachen (speichern) eine lokale Kopie des Profils.
		Diese gepufferte Kopie wird verwendet, wenn das Profil beim nächsten Anmelden nicht
		geladen werden kann.</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>Gruppen-Profile</term> <listitem><para>Diese werden von einem zentralen
		Profil-Server geladen.</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>Zwingende Profile</term> <listitem><para>Zwingende Profile können genauso für
		einen einzelnen Benutzer angelegt werden wie auch für jede Gruppe, deren Mitglied
		ein Benutzer ist. Zwingende Profile können nicht von einfachen Benutzern geändert
		werden. Nur der Administrator kann diese ändern oder neu konfigurieren.</para></listitem>
	</varlistentry>
</variablelist>

<para>Ein Windows NT4/200x/XP-Profil kann in seiner Größe variieren - von 130 Kbyte bis zu einem sehr großen
Umfang. Outlook-PST-Dateien sind meistens Teil des Profils und können viele Gbyte groß sein. Im 
Durchschnitt (in einer gut verwalteten Umgebung) ist ein Roaming Profile von 2 Mbyte ein guter Richtwert
für Planungszwecke. In einem undisziplinierten Umfeld habe ich bereits Profile von bis zu 2 Gbyte
gesehen. Benutzer neigen dazu, sich zu beschweren, wenn es eine Stunde dauert, sich an einer Workstation
anzumelden, jedoch ernten sie nur die Früchte von Unverstand (und Ignoranz).</para>

<para>Das bisher Erwähnte soll vor allem zeigen, dass Roaming Profiles, sowie eine gute
Kontrolle darüber, wie diese verändert werden können, neben guter Disziplin wesentlich zu einer
problemfreien Installation beitragen.</para>

<para>Microsofts Antwort auf das PST-Problem ist, alle E-Mail-Daten in einem MS Exchange Server-Backend
zu speichern. Dies macht eine PST-Datei überflüssig.</para>

<para>Lokale Profile bedeuten:</para>

<itemizedlist>
	<listitem><para>Wenn jede Maschine von vielen Benutzern verwendet wird, wird auch viel lokaler
	Speicherplatz für die Profile benötigt.</para></listitem> <listitem><para>Jede Workstation, an
	der sich der Benutzer anmeldet, hat ein eigenes Profil für ihn; diese Profile können sehr
	stark voneinander abweichen.</para></listitem>
</itemizedlist>

<para>Auf der anderen Seite bedeutet der Einsatz von Roaming Profiles:</para>

<itemizedlist>
	<listitem><para>Der Netzwerk-Administrator kann die Desktop-Umgebung aller Benutzer 
	kontrollieren.</para></listitem> 

	<listitem><para>Die Verwendung von zwingenden Profilen reduziert drastisch etwaige
	Overheads im Netzwerk-Management.</para></listitem>

	<listitem><para>Auf lange Sicht haben die Benutzer weniger Probleme damit.</para></listitem>

</itemizedlist>

</sect2>

<sect2>
<title>Das Standard-Profil verändern</title>

<para><quote>Wenn sich der Client am Domänen-Controller anmeldet, sucht er ein Profil zum Download.
Wohin stelle ich dieses Standard-Profil?</quote></para>

<para>
<indexterm><primary>Standard-Profil</primary></indexterm>
Zuerst muss der Samba-Server als ein Domänen-Controller konfiguriert werden. Dies erfolgt durch 
Einstellungen in der &smb.conf;:</para>

<smbconfblock>
<smbconfoption><name>security</name><value>user</value></smbconfoption>
<smbconfoption><name>os level</name><value>32 (or more)</value></smbconfoption>
<smbconfoption><name>domain logons</name><value>Yes</value></smbconfoption>
</smbconfblock>

<para>Es muss eine Freigabe namens <smbconfsection>[netlogon]</smbconfsection> geben, die world-readable
ist. Es ist generell eine gute Idee, ein Start-Skript hinzuzufügen, das Drucker- und 
Laufwerksverbindungen vorbereitet. Es gibt außerdem eine Einrichtung zum automatischen Synchronisieren
der Workstation-Uhr mit der des Anmelde-Servers (eine weitere gute Idee, dies zu verwenden).</para>

<note><para>Um das automatische Löschen der Roaming Profiles aus dem lokalen Cache der Workstation
(Festplatte) zu aktivieren, verwenden Sie den <application>Group Policy Editor</application>, mit dem Sie eine
Datei namens <filename>NTConfig.POL</filename> mit den passenden Einträgen erstellen. Diese Datei
muss im Wurzelverzeichnis der Freigabe <smbconfsection>netlogon</smbconfsection> platziert werden.
</para></note>

<para>Windows-Clients müssen Domänen-Mitglieder sein. Arbeitsgruppen-Maschinen benutzen keine
Netzwerk-Anmeldungen, also arbeiten sie auch nicht mit Domänen-Profilen zusammen.</para>

<para>Für Roaming Profiles fügen Sie Folgendes zur &smb.conf; hinzu:</para>

<smbconfblock>
<smbconfoption><name>logon path</name><value>\\%N\profiles\%U</value></smbconfoption>
<smbconfcomment>Standard-Anmelde-Laufwerk ist Z:</smbconfcomment>
<smbconfoption><name>logon drive</name><value>H:</value></smbconfoption>
<smbconfcomment>Dies erfordert eine PROFILES-Freigabe, die world-writable ist.</smbconfcomment>
</smbconfblock>

</sect2>
</sect1>
</chapter>

<?xml version="1.0" encoding="ISO-8859-1"?>
<chapter id="ProfileMgmt">
<chapterinfo>
	&author.jht;
    <pubdate>April 3 2003</pubdate>
<author>&author.sgw;<contrib>Deutsche Übersetzung</contrib></author>
</chapterinfo>

<title>Das Management von Desktop-Profilen</title>

<sect1>
<title>Eigenschaften und Vorzüge</title>

<para>
Sogenannte "Roaming Profiles" (zu Deutsch etwa "servergespeicherte Benutzerprofile") 
werden von manchen gefürchtet, von einigen gehasst, von vielen geliebt,
und sind ein Geschenk des Himmels für so manchen Administrator.
</para>

<para>
Roaming Profiles erlauben es einem Administrator, dem Benutzer einen konsistenten Desktop
zur Verfügung stellen, wenn er sich von einer Maschine zu einer anderen bewegt. Dieses
Kapitel stellt Informationen zur Verfügung, wie man Roaming Profiles konfiguriert und
verwaltet.
</para>

<para>
Während Roaming Profiles für manche wie das Nirvana klingen mögen, sind sie für andere ein
richtiges und konkretes Problem. Im Speziellen die Nutzer mobiler Computer, die oft
keine dauerhafte Netzwerk-Verbindung haben, sind oft besser mit rein lokalen Profilen beraten.
Dieses Kapitel bietet Informationen, um dem Samba-Administrator zu helfen, mit diesen Situationen
umzugehen.
</para>

</sect1>

<sect1>
<title>Roaming Profiles</title>

<warning>
<para>
Die Unterstützung für Roaming Profiles ist für Windows 9x/Me und Windows NT4/200x verschieden.
</para>
</warning>

<para>
Bevor wir die Konfiguration von Roaming Profiles diskutieren, ist es sinnvoll, zu sehen, wie
Windows 9x/Me und Windows NT4/200x Clients diese Eigenschaften implementieren.
</para>

<para>
Windows 9x/Me Clients senden einen NetUserGetInfo-Request an den Server, um den Pfad zu den
Profilen des Benutzers zu erhalten. Die Antwort hat jedoch nicht genug Platz für ein separates
Feld für den Pfad der Profile, nur für die home-Freigabe des Benutzers. Das bedeutet, daß
Windows 9x/Me-Profile darauf beschränkt sind, im Home-Verzeichnis des Benutzers gespeichert zu werden.
</para>

<para>
Windows NT4/200x-Clients senden einen NetSAMLogon RPC Request, der viele Felder enthält, inklusive
einem Feld für Pfad der Profile des Benutzers.
</para>

<sect2>
<title>Die Konfiguration von Samba für den Umgang mit Profilen</title>

<para>
Dieser Abschnitt dokumentiert, wie man Samba konfiguriert, um MS Windows Client Profile zu
unterstützen.
</para>

<sect3>
<title>NT4/200x Benutzer-Profile</title>

<para>
Um zum Beispiel Windows NT4/200x Clients zu unterstützen, setzen Sie folgendes im Abschnitt [global] der Datei &smb.conf;:
</para>

<para>
<smbconfblock>
<smbconfoption><name>logon path</name><value>\\profileserver\profileshare\profilepath\%U\moreprofilepath</value></smbconfoption>
</smbconfblock>

Dies wird typischerweise so implementiert:

<smbconfblock>
<smbconfoption><name>logon path</name><value>\\%L\Profiles\%u</value></smbconfoption>
</smbconfblock>
wobei <quote>%L</quote> auf den Namen des Samba-Servers aufgelöst wird, und <quote>%u</quote> auf den Benutzernamen.
</para>

<para>
Die Voreinstellung für diese Option ist <filename>\\%N\%U\profile</filename>, also
<filename>\\sambaserver\username\profile</filename>.
Der Dienst <filename>\\%N\%U</filename> wird automatisch vom [homes]-Dienst angelegt.
Wenn Sie einen Samba-Server für die Profile verwenden, müssen Sie die in "logon path" angegebene
Freigabe browseable machen. Bitte lesen Sie die manpage für &smb.conf;, um mehr über die 
unterschiedliche Semantik von <quote>%L</quote> und <quote>%N</quote> zu erfahren, wie auch über
<quote>%U</quote> und <quote>%u</quote>.
</para>

<note>
<para>
MS Windows NT/200x Clients trennen manchmal zwischen einzelnen
Logons eine Verbindung zu einem Server nicht. 
Es wird empfohlen, den Meta-Dienst <smbconfsection>homes</smbconfsection> nicht als Teil des
Profil-Pfads zu verwenden.
</para>
</note>
</sect3>

<sect3>
<title>Windows 9x/Me Benutzer-Profile</title>

<para>
Um Windows 9x/Me Clients zu unterstützen, müssen Sie den Parameter 
<smbconfoption><name>logon home</name></smbconfoption> verwenden. Samba wurde repariert, sodaß
<userinput>net use /home</userinput> nun auch funktioniert, und daß es auch auf dem Parameter
<command>logon home</command> beruht.
</para>

<para>
Mittels Verwendung des Parameters logon home sind Sie darauf beschränkt, Windows 9x/Me Benutzer-Profile
im Home-Verzeichnis des Benutzers abzulegen. Aber warten Sie! Es gibt einen Trick, den Sie
benutzen können. Wenn Sie folgendes im Abschnitt <smbconfsection>[global]</smbconfsection> Ihrer
&smb.conf;-Datei setzen:
</para>
<para><smbconfblock>
<smbconfoption><name>logon home</name><value>\\%L\%U\.profiles</value></smbconfoption>
</smbconfblock></para>

<para>
werden Ihre Windows 9x/Me Clients pflichtbewußt Ihre Clients in ein Unterverzeichnis Ihres
home-Verzeichnisses namens <filename>.profiles</filename> ablegen (und sie damit verstecken).
</para>

<para>
Nicht nur das, <userinput>net use /home</userinput> wird genauso funktionieren, aufgrund eines
Features in Windows 9x/Me. Es entfernt jegliche Verzeichnis-Angaben am Ende der Angabe
des Home-Verzeichnisses und benutzt nur die Teile, die Server und Freigabe angeben. Daher
sieht es für den Client so aus, als ob Sie <filename>\\%L\%U</filename> für
<smbconfoption><name>logon home</name></smbconfoption> spezifiziert hätten.
</para>
</sect3>

<sect3>
<title>Gemischte Windows 9x/Me und Windows NT4/200x Benutzer-Profile</title>

<para>
Sie können Profile für Windows 9x/Me und Windows NT4/200x Clients untertützen, indem Sie
beide Parameter <smbconfoption><name>logon home</name></smbconfoption> und
<smbconfoption><name>logon path</name></smbconfoption> angeben. Zum Beispiel:
</para>

<para><smbconfblock>
<smbconfoption><name>logon home</name><value>\\%L\%u\.profiles</value></smbconfoption>
<smbconfoption><name>logon path</name><value>\\%L\profiles\%u</value></smbconfoption>
</smbconfblock></para>

</sect3>
<sect3>
<title>Deaktivieren der Unterstützung von Roaming Profiles</title>

<para>
Oft wird gefragt: <quote>Wie kann ich die Verwendung lokaler Profile erzwingen?</quote> oder
<quote>Wie kann ich Roaming Profiles deaktivieren?</quote>
</para>

<para>
<indexterm><primary>roaming profiles</primary></indexterm>
Es gibt drei Arten, dies zu tun:
<indexterm><primary>windows registry settings</primary><secondary>roaming profiles</secondary></indexterm>
</para>


<variablelist>
	<varlistentry>
		<term>In &smb.conf;</term>
		<listitem><para>
		Ändern Sie die folgenden Settings und ALLE Clients werden dazu gezwungen,
		ein lokales Profil zu verwenden:
		<smbconfoption><name>logon home</name></smbconfoption> und <smbconfoption><name>logon path</name></smbconfoption>
		</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>MS Windows Registry</term>
		<listitem><para>
		Unter Verwendung der Microsoft Management Console gpedit.msc, um Ihre MS Windows XP
		Maschine zu zwingen, nur ein lokales Profil zu verwenden. Dies verändert natürlich
		Registry-Settings. Der volle Pfad zu der Option ist:
<screen>
Local Computer Policy\
	Computer Configuration\
		Administrative Templates\
			System\
				User Profiles\

Disable: Nur lokale Benutzer-Profile erlauben
Disable: Verhindern, daß Änderungen des Roaming Profiles zum Server weitergegeben werden 
</screen>
	</para> </listitem>
	</varlistentry>

	<varlistentry>
		<term>Ändern des Profil-Typs:</term>
		<listitem><para>Klicken Sie im Start-Menü mit der rechten Maustaste auf
		<guiicon>My Computer icon</guiicon>,
		wählen Sie <guimenuitem>Properties</guimenuitem>, klicken auf das Tab
		<guilabel>User Profiles</guilabel>,
		wählen Sie das Profil, das Sie vom Typ
		<guimenu>Roaming</guimenu> auf <guimenu>Local</guimenu> ändern wollen, und klicken auf 
		<guibutton>Change Type</guibutton>.
		</para></listitem>
	</varlistentry>
</variablelist>

<para>
Konsultieren Sie die Anleitung zur MS Windows Registry für Ihre spezifische Version von MS Windows,
um mehr Informationen dazu zu erhalten, welche Registrierungsschlüssel zu ändern sind, um die
Verwendung lokaler Benutzer-Profile zu erzwingen.
</para>

<note><para>
Die Besonderheiten, wie man ein lokales Profil auf ein roaming Profil wandelt, oder umgekehrt,
variieren je nach Version von MS Windows, die Sie einsetzen. Konsultieren Sie auch das
Microsoft MS Windows Resource Kit für besondere Informationen.
</para></note>

</sect3> </sect2>

<sect2> <title>Informationen zur Konfiguration von Windows Client Profilen</title>

<sect3> <title>Windows 9x/Me Profil-Setup</title>

<para>
Wenn sich ein Benutzer zum ersten Mal in Windows 9x anmeldet, wird die Datei user.DAT erstellt,
weiters die Verzeicnisse <filename>Startmenü</filename>, <filename>Desktop</filename>, 
<filename>Programme</filename>, und <filename>Netzwerkumgebung</filename>.
Diese Verzeichnisse und ihre Inhalte werden mit den lokalen Versionen in
<filename>c:\windows\profiles\username</filename> vereint, bei jedem folgenden Login,
wobei immer die jeweils neuesten Versionen verwendet werden. Sie werden folgende
<smbconfsection>[global]</smbconfsection>-Optionen verwenden müssen:
<smbconfoption><name>preserve case</name><value>yes</value></smbconfoption>,
<smbconfoption><name>short preserve case</name><value>yes</value></smbconfoption> und
<smbconfoption><name>case sensitive</name><value>no</value></smbconfoption>,
um Großbuchstaben in Shortcuts in einem der Profil-Verzeichnisse zu erhalten.
</para>

<para>
Die Datei <filename>user.DAT</filename> enthält alle Benutzereinstellungen. Wenn Sie einen Satz von
Einstellungen erzwingen wollen, benennen Sie die Datei <filename>user.DAT</filename> auf
<filename>user.MAN</filename> um, und verweigern den Schreibzugriff auf diese Datei.
</para>

<orderedlist>
	<listitem> <para>
	Gehen Sie auf der Windows 9x/Me Maschine auf <guimenu>Systemsteuerung</guimenu> ->
	<guimenuitem>Passwörter</guimenuitem> und wählen Sie den Tab
	<guilabel>Benutzer-Profile</guilabel>.
	Wählen Sie das erforderliche Level von Roaming-Einstellungen.
	Drücken Sie <guibutton>OK</guibutton>, aber erlauben Sie keinen Reboot.
	</para> </listitem>

	<listitem> <para>
	Dann gehen Sie auf <guimenu>Systemsteuerung</guimenu> ->,
	<guimenuitem>Netzwerk</guimenuitem> -> <guimenuitem>Client for Microsoft Networks</guimenuitem>	
	<guilabel>Einstellungen</guilabel>. Wählen Sie <guilabel>An NT Domäne anmelden</guilabel>.
	Dann stellen Sie sicher, daß das Primary Logon <guilabel>Client for Microsoft Networks</guilabel>
	ist. Drücken Sie <guibutton>OK</guibutton>, und erlauben diesmal den Reboot.
	</para> </listitem>
</orderedlist>

<para> 
In Windows 9x/ME werden die Profile vom Primary Logon geladen. Wenn Sie das Primary Logon auf
<quote>Client for Novell Networks</quote> gesetzt haben, werden die Profile und Logon-Skripts vom
Novell-Server geladen. Wenn Sie das Primary Logon auf <quote>Windows Logon</quote> haben, werden die
Profile von der lokalen Maschine geladen &smbmdash; ein wenig gegen das Prinzip der Roaming Profiles,
wie es scheint!
</para>

<para>
Sie werden nun sehen, daß der MS-Netzwerk-Login-Dialog <constant>[Benutzer, Passwort, Domäne]</constant>
anstatt nur <constant>[Benutzer, Passwort]</constant> enthält. Geben Sie den Domänen-Namen des
Samba-Servers ein (oder den einer anderen existierenden Domäne, aber denken Sie daran, daß der Benutzer
an dieser Domäne angemeldet wird, und die Profile aus dieser Domäne geladen werden, wenn dieser
Domänen-Anmelde-Server es unterstützt), Benutzernamen, und das Passwort des Benutzers.
</para>

<para> 
Sobald der Benutzer erfolgreich überprüft wurde, wird Sie die Windows 9x/Me-Maschine informieren, daß
<computeroutput>The user has not logged on before</computeroutput> und fragen
<computeroutput>Do you wish to save the user's preferences?</computeroutput> 
Select <guibutton>Yes</guibutton>.
</para>

<para>
Sobald der Windows 9x/Me-Client den Desktop hergestellt hat, sollte es Ihnen möglich sein, den Inhalt
des im Parameter <smbconfoption><name>logon path</name></smbconfoption> angegebenen Verzeichnisses
auf dem Samba-Server zu prüfen, und festzustellen, daß die Ordner
<filename>Desktop</filename>, <filename>Startmenü</filename>, <filename>Programme</filename> und
<filename>Netzwerkumgebung</filename> angelegt worden sind.
</para>

<para>
Diese Ordner werden lokal auf dem Client gepuffert (Cache),
und erfahren ein Update, wenn sich der Benutzer
abmeldet (wenn Sie sie dann nicht schon auf read-only gesetzt haben). Sie werden sehen, daß der Client,
wenn der Benutzer weitere Ordner oder Verknüpfungen anlegt, die heruntergeladenen Profil-Inhalte
mit dem Inhalt des lokalen Profil-Ordners zusammenfügt, unter Verwendung der neuesten Ordner und
Verknüpfungen jeden Profil-Bestands.
</para>

<para>
Wenn Sie die Ordner/Dateien auf dem Samba-Server read-only gesetzt haben, werden Sie Fehler von
der Windows 9x/Me-Maschine bei An- und Abmeldung erhalten, wenn sie versucht, lokale und entfernte
Profile zu vereinigen. Grundsätzlich sollten Sie die UNIX-Dateirechte und Eigentumsverhältnisse
auf dem Samba-Server prüfen, wenn Sie irgendwelche Fehler von der Windows 9x/Me-Maschine erhalten.
</para>

<para>
Wenn Sie Probleme beim Anlegen von Benutzerprofilen haben, können Sie den lokalen Desktop-Cache des
Benutzers zurücksetzen, wie unten gezeigt. Wenn sich dieser Benutzer das nächste Mal anmeldet, wird
ihm gesagt werden, daß er/sie sich <quote>zum ersten Mal</quote> anmeldet.
	
<indexterm><primary>windows registry settings</primary><secondary>profile path</secondary></indexterm>
	</para>


<orderedlist>
	<listitem><para>
	Anstatt sich im Dialog [Benutzer, Passwort, Domäne] anzumelden, drücken Sie <guibutton>escape</guibutton>.
	</para> </listitem>

	<listitem><para>
	Führen Sie <command>regedit.exe</command> aus, und suchen Sie nach:
	</para>

	<para>
	<filename>HKEY_LOCAL_MACHINE\Windows\CurrentVersion\ProfileList</filename>
	</para>

	<para>
	Sie werden einen ProfilePath-Eintrag für jeden Benutzer finden. Notieren Sie Sie die Inhalte
	dieses Schlüssels (wahrscheinlich <filename>c:\windows\profiles\username</filename>), dann
	löschen Sie den Schlüssel <parameter>ProfilePath</parameter> für den erforderlichen Benutzer.
	</para></listitem>

	<listitem><para>
	Verlassen Sie den Registry-Editor.
	</para></listitem>

	<listitem><para>
	Suchen Sie nach der .PWL password-caching Datei des Benutzers im Verzeichnis
	<filename>c:\windows</filename>, und löschen Sie es.
	</para></listitem>

	<listitem><para>
	Melden Sie sich vom Windows 9x/Me-Client ab.	
	</para></listitem>

	<listitem><para>
	Prüfen Sie die Inhalte des Profil-Pfads (siehe 
	<smbconfoption><name>logon path</name></smbconfoption>, wie oben beschrieben) und löschen Sie
	die Datei <filename>user.DAT</filename> oder <filename>user.MAN</filename> des Benutzers,
	nachdem Sie eine Sicherung angelegt haben, falls erforderlich.
	</para></listitem>
</orderedlist>

<warning><para>
Vor dem Löschen der Inhalte des in <parameter>ProfilePath</parameter> angegebenen Verzeichnisses
(wahrscheinlich <filename>c:\windows\profiles\username)</filename>) fragen Sie den Benutzer, ob er
irgendwelche wichtige Dateien auf seinem Desktop oder im Startmenü gespeichert hat. Löschen Sie
die Inhalte des Verzeichnisses <parameter>ProfilePath</parameter> (nach einem Backup, falls Dateien
benötigt werden).
</para>

<para>
Dies wird den Effekt haben, daß die lokale (read-only, versteckte) Datei <filename>user.DAT</filename>
aus dem Profil-Verzeichnis entfernt wird, genauso die lokalen Ordner 
<quote>Desktop</quote>, <quote>Startmenü</quote>, <quote>Programme</quote> und <quote>Netzwerkumgebung</quote>.
</para></warning>

<para>
Wenn alles scheitert, erhöhen Sie Samba's log-level auf einen Wert zwischen 3 und 10, und/oder
verwenden Sie einen Packet-Sniffer wie ethereal oder <command>netmon.exe</command>, und suchen
Sie nach Fehlermeldungen.
</para>

<para>
Wenn Sie Zugriff auf einen Windows NT4/200x Server haben, installieren Sie zuerst Roaming Profiles
und/oder Netzwerk-Anmeldungen auf dem Windows NT4/200x Server. Führen Sie eine Paketverfolgung aus,
(Trace)
oder prüfen Sie die Beispiel-Traces, die dem Windows NT4/200x Server beiliegen, und stellen
Sie die Unterschiede zum Samba-Trace fest.
</para>

</sect3>

<sect3>
<title>Windows NT4 Workstation</title>

<para>
Wenn sich ein Benutzer zum ersten Mal an einer Windows NT4 Workstation anmeldet, wird das Profil
NTuser.DAT angelegt. Der Ort, wo das Profil abgelegt wird, kann durch den Parameter
<smbconfoption><name>logon path</name></smbconfoption> angegeben werden.
</para>

<para>
Es gibt einen Parameter, der nun für die Verwendung mit NT-Profilen verfügbar ist:
<smbconfoption><name>logon drive</name></smbconfoption>.
Dieser sollte auf <filename>H:</filename> oder ein anderes Laufwerk gesetzt werden, und in Verbindung
mit dem neuen Parameter <smbconfoption><name>logon home</name></smbconfoption> verwendet werden.
</para>

<para>
Der Eintrag für das NT4-Profil ist ein Verzeichnis, keine Datei. Die NT-Hilfe bezüglich Profilen
erwähnt, daß ein Verzeichnis auch mit der Endung .PDS angelegt wird. Der Benutzer muß beim Anmelden
Schreibrechte haben, um den vollen Profil-Pfad anzulegen (und den Ordner mit der Endung .PDS, in den
Fällen, in denen er angelegt wird).
</para>

<para>
Windows NT4 legt mehr Ordner im Profil-Verzeichnis an als Windows 9x/Me. So legt es
den Ordner <filename>Anwendungsdaten</filename> und andere an, sowie <filename>Desktop</filename>,
<filename>Startmenü</filename>, <filename>Programme</filename> und <filename>Netzwerkumgebung</filename>.
Das Profil selbst wird in einer Datei namens <filename>NTuser.DAT</filename> gespeichert. Scheinbar wird
nichts in dem Verzeichnis .PDS gespeichert, und sein Zweck ist uns momentan unbekannt.</para>

<para>Sie können die <application>Systemsteuerung</application> dazu verwenden, um ein lokales
Profil auf einen Samba-Server zu kopieren (sehen Sie dazu die NT-Hilfe zu Profilen; diese ist sogar
dazu imstande, sie zum richtigen Platz in der <application>Systemsteuerung</application> zu bringen).
Die NT-Hilfe-Datei erwähnt auch, daß das Umbenennen der Datei <filename>NTuser.DAT</filename> auf
<filename>NTuser.MAN</filename> ein Profil in ein zwingendes Profil verwandelt.
</para>

<para>
Die Groß/Kleinschreibung des Profils ist wichtig. Die Datei muß <filename>NTuser.DAT</filename>
heissen, oder, für ein zwingendes Profil, <filename>NTuser.MAN</filename>. </para> </sect3>

<sect3> <title>Windows 2000/XP Professional</title>

<para>
Sie müssen zuerst auf der MS Windows Workstation das Profil von einem lokalen zu einem 
Domänen-Profil wandeln, wie folgt:</para>

<procedure>
	<step><para>Melden Sie sich als der <emphasis>lokale</emphasis> Workstation-Administrator an. </para></step>

	<step><para>Klicken Sie rechts auf das Icon <guiicon>Arbeitsplatz</guiicon>, wählen Sie
	<guimenuitem>Eigenschaften</guimenuitem>.</para></step>

	<step><para>Klicken Sie den Tab <guilabel>Erweitert</guilabel>.</para></step>

	<step><para>Klicken Sie im Abschnitt Benutzerprofile den Eintrag <guilabel>Einstellungen</guilabel>.</para></step>

	<step><para>Wählen Sie das Profil, das Sie wandeln wollen (einmal darauf klicken).</para></step>

	<step><para>Klicken Sie auf den Knopf <guibutton>Kopieren nach</guibutton>.</para></step>

	<step><para>In der Box <guilabel>Permitted to use</guilabel>, klicken Sie auf
	<guibutton>Ändern</guibutton>.</para></step>

	<step><para>Klicken Sie auf den Bereich <guilabel>Look in</guilabel>, der den Maschinen-Namen
	listet, es wird sich eine Auswahl-Box öffnen. Klicken Sie die Domäne, für die das Profil
	zugänglich sein muß.</para>

	<note><para>
	Sie werden sich anmelden müssen, wenn Sich ein Anmelde-Dialog öffnet.
	Zum Beispiel melden Sie sich an als <replaceable>DOMAIN</replaceable>\root,passwort:
	<replaceable>meinpasswort</replaceable>.</para></note> </step>

	<step><para>Um einem Profil zu gestatten, von jedem verwendet zu werden, wählen Sie
	<quote>Everyone</quote>. </para></step>

	<step><para>Klicken Sie auf <guibutton>OK</guibutton> und die Auswahl-Box schließt sich. </para></step>

	<step><para>Nun klicken Sie auf <guibutton>OK</guibutton>, um das Profil im angegebenen
	Pfad anzulegen.</para></step>
</procedure>

<para>Erledigt. Sie haben nun ein Profil, das mit dem Samba-Tool <command>profiles</command>
edititiert werden kann.
</para>

<note><para>
Unter Windows NT/200x erzwingt die Verwendung von zwingenden Profilen die Verwendung von
MS-Exchange für die SPeicherung von Mail-Daten und hält diese außerhalb des Desktop-Profils.
Dies verhindert, daß die Desktop-Profile unbenützbar werden.
</para> </note>

<sect4>
<title>Windows XP Service Pack 1</title>
	<para>
	Es gibt einen Sicherheits-Check, der neu für Windows XP ist (oder vielleicht nur für
	Windows XP Service Pack 1). Er kann via einer Gruppen-Richtlinie im Active Directory
	deaktiviert werden. Die Richtlinie heißt:
	</para>

	<para>
		<filename>Computer Configuration\Administrative Templates\System\User Profiles\<?latex \linebreak ?>Do not check for
	user ownership of Roaming Profile Folders</filename>i
	</para>

	<para>
	Dies sollte auf <constant>Aktiviert</constant> gesetzt werden.
	</para>

	<para>
	Hat die neue Version von Samba ein Analogon zum Active Directory? Wenn ja, können Sie die
	Richtlinie eventuell durch dieses setzen.
	</para>	

	<para>
	Wenn Sie keine Gruppen-Richtlinien in Samba setzen können, dann können Sie sie vielleicht
	lokal auf jeder Maschine setzen. Wenn Sie dies versuchen wollen, machen Sie folgendes
	(N.B. Ich weiß nicht mit Sicherheit, daß dies genauso funktioniert wie eine
	Domänen-Gruppenrichtlinie):
	</para>

<procedure>

<para>TODO : DIESE PROZEDUR MUSS NOCH ÜBERSETZT WERDEN - ANHAND VON SCREENSHOTS !!!</para>

	<step><para>On the XP workstation, log in with an Administrative account.</para></step>

	<step><para>Click on <guimenu>Start</guimenu> -> <guimenuitem>Run</guimenuitem>.</para></step>
	<step><para>Type <command>mmc</command>.</para></step>
	<step><para>Click on <guibutton>OK</guibutton>.</para></step>
	<step><para>A Microsoft Management Console should appear.</para></step>
	<step><para>Click on <guimenu>File</guimenu> -> <guimenuitem>Add/Remove Snap-in</guimenuitem> -> <guimenuitem>Add</guimenuitem>.</para></step> 
	<step><para>Double-click on <guiicon>Group Policy</guiicon>.</para></step> 
	<step><para>Click on <guibutton>Finish</guibutton> -> <guibutton>Close</guibutton>.</para></step> 
	<step><para>Click on <guibutton>OK</guibutton>.</para></step>
	<step><para>In the <quote>Console Root</quote> window expand <guiicon>Local Computer Policy</guiicon> ->
		<guiicon>Computer Configuration</guiicon> -> <guiicon>Administrative Templates</guiicon> -> <guiicon>System</guiicon> -> <guiicon>User Profiles</guiicon>.</para></step>
	<step><para>Double-click on <guilabel>Do not check for user ownership of Roaming Profile Folders</guilabel>.</para></step>
	<step><para>Select <guilabel>Enabled</guilabel>.</para></step>
	<step><para>Click on <guibutton>OK</guibutton>.</para></step>
	<step><para>Close the whole console. You do not need to save the settings (this refers to the
	console settings rather than the policies you have changed).</para></step>
	<step><para>Reboot.</para></step>
</procedure>
</sect4>
</sect3>
</sect2>

<sect2>
	<title>Das gemeinsame Nutzen von Profilen mit W9x/Me und NT4/200x/XP Workstations</title>

<para>
Das gemeinsame Nutzen von Desktop-Profilen mit verschiedenen Windows-Versionen ist nicht zu empfehlen.
Desktop-Profile sind ein Phänomen in Evolution, und Profile für spätere MS Windows-Versionen fügen
Eigenschaften hinzu, die mit früheren MS Windows Clients zu Problemen führen können. Vielleicht ist
der herausragendste Grund dafür, Profile nicht zu mischen, daß, wenn man sich von einer älteren
MS Windows Version abmeldet, das alte Format der Profil-Inhalte Information überschreiben könnte, die
zur neueren Version gehört, was in dem Verlust von Profil-Informations-Gehalt führt, wenn sich dieser
Benutzer wieder an der neueren Version von MS Windows anmeldet.</para>

<para>
Wenn Sie dasselbe Startmenü/Desktop mit W9x/Me teilen wollen, müssen Sie einen gemeinsamen Ort 
für die Profile angeben. Die Parameter in &smb.conf;, die gleich sein müssen, sind
<smbconfoption><name>logon path</name></smbconfoption> und
<smbconfoption><name>logon home</name></smbconfoption>. </para>

<para>
Wenn Sie dies korrekt eingerichtet haben, werden Sie separate Dateien <filename>user.DAT</filename>
und <filename>NTuser.DAT</filename> im selben Profil-Verzeichnis vorfinden.</para>

</sect2>

<sect2>
<title>Migration von Profilen von Windows NT4/200x Server zu Samba</title>

<para>
Es gibt nichts, das Sie davon abhält, jeglichen beliebigen Pfad für die Benutzer-Profile anzugeben.
Daher könnten Sie bestimmen, daß das Profil auf einem Samba-Server gespeichert werden soll, oder auf 
irgendeinem anderen SMB-Server, solange diese Server verschlüsselte Passwörter unterstützt.</para>

<sect3>
<title>Windows NT4 Profil-Verwaltungs-Werkzeuge</title>

<para>
Unglücklicherweise sind die Informationen zum Resource Kit spezifisch für die Version von
MS Windows NT4/200x. Das passende Resource Kit ist für jede Plattform erforderlich.</para>

<para>Hier eine Kurz-Anleitung:</para>

<para>TODO : DIESE PROZEDUR MUSS NOCH ÜBERSETZT WERDEN - ANHAND VON SCREENSHOTS !!!</para>
<procedure>
	<step><para>Klicken Sie auf Ihrem NT4 Domain Controller mit der rechten Maustaste auf
	<guiicon>Arbeitsplatz</guiicon>, dann wählen Sie die Klappe namens
	<guilabel>Benutzerprofile</guilabel>. </para></step>

	<step><para>Wählen Sie ein Benutzerprofil, das Sie migrieren wollen und klicken Sie darauf.
	</para>

	<note><para>Ich verwende den Begriff <quote>migrieren</quote> locker.
	Sie können ein Profil kopieren, um ein Gruppen-Profil anzulegen. Sie können dem Benutzer
	<parameter>Everyone</parameter> Rechte an dem Profil geben, auf das Sie kopieren. Dies
	müssen Sie tun, da Ihre Samba-Domäne kein Mitglied einer Vertrauensstellung mit Ihrem PDC
	ist.</para></note></step>

	<step><para>Klicken Sie auf <guibutton>Kopieren auf</guibutton>.</para></step>

	<step><para>In the box labeled <guilabel>Copy Profile to</guilabel> add your new path, e.g.,
	<filename>c:\temp\foobar</filename></para></step>

	<step><para>Click on <guibutton>Change</guibutton> in the <guilabel>Permitted to use</guilabel> box.</para></step>

	<step><para>Click on the group <quote>Everyone</quote>, click on <guibutton>OK</guibutton>. This
	closes the <quote>choose user</quote> box.</para></step>

	<step><para>Now click on <guibutton>OK</guibutton>.</para></step>
</procedure>

<para>Befolgen Sie obige Anleitung für jedes zu migrierende Profil.</para>

</sect3>

<sect3>
<title>Randbemerkungen</title>


<para>
<indexterm><primary>SID</primary></indexterm>
Sie sollten sich die SID Ihrer NT4-Domäne besorgen, dazu können Sie smbpasswd verwenden.
Lesen Sie dazu die man-page.</para>

</sect3>

<sect3> <title>moveuser.exe</title>

<para>
Das Windows 200x Professional Resource Kit enthält <command>moveuser.exe</command>.
<command>moveuser.exe</command> verändert die Sicherheit eines Profils von einem Benutzer auf einen
anderen. Dies erlaubt es, die Domäne des Kontos zu ändern, und/oder den Benutzernamen.</para>

<para>
Dieser Befehl ist dem Samba-Befehl <command>profiles</command> ähnlich.
</para>

</sect3>

<sect3>
<title>Die SID erhalten</title>

<para>
<indexterm><primary>SID</primary></indexterm>
Sie können die SID bestimmen, indem Sie das Programm <command>GetSID.exe</command> aus dem
Windows NT Server 4.0 Resource Kit verwenden.</para>

<para>Windows NT 4.0 speichert die lokalen Profil-Informationen in der Registry, an folgender Stelle:
<filename>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList</filename> </para>

<para>
Im Schlüssel "ProfileList" gibt es Sub-Schlüssel, die nach den SIDs der Benutzer benannt sind, die
sich an diesem Computer angemeldet haben. (Um die Informationen zu dem Benutzer zu finden, dessen
lokal zwischengespeichertes Profil sie verschieben wollen, bestimmen Sie dessen SID mit dem Werkzeug
<command>GetSID.exe</command>.) Innerhalb des entsprechenden Sub-Schlüssel des Benutzers werden Sie
einen String-Wert namens <parameter>ProfileImagePath</parameter>finden.</para>

</sect3> </sect2> </sect1>

<sect1> <title>Zwingende Profile</title>

<para>
<indexterm><primary>mandatory profiles</primary></indexterm>
Ein zwingendes Profil ("Mandatory Profile") ist ein Profil, das der Benutzer nicht überschreiben kann.
Während der einzelnen Sitzung des Benutzers sind Änderungen an der Desktop-Umgebung möglich, jedoch
sind alle diese Änderungen beim Abmelden des Benutzers verloren. Wenn es erwünscht ist, dem Benutzer
keinerlei Möglichkeit zur Veränderung der Desktop-Umgebung zu erlauben, muß dies durch Setzen von
Richtlinien erfolgen. Sehen Sie dazu das vorhergehende Kapitel. </para>

<note><para>
Das Profil-Verzeichnis (oder dessen Inhalte) sollten unter KEINEN Umständen read-only gesetzt werden,
da dies das Profil unbenutzbar machen kann. Wo es essentiell wichtig ist, ein Profil innerhalb des
UNIX-Dateisystems read-only zu setzen, kann dies gemacht werden, in diesem Fall müssen Sie jedoch
JEDENFALLS das VFS-Modul <command>fake-permissions</command> benutzen, um die MS Windows NT/200x/XP
Clients anzuweisen, daß der Benutzer Schreibberechtigung hat. Siehe <link linkend="fakeperms"/>.
</para></note>

<para>
Für MS Windows NT4/200x/XP kann die obige Methode auch zum Anlegen zwingender Profile verwendet
werden. Um ein Gruppen-Profil in ein zwingendes Profil zu wandeln, suchen Sie einfach nach der Datei
<filename>NTUser.DAT</filename> im kopierten Profil und benennen es auf 
<filename>NTUser.MAN</filename> um.</para>

<para>
Für MS Windows 9x/ME ist es die Datei <filename>User.DAT</filename>, die auf
<filename>User.MAN</filename> umbenannt werden muß, um ein zwingendes Profil zu erhalten.</para>

</sect1>

<sect1>
<title>Das Anlegen und Verwalten von Gruppen-Profilen</title>

<para>
<indexterm><primary>group profiles</primary></indexterm>
Die meisten Organisationen sind in Abteilungen gegliedert. Darin liegt ein angenehmer Nebeneffekt,
da üblicherweise die meisten Benutzer innerhalb einer Abteilung dieselben Desktop-Anwendungen
und dasselbe Desktop-Layout benötigen. MS Windows NT4/200x/XP erlaubt die Verwendung von 
Gruppen-Profilen. Ein Gruppen-Profil ist ein Profil, das ursprünglich unter Verwendung eines
Beispiel-Anwenders angelegt wird. Danach werden unter Verwendung des Profil-Migrations-Tools
(siehe oben) dem Profil Rechte für diejenige Benutzergruppe zugewiesen, die Zugriff auf das
Gruppen-Profil benötigt.</para>

<para>
Der nächste Schritt ist wichtig: Anstatt das Gruppen-Profil Benutzern auf einer
<quote>per user</quote>-Basis zuzuweisen (mittels User Manager), wird die Gruppe selbst dem nunmehr
modifizierten Profil zugewiesen.</para>

<note>
<para>
Seien Sie vorsichtig mit Gruppen-Profilen. Wenn der Benutzer, der Mitglied der Gruppe ist. auch ein
persönliches Profil hat, wird das Ergebnis eine Vereinigung (Merge) dieser beiden Profile sein.</para>
</note>

</sect1>

<sect1>
<title>Standard-Profile für Windows-Benutzer</title>

<para>
<indexterm><primary>default profile</primary></indexterm>
MS Windows 9x/Me und NT4/200x/XP benutzen ein Standard-Profil für jeden Benutzer, für den noch kein
Profil existiert. Bewaffnet mit dem Wissen, wo das Standard-Profil auf einer Windows-Workstation
zu finden ist, und wissend, welche Registrierungs-Schlüssel den Pfad beeinflussen, aus dem heraus das
Standard-Profil angelegt wird, ist es möglich, das Standard-Profil für die jeweilige Installation
zu optimieren. Dies hat signifikante administrative Vorteile.</para>

<sect2>
<title>MS Windows 9x/Me</title>

<para>Um Standard-Benutzer-Profile in Windows 9x/ME zu aktivieren, können Sie entweder den
<application>Windows 98 System Policy Editor</application> verwenden, oder die Registry direkt
ändern.</para>

<para>Um Standard-Benutzer-Profile in Windows 9x/ME zu aktivieren, öffnen Sie den
<application>System Policy Editor</application>, dann wählen Sie
<guimenu>Datei</guimenu> -> <guimenuitem>Registrierung öffnen</guimenuitem>, als nächstes klicken
Sie das Icon <guiicon>Lokaler Computer</guiicon>, klicken auf <guilabel>Windows 98 System</guilabel>,
wählen <guilabel>Benutzer-Profile</guilabel>, und klicken auf die Aktivieren-Box. Vergessen Sie
nicht, die Registry-Änderungen zu speichern.</para>


<para>Zum direkten Modifizieren der Registry, öffnen Sie den 
<application>Registrierungs-Editor</application> (<command>regedit.exe</command>) und wählen Sie
den Abschnitt <filename>HKEY_LOCAL_MACHINE\Network\Logon</filename>. Nun fügen Sie einen Wert vom Typ
DWORD hinzu, mit dem Namen <quote>User Profiles</quote>, um Benutzerprofile zu aktivieren, setzen Sie
ihn auf 1; um diese zu deaktivieren, setzen Sie ihn auf den Wert 0.</para>

<sect3>
<title>Behandlung von Benutzerprofilen mit Windows 9x/Me</title>

<para>Wenn sich ein Benutzer an einer Windows 9x/Me-Maschine anmeldet, wird der lokale Profilpfad
<filename>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\ProfileList</filename> auf einen
existierenden Eintrag für diesen Benutzer überprüft.</para>

<para>Wenn der Benutzer einen Eintrag in diesem Registrierungsabschnitt hat, prüft Windows 9x/Me, ob eine
lokal gepufferte Version des Benutzerprofils vorhanden ist. Windows 9x/Me prüft auch das 
Home-Verzeichnis des Benutzers (oder ein anderes angegebenes Verzeichnis, wenn diese Angabe verändert
wurde) auf dem Server auf Vorhandensein des Profils. Wenn ein Profil an beiden Orten existiert, wird
die neuere Version verwendet. Wenn das Benutzerprofil auf dem Server existiert, aber nicht auf der
lokalen Maschine, wird das Profil vom Server geladen und verwendet. Wenn es nur auf der lokalen
Maschine existiert, wird diese Kopie verwendet.</para>

<para>Wenn an keinem der beiden Orte ein Benutzerprofil gefunden wird, wird das Standard-Benutzer-Profil
der Windows 9x/Me-Maschine verwendet und in einen neu angelegten Ordner für den angemeldeten Benutzer
kopiert. Beim Abmelden werden alle vorgenommenen Änderungen des Benutzers in sein lokales Profil
geschrieben. Wenn der Benutzer ein "Roaming Profile" hat, werden die Änderungen in sein Profil auf
dem Server geschrieben.</para>

</sect3> </sect2>

<sect2>
<title>MS Windows NT4 Workstation</title>

<para>Unter MS Windows NT4 wird das Standard-Benutzer-Profil aus 
<filename>%SystemRoot%\Profiles</filename> bezogen, welches in einer Standard-Installation
<filename>C:\Windows NT\Profiles</filename> entspricht. Unter diesem Verzeichnis gibt es in einer
herkömmlichen sauberen Installation drei (3) Verzeichnisse: <filename>Administrator</filename>, <filename>All Users,</filename> und <filename>Default User</filename>. </para>

<para>
Das Verzeichnis <filename>All Users</filename> enthält Menü-Einstellungen, die für alle System-Benutzer
gleich sind. Das Verzeichnis <filename>Default User</filename> enthält Menü-Einträge, die per Benutzer
anpassbar sind, abhängig von den gewählten oder angelegten Profil-Einstellungen.</para>

<para>Wenn sich ein neuer Benutzer zum ersten Mal an einer MS Windows NT4-Maschine anmeldet, wird
ein neues Profil angelegt, zusammengesetzt aus:</para>

<itemizedlist>
	<listitem><para>All Users Einstellungen.</para></listitem>
	<listitem><para>Default User Einstellungen (enthalten die Standard-Datei <filename>NTUser.DAT</filename>).</para></listitem>
</itemizedlist>

<para>Wenn sich ein Benutzer an einer MS Windows NT4-Maschine anmeldet, die Mitglied einer MS 
Domäne ist, werden die folgenden Schritte in Bezug auf Profile durchlaufen:

<indexterm><primary>NTConfig.POL</primary></indexterm>
</para>


<procedure>
	<step> <para>
	Die Information bezüglich des Benutzerkontos, die während dem Anmelde-Vorgang erhalten wird,
	enthält den Ort, an dem das Desktop-Profil des Benutzers aufbewahrt wird. Der Profil-Pfad
	kann lokal auf der Maschine liegen oder auf einer Netzwerk-Freigabe. Wenn ein Profil in dem
	vom Benutzer-Konto angegebenen Pfad existiert, wird es auf 
	<filename>%SystemRoot%\Profiles\%USERNAME%</filename> kopiert. Dieses Profil erbt dann die
	Einstellungen im <filename>All Users</filename>-Profil in 
	<filename>%SystemRoot%\Profiles</filename>.</para> </step>

	<step> <para>
	Wenn das Benutzerkonto einen Profil-Pfad hat, aber dort kein Profil existiert, wird ein neues
	Profil in <filename>%SystemRoot%\Profiles\%USERNAME%</filename> angelegt, unter Verwendung
	des Profils <filename>Default User</filename>.</para> </step>.

	<step> <para>
	Wenn die Freigabe NETLOGON auf dem authentifizierenden Server (Logon-Server) eine
	Richtlinien-Datei (<filename>NTConfig.POL</filename>) enthält, werden dessen Inhalte auf
	<filename>NTUser.DAT</filename> angewandt, welches wiederum auf den Abschnitt
	<filename>HKEY_CURRENT_USER</filename> der Registrierung angewandt wird.</para> </step>

	<step> <para>
	Beim Abmelden des Benutzers wird, wenn das Profil ein "Roaming Profile" ist, das Profil
	in den Profil-Pfad geschrieben. Die Datei <filename>NTuser.DAT</filename> wird dann neu
	aus den Inhalten von <filename>HKEY_CURRENT_USER</filename> angelegt.
	Daher wird, falls beim nächsten Anmelden
	in der NETLOGON-Freigabe keine Datei <filename>NTConfig.POL</filename> existiert, die
	Auswirkung der vorigen Datei <filename>NTConfig.POL</filename> nach wie vor im Profil behalten.
	Diesen Effekt bezeichnet man als "Tattooing".</para> </step>
</procedure>

<para>
MS Windows NT4 Profile können <emphasis>lokal</emphasis> oder <emphasis>roaming</emphasis> sein.
Ein lokales Profil wird in <filename>%SystemRoot%\Profiles\%USERNAME%</filename> gespeichert. Ein
"Roaming Profile" wird auch in derselben Art gespeichert, außer der folgende Registrierungs-Schlüssel
wird wie folgt angelegt:</para>

<para><screen> HKEY_LOCAL_MACHINE\SYSTEM\Software\Microsoft\Windows NT\CurrentVersion\
winlogon\"DeleteRoamingCache"=dword:0000000
 </screen>
In diesem Fall, wird die lokale Kopie ((in <filename>%SystemRoot%\Profiles\%USERNAME%</filename>)
beim Abmelden gelöscht.</para>

<para>Unter MS Windows NT4, können Standard-Pfade für allgemeine Ressourcen wie <filename>Eigene
Dokumente</filename> auf eine Netzwerk-Freigabe umgeleitet werden, indem man die folgenden
Registrierungs-Schlüssel ändert. Diese Änderungen können durch Verwendung des System Policy Editor
vorgenommen werden. Dies erfordert das Anlegen Ihrer eigenen Vorlage für den Policy Editor, um
diese Änderungen per GUI zu erlauben. Eine andere Möglichkeit, dies zu tun, ist, zuerst ein
Standard-Benutzer-Profil anzulegen, dann, während man als anderer Benutzer angemeldet ist,
<command>regedt32</command> auszuführen, um die Schlüssel zu editieren.</para>

<para>
Der Registrierungs-Schlüssel, der das Verhalten der Ordner beeinflußt, die Teil des Standard-Benutzer-
Profils sind, ist auf Windows NT4:
<screen>
HKEY_CURRENT_USER
	\Software
		\Microsoft
			\Windows
				\CurrentVersion
					\Explorer
						\User Shell Folders
</screen>
<indexterm><primary>windows registry settings</primary><secondary>default profile locations</secondary></indexterm>
</para>

<para>
Der obige Schlüssel enthält eine Liste von automatisch verwalteten Ordnern. Die Standard-Einträge
werde in <link linkend="ProfileLocs"/> gezeigt.</para>

<table frame="all" id="ProfileLocs">
	<title>Standard-Werte der Registrierungs-Schlüssel für Benutzer-Ordner</title>
	<tgroup cols="2">
		<colspec align="left"/>
		<colspec align="left"/>
	<thead>
		<row><entry>Name</entry><entry>Standard-Wert</entry></row>
	</thead>
	<tbody>
		<row><entry>AppData</entry><entry>%USERPROFILE%\Anwendungsdaten</entry></row>
		<row><entry>Desktop</entry><entry>%USERPROFILE%\Desktop</entry></row>
		<row><entry>Favorites</entry><entry>%USERPROFILE%\Favoriten</entry></row>
		<row><entry>NetHood</entry><entry>%USERPROFILE%\Netzwerkumgebung</entry></row>
		<row><entry>PrintHood</entry><entry>%USERPROFILE%\Druckumgebung</entry></row>
		<row><entry>Programs</entry><entry>%USERPROFILE%\Startmenü\Programme</entry></row>
		<row><entry>Recent</entry><entry>%USERPROFILE%\Zuletzt verwendete Dokumente</entry></row>
		<row><entry>SendTo</entry><entry>%USERPROFILE%\SendTo</entry></row>
		<row><entry>Start Menu</entry><entry>%USERPROFILE%\Startmenü</entry></row>
		<row><entry>Startup</entry><entry>%USERPROFILE%\Startmenü\Programme\Autostart</entry></row>
	</tbody>
	</tgroup>
</table>

<para> The registry key that contains the location of the default profile settings is: </para>

<para> <filename>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\<?latex \linebreak ?>
User Shell Folders</filename> </para>

<para> The default entries are shown in <link linkend="regkeys"/>.</para>

<table frame="all" id="regkeys">
	<title>Defaults of Profile Settings Registry Keys</title>
	<tgroup cols="2">
		<colspec align="left"/>
		<colspec align="left"/>
	<tbody>
		<row><entry>Common Desktop</entry><entry>%SystemRoot%\Profiles\All Users\Desktop</entry></row>
		<row><entry>Common Programs</entry><entry>%SystemRoot%\Profiles\All Users\Programs</entry></row>
		<row><entry>Common Start Menu</entry><entry>%SystemRoot%\Profiles\All Users\Start Menu</entry></row>
		<row><entry>Common Startup</entry><entry>%SystemRoot%\Profiles\All Users\Start Menu\Programs\Startup</entry></row>
	</tbody>
	</tgroup>
</table>

</sect2>

<sect2> <title>MS Windows 200x/XP</title>

<note><para>
<indexterm><primary>GPOs</primary></indexterm>
MS Windows XP Home Edition verwendet standard-mäßig Per-Benutzer-Profile, aber kann nicht an
Domänen teilnehmen, sich nicht an NT/ADS-Domänen anmelden, und kann daher das Profil nur von sich selbst
beziehen. Während dies Vorteile hat, erlaubt die "Schönheit" von jenen MS Windows Clients, die an
Domänen-Anmeldevorgängen teilnehmen können, dem Administrator, ein globales Standard-Profil anzulegen,
und dessen Verwendung mittels Gruppenrichtlinien (GPOs) zu erzwingen.
</para></note>

<para>
Wenn sich ein neuer Benutzer zum ersten Mal an einer MS Windows 200x/XP Maschine anmeldet, wird das
Standard-Profil aus <filename>C:\Dokumente und Einstellungen\Default User</filename> geladen. Der
Administrator kann die dortigen Inhalte modifizieren und MS Windows 200x/XP wird diese verwenden. Dies
ist nicht gerade optimal, da es bedeutet, daß man ein neues Standard-Profil auf jede
MS Windows 200x/XP Client Workstation kopieren muß.</para>

<para>
Wenn MS Windows 200x/XP an einem Domänen-Kontext teilnimmt, und das Standard-Benutzer-Profil wird nicht
gefunden, sucht der Client nach einem Standard-Profil in der NETLOGON-Freigabe des authentifizierenden
Servers. In MS Windows Begriffen,
<?latex \linebreak ?><filename>%LOGONSERVER%\NETLOGON\Default User,</filename> und wenn ein solches
existiert, wird der Client es auf die Workstation kopieren, in das Verzeichnis
<filename>C:\Dokumente und Einstellungen\</filename>, unter dem Login-Namen des Benutzers.</para>

<note><para>Dieser Pfad entspricht, in Samba-Begriffen, der Freigabe
<smbconfsection>[NETLOGON]</smbconfsection> in &smb.conf;. Das Verzeichnis sollte im Wurzelverzeichnis
dieser Freigabe angelegt werden, und muß <filename>Default Profile</filename> heissen.</para></note>

<para>Wenn an diesem Ort kein Standard-Profil existiert, wird MS Windows 200x/XP das lokale
Standard-Profil verwenden.</para>

<para>Beim Abmelden wird das Desktop-Profil des Benutzers an dem Ort abgespeichert, der in den
Registrierungs-Einstellungen für diesen Benutzer gesetzt ist. Wenn keine spezifischen Richtlinien
angelegt oder dem Client während der Anmeldung weitergegeben worden sind (wie es Samba automatisch
tut), dann wird das Benutzerprofil nur auf der lokalen Maschine abgelegt, unter
<filename>C:\Dokumente und Einstellungen\%USERNAME%</filename>.</para>



<para>Jene, die dieses Standard-Verhalten verändern wollen, können dies auf drei Arten tun:</para>

<itemizedlist>
	<listitem> <para>
	Manuelles Ändern der Registrierungs-Schlüssel auf der lokalen Maschine und das Plazieren
	des Standard-Profils im Wurzelverzeichnis der NETLOGON-Freigabe. Dies wird nicht empfohlen,
	da es sehr wartungs-intensiv ist.
	</para> </listitem>

        <listitem> <para>
	Anlegen einer NT4-artigen NTConfig.POL Datei, die dieses Verhalten spezifiziert, und das
	Plazieren dieser Datei im Wurzelverzeichnis der NETLOGON-Freigabe, neben dem neuen
	Standard-Profil.
	</para> </listitem>

	<listitem> <para>
	Anlegen einer Gruppenrichtline (GPO), die das Verhalten per Active Directory erzwingt,
	und das Plazieren des neuen Standard-Profils in der NETLOGON-Freigabe.
	</para> </listitem>
</itemizedlist>

<para>
Der Registrierungs-Schlüssel, der das Verhalten der Ordner beeinflußt, die Bestandteil des
Standard-Benutzer-Profils sind, ist unter Windows 200x/XP: </para>

<para> <filename>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell
Folders\</filename> </para>

<para>
Der obige Schlüssel enthält eine Liste von automatisch verwalteten Ordnern. Die Standard-Einträge
werden in <link linkend="defregpthkeys"/>
<indexterm><primary>windows registry settings</primary><secondary>default profile locations</secondary></indexterm>
gezeigt.
</para>


<table frame="all" id="defregpthkeys">
	<title>Defaults of Default User Profile Paths Registry Keys</title>
	<tgroup cols="2">
		<colspec align="left"/>
		<colspec align="left"/>
	<thead>
		<row><entry>Name</entry><entry>Default Value</entry></row>
	</thead>
	<tbody>
		<row><entry>AppData</entry><entry>%USERPROFILE%\Application Data</entry></row>
		<row><entry>Cache</entry><entry>%USERPROFILE%\Local Settings\Temporary Internet Files</entry></row>
		<row><entry>Cookies</entry><entry>%USERPROFILE%\Cookies</entry></row>
		<row><entry>Desktop</entry><entry>%USERPROFILE%\Desktop</entry></row>
		<row><entry>Favorites</entry><entry>%USERPROFILE%\Favorites</entry></row>
		<row><entry>History</entry><entry>%USERPROFILE%\Local Settings\History</entry></row>
		<row><entry>Local AppData</entry><entry>%USERPROFILE%\Local Settings\Application Data</entry></row>
		<row><entry>Local Settings</entry><entry>%USERPROFILE%\Local Settings</entry></row>
		<row><entry>My Pictures</entry><entry>%USERPROFILE%\My Documents\My Pictures</entry></row>
		<row><entry>NetHood</entry><entry>%USERPROFILE%\NetHood</entry></row>
		<row><entry>Personal</entry><entry>%USERPROFILE%\My Documents</entry></row>
		<row><entry>PrintHood</entry><entry>%USERPROFILE%\PrintHood</entry></row>
		<row><entry>Programs</entry><entry>%USERPROFILE%\Start Menu\Programs</entry></row>
		<row><entry>Recent</entry><entry>%USERPROFILE%\Recent</entry></row>
		<row><entry>SendTo</entry><entry>%USERPROFILE%\SendTo</entry></row>
		<row><entry>Start Menu</entry><entry>%USERPROFILE%\Start Menu</entry></row>
		<row><entry>Startup</entry><entry>%USERPROFILE%\Start Menu\Programs\Startup</entry></row>
		<row><entry>Templates</entry><entry>%USERPROFILE%\Templates</entry></row>
	</tbody>
	</tgroup>
</table>

<para> There is also an entry called <quote>Default</quote> that has no value set. The default entry is
of type <constant>REG_SZ</constant>, all the others are of type <constant>REG_EXPAND_SZ</constant>. </para>

<para> It makes a huge difference to the speed of handling roaming user profiles if all the folders are
stored on a dedicated location on a network server. This means that it will not be necessary to write
the Outlook PST file over the network for every login and logout. </para>

<para> To set this to a network location, you could use the following examples: </para>

<para><filename>%LOGONSERVER%\%USERNAME%\Default Folders</filename></para>

<para> This would store the folders in the user's home directory under a directory called <filename>Default
Folders</filename>. You could also use: </para>

<para><filename>\\<replaceable>SambaServer</replaceable>\<replaceable>FolderShare</replaceable>\%USERNAME%</filename></para>

<para>
in which case the default folders will be stored in the server named <replaceable>SambaServer</replaceable>
in the share called <replaceable>FolderShare</replaceable> under a directory that has the name of the
MS Windows user as seen by the Linux/UNIX file system.	</para>

<para> Please note that once you have created a default profile share, you MUST migrate a user's profile
(default or custom) to it. </para>

<para> MS Windows 200x/XP profiles may be <emphasis>Local</emphasis> or <emphasis>Roaming</emphasis>.
	A roaming profile will be cached locally unless the following registry key is created: 

<indexterm><primary>delete roaming profiles</primary></indexterm>
</para>


<para> <programlisting> HKEY_LOCAL_MACHINE\SYSTEM\Software\Microsoft\Windows NT\CurrentVersion\
	winlogon\"DeleteRoamingCache"=dword:00000001</programlisting></para>

<para>
In this case, the local cache copy will be deleted on logout.
</para> 
</sect2> 
</sect1>

<sect1> <title>Common Errors</title>

<para>
The following are some typical errors, problems and questions that have been asked on the Samba mailing lists.
</para>

<sect2>
<title>Configuring Roaming Profiles for a Few Users or Groups</title>

<para>
With Samba-2.2.x, the choice you have is to enable or disable roaming profiles support. It is a
global only setting. The default is to have roaming profiles and the default path will locate them in
the user's home directory.
</para>

<para>
If disabled globally, then no one will have roaming profile ability. If enabled and you want it
to apply only to certain machines, then on those machines on which roaming profile support is not wanted
it is then necessary to disable roaming profile handling in the registry of each such machine.
</para>

<para>
With Samba-3, you can have a global profile setting in &smb.conf; and you can override this by
per-user settings using the Domain User Manager (as with MS Windows NT4/ Win 200xx). </para>

<para> In any case, you can configure only one profile per user. That profile can be either: </para>

<itemizedlist>
	<listitem>A profile unique to that user.</listitem>
	<listitem>A mandatory profile (one the user cannot change).</listitem>
	<listitem>A group profile (really should be mandatory, that is unchangable).</listitem>
</itemizedlist>

</sect2>

<sect2> <title>Cannot Use Roaming Profiles</title>

<para> A user requested the following: <quote> I do not want Roaming profiles to be implemented. I want
to give users a local profile alone. Please help me, I am totally lost with this error. For the past
two days I tried everything, I googled around but found no useful pointers. Please help me. </quote></para>

<para> The choices are: </para>

<variablelist>
	<varlistentry>
		<term>Local profiles</term> <listitem><para> I know of no registry keys that will allow
		auto-deletion of LOCAL profiles on log out.</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>Roaming profiles</term> <listitem><para> As a user logs onto the network, a centrally
		stored profile is copied to the workstation to form a local profile. This local profile
		will persist (remain on the workstation disk) unless a registry key is changed that will
		cause this profile to be automatically deleted on logout. </para></listitem>
	</varlistentry>
</variablelist>

<para>The roaming profile choices are: </para>

<variablelist>
	<varlistentry>
		<term>Personal roaming profiles</term> <listitem><para> These are typically stored in
		a profile share on a central (or conveniently located local) server. </para>

		<para> Workstations cache (store) a local copy of the profile. This cached
		copy is used when the profile cannot be downloaded at next logon. </para></listitem>
	</varlistentry>

	<varlistentry>
		<term>Group profiles</term> <listitem><para>These are loaded from a central profile
		server.</para></listitem>
	</varlistentry>

	<varlistentry>
		<term>Mandatory profiles</term> <listitem><para> Mandatory profiles can be created for
		a user as well as for any group that a user is a member of. Mandatory profiles cannot be
		changed by ordinary users. Only the administrator can change or reconfigure a mandatory
		profile. </para></listitem>
	</varlistentry>
</variablelist>

<para> A Windows NT4/200x/XP profile can vary in size from 130KB to very large. Outlook PST files are
most often part of the profile and can be many GB in size. On average (in a well controlled environment),
roaming profile size of 2MB is a good rule of thumb to use for planning purposes. In an undisciplined
environment, I have seen up to 2GB profiles. Users tend to complain when it takes an hour to log onto a
workstation but they harvest the fruits of folly (and ignorance). </para>

<para> The point of all the above is to show that roaming profiles and good controls of how they can be
changed as well as good discipline make up for a problem-free site. </para>

<para> Microsoft's answer to the PST problem is to store all email in an MS Exchange Server backend. This
removes the need for a PST file. </para>

<para>Local profiles mean: </para>

<itemizedlist>
	<listitem><para>If each machine is used by many users, then much local disk storage is needed
	for local profiles.</para></listitem> <listitem><para>Every workstation the user logs into has
	its own profile; these can be very different from machine to machine.</para></listitem>
</itemizedlist>

<para> On the other hand, use of roaming profiles means: </para>

<itemizedlist>
	<listitem><para>The network administrator can control the desktop environment of all users.</para></listitem>
	<listitem><para>Use of mandatory profiles drastically reduces network management overheads.</para></listitem>
	<listitem><para>In the long run, users will experience fewer problems.</para></listitem>
</itemizedlist>

</sect2>

<sect2>
<title>Changing the Default Profile</title>

<para><quote>When the client logs onto the Domain Controller, it searches
for a profile to download. Where do I put this default profile?</quote></para>

<para>
<indexterm><primary>default profile</primary></indexterm>
First, the Samba server needs to be configured as a Domain Controller. This can be done by
setting in &smb.conf;: </para>

<smbconfblock>
<smbconfoption><name>security</name><value>user</value></smbconfoption>
<smbconfoption><name>os level</name><value>32 (or more)</value></smbconfoption>
<smbconfoption><name>domain logons</name><value>Yes</value></smbconfoption>
</smbconfblock>

<para> There must be a <smbconfsection>[netlogon]</smbconfsection> share that is world readable. It is
a good idea to add a logon script to pre-set printer and drive connections. There is also a facility
for automatically synchronizing the workstation time clock with that of the logon server (another good
thing to do). </para>

<note><para> To invoke auto-deletion of roaming profile from the local workstation cache (disk storage), use
the <application>Group Policy Editor</application> to create a file called <filename>NTConfig.POL</filename>
with the appropriate entries. This file needs to be located in the <smbconfsection>netlogon</smbconfsection>
share root directory.</para></note>

<para> Windows clients need to be members of the domain. Workgroup machines do not use network logons
so they do not interoperate with domain profiles. </para>

<para> For roaming profiles, add to &smb.conf;: </para>

<smbconfblock>
<smbconfoption><name>logon path</name><value>\\%N\profiles\%U</value></smbconfoption>
<smbconfcomment>Default logon drive is Z:</smbconfcomment>
<smbconfoption><name>logon drive</name><value>H:</value></smbconfoption>
<smbconfcomment>This requires a PROFILES share that is world writable.</smbconfcomment>
</smbconfblock>

</sect2>
</sect1>
</chapter>

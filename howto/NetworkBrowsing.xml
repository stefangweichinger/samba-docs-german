<?xml version="1.0" encoding="ISO-8859-1"?>
<chapter id="NetworkBrowsing">
<chapterinfo>
	&author.jht;
	&author.jelmer;
	<author>&person.klimklim;<contrib>Deutsche Übersetzung</contrib></author>
	<author>&person.sgw;<contrib>Deutsche Übersetzung</contrib></author>
</chapterinfo>

<title>Netzwerk-Browsing</title>

<para>
Diese Dokumentation enthält detaillierte Informationen und einen Leitfaden, wie
man das Browsing über mehrere Subnetze und/oder Arbeitsgruppen (oder Domänen)
implementiert. WINS ist das beste Werkzeug, um NetBIOS-Namen auf IP-Adressen aufzulösen.
WINS ist nicht am Umgang mit Browse-Lists beteiligt, außer bei der Auflösung von Namen auf Adressen.
</para>

<note><para>
MS Windows 2000 und neuere Windows-Versionen können so konfiguriert werden, dass sie ohne NetBIOS über
TCP/IP arbeiten, wozu Samba ab Version 3 ebenfalls in der Lage ist. Ist
die Benutzung von NetBIOS über TCP/IP deaktiviert, werden die MS Windows Maschinen
über DNS und Active Directory aufgelöst. Die folgenden Informationen gehen davon aus,
dass ein Netz mit NetBIOS über TCP/IP betrieben wird. 
</para></note>

<sect1>
<title>Planung und Beginn</title>

<para>
Jemand bezog sich einst auf die Vergangenheit mit den Worten <quote><emphasis>Es war die beste
aller Zeiten, es war die schlechteste aller Zeiten.</emphasis></quote> Je mehr wir zurück blicken,
umso mehr sehnen wir uns nach dem, was war, und hoffen, dass es nie wiederkehrt.
</para>


<para>
<indexterm><primary>NetBIOS</primary></indexterm>
Für viele MS Windows Netzwerk-Administratoren beschreibt diese Aussage präzise deren
Gefühle bezüglich NetBIOS. Diejenigen, die NetBIOS gemeistert haben, wussten was sie erwartet.
Für diejenigen, die es nie geschafft haben, seine Eigenschaften zu zähmen, erscheint NetBIOS
wie Pattersons Fluch.
</para>

<para>
Für diejenigen, die nicht mit den botanischen Problemen Australiens vertraut sind:
Pattersons Fluch, <emphasis>Echium plantagineum</emphasis>, wurde Mitte des 19.
Jahrhunderts eingeführt. Seitdem hat es sich schnell ausgebreitet. Die hohe Samenproduktion
der Pflanze, mit einer Dichte von tausenden pro Quadratmeter, einer Lebensdauer von mehr
als sieben Jahren, der Fähigkeit, unter guten Voraussetzungen, über das ganze Jahr hinweg
zu keimen, sind einige der Eigenschaften, die es zu einem solch hartnäckigen Unkraut
machen. (Frank Patterson war einer der gefürchtesten Gesetzlosen Australiens. Nachdem
er wegen eines Diebstahls von vier Dollar am Galgen landete, verfluchte er die Stadt
Ironbark und die australische Regierung. Seine Familie pflanzte eine lilafarbene,
aus England stammende Pflanze auf sein Grab, die sich rasch im ganzen Land ausbreitete.
Aufgrund der Giftigkeit der Planze kostet ihre Vernichtung die Viehzüchter Australiens
ca. 30 Mill. Dollar pro Jahr, Anm. d. Übersetzers.)
</para>

<para>
In diesem Kapitel erfahren wir die grundlegenden Aspekte der Server Message Block- (SMB)
Vernetzung mit einem besonderen Blick auf SMB als Implementation in einer NetBIOS-über-TCP/IP-
(Network Basic Input/Output System) Umgebung. Da Samba SMB oder NetBIOS nicht
über ein anderes Protokoll implementiert, ist es wichtig zu wissen, wie man die
Netzwerkumgebung konfiguriert und sich schlicht daran zu erinnern, nichts anderes als TCP/IP auf 
allen MS Windows Clients im Netzwerk zu benutzen.
</para>

<para>
Samba bietet die Möglichkeit, WINS (Windows Inter-networking Name Server) samt der 
Systemerweiterungen von Microsofts WINS zu implementieren. Diese Systemerweiterungen
helfen Samba dabei, stabile WINS Operationen, über den herkömmlichen Anwendungsbereich von
MS WINS hinaus, zu ermöglichen.
</para>

<para>
WINS wirkt sich ausschließlich auf Systeme aus, die mit NetBIOS-über-TCP/IP laufen.
MS Windows 200x/XP können NetBIOS abschalten, in welchem Fall WINS keine Rolle mehr
spielt. Samba unterstützt dies ebenfalls.
</para>

<para>
In Netzwerken, in denen NetBIOS deaktiviert ist, d.h. wo WINS nicht mehr benötigt 
wird, ist der Einsatz eines DNS für die Namensauflösung unabdingbar.
</para>

</sect1>

<sect1>
<title>Was ist Browsing?</title>

<para>
Für die meisten ist Browsing, daß sie die MS Windows und Samba Server in der
Netzwerkumgebung sehen können, und daß, wenn man auf das Icon eines bestimmten
Servers klickt, ein Fenster geöffnet wird, in dem man die verfügbaren Freigaben und
Drucker des Servers sehen kann.
</para>

<para>
Was so einfach klingt, ist in Wirklichkeit eine komplexe Interaktion verschiedener
Technologien. Die dabei involvierten Technologien (oder Methoden) beinhalten:
</para>

<itemizedlist>
	<listitem>MS Windows Maschinen melden ihre Präsenz im Netzwerk an.</listitem>
	<listitem>Maschinen kündigen sich anderen Maschinen im Netzwerk an.</listitem>
	<listitem>Eine oder mehrere Maschinen fassen diese Ankündigungen lokal zusammen.</listitem>
	<listitem>Der Client findet die Maschine, die diese Liste von Maschinen gesammelt hat.</listitem>
	<listitem>Der Client ist in der Lage, den Namen der Maschine in eine IP-Adresse aufzulösen.</listitem>
	<listitem>Der Client ist in der Lage, sich mit einer anderen Maschine zu verbinden.</listitem>
</itemizedlist>

<para>
Die Samba-Anwendung, die die Verwaltung des Browsing und die Namensauflösung kontrolliert, heißt
<filename>nmbd</filename>. Die dabei verwendeten Konfigurationsparameter sind:
</para>

<para>Browsing-Optionen: <smbconfoption><name>os level</name></smbconfoption>(*),
	<smbconfoption><name>lm announce</name></smbconfoption>,
	<smbconfoption><name>lm interval</name></smbconfoption>,
	<smbconfoption><name>preferred master</name></smbconfoption>(*),
	<smbconfoption><name>local master</name></smbconfoption>(*),
	<smbconfoption><name>domain master</name></smbconfoption>(*),
	<smbconfoption><name>browse list</name></smbconfoption>,
	<smbconfoption><name>enhanced browsing</name></smbconfoption>.
</para>

<para>Namensauflösungs-Methoden:
	<smbconfoption><name>name resolve order</name></smbconfoption>(*).
</para>

<para>WINS-Optionen:
	<smbconfoption><name>dns proxy</name></smbconfoption>,
	<smbconfoption><name>wins proxy</name></smbconfoption>,
	<smbconfoption><name>wins server</name></smbconfoption>(*),
	<smbconfoption><name>wins support</name></smbconfoption>(*),
	<smbconfoption><name>wins hook</name></smbconfoption>.
</para>

<para>
<indexterm><primary>WINS</primary></indexterm>
Für Samba sind der WINS-Server und die WINS-Unterstützung zwei einander ausschließende Optionen. Die mit
(*) markierten Optionen sind die einzigen Optionen, die im Allgemeinen verändert werden müssen. Sogar wenn
keiner dieser Parameter gesetzt ist, tut <filename>nmbd</filename> nach wir vor seinen Job.
</para>

</sect1>

<sect1 id="netdiscuss">
<title>Diskussion</title>

<para>
Die gesamte MS Windows-Netzwerk-Technologie verwendet <quote>SMB Messaging</quote>. Dieses kann mit oder ohne
NetBIOS implementiert werden. MS Windows 200x unterstützt NetBIOS-über-TCP/IP, für Rückwärtskompatibilität.
MS scheint zu planen, NetBIOS-Unterstützung auslaufen zu lassen.
</para>

<sect2>
<title>NetBIOS-über-TCP/IP</title>

<para>
Samba implementiert NetBIOS, wie es auch MS Windows NT/200x/XP tut, indem es dieses Protokoll in
TCP/IP einbettet. NetBIOS-basierendes Netzwerke verwenden Broadcasts, um die Verwaltung der Browselists zu
regeln. Wenn man NetBIOS-über-TCP/IP ausführt, verwendet dieses UDP-Messaging, diese UDP-Nachrichten können
broadcast oder uni-cast sein.
</para>


<para>
<indexterm><primary>UDP</primary></indexterm>
Normalerweise können nur uni-cast UDP-Messages von Routern weitergeleitet werden. Der Parameter
<smbconfoption><name>remote announce</name></smbconfoption> in &smb.conf; hilft dabei, die Ankündigungen und
Aktualisierungen der Browselists in entfernte Netzwerksegmente über uni-cast UDP weiterzugeben. In ähnlicher
Weise implementiert der Parameter <smbconfoption><name>remote browse sync</name></smbconfoption> in &smb.conf;
die Sammlung und Zusammenfügung von Browselists mittels uni-cast UDP.
</para>

<para>
Weiters sollte <filename>nmbd</filename> in jenen Netzen, in denen Samba die einzige SMB-Server-Technologie ist,
wo immer es möglich ist, auf einer Maschine als der WINS-Server konfiguriert werden. Das macht es einfach, die
Browsing-Umgebung zu verwalten. Wenn jedes Netzwerk-Segment mit seinem eigenen Samba-WINS-Server konfiguriert 
ist, dann ist der einzige Weg, um Browsing über mehrere Segmente zu ermöglichen, die Verwendung der Parameter
<indexterm><primary>LMB</primary><see>Local Master Browser</see></indexterm>
<indexterm><primary>Local Master Browser</primary></indexterm>
<smbconfoption><name>remote announce</name></smbconfoption> und 
<smbconfoption><name>remote browse sync</name></smbconfoption> in Ihrer &smb.conf;.
</para>

<para>
<indexterm><primary>WINS</primary></indexterm>
Wenn nur ein WINS-Server für ein gesamtes Multi-Segment-Netzwerk verwendet wird, dann sollte die Verwendung
der Parameter <smbconfoption><name>remote announce</name></smbconfoption> und
<smbconfoption><name>remote browse sync</name></smbconfoption> nicht erforderlich sein.
</para>

<para>
<indexterm><primary>Replikation</primary><secondary>WINS</secondary></indexterm>
Seit Samba-3 wird an der Replikation von WINS gearbeitet. Der Großteil des Codes wurde bereits ins Samba-SVN
übernommen, muß aber noch <quote>reifen</quote>. Diese Replikation ist kein unterstütztes Feature der
Samba-3.0.0-Release. Hoffentlich wird es zu einem unterstützten Feature in einer der folgenden Samba-3-Releases. 
</para>

<para>
Derzeit unterstützt das Samba WINS keine MS-WINS-Replikation. Das bedeutet, daß, wenn Sie einen Samba-Server als
WINS-Server einrichten, nur <emphasis>ein</emphasis> <filename>nmbd</filename> als WINS-Server im Netzwerk 
konfiguriert sein darf. Manche Installationen haben mehrere Samba-WINS-Server aus Gründen der Redundanz 
eingesetzt (ein Server pro Subnetz) und dann <smbconfoption><name>remote announce</name></smbconfoption> und
<smbconfoption><name>remote browse sync</name></smbconfoption> verwendet, um die Sammlung und Zusammenführung
der Browselists über alle Segmente zu erzielen. Beachten Sie, daß dies bedeutet, daß Clients nur lokale Namen
auflösen, und so konfiguriert werden müssen, daß sie DNS zur Auflösung von Namen anderer Subnetze verwenden,
um es ihnen zu ermöglichen, die IP-Adressen der Server anderer Subnetze aufzulösen. Dieses Setup wird nicht
empfohlen, aber wird aus Gründen der Vollständigkeit, und aus praktischen Überlegungen aufgeführt
(d.h. als Szenario, <quote>wenn alles andere schiefgeht</quote>).
</para>

<para>
Zuletzt beachten Sie noch, daß Browselists eine Sammlung von unzuverlässigen Broadcast-Nachrichten sind, die in
Intervallen von nicht mehr als 15 Minuten wiederholt werden. Das bedeutet, daß es Zeit braucht, eine Browselist
zu bilden, und es bis zu 45 Minuten dauern kann, bis diese sich stabilisiert, speziell über verschiedene
Netzwerk-Segmente hinweg.
</para>

</sect2>

<sect2>
<title>TCP/IP ohne NetBIOS</title>

<para>
<indexterm><primary>NetBIOS</primary></indexterm>
<indexterm><primary>NetBIOS-frei</primary></indexterm>
<indexterm><primary>DNS</primary></indexterm>
Alle TCP/IP-fähigen Systeme verwenden verschiedene Formen der Namensauflösung. Die primären Methoden für
TCP/IP-Namensauflösung inkludieren entweder eine statische Datei (<filename>/etc/hosts</filename>) oder
DNS (Domain Name System). DNS ist die Technologie, die das Internet benutzbar macht. DNS-basierende
Namensauflösung wird von fast allen TCP/IP-fähigen Systemen unterstützt, nur ein paar wenige 
<quote>embedded</quote> TCP/IP-Systeme unterstützen kein DNS.
</para>

<para>
Wenn ein MS Windows 200x/XP-System versucht, einen Hostnamen zu einer IP-Adresse aufzulösen, folgt es einem
definierten Pfad:
</para>

<orderedlist>
	<listitem><para>
	Prüfung der Datei <filename>hosts</filename>. Diese befindet sich in
	<filename>C:\Windows NT\System32\Drivers\etc</filename>.
	</para></listitem>

	<listitem><para>
	Ausführung einer DNS-Abfrage.
	</para></listitem>

        <listitem><para>
	Prüfung des NetBIOS-Namens-Cache.
        </para></listitem>

        <listitem><para>
	Abfrage des WINS-Server.
        </para></listitem>

        <listitem><para>
	Ausführung einer Broadcast-Abfrage über UDP.
        </para></listitem>

        <listitem><para>
	Überprüfung der Datei LMHOSTS, in
        <filename>C:\Windows NT\System32\Drivers\etc</filename>.
        </para></listitem>
</orderedlist>


<para>
<indexterm><primary>DNS</primary></indexterm>
Windows 200x/XP kann seinen Hostnamen an einem <quote>Dynamic DNS Server</quote> registrieren. Sie können dies
erzwingen:
<command>ipconfig /registerdns</command>.
</para>

<para>
Mit Active Directory (ADS) ist ein korrekt funktionierender DNS-Server essentiell notwendig.
Beim Fehlen eines korrekt funktionierenden und arbeitenden DNS-Servers sind die MS Windows Clients und Server
nicht mehr imstande, einander gegenseitig zu finden, daher werden in Folge auch die Netzwerkdienste ernsthaft
geschädigt.
</para>

<para>
Die Verwendung von <quote>Dynamic DNS</quote> wird mit Active Directory wärmstens empfohlen,
wo auch der Einsatz von BIND9 vorzuziehen ist (wegen seiner Fähigkeit zur adäquaten Unterstützung der 
SRV-Einträge, die für Active Directory benötigt werden).
</para>

</sect2>

<sect2 id="adsdnstech">
<title>DNS und Active Directory</title>


<para>
<indexterm><primary>DNS</primary><secondary>Active Directory</secondary></indexterm>
Fallweise hören wir von UNIX-Netzwerk-Administratoren, die einen UNIX-basierenden Dynamic-DNS-Server
anstatt des MS-DNS-Servers einsetzen wollen. Während dies für manche wünschenswert seín mag, der
MS Windows 200x DNS Server ist für die Zusammenarbeit mit Active Directory automatisch vorkonfiguriert. Es
ist möglich, BIND in der Version 8 oder 9 einzusetzen, aber es wird fast mit Sicherheit notwendig sein,
SRV-Einträge anzulegen, damit MS Active Directory Clients Hostnamen auflösen können, um essentielle
Netzwerkdienste lokalisieren können. Im Folgenden einige der Standard-SRV-Einträge, die Active Directory
benötigt:
</para>

<variablelist>
<varlistentry>
	<term>_ldap._tcp.pdc._msdcs.<emphasis>Domain</emphasis></term>
	<listitem>
	<para>
	Gibt die Adresse des Windows NT PDC für die Domäne an.
	</para>
	</listitem>
</varlistentry>
<varlistentry>
	<term>_ldap._tcp.pdc._msdcs.<emphasis>DomainTree</emphasis></term>
	<listitem>
        <para>
	Löst die Adressen der <quote>Global Catalog Server</quote> in der Domäne auf.
        </para>
	</listitem>
</varlistentry>
<varlistentry>
        <term>_ldap._tcp.<emphasis>site</emphasis>.sites.writable._msdcs.<emphasis>Domain</emphasis></term>
	<listitem>
        <para>
	Gibt eine Liste der Domänen-Controller an, basierend auf den Sites.
        </para>
	</listitem>
</varlistentry>
<varlistentry>
        <term>_ldap._tcp.writable._msdcs.<emphasis>Domain</emphasis></term>
	<listitem>
        <para>
	Listet Domänen-Controller auf, die eine schreibberechtigte Kopie des Active Directory führen.
        </para>
	</listitem>
</varlistentry>
<varlistentry>
	<term>_ldap._tcp.<emphasis>GUID</emphasis>.domains._msdcs.<emphasis>DomainTree</emphasis></term>
	<listitem>
	<para>
	Eintrag, der von MS Windows Clients verwendet wird, um Maschinen mittels des 
	<quote>Global Unique Identifier</quote> zu lokalisieren.
	</para>
	</listitem>
</varlistentry>
<varlistentry>
	<term>_ldap._tcp.<emphasis>Site</emphasis>.gc._msdcs.<emphasis>DomainTree</emphasis></term>
	<listitem>
	<para>
	Verwendet von MS Windows Clients, um den <quote>Global Catalog server</quote> zu lokalisieren,
 	der abhängig von der Site-Konfiguration ist.
	</para>
	</listitem>
</varlistentry>
</variablelist>

	<para>
	Spezifische Einträge, die von MS Windows Clients verwendet werden, um essentielle Dienste für eine
	Beispiel-Domäne namens <constant>quenya.org</constant> zu lokalisieren, beinhalten:
	</para>

	<itemizedlist>
		<listitem><para>
		_kerberos._udp.quenya.org &smbmdash; Verwendet, um den KDC-Server über UDP zu kontaktieren.
		Dieser Eintrag muß für jeden KDC den Port 88 auflisten.
		</para></listitem>

		<listitem><para>
		_kpasswd._udp.quenya.org &smbmdash; Verwendet, um den <constant>kpasswd</constant>-Server
		zu lokalisieren, wenn die Änderung eines Benutzerpassworts bearbeitet werden soll. Dieser
		Eintrag muß den Port 464 auf dem Master-KDC auflisten.
		</para></listitem>

		<listitem><para>
		_kerberos._tcp.quenya.org &smbmdash; Verwendet, um den KDC-Server via TCP zu lokalisieren.
		Dieser Eintrag muß für jeden KDC den Port 88 auflisten.
		</para></listitem>

		<listitem><para>
		_ldap._tcp.quenya.org &smbmdash; Verwendet, um den LDAP-Dienst auf dem PDC zu lokalisieren.
		Dieser Eintrag muß den Port 389 des PDCs enthalten.		
		</para></listitem>

		<listitem><para>
		_kpasswd._tcp.quenya.org &smbmdash; Verwendet, um den <constant>kpasswd</constant>-Server
                zu lokalisieren, um Änderungen von Benutzerpasswörtern zu erlauben. Dieser Eintrag muß den Port
		464 enthalten.
		</para></listitem>

		<listitem><para>
		_gc._tcp.quenya.org &smbmdash; Verwendet, um den <quote>Global Catalog server</quote> für
		die Domäne zu lokalisieren. Dieser Eintrag muß den Port 3268 auflisten.
		</para></listitem>
	</itemizedlist>
	
	<para>
	Die folgenden Einträge werden auch vom Windows Domain Member Client verwendet, um wichtige Dienste
	auf den Windows ADS Domänen-Controllern zu finden.
	</para>

	<itemizedlist>
		<listitem><para>
		_ldap._tcp.pdc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_ldap.gc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_ldap.default-first-site-name._sites.gc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_ldap.{SecID}.domains._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_ldap._tcp.dc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_kerberos._tcp.dc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_ldap.default-first-site-name._sites.dc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_kerberos.default-first-site-name._sites.dc._msdcs.queyna.org
		</para></listitem>

		<listitem><para>
		SecID._msdcs.quenya.org
		</para></listitem>
	</itemizedlist>

	<para>
	Das Vorhandensein der korrekten DNS-Einträge kann so validiert werden:
<screen>
&rootprompt; dig @frodo -t any _ldap._tcp.dc._msdcs.quenya.org

; &lt;lt;&gt;&gt; DiG 9.2.2 &lt;lt;&gt;&gt; @frodo -t any _ldap._tcp.dc._msdcs.quenya.org
;; global options:  printcmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 3072
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 2


;; QUESTION SECTION:
;_ldap._tcp.dc._msdcs.quenya.org. IN        ANY


;; ANSWER SECTION:
_ldap._tcp.dc._msdcs.quenya.org. 600 IN SRV 0 100 389 frodo.quenya.org.
_ldap._tcp.dc._msdcs.quenya.org. 600 IN SRV 0 100 389 noldor.quenya.org.


;; ADDITIONAL SECTION:
frodo.quenya.org. 3600  IN      A       10.1.1.16
noldor.quenya.org. 1200  IN      A       10.1.1.17


;; Query time: 0 msec
;; SERVER: frodo#53(10.1.1.16)
;; WHEN: Wed Oct  7 14:39:31 2004
;; MSG SIZE  rcvd: 171
</screen>
	</para>

</sect2>

</sect1>

<sect1>
<title>Wie Browsing funktioniert</title>

<para>
MS Windows Maschinen registrieren ihre NetBIOS-Namen (d.h. den Maschinen-Namen für jeden laufenden Dienst)
beim Start. Die genaue Methode, in der diese Registrierung stattfindet, ist davon abhängig, ob der
MS Windows Client/Server eine WINS-Server-Adresse erhalten hat oder nicht, ob die LMHOSTS-Abfrage aktiviert ist,
ob DNS für die Auflösung von NetBIOS-Namen aktiviert ist, etc.
</para>

<para>
In dem Fall, wo es keinen WINS-Server gibt, werden alle Namensregistrierungen wie auch Namensabfragen mittels
UDP-Broadcasts durchgeführt. Dies beschränkt die Namensauflösung auf das lokale Subnetz, außer LMHOSTS wird
zur Listung aller Namen und IP-Adressen verwendet. In solchen Situationen bietet Samba eine Möglichkeit, mit
der der Samba-Server zwangsweise in die Browselist eines fernen MS Windows Netzwerks eingetragen werden kann
(mittels des Parameters <smbconfoption><name>remote announce</name></smbconfoption>).
</para>

<para>
Wo ein WINS-Server eingesetzt wird, wird der MS Windows Client UDP uni-cast verwenden, um sich am WINS-Server
zu registrieren. Solche Pakete können geroutet werden und daher erlaubt WINS Namensauflösung über geroutete
Netzwerke.
</para>

<para>
Während des Startvorgangs wird eine Wahl stattfinden, um einen <quote>Local Master Browser</quote> zu bestimmen,
wenn nicht bereits ein solcher existiert. In jedem NetBIOS-Netzwerk wird eine Maschine erwählt, um als
der <quote>Domain Master Browser</quote> zu fungieren. Dieses Domänen-Browsing hat nichts mit 
MS Domänen-Controlling zu tun. Stattdessen übernimmt der Domain Master Browser die Rolle, jeden
LMB (<quote>Local Master Browser</quote>) zu kontaktieren (entweder über WINS oder LMHOSTS ausfindig gemacht),
und die Browselists auszutauschen. Auf diese Weise erhält jeder Master Browser eine komplette Liste aller
Maschinen im Netzwerk. Alle 11 bis 15 Minuten wird eine Wahl abgehalten, um zu bestimmen, welche Maschine der
Master Browser sein soll. Nach den Kriterien dieser Wahl wird die Maschine mit der größten Uptime, der
höchsten Protokoll-Version oder anderen Kriterien die Wahl zum <quote>Domain Master Browser</quote> gewinnen.
</para>

<para>
Clients, die das Netzwerk durchsuchen wollen, verwenden diese Liste, aber sind auch abhängig von korrekter
Namensauflösung auf die entsprechenden IP-Adresse(n).
</para>

<para>
Jede Konfiguration, die die Namensauflösung und/oder die Browsing-Funktionalitäten verletzt, wird die Benutzer
verärgern, da sie dann immer wieder damit konfrontiert sind, die Netzwerkdienste nicht verwenden zu können.
</para>

<para>
Samba unterstützt ein Feature, das die erzwungene Synchronisation von Browselists über geroutete Netzwerke
mittels des Parameters <smbconfoption><name>remote browse sync</name></smbconfoption> in der Datei
&smb.conf; erlaubt. Dies veranlasst Samba, den LMB in einem fernen Netzwerk zu kontaktieren, und dort die
Synchronisation der Browselists zu erfragen. Dies überbrückt effektiv zwei durch Router getrennte Netzwerke.
Die beiden entfernten Netzwerke können entweder Broadcast-basierende oder WINS-basierende Namensauflösung
verwenden, aber es sollte beachtet werden, daß der Parameter 
<smbconfoption><name>remote browse sync</name></smbconfoption> Browselist-Synchronisation anbietet, und diese
ist etwas anderes als Namensauflösung. In anderen Worten, um <quote>Cross-Subnetz-Browsing</quote> korrekt
arbeiten zu lassen, ist es essentiell, daß ein Mechanismus zur Auflösung von Namen auf Adressen vorhanden ist.
Dieser Mechanismus kann via DNS, <filename>/etc/hosts</filename>, usw. funktionieren.
</para>

<sect2 id="DMB">
<title>Konfiguration von ARBEITSGRUPPEN-Browsing</title>

<para>
Um <quote>Cross-Subnetz-Browsing</quote> in einem Netzwerk zu konfigurieren, das Maschinen in einer
ARBEITSGRUPPE enthält, nicht solche einer NT Domäne, müssen Sie einen Samba-Server als Domänen Master Browser
(DMB) einrichten (beachten Sie, daß dies nicht dasselbe wie ein Primär-Domänen-Controller ist, obwohl in einer
NT Domäne dieselbe Maschine beide Funktionen übernimmt). Die Rolle eines Domänen Master Browsers ist das
Sammeln und Zusammenfügen der Browselists von den Lokalen Master Browsern all der Subnetze, die eine Maschine
beinhalten, die Teil der Arbeitsgruppe ist. Ohne daß eine Maschine als Domänen Master Browser konfiguriert ist,
würde jedes Subnetz eine isolierte Arbeitsgruppe sein, die unfähig wäre, irgendwelche Maschinen in einem anderen
Subnetz zu sehen. Es ist das Vorhandensein eines Domänen Master Browsers, der Cross-Subnetz-Browsing für eine
Arbeitsgruppe ermöglicht. 
</para>

<para>
In einer ARBEITSGRUPPEN-Umgebung muß der Domänen Master Browser ein Samba-Server sein, und es darf nur einen
DMB pro Arbeitsgruppen-Namen geben. Um einen Samba-Server als DMB einzurichten, setzen Sie folgende Option
im Abschnitt <smbconfsection>[global]</smbconfsection> der Datei &smb.conf;:
</para>

<para>
<smbconfblock>
<smbconfoption><name>domain master</name><value>yes</value></smbconfoption>
</smbconfblock>
</para>

<para>
Der Domänen Master Browser sollte vorzugsweise auch der Lokale Master Browser für sein eigenes Subnetz sein.
Um dies zu erreichen, setzen Sie die Optionen im Abschnitt <smbconfsection>[global]</smbconfsection>
der Datei &smb.conf; wie <link linkend="dmbexample">im folgenden Beispiel</link>:
</para>

<para>
<smbconfexample id="dmbexample">
<title>smb.conf für einen Domänen Master Browser</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain master</name><value>yes</value></smbconfoption>
<smbconfoption><name>local master</name><value>yes</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>yes</value></smbconfoption>
<smbconfoption><name>os level</name><value>65</value></smbconfoption>
</smbconfexample>
</para>

<para>
Der Domänen Master Browser kann dieselbe Maschine wie der WINS-Server sein, wenn notwendig.
</para>

<para>
Als Nächstes sollten Sie sicherstellen, daß jedes der Subnetze eine Maschine enthält, die als der Lokale Master 
Browser für die Arbeitsgruppe arbeiten kann. Jede MS Windows NT/200x/XP-Maschine sollte imstande sein, dies zu 
tun, genauso wie Windows 9x/Me-Maschinen (obwohl diese dazu neigen, öfters neu gestartet zu werden, also ist es
keine allzu gute Idee, diese dafür zu verwenden). Um einen Samba-Server zu einem Lokalen Master Browser zu 
machen, setzen Sie die Optionen im Abschnitt <smbconfsection>[global]</smbconfsection>
der Datei &smb.conf; wie <link linkend="lmbexample">im folgenden Beispiel</link>:
</para>

<para>
<smbconfexample id="lmbexample">
<title>smb.conf für einen Lokalen Master Browser</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain master</name><value>no</value></smbconfoption>
<smbconfoption><name>local master</name><value>yes</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>yes</value></smbconfoption>
<smbconfoption><name>os level</name><value>65</value></smbconfoption>
</smbconfexample>
</para>

<para>
Machen Sie das nicht für mehr als einen Samba-Server pro Subnetz, oder diese Rechner werden gegeneinander darum
kämpfen, welcher denn der Lokale Master Browser sein soll.
</para>

<para>
Der Parameter <smbconfoption><name>local master</name></smbconfoption> erlaubt es Samba, als Lokaler Master 
Browser zu arbeiten. Der Parameter <smbconfoption><name>preferred master</name></smbconfoption> veranlaßt
<command>nmbd</command> dazu, bei seinem Start eine Browser-Wahl zu erzwingen, und 
<smbconfoption><name>os level</name></smbconfoption> stuft Samba so hoch ein, daß es jede Wahl gewinnen sollte.
</para>

<para>
Wenn Sie eine NT-Maschine im Subnetz haben, die Sie zum Lokalen Master Browser machen wollen, können Sie Samba
<quote>verbieten</quote>, ein Lokaler Master Browser zu werden, indem Sie folgende Optionen im Abschnitt 
<smbconfsection>[global]</smbconfsection>
der Datei &smb.conf; wie <link linkend="nombexample">im folgenden Beispiel</link> setzen:
</para>

<para>
<smbconfexample id="nombexample">
<title>smb.conf für Samba-Server, der nicht Master Browser ist</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain master</name><value>no</value></smbconfoption>
<smbconfoption><name>local master</name><value>no</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>no</value></smbconfoption>
<smbconfoption><name>os level</name><value>0</value></smbconfoption>
</smbconfexample>
</para>

</sect2>

<sect2>
<title>Konfiguration von DOMÄNEN-Browsing</title>

<para>
Wenn Sie Samba-Server einer Windows-NT-Domäne hinzufügen, dann dürfen Sie keinen Samba-Server als Domänen Master
Browser einrichten. Standardmässig ist der Windows NT-PDC einer Domäne auch gleichzeitig der Domänen Master
Browser für diese Domäne. Das Netzwerk-Browsing kann zusammenbrechen, wenn sich ein Samba-Server mit dem
NetBIOS-Namen des Domänen Master Browsers am WINS-Server anmeldet (<replaceable>DOMÄNE</replaceable>&lt;1B&gt;),
zusätzlich zum PDC.
</para>

<para>
Für andere Subnetze als jenes, das den Windows NT PDC enthält, können Sie wie beschrieben Samba-Server als
Lokale Master Browser einrichten. Um einen Samba-Server zu einem Lokalen Master Browser zu machen, setzen Sie
folgende Optionen im Abschnitt <smbconfsection>[global]</smbconfsection>
der Datei &smb.conf; wie <link linkend="remsmb">im folgenden Beispiel</link>:
</para>

<para>
<smbconfexample id="remsmb">
<title>smb.conf für einen Lokalen Master Browser</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain master</name><value>no</value></smbconfoption>
<smbconfoption><name>local master</name><value>yes</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>yes</value></smbconfoption>
<smbconfoption><name>os level</name><value>65</value></smbconfoption>
</smbconfexample>
</para>

<para>
Wenn Sie wollen, daß ein Samba-Server mit anderen Maschinen im Subnetz um den Sieg in der Browsing-Wahl kämpft,
können Sie den Parameter <smbconfoption><name>os level</name></smbconfoption> auf niedrigere Werte setzen. Damit 
können Sie die Reihenfolge feintunen, in der die Maschinen zum Lokalen Master Browser werden, wenn sie laufen.
Mehr Details dazu im Abschnitt 
<link linkend="browse-force-master">Wie man Samba dazu zwingt, der Master zu sein</link>.
</para>

<para>
Wenn Sie Windows NT Maschinen haben, die Domänenmitglieder auf allen Subnetzen sind, und Sie sind sich sicher, 
daß diese Maschinen immer laufen werden, können Sie Samba von der Teilnahme an Browsing-Wahlen ausnehmen, und
damit deaktivieren, daß Samba jemals ein Lokaler Master Browser wird, indem Sie folgende Optionen im 
Abschnitt <smbconfsection>[global]</smbconfsection>
der Datei &smb.conf; wie <link linkend="xremmb">im folgenden Beispiel</link> setzen:
</para>

<para>
<smbconfexample id="xremmb">
<title>&smb.conf; für Samba-Server, der nie Master Browser wird</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain master</name><value>no</value></smbconfoption>
<smbconfoption><name>local master</name><value>no</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>no</value></smbconfoption>
<smbconfoption><name>os level</name><value>0</value></smbconfoption>
</smbconfexample>
</para>

</sect2>

<sect2 id="browse-force-master">
<title>Wie man Samba dazu zwingt, der Master zu sein</title>

<para>
Wer der Master Browser wird, hängt von einem Wahlvorgang ab, der Broadcasts verwendet. Jedes Wahl-Paket enthält
eine Anzahl von Parametern, die bestimmen, welchen Rang ein Host in der Wahl einnimmt. Per Standard verwendet
Samba einen niedrigen Rang und verliert daher die Wahlen gegen so gut wie jeden Windows-Netzwerk-Client oder
-Server.
</para>

<para>
Wenn Sie wollen, daß Samba Wahlen gewinnt, setzen Sie die globale Option 
<smbconfoption><name>os level</name></smbconfoption> in &smb.conf; auf einen höheren Wert. Der Standard ist 20.
Die Verwendung von 34 liesse Samba alle Wahlen gegen jedes andere System gewinnen (außer gegen andere 
Samba-Systeme).
</para>

<para>
Ein <smbconfoption><name>os level</name></smbconfoption> von 2 würde es Windows for Workgroups und Windows 9x/Me
schlagen lassen, aber nicht MS Windows NT/200x Server. Ein MS Windows NT/200x Server Domänen Controller verwendet
level 32. Das Maximum für <smbconfoption><name>os level</name></smbconfoption> ist 255.
</para>

<para>
Wenn Sie wollen, daß Samba bei seinem Start eine Wahl erzwingt, setzen Sie die globale Option
<smbconfoption><name>preferred master</name></smbconfoption> in &smb.conf; auf <constant>yes</constant>.
Samba hat dann einen leichten Vorteil gegnüber anderen potentiellen Master Browsern, die keine
<quote>Preferred Master Browser</quote> sind. Verwenden Sie diesen Parameter vorsichtig, denn wenn Sie zwei
Hosts (egal ob diese Windows 9x/Me oder NT/200x/XP oder Samba ausführen) im selben Subnetz habe, die
<smbconfoption><name>preferred master</name></smbconfoption> auf <constant>yes</constant> gesetzt haben, werden
diese beiden periodisch und kontinuierlich eine Wahl erzwingen, um Lokaler Master Browser zu werden.
</para>

<para>
Wenn Sie wollen, daß Samba ein <emphasis>Domänen Master Browser</emphasis> wird, dann ist es zu empfehlen,
daß Sie auch <smbconfoption><name>preferred master</name></smbconfoption> auf <constant>yes</constant> setzen,
da Samba nicht zum Domänen Master Browser für Ihr gesamtes LAN oder WAN wird, wenn er nicht auch ein Lokaler
Master Browser in seinem eigenen Broadcast-isolierten Subnetz ist. 
</para>

<para>
Es ist möglich, zwei Samba-Server so zu konfigurieren, daß sie versuchen, Domänen Master Browser für eine Domäne
zu werden. Der erste Server, der startet, wird der Domänen Master Browser. Alle anderen Samba-Server werden alle
fünf Minuten versuchen, zum Domänen Master Browser zu werden. Sie werden herausfinden, daß ein anderer 
Samba-Server bereits der Domänen Master Browser ist und scheitern. Dies gewährt automatisch Redundanz, wenn der
aktuelle Domänen Master Browser ausfallen sollte.
</para>

</sect2>

<sect2>
<title>Wie man Samba zum Domänen Master macht</title>

<para>
Der Domänen Master ist verantwortlich für die Sammlung und Zusammenführung der Browselists von
mehreren Subnetzen, sodaß Browsing über Subnetze hinweg stattfinden kann. Sie können Samba zum Domänen Master
machen, indem Sie in der Datei &smb.conf; den Parameter 
<smbconfoption><name>domain master</name><value>yes</value></smbconfoption> setzen. In der Voreinstellung ist
Samba kein Domänen Master.
</para>

<para>
Setzen Sie Samba nicht auf Domänen Master für eine Arbeitsgruppe, die denselben Namen wie eine
NT/200x Domäne hat. Wenn Samba als Domänen Master für eine Arbeitsgruppe konfiguriert ist, die sich im selben 
Subnetz wie
eine gleichnamige Windows NT/200x Domäne befindet, werden mit Sicherheit Browsing-Probleme auftreten.
</para>

<para>
Wenn Samba Domänen Master und Master Browser ist, wird es auf Master-Verlautbarungen (die ca. alle 12 Minuten
stattfinden) von Lokalen Master Browsern in anderen Subnetzen hören, und diese dann kontaktieren, um die
Browselists zu synchronisieren.
</para>

<para>
Wenn Sie wollen daß Samba der Domänen Master ist, sollten Sie auch den Wert für
<smbconfoption><name>os level</name></smbconfoption> ausreichend hoch setzen, um sicherzustellen, daß Samba
Browsing-Wahlen gewinnt, und <smbconfoption><name>preferred master</name></smbconfoption> auf
<constant>yes</constant>, um beim Start von Samba eine solche Wahl zu erzwingen.
</para>

<para>
Alle Server (inklusive Samba) und Clients sollten einen WINS-Server zur NetBIOS-Namensauflösung verwenden. Wenn
Ihre Clients nur Broadcasting zur NetBIOS-Namensauflösung verwenden, werden zwei Dinge geschehen:
</para>

<orderedlist>
<listitem>
	<para>
	Die Lokalen Master Browser werden nicht mehr imstande sein, einen Domänen Master Browser zu finden, da
	sie nur noch im lokalen Subnetz suchen können.
	</para>
</listitem>

<listitem>
	<para>
	Wenn ein Client doch eine domänen-weite Browselist erhascht, und ein Benutzer versucht, auf einen Host in
	dieser Liste zuzugreifen, wird er nicht imstande sein, den NetBIOS-Namen dieses Hosts aufzulösen.
	</para>
</listitem>
</orderedlist>

<para>
Wenn jedoch sowohl Samba als auch Ihre Clients einen WINS-Server verwenden, dann:
</para>

<orderedlist>
<listitem>
	<para>
	Lokale Master Browser kontaktieren den WINS-Server, und, sofern Samba sich als Domänen Master Browser
	am WINS-Server registriert hat, der Lokale Master Browser empfängt die IP-Adresse des Samba-Servers
	als die seines Domänen Master Browsers.
	</para>
</listitem>

<listitem>
	<para>
	Wenn ein Client eine domänen-weite Browselist erhält, und ein Benutzer versucht, auf einen Host in
        dieser Liste zuzugreifen, kontaktiert der Client den WINS-Server, um den NetBIOS-Namen dieses Hosts
	aufzulösen. Sofern dieser Host seinen eigenen NetBIOS-Namen am selben WINS-Server registriert hat, wird
	der Benutzer diesen Host auch sehen können.	
	</para>
</listitem>
</orderedlist>

</sect2>

<sect2>
<title>Bemerkung zu Broadcast-Adressen</title>

<para>
Wenn Ihr Netzwerk eine auf 0 basierende Broadcast-Adresse verwendet (zum Beispiel, wenn diese auf 0 endet), dann
werden Sie Probleme bekommen. Windows for Workgroups scheint keine 0-Broadcasts zu unterstützen, und Sie werden
wahrscheinlich herausfinden, daß Browsing und Namensauflösung nicht funktionieren.
</para>
</sect2>

<sect2>
<title>Mehrere Interfaces</title>

<para>
Samba unterstützt Maschinen mit mehreren Netzwerk-Interfaces. Wenn Sie mehrere Interfaces haben, müssen Sie die
Option <smbconfoption><name>interfaces</name></smbconfoption> in &smb.conf; setzen, um sie zu konfigurieren.
</para>
</sect2>
<sect2>
<title>Verwendung des Parameters Remote Announce</title>
<para>
Der Parameter <smbconfoption><name>remote announce</name></smbconfoption> in &smb.conf; kann dazu verwendet
werden, zu erzwingen, daß all die NetBIOS-Namen eines Netzwerks in einem entfernten Netzwerk bekanntgegeben
werden. Die Syntax des Parameters <smbconfoption><name>remote announce</name></smbconfoption> ist:
<smbconfblock>
<smbconfoption><name>remote announce</name><value>a.b.c.d [e.f.g.h] ...</value></smbconfoption>
</smbconfblock>
<emphasis>or</emphasis>
<smbconfblock>
<smbconfoption><name>remote announce</name><value>a.b.c.d/ARBEITSGRUPPE [e.f.g.h/ARBEITSGRUPPE] ...</value></smbconfoption>
</smbconfblock>

wobei:
<variablelist>
	<varlistentry><term><replaceable>a.b.c.d</replaceable> und <replaceable>e.f.g.h</replaceable></term>
		<listitem><para>
<indexterm><primary>LMB</primary><see>Local Master Browser</see></indexterm>
<indexterm><primary>Local Master Browser</primary></indexterm>
		entweder die IP-Adresse des LMB (Lokaler Master Browser) ist oder die Broadcast-Adresse des
		entfernten Netzwerks, d.h. der LMB ist unter 192.168.1.10 erreichbar, oder die Adresse wird
		als 192.168.1.255 angegeben, wobei ein 24-Bit-Netzwerk angenommen wird (255.255.255.0).
		Wenn die Bekanntgabe an die Broadcast-Adresse des entfernten Netzwerks erfolgt, wird jeder
		Host diese empfangen. Das macht ziemlich viel <quote>Lärm</quote> im Netz, und daher nicht
		erstrebenswert, kann aber erforderlich sein, wenn wir die IP-Adresse des entfernten LMBs nicht
		kennen.
		</para></listitem>
	</varlistentry>

	<varlistentry>
		<term><replaceable>ARBEITSGRUPPE</replaceable></term>
		<listitem><para>ist optional und kann entweder unsere eigene Arbeitsgruppe oder die des 
		entfernten Netzwerks sein. Wenn Sie den Arbeitsgruppen-Namen des entfernten Netzwerks verwenden,
		werden unser NetBIOS-Maschinen-Namen so aussehen, als ob sie jener Arbeitsgruppe gehörten. Dies
		kann zu Namensauflösungs-Problemen führen und sollte vermieden werden.
		</para></listitem>
	</varlistentry>
</variablelist>
</para>

</sect2>

<sect2>
<title>Verwendung des Parameters Remote Browse Sync</title>

<para>
Der Parameter <smbconfoption><name>remote browse sync</name></smbconfoption> 
in &smb.conf; wird verwendet, um einem anderen LMB mitzuteilen, daß er seine NetBIOS-Namensliste mit unserem
Samba-LMB synchronisieren muß. Dies funktioniert nur, wenn der Samba-Server, der diese Option gesetzt hat,
gleichzeitig der LMB in seinem Netzwerk-Segment ist.
</para>

<para>
Die Syntax des Parameters <smbconfoption><name>remote browse sync</name></smbconfoption> ist:

<smbconfblock>
<smbconfoption><name>remote browse sync</name><value><replaceable>a.b.c.d</replaceable></value></smbconfoption>
</smbconfblock>

wobei <replaceable>a.b.c.d</replaceable> entweder die IP-Adresse des entfernten LMBs ist, oder die 
Netzwerk-Broadcast-Adresse des entfernten Netzwerk-Segments.
</para>

</sect2>

</sect1>

<sect1>
<title>WINS &smbmdash; Der <quote>Windows Inter-networking Name Server</quote></title>

<para>
Die Verwendung von WINS (entweder Samba oder MS Windows NT Server WINS) wird wärmstens empfohlen. Jede
NetBIOS-Maschine registriert seinen Namen zusammen mit einem <quote>name_type</quote>-Wert für jeden der
Dienste, die sie zur Verfügung stellt. Die Maschine registriert Ihren Namen direkt als eindeutigen Namen
(Typ 0x03). Sie registriert ihren Namen auch, wenn sie den LanManager-kompatiblen Server-Dienst ausführt
(wird zur Freigabe von Dateien und Druckern verwendet), indem sie den Server-Namen (Typ 0x20) registriert.
</para>

<para>
Alle NetBIOS-Namen sind bis zu 15 Zeichen lang. Die Variable name_type wird an den Namen angehängt, daher 
entsteht ein 16-Zeichen-Name. Jeder Name, der kürzer als 15 Zeichen ist, wird mit Leerzeichen bis zum 15. Zeichen
aufgefüllt. Daher sind alle NetBIOS-Namen 16 Zeichen lang (inklusiver der name_type Information).
</para>

<para>
WINS kann diese 16-Zeichen-Namen bei ihrer Registrierung speichern. Ein Client, der sich am Netzwerk anmelden 
will, kann den WINS-Server nach einer Liste aller registrierten Namen befragen. Das spart 
Broadcast-Netzwerkverkehr und beschleunigt die Bearbeitung von Anmeldungen deutlich. Da Broadcast-Namensauflösung
nicht über Netzwerk-Segmente hinweg verwendet werden kann, kann diese Art von Information nur via WINS
bereitgestellt werden, oder via einer statisch konfigurierten <filename>lmhosts</filename>-Datei, die bei
Fehlen von WINS auf allen Clients vorhanden sein muß. 
</para>

<para>
WINS erfüllt auch den Zweck, die Synchronisation von Browselists auf allen LMBs zu erzwingen. Die LMBs müssen 
ihre Browselists mit dem DMB (Domänen Master Browser) synchronisieren, und WINS hilft den LMBs, ihren
zugehörigen DMB zu identifizieren. Per Definition funktioniert dies nur innerhalb einer einzelnen Arbeitsgruppe.
Beachten Sie, daß der Domänen Master Browser nichts damit zu tun hat, was als MS Windows NT Domäne bezeichnet
wird. Letzteres ist die Bezeichnung für eine Sicherheits-Umgebung, während sich die Bezeichnung DMB nur auf den 
Master-Controller der Browselist-Informationen bezieht.
</para>

<para>
WINS arbeitet nur korrekt, wenn der TCP/IP-Protokoll-Stack jedes Clients für die Verwendung der WINS-Server
konfiguriert ist. Jeder Client, der nicht für die Verwendung des WINS-Servers konfiguriert ist, verwendet
weiterhin Broadcast-Namensauflösung, und es kann sein, daß WINS gar nicht von diesem Client erfährt. In jedem
Fall werden die Namen von Maschinen, die nicht im WINS registriert sind, nicht von anderen Clients aufgelöst
werden können, und daher zu Zugriffsproblemen und Fehlern führen.
</para>

<para>
Um Samba als WINS-Server zu konfigurieren, fügen Sie
<smbconfoption><name>wins support</name><value>yes</value></smbconfoption> zum Abschnitt 
<smbconfsection>[global]</smbconfsection> ihrer &smb.conf; hinzu.
</para>

<para>
Um Samba so zu konfigurieren, daß es sich an einem WINS-Server registriert, fügen Sie
<smbconfoption><name>wins server</name><value>a.b.c.d</value></smbconfoption> zum Abschnitt
<smbconfsection>[global]</smbconfsection> ihrer &smb.conf; hinzu.
</para>

<important><para>
Verwenden Sie niemals <smbconfoption><name>wins support</name><value>yes</value></smbconfoption> gemeinsam mit
<smbconfoption><name>wins server</name><value>a.b.c.d</value></smbconfoption>, besonders nicht mit der eigenen
IP-Adresse. Wenn beide Parameter so angegeben werden, wird &nmbd; den Start verweigern!
</para></important>

<sect2>
<title>Die Konfiguration des WINS Servers</title>

<para>
Es kann entweder ein Samba-Server oder ein Windows NT Server als ein WINS-Server eingerichtet werden. Um einen
Samba-Server als WINS-Server einzurichten, müssen Sie auf dem gewählten Server folgende Zeile dem Abschnitt
<smbconfsection>[global]</smbconfsection> der &smb.conf; hinzufügen:
</para>

<para>
<smbconfblock>
<smbconfoption><name>wins support</name><value>yes</value></smbconfoption>
</smbconfblock>
</para>

<para>
Samba-Versionen vor 1.9.17 hatten diesen Parameter standardmässig auf <quote>yes</quote> gesetzt. 
Wenn Sie irgendwelche älteren
Samba-Versionen in Ihrem Netzwerk haben, ist es sehr ratsam, diese Installationen auf eine aktuelle Version zu
aktualisieren oder zumindest auf all diesen Maschinen den Parameter auf <quote>no</quote> zu setzen.
</para>

<para>
Maschinen, die mit <smbconfoption><name>wins support</name><value>yes</value></smbconfoption> konfiguriert sind,
führen eine Liste aller auf ihnen registrierter NetBIOS-Namen, und arbeiten damit als DNS für NetBIOS-Namen.
</para>

<para>
Es wird wärmstens empfohlen, nur einen WINS-Server einzurichten. Setzen Sie die Option
<smbconfoption><name>wins support</name><value>yes</value></smbconfoption> nicht auf mehr als einem Samba-Server.
</para>

<para>
<indexterm><primary>Replikation</primary><secondary>WINS</secondary></indexterm>
Um einen Windows NT/200x Server als WINS-Server einzurichten, installieren und konfigurieren Sie den WINS-Dienst.
Konsultieren Sie die Windows NT/200x-Dokumentation für mehr Details dazu. Windows NT/200x WINS Server können sich
untereinander replizieren, was es erlaubt, mehr als einen solchen Server in einer komplexen Subnetz-Umgebung
einzurichten. Da Microsoft verweigert, die Replikations-Protokolle zu dokumentieren, kann Samba derzeit nicht an
diesen Replikationen teilnehmen. Es ist möglich, daß zukünftig ein Samba-zu-Samba WINS-Replikations-Protokoll
definiert werden könnte, was bedeuten würde, daß mehr als nur eine Samba-Maschine als WINS-Server eingerichtet
werden könnte. Derzeit sollte jedoch nur ein Samba-Server den Parameter
<smbconfoption><name>wins support</name><value>yes</value></smbconfoption> gesetzt haben.
</para>

<para>
Nachdem der WINS-Server konfiguriert wurde, müssen Sie sicherstellen, daß alle Maschinen im Netzwerk mit der
Adresse dieses WINS-Servers konfiguriert werden. Wenn Ihr WINS-Server eine Samba-Maschine ist, tragen Sie die
IP-Adresse der Samba-Maschine im Feld <guilabel>Primärer WINS Server</guilabel> der Dialoge
<guilabel>Systemsteuerung->Netzwerk->Protokolle->TCP->WINS Server</guilabel> von Windows 9x/Me oder 
Windows NT/200x ein. Um einem Samba-Server die Adresse des WINS-Servers mitzuteilen, fügen Sie die folgende
Zeile zum Abschnitt
<smbconfsection>[global]</smbconfsection> ihrer &smb.conf; hinzu:
</para>

<para>
<smbconfblock>
<smbconfoption><name>wins server</name><value>&lt;Name oder IP-Adresse&gt;</value></smbconfoption>
</smbconfblock>
</para>

<para>
wobei &lt;Name oder IP-Adresse&gt; entweder der DNS-Name oder die IP-Adresse des WINS-Servers ist.
</para>

<para>
Diese Zeile darf nicht in der Datei &smb.conf; des als WINS-Server arbeitenden Samba-Servers selbst
enthalten sein. Wenn Sie sowohl
<smbconfoption><name>wins support</name><value>yes</value></smbconfoption> wie auch
<smbconfoption><name>wins server</name><value>&lt;name&gt;</value></smbconfoption> setzen, wird
<command>nmbd</command> nicht starten.
</para>

<para>
Es gibt zwei mögliche Szenarios, um Cross-Subnetz-Browsing einzurichten. Das erste behandelt Details der
Einrichtung von Cross-Subnetz-Browsing in einem Netzwerk, das Maschinen mit Windows 9x/Me, Samba und 
Windows NT/200x enthält, die nicht als Mitglieder einer Windows NT Domäne konfiguriert sind. Das zweite
Szenario behandelt Details der Einrichtung von Cross-Subnetz-Browsing in einem Netzwerk, das NT Domänen
enthält.
</para>

</sect2>

<sect2>
<title>WINS Replikation</title>

<para>
<indexterm><primary>Replikation</primary><secondary>WINS</secondary></indexterm>
Samba-3 erlaubt WINS-Replikation unter Verwendung des Hilfsmittels <filename>wrepld</filename>. Dieses kann
derzeit nicht eingesetzt werden, da es sich nach wie vor in aktiver Entwicklung befindet. Sobald es
einigermassen funktional ist, werden wir dazu manpages erstellen, und diesen Abschnitt der Dokumentation
erweitern, um entsprechende Details zu Verwendung und technischen Hintergründen bereitzustellen.
</para>

</sect2>
<sect2>
<title>Statische WINS-Einträge</title>

<para>
Das Hinzufügen von statischen Einträgen zu Ihrem WINS-Server ist tatsächlich ziemlich einfach. Alles, was Sie
tun müssen, ist, eine Zeile zur Datei <filename>wins.dat</filename> hinzuzufügen, üblicherweise in
<filename class="directory">/usr/local/samba/var/locks</filename> oder 
<filename>/var/run/samba</filename>.
</para>

<para>
Einträge in <filename>wins.dat</filename> haben die Form:

<programlisting>
"NAME#TYPE" TTL ADDRESS+ FLAGS
</programlisting>
wobei NAME der NetBIOS-Namen ist, TYPE der NetBIOS-Typ, TTL die <quote>time-to-live</quote> als Absolut-Zeit in
Sekunden, ADDRESS+ eine oder mehrere Adressen, die mit der Registrierung zusammenhängen, und FLAGS sind die
NetBIOS-Flags für die Registrierung.
</para>

<para>
Ein typischer dynamischer Eintrag sieht so aus:
<programlisting>
"MADMAN#03" 1055298378 192.168.1.2 66R
</programlisting>

Um ihn statisch zu machen, muß nur der Wert für TTL auf 0 gesetzt werden:

<programlisting>
"MADMAN#03" 0 192.168.1.2 66R
</programlisting>
</para>

<para>
Obwohl diese Methode nur mit frühen Samba-3-Versionen funktioniert, ist es möglich, daß sie sich in zukünftigen
Samba-Versionen verändert, wenn WINS-Replikation hinzugefügt wird.
</para>

</sect2>
</sect1>

<sect1>
<title>Hilfreiche Hinweise</title>

<para>
Die folgenden Hinweise sollten sorgfältig bedacht werden, da sie bereits für viele Netzwerk-Administratoren
zu Stolpersteinen geworden sind.
</para>

<sect2>
<title>Windows Netzwerk-Protokolle</title>

<para>
Eine verbreitete Ursache von Browsing-Problemen ist, wenn mehrere Netzwerk-Protokolle auf einer 
MS-Windows-Maschine installiert werden.
</para>

<warning><para>
Verwenden Sie nicht mehr als ein Protokoll auf MS Windows Clients.
</para></warning>

<para>
Jede NetBIOS-Maschine nimmt alle 15 Minuten an der Wahl des LMB (und des DMB) teil. Eine Anzahl von
Auswahl-Kriterien wird verwendet, um die Rangfolge der Maschinen zum Gewinnen dieser Wahl zu bestimmen. 
Eine Maschine, die Samba ausführt, oder Windows NT, wird bevorzugt, so daß die am ehesten passende Maschine
voraussichtlich gewinnen und damit diese Rolle übernehmen wird.
</para>

<para>
Der Auswahlprozess wird sozusagen über jedes NetBIOS-Netzwerk-Interface <quote>ausgefochten</quote>. Im Fall
einer Maschine mit Windows 9x/Me, die sowohl TCP/IP als auch IPX installiert hat, und NetBIOS über beide
Protokolle aktiviert hat, wird die Wahl über beide Protokolle entschieden. Wie es oft passiert, wenn die
Maschine mit Windows 9x/Me die einzig mit beiden Protokollen ist, kann der LMB auf dem NetBIOS-Netzwerk-Interface
über das IPX-Protokoll gewonnen werden. Samba verliert dann seine LMB-Rolle, da Windows 9x/Me darauf beharrt, zu
wissen, wer der LMB ist. Samba wird dann seine Funktion als LMB beenden und daher werden ab da die
Browselist-Operationen auf allen Maschinen, die nur über TCP/IP arbeiten, scheitern.
</para>

<para>
Auf Windows 95, 98, 98SE, und ME bezieht man sich generell als Windows 9x/Me.
Windows NT4, 200x, und XP verwenden gemeinsame Protokolle. Diese Systeme werden grob als die Windows-NT-Familie
bezeichnet, aber es sollte verstanden sein, daß Windows 2000 und XP/2003 neue Protokoll-Erweiterungen
einführen, die das Verhalten dieser Systeme unterschiedlich zu dem Verhalten von MS Windows NT4 machen.
Allgemein, wo ein Server nicht das neuere oder erweiterte Protokoll unterstützt, fällt er zurück auf die
Verwendung der NT4-Protokolle.
</para>

<para>
Die sicherste Regel von allen, die es zu befolgen gilt, ist: Verwenden Sie nur ein Protokoll!
</para>

</sect2>

<sect2>
<title>Die Reihenfolge der Namensauflösung</title>

<para>
Die Auflösung von NetBIOS-Namen auf IP-Adressen kann mittels vieler Methoden erfolgen. Die einzigen Methoden,
die NetBIOS-Information vom Typ name_type bereitstellen können, sind:
</para>

<itemizedlist>
	<listitem>WINS &smbmdash; das beste Werkzeug.</listitem>
	<listitem>LMHOSTS &smbmdash; statisch und schwierig zu warten.</listitem>
	<listitem>Broadcast &smbmdash; verwendet UDP und kann keine Namen über Segmente hinweg auflösen.</listitem>
</itemizedlist>

<para>
Alternative Möglichkeiten der Namensauflösung inkludieren:
</para>
<itemizedlist>
<listitem>Statische <filename>/etc/hosts</filename> &smbmdash;  schwierig zu warten, fehlende name_type-Information.</listitem>
<listitem>DNS &smbmdash; ist eine gute Wahl, jedoch fehlt die name_type-Information.</listitem>
</itemizedlist>

<para>
Viele Installationen wollen DNS-Lookups verbieten und den Netzwerk-Verkehr, der durch Broadcast-Namensauflösung
entsteht, vermeiden. Der Parameter <parameter>name resolve order</parameter> ist hier von grosser Hilfe.
Die Syntax des Parameters <parameter>name resolve order</parameter> ist:
<smbconfblock>
<smbconfoption><name>name resolve order</name><value>wins lmhosts bcast host</value></smbconfoption>
</smbconfblock>
<emphasis>oder</emphasis>
<smbconfblock>
<smbconfoption><name>name resolve order</name><value>wins lmhosts  	(eliminiert bcast und host)</value></smbconfoption>
</smbconfblock>
Der Standard ist:
<smbconfblock>
<smbconfoption><name>name resolve order</name><value>host lmhost wins bcast</value></smbconfoption>
</smbconfblock>
wobei <quote>host</quote> sich auf die nativen Methoden bezieht, die vom UNIX-System zur Implementation des
Funktions-Aufrufs gethostbyname() verwendet werden. Dies wird normalerweise über die Dateien
<filename>/etc/host.conf</filename>, <filename>/etc/nsswitch.conf</filename> und
<filename>/etc/resolv.conf</filename> gesteuert.
</para>
</sect2>
</sect1>

<sect1>
<title>Technischer Überblick über das Browsing</title>

<para>
SMB-Netzwerke bieten einen Mechanismus, mit dem Clients auf eine Liste von Maschinen in einem Netzwerk zugreifen
können, eine sogenannte <smbconfoption><name>Browselist</name></smbconfoption>. Diese Liste enthält
Maschinen, die bereit zum Anbieten von Datei- und/oder Druckdienste an andere Maschinen im Netzwerk sind.
Daher umfaßt diese Liste keine Maschinen, die momentan nicht imstande sind, Serveraufgaben zu erfüllen. Die
Browselist wird von allen SMB-Clients intensiv benutzt. Die Konfiguration des SMB-Browsing war für manche
Samba-Benutzer problematisch, daher gibt es jetzt dieses Dokument.
</para>

<para>
MS Windows 2000 und spätere Versionen von Windows, genauso wie Samba-3 und dessen spätere Versionen, können
so konfiguriert werden, daß sie NetBIOS-über-TCP/IP nicht verwenden. Wenn sie auf diese Art konfiguriert sind,
ist es unumgänglich, daß die Namensauflösung (mittels DNS/LDAP/ADS) korrekt konfiguriert und arbeitsfähig ist.
Browsing funktioniert nicht, wenn die Namensauflösung von SMB-Maschinen-Namen auf IP-Adressen nicht korrekt
funktioniert.
</para>

<para>
Wo NetBIOS-über-TCP/IP aktiviert ist, wird der Einsatz eines WINS-Servers stärkstens empfohlen, um die
Namensauflösung zu unterstützen. WINS erlaubt es Clients in anderen Netzwerk-Segmenten, 
NetBIOS-name_type-Informationen zu beziehen, die von keiner anderen Methode der Namensauflösung bereitgestellt 
werden können.
</para>

<sect2>
<title>Die Unterstützung des Browsing in Samba</title>

<para>
Samba unterstützt Browsing. Das Browsing wird von &nmbd; bereitgestellt und wird auch von Optionen in der Datei
&smb.conf; gesteuert. Samba kann als Lokaler Master Browser für eine Arbeitsgruppe arbeiten und die Fähigkeit,
Domänenanmeldungen und Domänenskripts zu unterstützen, ist jetzt verfügbar.
</para>

<para>
Samba kann auch als Domänen Master Browser für eine Arbeitsgruppe arbeiten. Das bedeutet, daß es die Listen der
Lokalen Master Browser sammelt, und sie zu einer Serverliste für ein gesamtes WAN zusammenfügt. Um es den Clients
zu ermöglichen, die Namen, die sie in der Liste finden, auch aufzulösen, wird empfohlen, daß sowohl Samba wie
auch die Clients einen WINS-Server verwenden.
</para>

<para>
Konfigurieren Sie Samba nicht als Domänen Master für eine Arbeitsgruppe, die denselben Namen wie eine NT Domäne
hat. In jedem WAN dürfen Sie immer nur einen Domänen Master Browser pro Arbeitsgruppe haben, egal ob es NT, 
Samba, oder sonst ein Typ von Domänen Master ist, der diesen Dienst anbietet.
</para>

<note><para>
<command>nmbd</command> kann als WINS-Server konfiguriert werden, aber es nicht notwendig, Samba im Speziellen
als WINS-Server zu verwenden. MS Windows NT4, Server oder Advanced Server 200x können als Ihr WINS-Server
eingerichtet werden. In einer gemischten NT/200x-Server- und Samba-Umgebung in einem WAN wird empfohlen, daß
Sie die MS WINS-Server-Fähigkeiten einsetzen. In einem reinen Samba-Umfeld wird empfohlen, einen und nur einen
Samba-Server als WINS-Server zu verwenden.
</para></note>

<para>
Um Browsing zu aktivieren, müssen Sie nmbd wie üblich ausführen, aber müssen auch die Option
<smbconfoption><name>workgroup</name></smbconfoption> &smb.conf; verwenden, um zu bestimmen, welcher
Arbeitsgruppe Samba angehören soll.
</para>

<para>
Samba hat auch eine nützliche Option, um es einem Samba-Server zu ermöglichen, sich selbst für das Browsing in
einem anderen Subnetz anzubieten. Es wird empfohlen, daß diese Option nur für <quote>ungewöhnliche</quote>
Zwecke eingesetzt wird: Verlautbarungen über das Internet, zum Beispiel. Sehen Sie nach der Option
<smbconfoption><name>remote announce</name></smbconfoption> in der manpage zu
&smb.conf;. 
</para>
</sect2>

<sect2>
<title>Problemlösung</title>

<para>
Wenn etwas nicht funktioniert, hilft Ihnen die Datei <filename>log.nmbd</filename>, das Problem zu lokalisieren.
Versuchen Sie ein <smbconfoption><name>log level</name></smbconfoption> von 2 oder 3, um Probleme zu finden.
Beachten Sie auch, daß die aktuelle Browselist üblicherweise in Textform in einer Datei namens
<filename>browse.dat</filename> gespeichert wird.
</para>

<para>
Wenn es nicht funktioniert, sollten Sie noch immer den Servernamen als <filename>\\SERVER</filename> im
<command>Dateimanager</command> eingeben können, und dieser sollte eine Liste der dort verfügbaren Freigaben
anzeigen.
</para>

<para>
Manche Anwender haben beobachtet, daß das Browsing scheitert, weil sie die globale Option
<smbconfoption><name>guest account</name></smbconfoption> nicht auf ein gültiges Konto gesetzt haben.
Erinnern Sie sich, daß die IPC$-Verbindung, die die Freigaben auflistet, als guest hergestellt wird, und dafür
brauchen Sie den gültigen <smbconfoption><name>guest account</name></smbconfoption>.
</para>

<para>
MS Windows 2000 und spätere Versionen (wie auch Samba) können so konfiguriert werden, daß sie anonymen Zugriff
(also mit dem guest account) auf die IPC$-Freigabe verbieten. In diesem Fall verwendet die
MS Windows 2000/XP/2003 Maschine den Namen des gerade angemeldeten Benutzers zur Verbindung mit der
IPC$-Freigabe. MS Windows 9x/Me Clients können das nicht, und werden dann auch nicht die Resourcen des Servers
browsen können.
</para>

<para>
Das andere grosse Problem, das viele Leute haben, ist, daß ihre Broadcast-Adresse, Netmask oder IP-Adresse falsch
ist 
(angegeben mit der Option <smbconfoption><name>interfaces</name><value></value></smbconfoption> in &smb.conf;).
</para>
</sect2>

<sect2>
<title>Cross-Subnetz-Browsing</title>

<para>
<indexterm><primary>Replikation</primary><secondary>Browselists</secondary></indexterm>
Seit der Veröffentlichung von Samba 1.9.17 (alpha1) unterstützt Samba die Replikation von Browselists über
die Subnetz-Grenzen hinweg. Dieser Abschnitt beschreibt, wie man dieses Feature in verschiedenen Arten 
einrichtet.
</para>

<para>
Um Broswelists zu sehen, die TCP/IP-Subnetze umspannen (d.h. Netzwerke, die von Routern getrennt sind, die keinen
Broadcast-Verkehr weiterleiten), müssen Sie zumindest einen WINS-Server einrichten. Der WINS-Server fungiert als
DNS für NetBIOS-Namen. Dies erlaubt die Auflösung von NetBIOS-Namen auf IP-Adressen mittels einer direkten 
Abfrage des WINS-Servers. Es geschieht mittels eines gerichteten UDP-Pakets auf Port 137 der 
WINS-Server-Maschine. Der WINS-Server vermeidet die Notwendigkeit der Standard-Namensauflösung, die mittels
UDP-Broadcasts von der Client-Maschine aus geschehen würde. Das bedeutet, daß Maschinen in einem Subnetz nicht
imstande sind, die Namen von Maschinen in einem anderen Subnetz ohne Verwendung eines WINS-Servers aufzulösen.
</para>

<para>
Erinnern Sie sich, um das Browsing über Subnetze hinweg korrekt funktionieren zu lassen, müssen alle Maschinen,
egal ob Windows 95, Windows NT oder Samba, die IP-Adresse einen WINS-Servers mittels DHCP-Server oder manueller
Konfiguration erhalten (für Windows 9x/Me und Windows NT/200x/XP ist dies in den TCP/IP-Eigenschaften, unter
den Netzwerkeinstellungen); für Samba ist dies in der Datei &smb.conf;.
</para>

<sect3>
<title>Das Verhalten des Cross-Subnetz-Browsing</title>

<para>
Cross-subnet Browsing ist ein <quote>komplizierter Tanz</quote>, mit vielen bewegten Teilen. Es hat Microsoft
einige Jahre gekostet, den Code dafür korrekt zu erstellen, und Samba hängt in einigen Bereichen nach. Samba
ist jedoch bei korrekter Konfiguration zu Cross-Subnetz-Browsing imstande.
</para>

<para>
Nehmen wir an, ein Netzwerk sei so konfiguriert wie im folgenden 
<link linkend="browsing1">Cross-Subnetz-Browsing Beispiel</link>.
</para>

<image id="browsing1" scale="40"><imagedescription>Cross-Subnetz-Browsing Beispiel.</imagedescription><imagefile>browsing1</imagefile></image>
	
<para>
Dieses besteht aus 3 Subnetzen (1, 2, 3), verbunden durch zwei Router (R1, R2), die keine Broadcasts 
weiterleiten. Subnetz 1 beinhaltet fünf Maschinen, Subnetz 2 vier Maschinen, Subnetz 3 vier Maschinen. Nehmen wir
an, daß alle Maschinen so konfiguriert sind, daß sie in der gleichen Arbeitsgruppe sind (der Einfachheit halber).
Die Maschine N1_C im Subnetz 1 ist als der Domänen Master Browser konfiguriert (d.h. diese Maschine sammelt
die Browselists für die Arbeitsgruppe). Die Maschine N2_D ist als der WINS-Server eingerichtet und alle anderen
Maschinen sind so konfiguriert, daß sie ihre jeweiligen NetBIOS-Namen an diesem WINS-Server registrieren.
</para>

<para>
Wenn dies Maschinen gebootet werden, finden die Wahlen zum Master Browser in jedem der drei Subnetze statt.
Nehmen wir an, daß die Maschine N1_C im Subnetz 1 gewinnt, N2_B im Subnetz 2, und N3_D im Subnetz 3. Diese
Maschinen sind sodann als Lokale Master Browser in ihrem jeweiligen Subnetz bekannt. N1_C hat einen Vorteil
bei der Wahl zum Lokalen Master Browser im Subnetz 1, da sie als der Domänen Master Browser konfiguriert ist.
</para>

<para>
In jedem der drei Netzwerke werden Maschinen, auf denen Freigaben eingerichtet sind, mittels Broadcast mitteilen,
daß sie diese Dienste anbieten. Der Lokale Master Browser in jedem Subnetz wird diese Broadcasts empfangen, und
einen Eintrag bezüglich der Tatsache, daß die Maschine diesen Dienst anbietet, festhalten. Die Liste dieser
Einträge ist die Grundlage für die Browselist. Nehmen Sie für diesen Fall an, daß alle Maschinen eingerichtete
Freigaben haben, so daß alle Maschinen in der Browselist sind.
</para>

<para>
Für jedes Netzwerk wird der Lokale Master Browser als <quote>authoritativ</quote> für all die Namen betrachtet,
die er via Broadcasts empfängt. 


For each network, the Local Master Browser on that network is
considered <quote>authoritative</quote> for all the names it receives via
local broadcast. This is because a machine seen by the Local Master
Browser via a local broadcast must be on the same network as the
Local Master Browser and thus is a <quote>trusted</quote>
and <quote>verifiable</quote> resource. Machines on other networks that
the Local Master Browsers learn about when collating their
browse lists have not been directly seen. These records are
called <quote>non-authoritative.</quote>
</para>

<para>
At this point the browse lists appear as shown in <link linkend="browsubnet">the next example</link> (these are 
the machines you would see in your network neighborhood if you looked in it on a particular network right now).
</para>

<para>
<table frame="all" id="browsubnet">
	<title>Browse Subnet Example 1</title>		
	<tgroup align="left" cols="3">
	<thead>
		<row><entry>Subnet</entry><entry>Browse Master</entry><entry>List</entry></row>
	</thead>

	<tbody>
		<row><entry>Subnet1</entry><entry>N1_C</entry><entry>N1_A, N1_B, N1_C, N1_D, N1_E</entry></row>
		<row><entry>Subnet2</entry><entry>N2_B</entry><entry>N2_A, N2_B, N2_C, N2_D</entry></row>
		<row><entry>Subnet3</entry><entry>N3_D</entry><entry>N3_A, N3_B, N3_C, N3_D</entry></row>
	</tbody>
	</tgroup>
</table>
</para>

<para>
At this point all the subnets are separate, and no machine is seen across any of the subnets.
</para>

<para>
Now examine subnet 2. As soon as N2_B has become the Local
Master Browser it looks for a Domain Master Browser with which to synchronize
its browse list. It does this by querying the WINS server
(N2_D) for the IP address associated with the NetBIOS name 
WORKGROUP&lt;1B&gt;. This name was registered by the Domain Master
Browser (N1_C) with the WINS server as soon as it was started.
</para>

<para>
Once N2_B knows the address of the Domain Master Browser, it
tells it that is the Local Master Browser for subnet 2 by
sending a <emphasis>MasterAnnouncement</emphasis> packet as a UDP port 138 packet.
It then synchronizes with it by doing a <emphasis>NetServerEnum2</emphasis> call. This
tells the Domain Master Browser to send it all the server
names it knows about. Once the Domain Master Browser receives
the <emphasis>MasterAnnouncement</emphasis> packet, it schedules a synchronization
request to the sender of that packet. After both synchronizations
are complete the browse lists look as shown in <link linkend="brsbex">following example</link>:
</para>

<table frame="all" id="brsbex">
	<title>Browse Subnet Example 2</title>		
	<tgroup	cols="3">
		<colspec align="left"/>
		<colspec align="left"/>
		<colspec align="justify" colwidth="1*"/>
	<thead>
		<row><entry>Subnet</entry><entry>Browse Master</entry><entry>List</entry></row>
	</thead>

	<tbody>
		<row><entry>Subnet1</entry><entry>N1_C</entry><entry>N1_A, N1_B, N1_C, N1_D, N1_E,
N2_A(*), N2_B(*), N2_C(*), N2_D(*)</entry></row>
		<row><entry>Subnet2</entry><entry>N2_B</entry><entry>N2_A, N2_B, N2_C, N2_D, N1_A(*), 
N1_B(*), N1_C(*), N1_D(*), N1_E(*)</entry></row>
		<row><entry>Subnet3</entry><entry>N3_D</entry><entry>N3_A, N3_B, N3_C, N3_D</entry></row>
	</tbody>
	</tgroup>
</table>

<para>
Servers with an (*) after them are non-authoritative names.
</para>

<para>
At this point users looking in their network neighborhood on
subnets 1 or 2 will see all the servers on both, users on
subnet 3 will still only see the servers on their own subnet.
</para>

<para>
The same sequence of events that occurred for N2_B now occurs
for the Local Master Browser on subnet 3 (N3_D). When it
synchronizes browse lists with the Domain Master Browser (N1_A)
it gets both the server entries on subnet 1, and those on
subnet 2. After N3_D has synchronized with N1_C and vica versa,
the browse lists will appear as shown in <link linkend="brsex2">following example</link>.
</para>

<table frame="all" id="brsex2">
	<title>Browse Subnet Example 3</title>		
	<tgroup cols="3" align="left">
		<colspec align="left"/>
		<colspec align="left"/>
		<colspec align="justify" colwidth="1*"/>

	<thead>
		<row><entry>Subnet</entry><entry>Browse Master</entry><entry>List</entry></row>
	</thead>

	<tbody>
		<row><entry>Subnet1</entry><entry>N1_C</entry><entry>N1_A, N1_B, N1_C, N1_D, N1_E, 
N2_A(*), N2_B(*), N2_C(*), N2_D(*), N3_A(*), N3_B(*), N3_C(*), N3_D(*)</entry></row>
		<row><entry>Subnet2</entry><entry>N2_B</entry><entry>N2_A, N2_B, N2_C, N2_D, N1_A(*), 
N1_B(*), N1_C(*), N1_D(*), N1_E(*)</entry></row>
		<row><entry>Subnet3</entry><entry>N3_D</entry><entry>N3_A, N3_B, N3_C, N3_D, N1_A(*), 
N1_B(*), N1_C(*), N1_D(*), N1_E(*), N2_A(*), N2_B(*), N2_C(*), N2_D(*)</entry></row>
	</tbody>
	</tgroup>
</table>

<para>
Servers with an (*) after them are non-authoritative names.
</para>

<para>
At this point, users looking in their network neighborhood on
subnets 1 or 3 will see all the servers on all subnets, while users on
subnet 2 will still only see the servers on subnets 1 and 2, but not 3.
</para>

<para>
Finally, the Local Master Browser for subnet 2 (N2_B) will sync again
with the Domain Master Browser (N1_C) and will receive the missing
server entries. Finally, as when a steady state (if no machines
are removed or shut off) has been achieved, the browse lists will appear
as shown in <link linkend="brsex3">example below</link>.
</para>

<table frame="all" id="brsex3">
	<title>Browse Subnet Example 4</title>		
	<tgroup cols="3" align="left">
		<colspec align="left"/>
		<colspec align="left"/>
		<colspec align="justify" width="1*"/>

	<thead>
		<row><entry>Subnet</entry><entry>Browse Master</entry><entry>List</entry></row>
	</thead>

	<tbody>
		<row><entry>Subnet1</entry><entry>N1_C</entry><entry>N1_A, N1_B, N1_C, N1_D, N1_E,
N2_A(*), N2_B(*), N2_C(*), N2_D(*), N3_A(*), N3_B(*), 
N3_C(*), N3_D(*)</entry></row>
		<row><entry>Subnet2</entry><entry>N2_B</entry><entry>N2_A, N2_B, N2_C, N2_D, N1_A(*), 
N1_B(*), N1_C(*), N1_D(*), N1_E(*), N3_A(*), N3_B(*), 
N3_C(*), N3_D(*)</entry></row>
		<row><entry>Subnet3</entry><entry>N3_D</entry><entry>N3_A, N3_B, N3_C, N3_D, N1_A(*), 
N1_B(*), N1_C(*), N1_D(*), N1_E(*), N2_A(*), N2_B(*), 
N2_C(*), N2_D(*)</entry></row>
	</tbody>
	</tgroup>
</table>

<para>
Servers with an (*) after them are non-authoritative names.
</para>

<para>
Synchronizations between the Domain Master Browser and Local
Master Browsers will continue to occur, but this should remain a
steady state operation.
</para>

<para>
If either router R1 or R2 fails, the following will occur:
</para>

<orderedlist>
<listitem>
	<para>
	Names of computers on each side of the inaccessible network fragments
	will be maintained for as long as 36 minutes in the network neighborhood
	lists.
	</para>
</listitem>

<listitem>
	<para>
	Attempts to connect to these inaccessible computers will fail, but the
	names will not be removed from the network neighborhood lists.
	</para>
</listitem>

<listitem>
	<para>
	If one of the fragments is cut off from the WINS server, it will only
	be able to access servers on its local subnet using subnet-isolated
	broadcast NetBIOS name resolution. The effects are similar to that of
	losing access to a DNS server.
	</para>
</listitem>
</orderedlist>
</sect3>
</sect2>
</sect1>

<sect1>
<title>Common Errors</title>

<para>
Many questions are asked on the mailing lists regarding browsing. The majority of browsing
problems originate from incorrect configuration of NetBIOS name resolution. Some are of
particular note.
</para>

<sect2>
<title>How Can One Flush the Samba NetBIOS Name Cache without Restarting Samba?</title>

<para>
<indexterm><primary>flush name cache</primary></indexterm>
Samba's <command>nmbd</command> process controls all browse list handling. Under normal circumstances it is
safe to restart <command>nmbd</command>. This will effectively flush the Samba NetBIOS name cache and cause it
to be rebuilt. This does not make certain that a rogue machine name will not re-appear
in the browse list. When <command>nmbd</command> is taken out of service, another machine on the network will
become the Browse Master. This new list may still have the rogue entry in it. If you really
want to clear a rogue machine from the list, every machine on the network will need to be
shut down and restarted after all machines are down. Failing a complete restart, the only
other thing you can do is wait until the entry times out and is then flushed from the list.
This may take a long time on some networks (perhaps months).
</para>

</sect2>
 
<sect2>
	<title>Server Resources Can Not Be Listed</title>

<para><quote>My Client Reports <quote>This server is not configured to list shared resources</quote></quote></para>

		
<para>
Your guest account is probably invalid for some reason. Samba uses the
guest account for browsing in <command>smbd</command>. Check that your guest account is
valid.
</para>

<para>Also see <smbconfoption><name>guest account</name></smbconfoption> in the &smb.conf; man page.</para>

</sect2>

<sect2>
	<title>I get an <errorname>`Unable to browse the network'</errorname> error</title>

	<para>This error can have multiple causes:
<indexterm><primary>Browsing Probleme</primary></indexterm>
	</para>
	
	<itemizedlist>
		<listitem><para>There is no Local Master Browser. Configure &nmbd; 
			or any other machine to serve as Local Master Browser.</para></listitem>
		<listitem><para>You cannot log onto the machine that is the local master 
			browser. Can you logon to it as a guest user? </para></listitem>
		<listitem><para>There is no IP connectivity to the Local Master Browser. 
			Can you reach it by broadcast?</para></listitem>
</itemizedlist>
</sect2>

<sect2>
<title>Browsing of Shares and Directories is Very Slow</title>

<para><quote>
<indexterm><primary>langsames Browsing</primary></indexterm>
There are only two machines on a test network. One a Samba server, the other a Windows XP machine.
Authentication and logons work perfectly, but when I try to explore shares on the Samba server, the
Windows XP client becomes unresponsive. Sometimes it does not respond for some minutes. Eventually,
Windows Explorer will respond and displays files and directories without problem.
display file and directory.</quote>
</para>

<para><quote>
But, the share is immediately available from a command shell (<command>cmd</command>, followed by 
exploration with dos command. Is this a Samba problem or is it a Windows problem? How can I solve this?
</quote></para>

<para>
Here are a few possibilities:
</para>

<variablelist>
	<varlistentry>
		<term>Bad Networking Hardware</term>
		<listitem><para>
<indexterm><primary>Schlechte Hardware</primary></indexterm>
<indexterm><primary>WebClient</primary></indexterm>
		Most common defective hardware problems center around low cost or defective HUBs, routers,
		Network Interface Controllers (NICs) and bad wiring. If one piece of hardware is defective
		the whole network may suffer. Bad networking hardware can cause data corruption. Most bad
		networking hardware problems are accompanied by an increase in apparent network traffic,
		but not all.
		</para></listitem>
	</varlistentry>
	
	<varlistentry>
		<term>The Windows XP WebClient</term>
		<listitem><para>
		A number of sites have reported similar slow network browsing problems and found that when
		the WebClient service is turned off, the problem disappears. This is certainly something
		that should be explored as it is a simple solution &smbmdash; if it works.
		</para></listitem>
	</varlistentry>
	
	<varlistentry>
		<term>Inconsistent WINS Configuration</term>
		<listitem><para>
		This type of problem is common when one client is configured to use a WINS server (that is
		a TCP/IP configuration setting) and there is no WINS server on the network. Alternately,
		this will happen is there is a WINS server and Samba is not configured to use it. The use of
		WINS is highly recommended if the network is using NetBIOS over TCP/IP protocols. If use
		of NetBIOS over TCP/IP is disabled on all clients, Samba should not be configured as a WINS
		server neither should it be configured to use one.
		</para></listitem>
	</varlistentry>
	
	<varlistentry>
		<term>Incorrect DNS Configuration</term>
		<listitem><para>
		If use of NetBIOS over TCP/IP is disabled, Active Directory is in use and the DNS server
		has been incorrectly configured. Refer <link linkend="adsdnstech">DNS and Active Directory</link> for more information.
		</para></listitem>
	</varlistentry>
</variablelist>

</sect2>
</sect1>
</chapter>

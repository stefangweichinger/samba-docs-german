<?xml version="1.0" encoding="ISO-8859-1"?>
<chapter id="NetworkBrowsing">
<chapterinfo>
	&author.jht;
	&author.jelmer;
	<author>&person.sgw;<contrib>Deutsche Übersetzung</contrib></author>
</chapterinfo>

<title>Netzwerk-Browsing</title>

<para>
Diese Dokumentation enthält detaillierte Informationen und einen Leitfaden dazu, wie
man das Browsing über mehrere Subnetze und/oder Arbeitsgruppen (oder Domänen) hinweg
implementiert. WINS ist das beste Werkzeug, um NetBIOS-Namen in IP-Adressen aufzulösen.
WINS hat nichts mit Browse-Listen zu tun, außer bei der Auflösung von Namen in Adressen.
</para>

<note><para>
MS Windows 2000 und neuere Windows-Versionen können so konfiguriert werden, dass sie ohne NetBIOS über
TCP/IP arbeiten, wozu Samba ab Version 3 ebenfalls in der Lage ist. Ist
die Benutzung von NetBIOS über TCP/IP deaktiviert, werden die MS Windows-Maschinen
über DNS und Active Directory aufgelöst. Die folgenden Informationen gehen davon aus,
dass ein Netz mit NetBIOS über TCP/IP betrieben wird. 
</para></note>

<sect1>
<title>Planung und Beginn</title>

<para>
Jemand bezog sich einst auf die Vergangenheit mit den Worten <quote><emphasis>Es war die beste
aller Zeiten, es war die schlechteste aller Zeiten.</emphasis></quote> Je mehr wir zurückblicken,
umso mehr sehnen wir uns nach dem, was war, und hoffen, dass es nie wiederkehrt.
</para>


<para>
<indexterm><primary>NetBIOS</primary></indexterm>
Diese Aussage beschreibt präzise die
Gefühle vieler MS Windows Netzwerk-Administratoren in Hinblick auf NetBIOS. Diejenigen, die NetBIOS gemeistert haben, wussten, was sie erwartet.
Denjenigen, die es nie geschafft haben, seine Eigenschaften zu zähmen, erscheint NetBIOS
wie Pattersons Fluch.
</para>

<para>
Für diejenigen, die nicht mit den botanischen Problemen Australiens vertraut sind:
Pattersons Fluch, <emphasis>Echium plantagineum</emphasis>, wurde Mitte des 19.
Jahrhunderts eingeführt. Seitdem hat es sich schnell ausgebreitet. Die hohe Samenproduktion
der Pflanze mit einer Dichte von Tausenden Samen pro Quadratmeter, ihre Lebensdauer von mehr
als sieben Jahren und ihre Fähigkeit, unter guten Voraussetzungen über das ganze Jahr hinweg
zu keimen, sind einige der Eigenschaften, die sie zu einem solch hartnäckigen Unkraut
machen. (Frank Patterson war einer der gefürchtetsten Gesetzlosen Australiens. Nachdem
er wegen eines Diebstahls von vier Dollar am Galgen landete, verfluchte er die Stadt
Ironbark und die australische Regierung. Seine Familie pflanzte eine lilafarbene,
aus England stammende Pflanze auf sein Grab, die sich rasch im ganzen Land ausbreitete.
Aufgrund der Giftigkeit der Pflanze kostet ihre Vernichtung die Viehzüchter Australiens
ca. 30 Mill. Dollar pro Jahr, Anm. d. Übersetzers.)
</para>

<para>
In diesem Kapitel erfahren wir die grundlegenden Aspekte der Server Message Block-(SMB-)Vernetzung mit einem besonderen Blick auf SMB als Implementation in einer NetBIOS-über-TCP/IP-Umgebung
(NetBIOS = Network Basic Input/Output System). Da Samba SMB oder NetBIOS nicht
über ein anderes Protokoll implementiert, ist es wichtig zu wissen, wie man die
Netzwerkumgebung konfiguriert, und sich schlicht daran zu erinnern, nichts anderes als TCP/IP auf 
allen MS Windows-Clients im Netzwerk zu benutzen.
</para>

<para>
Samba bietet die Möglichkeit, WINS (Windows Inter-networking Name Server) samt der 
Systemerweiterungen von Microsofts WINS zu implementieren. Diese Systemerweiterungen
helfen Samba dabei, stabile WINS-Operationen - über den herkömmlichen Anwendungsbereich von
MS WINS hinaus - zu ermöglichen.
</para>

<para>
WINS wirkt sich ausschließlich auf Systeme aus, die mit NetBIOS-über-TCP/IP laufen.
MS Windows 200x/XP können NetBIOS abschalten. In so einem Fall spielt WINS keine Rolle mehr. Samba unterstützt dies ebenfalls.
</para>

<para>
In Netzwerken, in denen NetBIOS deaktiviert ist, d.h. wo WINS nicht mehr benötigt 
wird, ist der Einsatz eines DNS für die Namensauflösung unabdingbar.
</para>

</sect1>

<sect1>
<title>Was ist Browsing?</title>

<para>
Für die meisten bedeutet Browsing, dass sie die MS Windows- und Samba-Server in der
Netzwerkumgebung sehen können und dass, wenn man auf das Icon eines bestimmten
Servers klickt, ein Fenster geöffnet wird, in dem man die verfügbaren Freigaben und
Drucker des Servers sehen kann.
</para>

<para>
Was so einfach klingt, ist in Wirklichkeit eine komplexe Interaktion verschiedener
Technologien. Die dabei involvierten Technologien (oder Methoden) beinhalten Folgendes:
</para>

<itemizedlist>
	<listitem>MS Windows-Maschinen melden ihre Präsenz im Netzwerk an.</listitem>
	<listitem>Maschinen kündigen sich anderen Maschinen im Netzwerk an.</listitem>
	<listitem>Eine oder mehrere Maschinen fassen diese Ankündigungen lokal zusammen.</listitem>
	<listitem>Der Client findet die Maschine, die diese Liste von Maschinen gesammelt hat.</listitem>
	<listitem>Der Client ist in der Lage, den Namen der Maschine in eine IP-Adresse aufzulösen.</listitem>
	<listitem>Der Client ist in der Lage, sich mit einer anderen Maschine zu verbinden.</listitem>
</itemizedlist>

<para>
Die Samba-Anwendung, die die Verwaltung des Browsings und die Namensauflösung kontrolliert, heißt
<filename>nmbd</filename>. Die dabei verwendeten Konfigurationsparameter sind:
</para>

<para>Browsing-Optionen: <smbconfoption><name>os level</name></smbconfoption>(*),
	<smbconfoption><name>lm announce</name></smbconfoption>,
	<smbconfoption><name>lm interval</name></smbconfoption>,
	<smbconfoption><name>preferred master</name></smbconfoption>(*),
	<smbconfoption><name>local master</name></smbconfoption>(*),
	<smbconfoption><name>domain master</name></smbconfoption>(*),
	<smbconfoption><name>browse list</name></smbconfoption>,
	<smbconfoption><name>enhanced browsing</name></smbconfoption>.
</para>

<para>Namensauflösungsmethoden:
	<smbconfoption><name>name resolve order</name></smbconfoption>(*).
</para>

<para>WINS-Optionen:
	<smbconfoption><name>dns proxy</name></smbconfoption>,
	<smbconfoption><name>wins proxy</name></smbconfoption>,
	<smbconfoption><name>wins server</name></smbconfoption>(*),
	<smbconfoption><name>wins support</name></smbconfoption>(*),
	<smbconfoption><name>wins hook</name></smbconfoption>.
</para>

<para>
<indexterm><primary>WINS</primary></indexterm>
Für Samba sind der WINS-Server und die WINS-Unterstützung zwei einander ausschließende Optionen. Die mit
(*) markierten Optionen sind die einzigen Optionen, die im Allgemeinen verändert werden müssen. Sogar wenn
keiner dieser Parameter gesetzt ist, tut <filename>nmbd</filename> nach wir vor seinen Job.
</para>

</sect1>

<sect1 id="netdiscuss">
<title>Diskussion</title>

<para>
Die gesamte MS Windows-Netzwerk-Technologie verwendet <quote>SMB Messaging</quote>. Dieses kann mit oder ohne
NetBIOS implementiert werden. MS Windows 200x unterstützt NetBIOS-über-TCP/IP, um Rückwärtskompatibilität zu gewährleisten.
Microsoft scheint zu planen, die NetBIOS-Unterstützung auslaufen zu lassen.
</para>

<sect2>
<title>NetBIOS-über-TCP/IP</title>

<para>
Samba implementiert NetBIOS, wie es auch MS Windows NT/200x/XP tut, indem es dieses Protokoll in
TCP/IP einbettet. NetBIOS-basierendes Netzwerke verwenden Broadcasts, um die Verwaltung der Browse-Listen zu
regeln. Wenn man NetBIOS-über-TCP/IP ausführt, verwendet dieses das UDP-Messaging. Diese UDP-Nachrichten können
Broadcasts oder Unicasts sein.
</para>


<para>
<indexterm><primary>UDP</primary></indexterm>
Normalerweise können nur Unicast-UDP-Messages von Routern weitergeleitet werden. Der Parameter
<smbconfoption><name>remote announce</name></smbconfoption> in &smb.conf; hilft dabei, die Ankündigungen und
Aktualisierungen der Browse-Listen über Unicast-UDP an entfernte Netzwerksegmente weiterzugeben. In ähnlicher
Weise implementiert der Parameter <smbconfoption><name>remote browse sync</name></smbconfoption> in &smb.conf;
die Sammlung und Zusammenfügung von Browse-Listen mit Unicast-UDP.
</para>

<para>
Außerdem sollte <filename>nmbd</filename> in jenen Netzen, in denen Samba die einzige SMB-Server-Technologie ist,
nach Möglichkeit auf einer Maschine als der WINS-Server konfiguriert werden. Das macht es einfach, die
Browsing-Umgebung zu verwalten. Wenn jedes Netzwerk-Segment mit seinem eigenen Samba-WINS-Server konfiguriert 
ist, dann besteht der einzige Weg, das Browsing über mehrere Segmente zu ermöglichen, in der Verwendung der Parameter
<indexterm><primary>LMB</primary><see>Local Master Browser</see></indexterm>
<indexterm><primary>Local Master Browser</primary></indexterm>
<smbconfoption><name>remote announce</name></smbconfoption> und 
<smbconfoption><name>remote browse sync</name></smbconfoption> in Ihrer &smb.conf;.
</para>

<para>
<indexterm><primary>WINS</primary></indexterm>
Wenn nur ein WINS-Server für ein gesamtes Multi-Segment-Netzwerk verwendet wird, dann sollte die Verwendung
der Parameter <smbconfoption><name>remote announce</name></smbconfoption> und
<smbconfoption><name>remote browse sync</name></smbconfoption> nicht erforderlich sein.
</para>

<para>
<indexterm><primary>Replikation</primary><secondary>WINS</secondary></indexterm>
Seit Samba-3 wird an der Replikation von WINS gearbeitet. Der Großteil des Codes wurde bereits ins Samba-SVN
übernommen, muss aber noch <quote>reifen</quote>. Diese Replikation ist kein unterstütztes Feature der
Samba-3.0.0-Release. Hoffentlich wird es in einer der folgenden Samba-3-Releases zu einem unterstützten Feature. 
</para>

<para>
Derzeit unterstützt das Samba-WINS keine MS-WINS-Replikation. Das bedeutet: Wenn Sie einen Samba-Server als
WINS-Server einrichten, darf nur <emphasis>ein</emphasis> <filename>nmbd</filename> als WINS-Server im Netzwerk 
konfiguriert sein. Manche Installationen haben mehrere Samba-WINS-Server aus Gründen der Redundanz 
eingesetzt (ein Server pro Subnetz) und dann <smbconfoption><name>remote announce</name></smbconfoption> und
<smbconfoption><name>remote browse sync</name></smbconfoption> verwendet, um die Sammlung und Zusammenführung
der Browse-Listen über alle Segmente zu erzielen. Beachten Sie, dass dies bedeutet, dass Clients nur lokale Namen
auflösen, und so konfiguriert werden müssen, dass sie DNS zur Auflösung von Namen anderer Subnetze verwenden,
um es ihnen zu ermöglichen, die IP-Adressen der Server anderer Subnetze aufzulösen. Dieses Setup wird nicht
empfohlen, wird aber aus Gründen der Vollständigkeit und aus praktischen Überlegungen aufgeführt
(d.h. als Szenario für den Moment, <quote>wenn alles andere schief geht</quote>).
</para>

<para>
Zuletzt sollten Sie noch beachten, dass Browse-Listen eine Sammlung von unzuverlässigen Broadcast-Nachrichten sind, die in
Intervallen von nicht mehr als 15 Minuten wiederholt werden. Das bedeutet, dass es Zeit braucht, eine Browse-Liste
zu bilden, und dass es bis zu 45 Minuten dauern kann, bis diese sich stabilisiert, speziell über verschiedene
Netzwerk-Segmente hinweg.
</para>

</sect2>

<sect2>
<title>TCP/IP ohne NetBIOS</title>

<para>
<indexterm><primary>NetBIOS</primary></indexterm>
<indexterm><primary>NetBIOS-frei</primary></indexterm>
<indexterm><primary>DNS</primary></indexterm>
Alle TCP/IP-fähigen Systeme verwenden verschiedene Formen der Namensauflösung. Die primären Methoden für die
TCP/IP-Namensauflösung sehen entweder eine statische Datei (<filename>/etc/hosts</filename>) vor oder
DNS (Domain Name System). DNS ist die Technologie, die das Internet benutzbar macht. Die DNS-basierende
Namensauflösung wird von fast allen TCP/IP-fähigen Systemen unterstützt, nur ein paar wenige 
<quote>embedded</quote> TCP/IP-Systeme unterstützen kein DNS.
</para>

<para>
Wenn ein MS Windows 200x/XP-System versucht, einen Hostnamen zu einer IP-Adresse aufzulösen, folgt es einem
definierten Pfad:
</para>

<orderedlist>
	<listitem><para>
	Prüfung der Datei <filename>hosts</filename>. Diese befindet sich in
	<filename>C:\Windows NT\System32\Drivers\etc</filename>.
	</para></listitem>

	<listitem><para>
	Ausführung einer DNS-Abfrage
	</para></listitem>

        <listitem><para>
	Prüfung des NetBIOS-Namens-Cache
        </para></listitem>

        <listitem><para>
	Abfrage des WINS-Servers
        </para></listitem>

        <listitem><para>
	Ausführung einer Broadcast-Abfrage über UDP
        </para></listitem>

        <listitem><para>
	Überprüfung der Datei LMHOSTS, in
        <filename>C:\Windows NT\System32\Drivers\etc</filename>
        </para></listitem>
</orderedlist>


<para>
<indexterm><primary>DNS</primary></indexterm>
Windows 200x/XP kann seinen Hostnamen an einem <quote>Dynamic DNS Server</quote> registrieren. Sie können dies
erzwingen:
<command>ipconfig /registerdns</command>.
</para>

<para>
Wenn Sie Active Directory (ADS) verwenden, brauchen Sie unbedingt einen korrekt funktionierenden DNS-Server.
Fehlt ein korrekt funktionierender und arbeitender DNS-Server, sind die MS Windows-Clients und Server
nicht mehr imstande, einander gegenseitig zu finden. Daher werden in der Folge auch die Netzwerkdienste ernsthaft
geschädigt.
</para>

<para>
Die Verwendung von <quote>Dynamic DNS</quote>  mit Active Directory wirdwärmstens empfohlen,
wobei auch der Einsatz von BIND9 vorzuziehen ist (wegen seiner Fähigkeit zur adäquaten Unterstützung der 
SRV-Einträge, die für Active Directory benötigt werden).
</para>

</sect2>

<sect2 id="adsdnstech">
<title>DNS und Active Directory</title>


<para>
<indexterm><primary>DNS</primary><secondary>Active Directory</secondary></indexterm>
Gelegentlich hören wir von UNIX-Netzwerk-Administratoren, die einen UNIX-basierenden Dynamic-DNS-Server
anstatt des MS-DNS-Servers einsetzen wollen. Dies mag zwar für manche wünschenswert sein, aber der
MS Windows 200x-DNS-Server ist für die Zusammenarbeit mit Active Directory automatisch vorkonfiguriert. Es
ist möglich, BIND in der Version 8 oder 9 einzusetzen, aber es wird fast mit Sicherheit notwendig sein,
SRV-Einträge anzulegen, damit MS Active-Directory-Clients Hostnamen auflösen können, um essenzielle
Netzwerkdienste lokalisieren können. Im Folgenden sehen Sie einige der Standard-SRV-Einträge, die Active Directory
benötigt:
</para>

<variablelist>
<varlistentry>
	<term>_ldap._tcp.pdc._msdcs.<emphasis>Domain</emphasis></term>
	<listitem>
	<para>
	Gibt die Adresse des Windows NT-PDC für die Domäne an.
	</para>
	</listitem>
</varlistentry>
<varlistentry>
	<term>_ldap._tcp.pdc._msdcs.<emphasis>DomainTree</emphasis></term>
	<listitem>
        <para>
	Löst die Adressen der <quote>Global Catalog Server</quote> in der Domäne auf.
        </para>
	</listitem>
</varlistentry>
<varlistentry>
        <term>_ldap._tcp.<emphasis>site</emphasis>.sites.writable._msdcs.<emphasis>Domain</emphasis></term>
	<listitem>
        <para>
	Gibt eine Liste der Domänen-Controller an, die auf den Sites basiert.
        </para>
	</listitem>
</varlistentry>
<varlistentry>
        <term>_ldap._tcp.writable._msdcs.<emphasis>Domain</emphasis></term>
	<listitem>
        <para>
	Listet Domänen-Controller auf, die eine schreibberechtigte Kopie des Active Directory führen.
        </para>
	</listitem>
</varlistentry>
<varlistentry>
	<term>_ldap._tcp.<emphasis>GUID</emphasis>.domains._msdcs.<emphasis>DomainTree</emphasis></term>
	<listitem>
	<para>
	Eintrag, der von MS Windows-Clients verwendet wird, um Maschinen mit dem 
	<quote>Global Unique Identifier</quote> zu lokalisieren.
	</para>
	</listitem>
</varlistentry>
<varlistentry>
	<term>_ldap._tcp.<emphasis>Site</emphasis>.gc._msdcs.<emphasis>DomainTree</emphasis></term>
	<listitem>
	<para>
	Wird von MS Windows-Clients verwendet, um den <quote>Global Catalog Server</quote> zu lokalisieren,
 	der von der Site-Konfiguration abhängig ist.
	</para>
	</listitem>
</varlistentry>
</variablelist>

	<para>
	Spezifische Einträge, die von MS Windows-Clients verwendet werden, um essenzielle Dienste für eine
	Beispiel-Domäne namens <constant>quenya.org</constant> zu lokalisieren. Sie beinhalten:
	</para>

	<itemizedlist>
		<listitem><para>
		_kerberos._udp.quenya.org &smbmdash; Wird verwendet, um den KDC-Server über UDP zu kontaktieren.
		Dieser Eintrag muss für jeden KDC den Port 88 auflisten.
		</para></listitem>

		<listitem><para>
		_kpasswd._udp.quenya.org &smbmdash; Wird verwendet, um den <constant>kpasswd</constant>-Server
		zu lokalisieren, wenn die Änderung eines Benutzerpassworts bearbeitet werden soll. Dieser
		Eintrag muss den Port 464 auf dem Master-KDC auflisten.
		</para></listitem>

		<listitem><para>
		_kerberos._tcp.quenya.org &smbmdash; Wird verwendet, um den KDC-Server via TCP zu lokalisieren.
		Dieser Eintrag muss für jeden KDC den Port 88 auflisten.
		</para></listitem>

		<listitem><para>
		_ldap._tcp.quenya.org &smbmdash; Wird verwendet, um den LDAP-Dienst auf dem PDC zu lokalisieren.
		Dieser Eintrag muss den Port 389 des PDCs enthalten.		
		</para></listitem>

		<listitem><para>
		_kpasswd._tcp.quenya.org &smbmdash; Wird verwendet, um den <constant>kpasswd</constant>-Server
                zu lokalisieren, um Änderungen von Benutzerpasswörtern zu erlauben. Dieser Eintrag muss den Port
		464 enthalten.
		</para></listitem>

		<listitem><para>
		_gc._tcp.quenya.org &smbmdash; Wird verwendet, um den <quote>Global Catalog Server</quote> für
		die Domäne zu lokalisieren. Dieser Eintrag muss den Port 3268 auflisten.
		</para></listitem>
	</itemizedlist>
	
	<para>
	Die folgenden Einträge werden auch vom Windows Domain-Member-Client verwendet, um wichtige Dienste
	auf den Windows ADS-Domänencontrollern zu finden.
	</para>

	<itemizedlist>
		<listitem><para>
		_ldap._tcp.pdc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_ldap.gc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_ldap.default-first-site-name._sites.gc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_ldap.{SecID}.domains._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_ldap._tcp.dc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_kerberos._tcp.dc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_ldap.default-first-site-name._sites.dc._msdcs.quenya.org
		</para></listitem>

		<listitem><para>
		_kerberos.default-first-site-name._sites.dc._msdcs.queyna.org
		</para></listitem>

		<listitem><para>
		SecID._msdcs.quenya.org
		</para></listitem>
	</itemizedlist>

	<para>
	Das Vorhandensein der korrekten DNS-Einträge kann so validiert werden:
<screen>
&rootprompt; dig @frodo -t any _ldap._tcp.dc._msdcs.quenya.org

; &lt;lt;&gt;&gt; DiG 9.2.2 &lt;lt;&gt;&gt; @frodo -t any _ldap._tcp.dc._msdcs.quenya.org
;; global options:  printcmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 3072
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 2


;; QUESTION SECTION:
;_ldap._tcp.dc._msdcs.quenya.org. IN        ANY


;; ANSWER SECTION:
_ldap._tcp.dc._msdcs.quenya.org. 600 IN SRV 0 100 389 frodo.quenya.org.
_ldap._tcp.dc._msdcs.quenya.org. 600 IN SRV 0 100 389 noldor.quenya.org.


;; ADDITIONAL SECTION:
frodo.quenya.org. 3600  IN      A       10.1.1.16
noldor.quenya.org. 1200  IN      A       10.1.1.17


;; Query time: 0 msec
;; SERVER: frodo#53(10.1.1.16)
;; WHEN: Wed Oct  7 14:39:31 2004
;; MSG SIZE  rcvd: 171
</screen>
	</para>

</sect2>

</sect1>

<sect1>
<title>Wie Browsing funktioniert</title>

<para>
MS Windows-Maschinen registrieren ihre NetBIOS-Namen (d.h. den Maschinen-Namen für jeden laufenden Dienst)
beim Start. Die genaue Methode, mit der diese Registrierung stattfindet, ist davon abhängig, ob der
MS Windows-Client/Server eine WINS-Server-Adresse erhalten hat oder nicht, ob die LMHOSTS-Abfrage aktiviert ist,
ob DNS für die Auflösung von NetBIOS-Namen aktiviert ist etc.
</para>

<para>
Falls es keinen WINS-Server gibt, werden alle Namensregistrierungen wie auch Namensabfragen mit
UDP-Broadcasts durchgeführt. Dies beschränkt die Namensauflösung auf das lokale Subnetz, es sei denn, LMHOSTS wird
zur Listung aller Namen und IP-Adressen verwendet. In solchen Situationen bietet Samba eine Möglichkeit, mit
der der Samba-Server zwangsweise in die Browse-Liste eines fernen MS Windows-Netzwerks eingetragen werden kann
(durch den Parameter <smbconfoption><name>remote announce</name></smbconfoption>).
</para>

<para>
Wo ein WINS-Server eingesetzt wird, wird der MS Windows-Client einen UDP-Unicast verwenden, um sich am WINS-Server
zu registrieren. Solche Pakete können geroutet werden, und daher erlaubt WINS die Namensauflösung über geroutete
Netzwerke.
</para>

<para>
Während des Startvorgangs wird eine Wahl stattfinden, um einen <quote>Local Master Browser</quote> zu bestimmen,
wenn nicht bereits ein solcher existiert. In jedem NetBIOS-Netzwerk wird eine Maschine ausgewählt, um als
der <quote>Domain Master Browser</quote> zu fungieren. Dieses Domänen-Browsing hat nichts mit dem 
MS Domänen-Controlling zu tun. Stattdessen übernimmt der Domain Master Browser die Rolle, jeden
LMB (<quote>Local Master Browser</quote>) zu kontaktieren (er wird entweder über WINS oder LMHOSTS ausfindig gemacht),
und die Browse-Listen auszutauschen. Auf diese Weise erhält jeder Master Browser eine komplette Liste aller
Maschinen im Netzwerk. Alle 11 bis 15 Minuten wird eine Wahl abgehalten, um zu bestimmen, welche Maschine der
Master Browser sein soll. Nach den Kriterien dieser Wahl wird die Maschine mit der größten Uptime, der
höchsten Protokoll-Version oder anderen Kriterien die Wahl zum <quote>Domain Master Browser</quote> gewinnen.
</para>

<para>
Clients, die das Netzwerk durchsuchen wollen, verwenden diese Liste, aber sind auch abhängig von der korrekten
Namensauflösung in die entsprechenden IP-Adresse(n).
</para>

<para>
Jede Konfiguration, die die Namensauflösung und/oder die Browsing-Funktionalitäten verletzt, wird die Benutzer
verärgern, da sie dann immer wieder damit konfrontiert sind, die Netzwerkdienste nicht verwenden zu können.
</para>

<para>
Samba unterstützt ein Feature, das die erzwungene Synchronisation von Browse-Listen über geroutete Netzwerke
mit dem Parameter <smbconfoption><name>remote browse sync</name></smbconfoption> in der Datei
&smb.conf; erlaubt. Dies veranlasst Samba, den LMB in einem fernen Netzwerk zu kontaktieren und dort die
Synchronisation der Browse-Listen zu erfragen. Dies überbrückt effektiv zwei durch Router getrennte Netzwerke.
Die beiden entfernten Netzwerke können entweder eine broadcast-basierende oder eine WINS-basierende Namensauflösung
verwenden, aber Sie sollten beachten, dass der Parameter 
<smbconfoption><name>remote browse sync</name></smbconfoption> die Browse-Listen-Synchronisation anbietet, und diese
ist etwas anderes als Namensauflösung. Mit anderen Worten: um das <quote>Cross-Subnetz-Browsing</quote> korrekt
arbeiten zu lassen, ist es unbedingt notwendig, dass ein Mechanismus zur Auflösung von Namen in Adressen vorhanden ist.
Dieser Mechanismus kann via DNS, <filename>/etc/hosts</filename> usw. funktionieren.
</para>

<sect2 id="DMB">
<title>Konfiguration des ARBEITSGRUPPEN-Browsings</title>

<para>
Um das <quote>Cross-Subnetz-Browsing</quote> in einem Netzwerk zu konfigurieren, das Maschinen in einer
ARBEITSGRUPPE enthält, nicht solche einer NT Domäne, müssen Sie einen Samba-Server als Domain Master Browser
(DMB) einrichten (beachten Sie, dass dies nicht dasselbe wie ein primärer Domänencontroller ist, obwohl in einer
NT-Domäne dieselbe Maschine beide Funktionen übernimmt). Die Aufgabe eines Domain Master Browsers ist es,
die Browse-Listen von den lokalen Master-Browsern all der Subnetze zu sammeln und zusammenzufügen, die eine Maschine
beinhalten, die Teil der Arbeitsgruppe ist. Wäre keine Maschine als Domain Master Browser konfiguriert,
würde jedes Subnetz eine isolierte Arbeitsgruppe sein, die unfähig wäre, irgendwelche Maschinen in einem anderen
Subnetz zu sehen. Es ist das Vorhandensein eines Domain Master Browsers, das das Cross-Subnetz-Browsing für eine
Arbeitsgruppe ermöglicht. 
</para>

<para>
In einer ARBEITSGRUPPEN-Umgebung muss der Domain Master Browser ein Samba-Server sein, und es darf nur einen
DMB pro Arbeitsgruppen-Name geben. Um einen Samba-Server als DMB einzurichten, setzen Sie folgende Option
im Abschnitt <smbconfsection>[global]</smbconfsection> der Datei &smb.conf;:
</para>

<para>
<smbconfblock>
<smbconfoption><name>domain master</name><value>yes</value></smbconfoption>
</smbconfblock>
</para>

<para>
Der Domain Master Browser sollte vorzugsweise auch der lokale Master-Browser für sein eigenes Subnetz sein.
Um dies zu erreichen, setzen Sie die Optionen im Abschnitt <smbconfsection>[global]</smbconfsection>
der Datei &smb.conf; wie <link linkend="dmbexample">im folgenden Beispiel</link>:
</para>

<para>
<smbconfexample id="dmbexample">
<title>smb.conf für einen Domain Master Browser</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain master</name><value>yes</value></smbconfoption>
<smbconfoption><name>local master</name><value>yes</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>yes</value></smbconfoption>
<smbconfoption><name>os level</name><value>65</value></smbconfoption>
</smbconfexample>
</para>

<para>
Der Domain Master Browser kann dieselbe Maschine wie der WINS-Server sein, sollte es erforderlich sein.
</para>

<para>
Als Nächstes sollten Sie sicherstellen, dass jedes der Subnetze eine Maschine enthält, die als der lokale Master-
Browser für die Arbeitsgruppe arbeiten kann. Jede MS Windows NT/200x/XP-Maschine sollte imstande sein, dies zu 
tun, genauso wie Windows 9x/Me-Maschinen (obwohl diese dazu neigen, öfter Neustarts zu  brauchen; also ist es
keine allzu gute Idee, diese dafür zu verwenden). Um einen Samba-Server zu einem lokalen Master-Browser zu 
machen, setzen Sie die Optionen im Abschnitt <smbconfsection>[global]</smbconfsection>
der Datei &smb.conf; wie <link linkend="lmbexample">im folgenden Beispiel</link>:
</para>

<para>
<smbconfexample id="lmbexample">
<title>smb.conf für einen lokalen Master-Browser</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain master</name><value>no</value></smbconfoption>
<smbconfoption><name>local master</name><value>yes</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>yes</value></smbconfoption>
<smbconfoption><name>os level</name><value>65</value></smbconfoption>
</smbconfexample>
</para>

<para>
Machen Sie das nicht für mehr als einen Samba-Server pro Subnetz, oder diese Rechner werden gegeneinander darum
kämpfen, wer denn der lokale Master-Browser sein soll.
</para>

<para>
Der Parameter <smbconfoption><name>local master</name></smbconfoption> erlaubt es Samba, als lokaler Master-
Browser zu arbeiten. Der Parameter <smbconfoption><name>preferred master</name></smbconfoption> veranlasst
<command>nmbd</command> dazu, bei seinem Start eine Browser-Wahl zu erzwingen, und 
<smbconfoption><name>os level</name></smbconfoption> stuft Samba so hoch ein, dass es jede Wahl gewinnen sollte.
</para>

<para>
Wenn Sie eine NT-Maschine im Subnetz haben, die Sie zum lokalen Master-Browser machen wollen, können Sie es Samba
<quote>verbieten</quote>, ein lokaler Master-Browser zu werden, indem Sie folgende Optionen im Abschnitt 
<smbconfsection>[global]</smbconfsection>
der Datei &smb.conf; wie <link linkend="nombexample">im folgenden Beispiel</link> setzen:
</para>

<para>
<smbconfexample id="nombexample">
<title>smb.conf für einen Samba-Server, der kein Master-Browser ist</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain master</name><value>no</value></smbconfoption>
<smbconfoption><name>local master</name><value>no</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>no</value></smbconfoption>
<smbconfoption><name>os level</name><value>0</value></smbconfoption>
</smbconfexample>
</para>

</sect2>

<sect2>
<title>Konfiguration des DOMÄNEN-Browsings</title>

<para>
Wenn Sie Samba-Server einer Windows-NT-Domäne hinzufügen, dann dürfen Sie keinen Samba-Server als Domain Master
Browser einrichten. Standardmäßig ist der Windows NT-PDC einer Domäne auch gleichzeitig der Domain Master
Browser für diese Domäne. Das Netzwerk-Browsing kann zusammenbrechen, wenn sich ein Samba-Server mit dem
NetBIOS-Namen des Domain Master Browsers zusätzlich zum PDC am WINS-Server anmeldet (<replaceable>DOMÄNE</replaceable>&lt;1B&gt;).
</para>

<para>
Für andere Subnetze als jenes, das den Windows NT PDC enthält, können Sie wie beschrieben Samba-Server als
lokale Master-Browser einrichten. Um einen Samba-Server zu einem lokalen Master-Browser zu machen, setzen Sie
folgende Optionen im Abschnitt <smbconfsection>[global]</smbconfsection>
der Datei &smb.conf; wie <link linkend="remsmb">im folgenden Beispiel</link>:
</para>

<para>
<smbconfexample id="remsmb">
<title>smb.conf für einen lokalen Master-Browser</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain master</name><value>no</value></smbconfoption>
<smbconfoption><name>local master</name><value>yes</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>yes</value></smbconfoption>
<smbconfoption><name>os level</name><value>65</value></smbconfoption>
</smbconfexample>
</para>

<para>
Wenn Sie wollen, dass ein Samba-Server mit anderen Maschinen im Subnetz um den Sieg in der Browsing-Wahl kämpft,
können Sie den Parameter <smbconfoption><name>os level</name></smbconfoption> auf niedrigere Werte setzen. Damit 
können Sie die Reihenfolge feintunen, in der die Maschinen zum lokalen Master-Browser werden, wenn sie laufen.
Mehr Details dazu finden Sie im Abschnitt 
<link linkend="browse-force-master">Wie man Samba dazu zwingt, der Master zu sein</link>.
</para>

<para>
Wenn Sie Windows NT-Maschinen haben, die Domänenmitglieder auf allen Subnetzen sind, und Sie sich sicher sind, 
dass diese Maschinen immer laufen werden, können Sie Samba von der Teilnahme an Browsing-Wahlen ausnehmen. Auf diese Weise
 deaktivieren Sie, dass Samba jemals ein lokaler Master-Browser wird, indem Sie folgende Optionen im 
Abschnitt <smbconfsection>[global]</smbconfsection>
der Datei &smb.conf; wie <link linkend="xremmb">im folgenden Beispiel</link> setzen:
</para>

<para>
<smbconfexample id="xremmb">
<title>&smb.conf; für einen Samba-Server, der nie Master-Browser wird</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>domain master</name><value>no</value></smbconfoption>
<smbconfoption><name>local master</name><value>no</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>no</value></smbconfoption>
<smbconfoption><name>os level</name><value>0</value></smbconfoption>
</smbconfexample>
</para>

</sect2>

<sect2 id="browse-force-master">
<title>Wie man Samba dazu zwingt, der Master zu sein</title>

<para>
Wer der Master-Browser wird, hängt von einem Wahlvorgang ab, der Broadcasts verwendet. Jedes Wahl-Paket enthält
eine Anzahl von Parametern, die bestimmen, welchen Rang ein Host bei der Wahl einnimmt. Standardmäßig verwendet
Samba einen niedrigen Rang und verliert daher die Wahlen gegen so gut wie jeden Windows-Netzwerk-Client oder
-Server.
</para>

<para>
Wenn Sie wollen, dass Samba Wahlen gewinnt, setzen Sie die globale Option 
<smbconfoption><name>os level</name></smbconfoption> in &smb.conf; auf einen höheren Wert. Der Standard ist 20.
Die Verwendung von 34 ließe Samba alle Wahlen gegen jedes andere System gewinnen (außer gegen andere 
Samba-Systeme).
</para>

<para>
Ein <smbconfoption><name>os level</name></smbconfoption> von 2 würde Samba Windows for Workgroups und Windows 9x/Me
schlagen lassen, aber nicht MS Windows NT/200x-Server. Ein MS Windows NT/200x-Server-Domänencontroller verwendet
level 32. Das Maximum für <smbconfoption><name>os level</name></smbconfoption> ist 255.
</para>

<para>
Wenn Sie wollen, dass Samba bei seinem Start eine Wahl erzwingt, setzen Sie die globale Option
<smbconfoption><name>preferred master</name></smbconfoption> in &smb.conf; auf <constant>yes</constant>.
Samba hat dann einen leichten Vorteil gegenüber anderen potenziellen Master-Browsern, die keine
<quote>Preferred Master Browser</quote> sind. Verwenden Sie diesen Parameter vorsichtig, denn wenn Sie zwei
Hosts (egal ob diese Windows 9x/Me oder NT/200x/XP oder Samba ausführen) im selben Subnetz haben, bei denen
<smbconfoption><name>preferred master</name></smbconfoption> auf <constant>yes</constant> gesetzt ist, werden
diese beiden periodisch und kontinuierlich eine Wahl erzwingen, um lokaler Master-Browser zu werden.
</para>

<para>
Wenn Sie wollen, dass Samba ein <emphasis>Domain Master Browser</emphasis> wird, dann ist es zu empfehlen,
dass Sie auch <smbconfoption><name>preferred master</name></smbconfoption> auf <constant>yes</constant> setzen,
da Samba nicht zum Domain Master Browser für Ihr gesamtes LAN oder WAN wird, wenn es nicht auch ein lokaler
Master-Browser in seinem eigenen broadcast-isolierten Subnetz ist. 
</para>

<para>
Es ist möglich, zwei Samba-Server so zu konfigurieren, dass sie versuchen, Domain Master Browser für eine Domäne
zu werden. Der erste Server, der startet, wird der Domain Master Browser. Alle anderen Samba-Server werden alle
fünf Minuten versuchen, zum Domain Master Browser zu werden. Sie werden herausfinden, dass ein anderer 
Samba-Server bereits der Domain Master Browser ist, und scheitern. Dies gewährt automatisch Redundanz, wenn der
aktuelle Domain Master Browser ausfallen sollte.
</para>

</sect2>

<sect2>
<title>Wie man Samba zum Domänen-Master macht</title>

<para>
Der Domänen-Master ist für die Sammlung und Zusammenführung der Browse-Listen von
mehreren Subnetzen verantwortlich, so dass ein Browsing über Subnetze hinweg stattfinden kann. Sie können Samba zum Domänen-Master
machen, indem Sie in der Datei &smb.conf; den Parameter 
<smbconfoption><name>domain master</name><value>yes</value></smbconfoption> setzen. In der Voreinstellung ist
Samba kein Domänen-Master.
</para>

<para>
Machen Sie Samba nicht zum Domänen-Master für eine Arbeitsgruppe, die denselben Namen wie eine
NT/200x-Domäne hat. Wenn Samba als Domänen-Master für eine Arbeitsgruppe konfiguriert ist, die sich im selben 
Subnetz wie
eine gleichnamige Windows NT/200x-Domäne befindet, werden mit Sicherheit Browsing-Probleme auftreten.
</para>

<para>
Wenn Samba Domänen-Master und Master-Browser ist, wird es auf Master-Verlautbarungen (die ca. alle 12 Minuten
stattfinden) von lokalen Master-Browsern in anderen Subnetzen hören und diese dann kontaktieren, um die
Browse-Listen zu synchronisieren.
</para>

<para>
Wenn Sie wollen, dass Samba der Domänen-Master ist, sollten Sie auch den Wert für
<smbconfoption><name>os level</name></smbconfoption> ausreichend hoch setzen, um sicherzustellen, dass Samba
Browsing-Wahlen gewinnt, und <smbconfoption><name>preferred master</name></smbconfoption> auf
<constant>yes</constant> setzen, um beim Start von Samba eine solche Wahl zu erzwingen.
</para>

<para>
Alle Server (inklusive Samba) und Clients sollten einen WINS-Server zur NetBIOS-Namensauflösung verwenden. Wenn
Ihre Clients nur Broadcasting zur NetBIOS-Namensauflösung verwenden, werden zwei Dinge geschehen:
</para>

<orderedlist>
<listitem>
	<para>
	Die lokalen Master-Browser werden nicht mehr imstande sein, einen Domain Master Browser zu finden, da
	sie nur noch im lokalen Subnetz suchen können.
	</para>
</listitem>

<listitem>
	<para>
	Wenn ein Client doch eine domänen-weite Browse-Liste erhascht und ein Benutzer versucht, auf einen Host in
	dieser Liste zuzugreifen, wird er nicht imstande sein, den NetBIOS-Namen dieses Hosts aufzulösen.
	</para>
</listitem>
</orderedlist>

<para>
Wenn jedoch sowohl Samba als auch Ihre Clients einen WINS-Server verwenden, dann gilt Folgendes:
</para>

<orderedlist>
<listitem>
	<para>
	Lokale Master-Browser kontaktieren den WINS-Server, und - sofern Samba sich als Domain Master Browser
	am WINS-Server registriert hat - der lokale Master-Browser empfängt die IP-Adresse des Samba-Servers
	als die seines Domain Master Browsers.
	</para>
</listitem>

<listitem>
	<para>
	Wenn ein Client eine domänen-weite Browse-Liste erhält und ein Benutzer versucht, auf einen Host in
        dieser Liste zuzugreifen, kontaktiert der Client den WINS-Server, um den NetBIOS-Namen dieses Hosts
	aufzulösen. Sofern dieser Host seinen eigenen NetBIOS-Namen am selben WINS-Server registriert hat, wird
	der Benutzer diesen Host auch sehen können.	
	</para>
</listitem>
</orderedlist>

</sect2>

<sect2>
<title>Bemerkung zu Broadcast-Adressen</title>

<para>
Wenn Ihr Netzwerk eine auf 0 basierende Broadcast-Adresse verwendet (zum Beispiel, wenn diese auf 0 endet), dann
werden Sie Probleme bekommen. Windows for Workgroups scheint keine 0-Broadcasts zu unterstützen, und Sie werden
wahrscheinlich herausfinden, dass das Browsing und die Namensauflösung nicht funktionieren.
</para>
</sect2>

<sect2>
<title>Mehrere Interfaces</title>

<para>
Samba unterstützt Maschinen mit mehreren Netzwerk-Interfaces. Wenn Sie mehrere Interfaces haben, müssen Sie die
Option <smbconfoption><name>interfaces</name></smbconfoption> in &smb.conf; setzen, um sie zu konfigurieren.
</para>
</sect2>
<sect2>
<title>Verwendung des Parameters Remote Announce</title>
<para>
Mit dem Parameter <smbconfoption><name>remote announce</name></smbconfoption> in &smb.conf; können Sie erzwingen, dass all die NetBIOS-Namen eines Netzwerks in einem entfernten Netzwerk bekannt gegeben
werden. Die Syntax des Parameters <smbconfoption><name>remote announce</name></smbconfoption> ist:
<smbconfblock>
<smbconfoption><name>remote announce</name><value>a.b.c.d [e.f.g.h] ...</value></smbconfoption>
</smbconfblock>
<emphasis>oder</emphasis>
<smbconfblock>
<smbconfoption><name>remote announce</name><value>a.b.c.d/ARBEITSGRUPPE [e.f.g.h/ARBEITSGRUPPE] ...</value></smbconfoption>
</smbconfblock>

wobei Folgendes gilt:
<variablelist>
	<varlistentry><term><replaceable>a.b.c.d</replaceable> und <replaceable>e.f.g.h</replaceable></term>
		<listitem><para>
<indexterm><primary>LMB</primary><see>Local Master Browser</see></indexterm>
<indexterm><primary>Local Master Browser</primary></indexterm>
		ist entweder die IP-Adresse des LMB (lokalen Master-Browsers) oder die Broadcast-Adresse des
		entfernten Netzwerks, d.h., der LMB ist unter 192.168.1.10 erreichbar, oder die Adresse wird
		als 192.168.1.255 angegeben, wobei ein 24-Bit-Netzwerk angenommen wird (255.255.255.0).
		Wenn die Bekanntgabe an die Broadcast-Adresse des entfernten Netzwerks erfolgt, wird jeder
		Host diese empfangen. Das macht ziemlich viel <quote>Lärm</quote> im Netz und ist daher nicht
		erstrebenswert, kann aber erforderlich sein, wenn wir die IP-Adresse des entfernten LMBs nicht
		kennen.
		</para></listitem>
	</varlistentry>

	<varlistentry>
		<term><replaceable>ARBEITSGRUPPE</replaceable></term>
		<listitem><para>ist optional und kann entweder unsere eigene Arbeitsgruppe oder die des 
		entfernten Netzwerks sein. Wenn Sie den Arbeitsgruppen-Namen des entfernten Netzwerks verwenden,
		werden unsere NetBIOS-Maschinen-Namen so aussehen, als ob sie jener Arbeitsgruppe gehörten. Dies
		kann zu Problemen bei der Namensauflösung führen und sollte vermieden werden.
		</para></listitem>
	</varlistentry>
</variablelist>
</para>

</sect2>

<sect2>
<title>Verwendung des Parameters Remote Browse Sync</title>

<para>
Der Parameter <smbconfoption><name>remote browse sync</name></smbconfoption> 
in &smb.conf; wird verwendet, um einem anderen LMB mitzuteilen, dass er seine NetBIOS-Namensliste mit unserem
Samba-LMB synchronisieren muss. Dies funktioniert nur, wenn der Samba-Server, der diese Option gesetzt hat,
gleichzeitig der LMB in seinem Netzwerk-Segment ist.
</para>

<para>
Die Syntax des Parameters <smbconfoption><name>remote browse sync</name></smbconfoption> ist:

<smbconfblock>
<smbconfoption><name>remote browse sync</name><value><replaceable>a.b.c.d</replaceable></value></smbconfoption>
</smbconfblock>

wobei <replaceable>a.b.c.d</replaceable> entweder die IP-Adresse des entfernten LMBs ist oder die 
Netzwerk-Broadcast-Adresse des entfernten Netzwerk-Segments.
</para>

</sect2>

</sect1>

<sect1>
<title>WINS &smbmdash; Der <quote>Windows Internetworking Name Server</quote></title>

<para>
Die Verwendung von WINS (entweder als Samba-WINS oder als MS Windows NT-Server-WINS) wird wärmstens empfohlen. Jede
NetBIOS-Maschine registriert seinen Namen zusammen mit einem <quote>name_type</quote>-Wert für jeden der
Dienste, die sie zur Verfügung stellt. Die Maschine registriert ihren Namen direkt als eindeutigen Namen
(Typ 0x03). Sie registriert ihren Namen auch, wenn sie den LanManager-kompatiblen Server-Dienst ausführt
(er wird zur Freigabe von Dateien und Druckern verwendet), indem sie den Server-Namen (Typ 0x20) registriert.
</para>

<para>
Alle NetBIOS-Namen sind bis zu 15 Zeichen lang. Die Variable <quote>name_type</quote> wird an den Namen angehängt, daher 
entsteht ein 16-Zeichen-Name. Jeder Name, der kürzer als 15 Zeichen ist, wird mit Leerzeichen bis zum 15. Zeichen
aufgefüllt. Daher sind alle NetBIOS-Namen 16 Zeichen lang (inklusive der <quote>name_type</quote>-Information).
</para>

<para>
WINS kann diese 16-Zeichen-Namen bei ihrer Registrierung speichern. Ein Client, der sich am Netzwerk anmelden 
will, kann den WINS-Server nach einer Liste aller registrierten Namen befragen. Das spart 
Broadcast-Netzwerkverkehr und beschleunigt die Bearbeitung von Anmeldungen deutlich. Da die Broadcast-Namensauflösung
nicht über Netzwerk-Segmente hinweg verwendet werden kann, kann diese Art von Information nur über WINS
bereitgestellt werden oder über eine statisch konfigurierte <filename>lmhosts</filename>-Datei, die beim
Fehlen von WINS auf allen Clients vorhanden sein muss. 
</para>

<para>
WINS erfüllt auch den Zweck, die Synchronisation von Browse-Listen auf allen LMBs zu erzwingen. Die LMBs müssen 
ihre Browse-Listen mit dem DMB (Domain Master Browser) synchronisieren, und WINS hilft den LMBs, ihren
zugehörigen DMB zu identifizieren. Per Definition funktioniert dies nur innerhalb einer einzelnen Arbeitsgruppe.
Beachten Sie, dass der Domain Master Browser nichts mit dem zu tun hat, was als MS Windows NT-Domäne bezeichnet
wird. Letzteres ist die Bezeichnung für eine Sicherheitsumgebung, während sich die Bezeichnung DMB nur auf den 
Master-Controller der Browse-Listen-Informationen bezieht.
</para>

<para>
WINS arbeitet nur korrekt, wenn der TCP/IP-Protokoll-Stack jedes Clients für die Verwendung der WINS-Server
konfiguriert ist. Jeder Client, der nicht für die Verwendung des WINS-Servers konfiguriert ist, verwendet
weiterhin eine Broadcast-Namensauflösung, und es kann sein, dass WINS gar nicht von diesem Client erfährt. In jedem
Fall werden die Namen von Maschinen, die nicht im WINS registriert sind, nicht von anderen Clients aufgelöst
werden können und daher zu Zugriffsproblemen und Fehlern führen.
</para>

<para>
Um Samba als WINS-Server zu konfigurieren, fügen Sie
<smbconfoption><name>wins support</name><value>yes</value></smbconfoption> zum Abschnitt 
<smbconfsection>[global]</smbconfsection> ihrer &smb.conf; hinzu.
</para>

<para>
Um Samba so zu konfigurieren, dass es sich an einem WINS-Server registriert, fügen Sie
<smbconfoption><name>wins server</name><value>a.b.c.d</value></smbconfoption> zum Abschnitt
<smbconfsection>[global]</smbconfsection> ihrer &smb.conf; hinzu.
</para>

<important><para>
Verwenden Sie niemals <smbconfoption><name>wins support</name><value>yes</value></smbconfoption> gemeinsam mit
<smbconfoption><name>wins server</name><value>a.b.c.d</value></smbconfoption>, besonders nicht mit der eigenen
IP-Adresse. Wenn beide Parameter so angegeben werden, wird &nmbd; den Start verweigern!
</para></important>

<sect2>
<title>Die Konfiguration des WINS-Servers</title>

<para>
Sie können entweder einen Samba-Server oder einen Windows NT-Server als WINS-Server einrichten. Um einen
Samba-Server als WINS-Server einzurichten, müssen Sie auf dem gewählten Server folgende Zeile zum Abschnitt
<smbconfsection>[global]</smbconfsection> der &smb.conf; hinzufügen:
</para>

<para>
<smbconfblock>
<smbconfoption><name>wins support</name><value>yes</value></smbconfoption>
</smbconfblock>
</para>

<para>
Samba-Versionen vor 1.9.17 hatten diesen Parameter standardmäßig auf <quote>yes</quote> gesetzt. 
Wenn Sie irgendwelche älteren
Samba-Versionen in Ihrem Netzwerk haben, ist es sehr ratsam, diese Installationen auf eine aktuelle Version zu
updaten oder zumindest auf all diesen Maschinen den Parameter auf <quote>no</quote> zu setzen.
</para>

<para>
Maschinen, die mit <smbconfoption><name>wins support</name><value>yes</value></smbconfoption> konfiguriert sind,
führen eine Liste aller auf ihnen registrierten NetBIOS-Namen und arbeiten damit als DNS für NetBIOS-Namen.
</para>

<para>
Es wird wärmstens empfohlen, nur einen WINS-Server einzurichten. Setzen Sie die Option
<smbconfoption><name>wins support</name><value>yes</value></smbconfoption> nicht auf mehr als einem Samba-Server.
</para>

<para>
<indexterm><primary>Replikation</primary><secondary>WINS</secondary></indexterm>
Um einen Windows NT/200x-Server als WINS-Server einzurichten, installieren und konfigurieren Sie den WINS-Dienst.
Konsultieren Sie die Windows NT/200x-Dokumentation für mehr Details zu diesem Thema. Windows NT/200x-WINS-Server können sich
untereinander replizieren, was es erlaubt, mehr als einen solchen Server in einer komplexen Subnetz-Umgebung
einzurichten. Da Microsoft sich weigert, die Replikationsprotokolle zu dokumentieren, kann Samba derzeit nicht an
diesen Replikationen teilnehmen. Es ist möglich, dass zukünftig ein Samba-zu-Samba-WINS-Replikationsprotokoll
definiert werden kann, was bedeuten würde, dass mehr als nur eine Samba-Maschine als WINS-Server eingerichtet
werden könnte. Derzeit sollte jedoch nur auf einem Samba-Server der Parameter
<smbconfoption><name>wins support</name><value>yes</value></smbconfoption> gesetzt sein.
</para>

<para>
Nachdem der WINS-Server konfiguriert worden ist, müssen Sie sicherstellen, dass alle Maschinen im Netzwerk mit der
Adresse dieses WINS-Servers konfiguriert werden. Wenn Ihr WINS-Server eine Samba-Maschine ist, tragen Sie die
IP-Adresse der Samba-Maschine im Feld <guilabel>Primärer WINS Server</guilabel> der Dialoge
<guilabel>Systemsteuerung->Netzwerk->Protokolle->TCP->WINS Server</guilabel> von Windows 9x/Me oder 
Windows NT/200x ein. Um einem Samba-Server die Adresse des WINS-Servers mitzuteilen, fügen Sie die folgende
Zeile zum Abschnitt
<smbconfsection>[global]</smbconfsection> ihrer &smb.conf; hinzu:
</para>

<para>
<smbconfblock>
<smbconfoption><name>wins server</name><value>&lt;Name oder IP-Adresse&gt;</value></smbconfoption>
</smbconfblock>
</para>

<para>
wobei &lt;Name oder IP-Adresse&gt; entweder der DNS-Name oder die IP-Adresse des WINS-Servers ist.
</para>

<para>
Diese Zeile darf nicht in der Datei &smb.conf; des Samba-Servers enthalten sein, der als WINS-Server arbeitet. Wenn Sie sowohl
<smbconfoption><name>wins support</name><value>yes</value></smbconfoption> als auch
<smbconfoption><name>wins server</name><value>&lt;name&gt;</value></smbconfoption> setzen, wird
<command>nmbd</command> nicht starten.
</para>

<para>
Es gibt zwei mögliche Szenarios, um ein Cross-Subnetz-Browsing einzurichten. Das erste behandelt Details der
Einrichtung des Cross-Subnetz-Browsings in einem Netzwerk, das Maschinen mit Windows 9x/Me, Samba und 
Windows NT/200x enthält, die nicht als Mitglieder einer Windows NT-Domäne konfiguriert sind. Das zweite
Szenario behandelt die Details der Einrichtung von Cross-Subnetz-Browsing in einem Netzwerk, das NT-Domänen
enthält.
</para>

</sect2>

<sect2>
<title>WINS-Replikation</title>

<para>
<indexterm><primary>Replikation</primary><secondary>WINS</secondary></indexterm>
Samba-3 erlaubt eine WINS-Replikation, wenn dazu das Utility <filename>wrepld</filename> verwendet wird. Dieses kann
derzeit nicht eingesetzt werden, da es sich nach wie vor in der Entwicklung befindet. Sobald es
einigermaßen funktioniert, werden wir dazu Manpages erstellen und diesen Abschnitt der Dokumentation
erweitern, um Ihnen entsprechende Details zur Verwendung und zu den technischen Hintergründen zur Verfügung zu stellen.
</para>

</sect2>
<sect2>
<title>Statische WINS-Einträge</title>

<para>
Das Hinzufügen von statischen Einträgen zu Ihrem WINS-Server ist tatsächlich ziemlich einfach. Alles, was Sie
tun müssen, ist, eine Zeile zur Datei <filename>wins.dat</filename> hinzuzufügen, üblicherweise in
<filename class="directory">/usr/local/samba/var/locks</filename> oder 
<filename>/var/run/samba</filename>.
</para>

<para>
Einträge in <filename>wins.dat</filename> haben die Form:

<programlisting>
"NAME#TYPE" TTL ADDRESS+ FLAGS
</programlisting>
Dabei ist NAME der NetBIOS-Name, TYPE der NetBIOS-Typ, TTL die <quote>time-to-live</quote> als Absolut-Zeit in
Sekunden und ADDRESS+ eine oder mehrere Adressen, die mit der Registrierung zusammenhängen; und FLAGS sind die
NetBIOS-Flags für die Registrierung.
</para>

<para>
Ein typischer dynamischer Eintrag sieht so aus:
<programlisting>
"MADMAN#03" 1055298378 192.168.1.2 66R
</programlisting>

Um ihn statisch zu machen, muss nur der Wert für TTL auf 0 gesetzt werden:

<programlisting>
"MADMAN#03" 0 192.168.1.2 66R
</programlisting>
</para>

<para>
Obwohl diese Methode nur mit frühen Samba-3-Versionen funktioniert, ist es möglich, dass sie sich in zukünftigen
Samba-Versionen verändert, wenn WINS-Replikation hinzugefügt wird.
</para>

</sect2>
</sect1>

<sect1>
<title>Hilfreiche Hinweise</title>

<para>
Achten Sie auf die folgenden Hinweise, da diese Punkte bereits für viele Netzwerk-Administratoren
zu Stolpersteinen geworden sind.
</para>

<sect2>
<title>Windows-Netzwerk-Protokolle</title>

<para>
Eine verbreitete Ursache von Browsing-Problemen ist, dass mehrere Netzwerk-Protokolle auf einer 
MS Windows-Maschine installiert werden.
</para>

<warning><para>
Verwenden Sie nicht mehr als ein Protokoll auf MS Windows-Clients.
</para></warning>

<para>
Jede NetBIOS-Maschine nimmt alle 15 Minuten an der Wahl des LMB (und des DMB) teil. Eine Anzahl von
Auswahl-Kriterien wird verwendet, um die Rangfolge der Maschinen zum Gewinnen dieser Wahl zu bestimmen. 
Eine Maschine, die Samba ausführt, oder Windows NT, wird bevorzugt, so dass die am ehesten passende Maschine
voraussichtlich gewinnen und damit diese Rolle übernehmen wird.
</para>

<para>
Der Auswahlprozess wird sozusagen über jedes NetBIOS-Netzwerk-Interface <quote>ausgefochten</quote>. Im Fall
einer Maschine mit Windows 9x/Me, die sowohl TCP/IP als auch IPX installiert hat und NetBIOS über beide
Protokolle aktiviert hat, wird die Wahl über beide Protokolle entschieden. Falls, wie es oft passiert, die
Maschine mit Windows 9x/Me die einzige mit beiden Protokollen ist, kann der LMB auf dem NetBIOS-Netzwerk-Interface
über das IPX-Protokoll gewonnen werden. Samba verliert dann seine LMB-Rolle, da Windows 9x/Me darauf beharrt zu
wissen, wer der LMB ist. Samba wird dann seine Funktion als LMB beenden, und daher werden ab da die
Browse-Listen-Operationen auf allen Maschinen scheitern, die nur über TCP/IP arbeiten.
</para>

<para>
Auf Windows 95, 98, 98SE und ME bezieht man sich generell als Windows 9x/Me.
Windows NT4, 200x und XP verwenden gemeinsame Protokolle. Diese Systeme werden grob als die Windows-NT-Familie
bezeichnet, aber Sie sollten wissen, dass Windows 2000 und XP/2003 neue Protokoll-Erweiterungen
einführen, wodurch sich das Verhalten dieser Systeme vom Verhalten von MS Windows NT4 unterscheidet.
Allgemein gilt, dass ein Server zur Verwendung der NT4-Protokolle zurückkehrt, wenn er nicht das neuere oder erweiterte Protokoll unterstützt.
</para>

<para>
Die sicherste Regel von allen, die es zu befolgen gilt, ist: Verwenden Sie nur ein Protokoll!
</para>

</sect2>

<sect2>
<title>Die Reihenfolge der Namensauflösung</title>

<para>
Die Auflösung von NetBIOS-Namen in IP-Adressen kann mit vielen Methoden erfolgen. Die einzigen Methoden,
die NetBIOS-Informationen vom Typ <quote>name_type</quote> bereitstellen können, sind:
</para>

<itemizedlist>
	<listitem>WINS &smbmdash; das beste Werkzeug.</listitem>
	<listitem>LMHOSTS &smbmdash; statisch und schwierig zu warten.</listitem>
	<listitem>Broadcast &smbmdash; verwendet UDP und kann keine Namen über Segmente hinweg auflösen.</listitem>
</itemizedlist>

<para>
Alternative Möglichkeiten der Namensauflösung sind:
</para>
<itemizedlist>
<listitem>Statische <filename>/etc/hosts</filename> &smbmdash; schwierig zu warten; fehlende <quote>name_type</quote>-Information.</listitem>
<listitem>DNS &smbmdash; ist eine gute Wahl, jedoch fehlt die name_type-Information.</listitem>
</itemizedlist>

<para>
Viele Installationen wollen DNS-Lookups verbieten und den Netzwerk-Verkehr vermeiden, der durch die Broadcast-Namensauflösung
entsteht. Der Parameter <parameter>name resolve order</parameter> ist hier von großer Hilfe.
Die Syntax des Parameters <parameter>name resolve order</parameter> ist:
<smbconfblock>
<smbconfoption><name>name resolve order</name><value>wins lmhosts bcast host</value></smbconfoption>
</smbconfblock>
<emphasis>oder</emphasis>
<smbconfblock>
<smbconfoption><name>name resolve order</name><value>wins lmhosts  	(eliminiert bcast und host)</value></smbconfoption>
</smbconfblock>
Der Standard ist:
<smbconfblock>
<smbconfoption><name>name resolve order</name><value>host lmhost wins bcast</value></smbconfoption>
</smbconfblock>
wobei <quote>host</quote> sich auf die nativen Methoden bezieht, die vom UNIX-System zur Implementation des
Funktionsaufrufs gethostbyname() verwendet werden. Dies wird normalerweise über die Dateien
<filename>/etc/host.conf</filename>, <filename>/etc/nsswitch.conf</filename> und
<filename>/etc/resolv.conf</filename> gesteuert.
</para>
</sect2>
</sect1>

<sect1>
<title>Technischer Überblick über das Browsing</title>

<para>
SMB-Netzwerke bieten einen Mechanismus, mit dem Clients auf eine Liste von Maschinen in einem Netzwerk zugreifen
können, eine so genannte <smbconfoption><name>Browse-Liste</name></smbconfoption>. Diese Liste enthält
Maschinen, die andere Maschinen im Netzwerk Datei- und/oder Druckdienste anbieten.
Daher umfasst diese Liste keine Maschinen, die momentan nicht imstande sind, Serveraufgaben zu erfüllen. Die
Browse-Liste wird von allen SMB-Clients intensiv benutzt. Die Konfiguration des SMB-Browsings war für manche
Samba-Benutzer problematisch, daher gibt es jetzt dieses Dokument.
</para>

<para>
MS Windows 2000 und spätere Versionen von Windows, genauso wie Samba-3 und dessen spätere Versionen, können
so konfiguriert werden, dass sie NetBIOS-über-TCP/IP nicht verwenden. Wenn sie auf diese Art konfiguriert sind,
ist es unumgänglich, dass die Namensauflösung (mittels DNS/LDAP/ADS) korrekt konfiguriert und arbeitsfähig ist.
Das Browsing funktioniert nicht, wenn die Namensauflösung von SMB-Maschinen-Namen in IP-Adressen nicht korrekt
funktioniert.
</para>

<para>
Wo NetBIOS-über-TCP/IP aktiviert ist, wird der Einsatz eines WINS-Servers unbedingt empfohlen, um die
Namensauflösung zu unterstützen. WINS erlaubt es Clients in anderen Netzwerk-Segmenten, 
NetBIOS-name_type-Informationen zu beziehen, die von keiner anderen Methode der Namensauflösung bereitgestellt 
werden können.
</para>

<sect2>
<title>Die Unterstützung des Browsings in Samba</title>

<para>
Samba unterstützt Browsing. Das Browsing wird von &nmbd; bereitgestellt und wird auch von Optionen in der Datei
&smb.conf; gesteuert. Samba kann als lokaler Master-Browser für eine Arbeitsgruppe arbeiten, und die Fähigkeit,
Domänenanmeldungen und Domänenskripts zu unterstützen, ist jetzt verfügbar.
</para>

<para>
Samba kann auch als Domain Master Browser für eine Arbeitsgruppe arbeiten. Das bedeutet, dass es die Listen der
lokalen Master-Browser sammelt und sie zu einer Serverliste für ein gesamtes WAN zusammenfügt. Um es den Clients
zu ermöglichen, die Namen, die sie in der Liste finden, auch aufzulösen, wird empfohlen, dass sowohl Samba als
auch die Clients einen WINS-Server verwenden.
</para>

<para>
Konfigurieren Sie Samba nicht als Domänen-Master für eine Arbeitsgruppe, die denselben Namen wie eine NT-Domäne
hat. In jedem WAN dürfen Sie immer nur einen Domain Master Browser pro Arbeitsgruppe haben, egal ob es NT, 
Samba oder sonst ein Typ von Domänen-Master ist, der diesen Dienst anbietet.
</para>

<note><para>
<command>nmbd</command> kann als WINS-Server konfiguriert werden, aber es ist nicht notwendig, Samba im Speziellen
als WINS-Server zu verwenden. MS Windows NT4, Server oder Advanced Server 200x können als Ihr WINS-Server
eingerichtet werden. In einer gemischten NT/200x-Server- und Samba-Umgebung in einem WAN wird empfohlen, dass
Sie die MS WINS-Server-Fähigkeiten einsetzen. In einem reinen Samba-Umfeld wird empfohlen, einen und nur einen
Samba-Server als WINS-Server zu verwenden.
</para></note>

<para>
Um das Browsing zu aktivieren, müssen Sie &nmbd; wie üblich ausführen, aber müssen auch die Option
<smbconfoption><name>workgroup</name></smbconfoption> &smb.conf; verwenden, um zu bestimmen, welcher
Arbeitsgruppe Samba angehören soll.
</para>

<para>
Samba hat auch eine nützliche Option, um es einem Samba-Server zu ermöglichen, sich selbst für das Browsing in
einem anderen Subnetz anzubieten. Es wird empfohlen, diese Option nur für <quote>ungewöhnliche</quote>
Zwecke einzusetzen: für Verlautbarungen über das Internet, zum Beispiel. Lesen Sie zu der Option
<smbconfoption><name>remote announce</name></smbconfoption> in der Manpage zu
&smb.conf; nach. 
</para>
</sect2>

<sect2>
<title>Problemlösung</title>

<para>
Wenn etwas nicht funktioniert, hilft Ihnen die Datei <filename>log.nmbd</filename>, das Problem zu lokalisieren.
Testen Sie einen <smbconfoption><name>log level</name></smbconfoption> von 2 oder 3, um Probleme zu finden.
Beachten Sie auch, dass die aktuelle Browse-Liste üblicherweise in Textform in einer Datei namens
<filename>browse.dat</filename> gespeichert wird.
</para>

<para>
Wenn es nicht funktioniert, sollten Sie noch immer den Servernamen als <filename>\\SERVER</filename> im
<command>Dateimanager</command> eingeben können, und dieser sollte eine Liste der dort verfügbaren Freigaben
anzeigen.
</para>

<para>
Manche Anwender haben beobachtet, dass das Browsing scheitert, weil sie die globale Option
<smbconfoption><name>guest account</name></smbconfoption> nicht auf ein gültiges Konto gesetzt haben.
Erinnern Sie sich, dass die IPC$-Verbindung, die die Freigaben auflistet, als <quote>guest</quote> hergestellt wird, und dafür
brauchen Sie den gültigen <smbconfoption><name>guest account</name></smbconfoption>.
</para>

<para>
MS Windows 2000 und spätere Versionen (wie auch Samba) können so konfiguriert werden, dass sie anonymen Zugriff
(also mit dem guest account) auf die IPC$-Freigabe verbieten. In diesem Fall verwendet die
MS Windows 2000/XP/2003-Maschine den Namen des gerade angemeldeten Benutzers zur Verbindung mit der
IPC$-Freigabe. MS Windows 9x/Me-Clients können das nicht und werden dann auch nicht die Ressourcen des Servers
browsen können.
</para>

<para>
Das andere große Problem, das viele Leute haben, ist, dass ihre Broadcast-Adresse, Netmask oder IP-Adresse falsch
ist 
(sie wird mit der Option <smbconfoption><name>interfaces</name><value></value></smbconfoption> in &smb.conf; angegeben).
</para>
</sect2>

<sect2>
<title>Cross-Subnetz-Browsing</title>

<para>
<indexterm><primary>Replikation</primary><secondary>Browse-Listen</secondary></indexterm>
Seit der Veröffentlichung von Samba 1.9.17 (alpha1) unterstützt Samba die Replikation von Browse-Listen über
die Subnetz-Grenzen hinweg. Dieser Abschnitt beschreibt, wie man diese Replikation auf verschiedene Arten
einrichtet.
</para>

<para>
Um Browse-Listen zu sehen, die TCP/IP-Subnetze umspannen (d.h. Netzwerke, die von Routern getrennt sind, die keinen
Broadcast-Verkehr weiterleiten), müssen Sie zumindest einen WINS-Server einrichten. Der WINS-Server fungiert als
DNS für NetBIOS-Namen. Dies erlaubt die Auflösung von NetBIOS-Namen in IP-Adressen durch eine direkte 
Abfrage des WINS-Servers. Dies geschieht mittels eines gerichteten UDP-Pakets auf Port 137 der 
WINS-Server-Maschine. Mit einem WINS-Server ist keine Standard-Namensauflösung erforderlich, die mittels
UDP-Broadcasts von der Client-Maschine aus geschehen würde. Das bedeutet, dass Maschinen in einem Subnetz nicht
imstande sind, die Namen von Maschinen in einem anderen Subnetz aufzulösen, solange sie keinen WINS-Server verwenden.
</para>

<para>
Denken Sie daran: Um das Browsing über Subnetze hinweg korrekt funktionieren zu lassen, müssen alle Maschinen,
egal ob Windows 95, Windows NT oder Samba, die IP-Adresse einen WINS-Servers mittels DHCP-Server oder manueller
Konfiguration erhalten (für Windows 9x/Me und Windows NT/200x/XP erfolgt die Konfiguration in den TCP/IP-Eigenschaften unter
den Netzwerkeinstellungen); für Samba erfolgt die Konfiguration in der Datei &smb.conf;.
</para>

<sect3>
<title>Das Verhalten des Cross-Subnetz-Browsings</title>

<para>
Das Cross-Subnetz-Browsing ist ein <quote>komplizierter Tanz</quote>, mit vielen bewegten Teilen. Es hat Microsoft
einige Jahre gekostet, den Code dafür korrekt zu erstellen, und Samba hängt in einigen Bereichen nach. Samba
ist jedoch bei korrekter Konfiguration zum Cross-Subnetz-Browsing imstande.
</para>

<para>
Nehmen wir an, ein Netzwerk sei so konfiguriert wie im folgenden 
<link linkend="browsing1">Cross-Subnetz-Browsing-Beispiel</link>.
</para>

<image id="browsing1" scale="40"><imagedescription>Beispiel für das Cross-Subnetz-Browsing</imagedescription><imagefile>browsing1</imagefile></image>
	
<para>
Unser Beispielnetz besteht aus drei Subnetzen (1, 2, 3), die durch zwei Router (R1, R2)verbunden sind, die keine Broadcasts 
weiterleiten. Subnetz 1 enthält fünf Maschinen, Subnetz 2 vier Maschinen und Subnetz 3 vier Maschinen. Nehmen wir
an, dass alle Maschinen so konfiguriert sind, dass sie in der gleichen Arbeitsgruppe sind (der Einfachheit halber).
Die Maschine N1_C im Subnetz 1 ist als der Domain Master Browser konfiguriert (d.h., diese Maschine sammelt
die Browse-Listen für die Arbeitsgruppe). Die Maschine N2_D ist als der WINS-Server eingerichtet, und alle anderen
Maschinen sind so konfiguriert, dass sie ihre jeweiligen NetBIOS-Namen an diesem WINS-Server registrieren.
</para>

<para>
Wenn diese Maschinen gebootet werden, finden die Wahlen zum Master-Browser in jedem der drei Subnetze statt.
Nehmen wir an, dass die Maschine N1_C im Subnetz 1 gewinnt, N2_B im Subnetz 2 und N3_D im Subnetz 3. Diese
Maschinen sind sodann als lokale Master-Browser in ihrem jeweiligen Subnetz bekannt. N1_C hat einen Vorteil
bei der Wahl zum lokalen Master-Browser im Subnetz 1, da sie als der Domain Master Browser konfiguriert ist.
</para>

<para>
In jedem der drei Netzwerke werden Maschinen, auf denen Freigaben eingerichtet sind, durch einen Broadcast mitteilen,
dass sie diese Dienste anbieten. Der lokale Master-Browser in jedem Subnetz wird diese Broadcasts empfangen und in
einem Eintrag festhalten, dass die Maschine diesen Dienst anbietet. Die Liste dieser
Einträge ist die Grundlage für die Browse-Liste. Nehmen Sie für diesen Fall an, dass alle Maschinen eingerichtete
Freigaben haben, so dass alle Maschinen in der Browse-Liste sind.
</para>

<para>
Für jedes Netzwerk wird der lokale Master-Browser als <quote>autoritativ</quote> für all die Namen betrachtet,
die er durch lokale Broadcasts empfängt. Das rührt daher, dass eine Maschine, die vom LMB über einen lokalen
Broadcast gesehen wird, im selben Netzwerk wie der LMB sein muss und daher eine <quote>vertrauenswürdige</quote>
und <quote>überprüfbare</quote> Ressource ist. Maschinen in anderen Netzwerken, von denen die LMBs beim
Sammeln der Browse-Listen erfahren, wurden nicht direkt gesehen; diese Einträge werden als 
<quote>nicht autoritativ</quote> bezeichnet.
</para>

<para>
An diesem Punkt sehen Browse-Listen wie im <link linkend="browsubnet">nächsten Beispiel</link> aus (dies sind die
Maschinen, die Sie in Ihrer Netzwerkumgebung sehen würden, wenn Sie jetzt in einem einzelnen Netzwerk nachsehen würden).
</para>

<para>
<table frame="all" id="browsubnet">
	<title>Subnetz-Browsing Beispiel 1</title>		
	<tgroup align="left" cols="3">
	<thead>
		<row><entry>Subnetz</entry><entry>Browse-Master</entry><entry>Liste</entry></row>
	</thead>

	<tbody>
		<row><entry>Subnetz1</entry><entry>N1_C</entry><entry>N1_A, N1_B, N1_C, N1_D, N1_E</entry></row>
		<row><entry>Subnetz2</entry><entry>N2_B</entry><entry>N2_A, N2_B, N2_C, N2_D</entry></row>
		<row><entry>Subnetz3</entry><entry>N3_D</entry><entry>N3_A, N3_B, N3_C, N3_D</entry></row>
	</tbody>
	</tgroup>
</table>
</para>

<para>
An diesem Punkt sind alle Subnetze separat, und keine Maschine wird über die Grenzen eines Subnetzes hinweg 
gesehen.
</para>

<para>
Sehen Sie sich nun Subnetz 2 an. Sobald N2_B zum lokalen Master-Browser geworden ist, sucht diese Maschine nach einem
DMB, mit dem sie ihre Browse-Liste synchronisieren kann. Das tut sie, indem sie auf dem WINS-Server (N2_D)
nach der IP-Adresse fragt, die mit dem NetBIOS-Namen ARBEITSGRUPPE&lt;1B&gt; assoziiert ist. Dieser Name wurde vom
DMB (N1_C) auf dem WINS-Server registriert, als der DMB gestartet wurde.
</para>

<para>
Sobald N2_B die Adresse des DMB kennt, teilt diese Maschine dem DMB mit, dass sie der LMB für das Subnetz 2 ist,
indem sie ein <emphasis>MasterAnnouncement</emphasis>-Paket als UDP-Paket an den Port 138 sendet. Dann
synchronisiert sie sich mit dem DMB, indem sie einen Aufruf namens <emphasis>NetServerEnum2</emphasis>
durchführt. Das weist den DMB an, all die Servernamen zu senden, über die er Bescheid weiß. Bei Empfang
des <emphasis>MasterAnnouncement</emphasis>-Pakets setzt der DMB eine Synchronisations-Abfrage an den Absender
dieses Pakets ab. Nachdem beide Synchronisationen vollständig erfolgt sind, sehen die Browse-Listen so aus wie in
<link linkend="brsbex">folgender Tabelle</link>:
</para>

<table frame="all" id="brsbex">
	<title>Subnetz-Browsing Beispiel 2</title>		
	<tgroup	cols="3">
		<colspec align="left"/>
		<colspec align="left"/>
		<colspec align="justify" colwidth="1*"/>
	<thead>
		<row><entry>Subnetz</entry><entry>Browse-Master</entry><entry>Liste</entry></row>
	</thead>

	<tbody>
		<row><entry>Subnetz1</entry><entry>N1_C</entry><entry>N1_A, N1_B, N1_C, N1_D, N1_E,
N2_A(*), N2_B(*), N2_C(*), N2_D(*)</entry></row>
		<row><entry>Subnetz2</entry><entry>N2_B</entry><entry>N2_A, N2_B, N2_C, N2_D, N1_A(*), 
N1_B(*), N1_C(*), N1_D(*), N1_E(*)</entry></row>
		<row><entry>Subnetz3</entry><entry>N3_D</entry><entry>N3_A, N3_B, N3_C, N3_D</entry></row>
	</tbody>
	</tgroup>
</table>

<para>
Server mit einem folgenden (*) sind nicht-autoritative Namen.
</para>

<para>
An diesem Punkt sehen die Benutzer, die in ihre Netzwerkumgebungen schauen, im Subnetz 1 oder 2 alle Server auf 
beiden Subnetzen; Benutzer im Subnetz 3 sehen nach wie vor nur die Server in ihrem eigenen Subnetz.
</para>

<para>
Dieselbe Abfolge von Ereignissen, die für N2_B geschehen ist, läuft nun für den LMB im Subnetz 3 ab (N3_D).
Wenn dieser seine Browse-Liste mit dem DMB (N1_A) synchronisiert, erhält er sowohl die Server-Einträge im 
Subnetz 1 als auch die im Subnetz 2. Nachdem N3_D sich mit N1_C synchronisiert hat und vice versa, sehen
die Browse-Listen wie im <link linkend="brsex2">folgenden Beispiel</link> aus. 
</para>

<table frame="all" id="brsex2">
	<title>Subnetz-Browsing Beispiel 3</title>		
	<tgroup cols="3" align="left">
		<colspec align="left"/>
		<colspec align="left"/>
		<colspec align="justify" colwidth="1*"/>

	<thead>
		<row><entry>Subnetz</entry><entry>Browse-Master</entry><entry>Liste</entry></row>
	</thead>

	<tbody>
		<row><entry>Subnetz1</entry><entry>N1_C</entry><entry>N1_A, N1_B, N1_C, N1_D, N1_E, 
N2_A(*), N2_B(*), N2_C(*), N2_D(*), N3_A(*), N3_B(*), N3_C(*), N3_D(*)</entry></row>
		<row><entry>Subnetz2</entry><entry>N2_B</entry><entry>N2_A, N2_B, N2_C, N2_D, N1_A(*), 
N1_B(*), N1_C(*), N1_D(*), N1_E(*)</entry></row>
		<row><entry>Subnetz3</entry><entry>N3_D</entry><entry>N3_A, N3_B, N3_C, N3_D, N1_A(*), 
N1_B(*), N1_C(*), N1_D(*), N1_E(*), N2_A(*), N2_B(*), N2_C(*), N2_D(*)</entry></row>
	</tbody>
	</tgroup>
</table>

<para>
Server mit einem folgenden (*) sind nicht-autoritative Namen.
</para>

<para>
An diesem Punkt sehen die Benutzer, die in ihre Netzwerkumgebungen schauen, im Subnetz 1 oder 3 alle Server auf
allen Subnetzen; und Benutzer im Subnetz 2 sehen nur die Server in den Subnetzen 1 und 2, aber nicht die im 
Subnetz 3. 
</para>

<para>
Abschließend wird sich der LMB des Subnetzes 2 (N2_B) mit dem DMB (N1_C) synchronisieren und die fehlenden
Server-Einträge erhalten. Wenn dann ein stabiler Zustand erreicht ist (sofern keine Maschinen entfernt oder
abgeschaltet werden), sehen die Browse-Listen so aus wie in <link linkend="brsex3">dieser Tabelle</link>.
</para>

<table frame="all" id="brsex3">
	<title>Subnetz-Browsing Beispiel 4</title>		
	<tgroup cols="3" align="left">
		<colspec align="left"/>
		<colspec align="left"/>
		<colspec align="justify" width="1*"/>

	<thead>
		<row><entry>Subnetz</entry><entry>Browse-Master</entry><entry>List</entry></row>
	</thead>

	<tbody>
		<row><entry>Subnetz1</entry><entry>N1_C</entry><entry>N1_A, N1_B, N1_C, N1_D, N1_E,
N2_A(*), N2_B(*), N2_C(*), N2_D(*), N3_A(*), N3_B(*), 
N3_C(*), N3_D(*)</entry></row>
		<row><entry>Subnetzz2</entry><entry>N2_B</entry><entry>N2_A, N2_B, N2_C, N2_D, N1_A(*), 
N1_B(*), N1_C(*), N1_D(*), N1_E(*), N3_A(*), N3_B(*), 
N3_C(*), N3_D(*)</entry></row>
		<row><entry>Subnetz3</entry><entry>N3_D</entry><entry>N3_A, N3_B, N3_C, N3_D, N1_A(*), 
N1_B(*), N1_C(*), N1_D(*), N1_E(*), N2_A(*), N2_B(*), 
N2_C(*), N2_D(*)</entry></row>
	</tbody>
	</tgroup>
</table>

<para>
Server mit einem folgenden (*) sind nicht-autoritative Namen.
</para>

<para>
Synchronisationen zwischen dem DMB und den LMBs werden weiter passieren, aber dies sollte ein Vorgang sein, der
einen gleich bleibenden Status aufrechterhält und keine Veränderungen herbeiführt.
</para>

<para>
Wenn Router R1 oder R2 ausfällt, passiert Folgendes:
</para>

<orderedlist>
<listitem>
	<para>
	Die Namen von Rechnern auf beiden Seiten der unerreichbaren Netzwerk-Fragmente werden bis zu 36 Minuten
	lang in den Netzwerkumgebungslisten weitergeführt.
	</para>
</listitem>

<listitem>
	<para>
	Versuche, sich mit diesen unerreichbaren Rechnern zu verbinden, werden scheitern, aber deren Namen werden
	nicht aus den Netzwerkumgebungslisten entfernt.	
	</para>
</listitem>

<listitem>
	<para>
	Wenn eines der Fragmente vom WINS-Server abgeschnitten wird, ist es nur noch fähig, auf Server 
	seines eigenen lokalen Subnetzes zuzugreifen, und zwar über eine subnetz-isolierte, auf Broadcasts beruhende
	Namensauflösung. Die Auswirkungen ähneln denen beim Verlust der Verbindung zu einem DNS-Server.
	</para>
</listitem>
</orderedlist>
</sect3>
</sect2>
</sect1>

<sect1>
<title>Gängige Fehler</title>

<para>
In den Mailing-Listen werden viele Fragen zum Browsing gestellt. Der Großteil der Browsing-Probleme rühren
von fehlerhafter Konfiguration der NetBIOS-Namensauflösung her. Manche bedürfen besonderer Beachtung.
</para>

<sect2>
<title>Wie kann man den Samba-NetBIOS-Name-Cache leeren, ohne Samba neu zu starten?</title>

<para>
<indexterm><primary>Name-Cache leeren</primary></indexterm>
<indexterm><primary>flush name cache</primary></indexterm>
Sambas <command>nmbd</command>-Prozess verwaltet den gesamten Umgang mit Browse-Listen. Unter normalen Umständen
ist es sicher, den Prozess <command>nmbd</command> neu zu starten. Dies wird den Samba NetBIOS-Name-Cache
effektiv leeren und dessen Neuaufbau initiieren. Wenn <command>nmbd</command> außer Betrieb genommen wird,
wird eine andere Maschine im Netzwerk zum Browse-Master. Diese neue Liste kann nach wie vor den fehlerhaften
Eintrag beinhalten. Wenn Sie wirklich eine fehlerhafte Maschine aus der Liste entfernen wollen, muss jede
Maschine im Netzwerk heruntergefahren und neu gestartet werden, nachdem alle Maschinen abgeschaltet worden sind.
Wenn kein kompletter Neustart möglich ist, besteht die einzige andere Möglichkeit darin zu warten, bis der betreffende
Eintrag seine Ablaufzeit erreicht hat und aus der Liste entfernt wird. Dies kann in manchen Netzwerken lange
dauern (vielleicht Monate ...).
</para>

</sect2>
 
<sect2>
<title>Die Server-Ressourcen können nicht aufgelistet werden</title>

<para><quote>Mein Client meldet <quote>This server is not configured to list shared resources</quote></quote></para>.

		
<para>
Wahrscheinlich ist Ihr Gastzugang aus irgendeinem Grund ungültig. Samba verwendet den <smbconfoption><name>guest account</name></smbconfoption> in
<command>smbd</command> für das Browsing. Überprüfen Sie, dass Ihr <smbconfoption><name>guest account</name></smbconfoption> gültig ist.
</para>

<para>Sehen Sie sich auch den Abschnitt zu 
<smbconfoption><name>guest account</name></smbconfoption> in der Manpage zu &smb.conf; an.</para>

</sect2>

<sect2>
	<title>Ich bekomme einen Fehler <errorname>"Unable to browse the network"</errorname></title>

	<para>Dieser Fehler kann viele Gründe haben:
<indexterm><primary>Browsing-Probleme</primary></indexterm>
	</para>
	
	<itemizedlist>
		<listitem><para>Es gibt keinen lokalen Master-Browser. Konfigurieren Sie &nmbd; 
			oder irgendeine andere Maschine als lokalen Master-Browser.</para></listitem>
		<listitem><para>Sie können sich nicht am lokalen Master-Browser anmelden. Können Sie sich dort
			als <quote>guest</quote> anmelden?</para></listitem>
		<listitem><para>Es gibt keine IP-Verbindung zum lokalen Master-Browser. Können Sie ihn mittels
			Broadcast erreichen?</para></listitem>
</itemizedlist>
</sect2>

<sect2>
<title>Das Browsing von Freigaben und Verzeichnissen ist sehr langsam</title>

<para><quote>
<indexterm><primary>langsames Browsing</primary></indexterm>
Es gibt nur zwei Maschinen in einem Test-Netzwerk. Eine Maschine ist ein Samba-Server, die andere eine
Windows XP-Maschine. Authentifikation und Anmeldungen funktionieren perfekt, aber wenn ich versuche, die
Freigaben am Samba-Server zu durchsuchen, wird der Windows XP-Client unbrauchbar. Manchmal reagiert er
für einige Minuten nicht. Manchmal antwortet der Windows Explorer und zeigt Dateien und Verzeichnisse ohne
Probleme.</quote>
</para>

<para><quote>
Aber die Freigabe ist von der Befehlszeile (<command>cmd</command>) aus unverzüglich verfügbar. Ist das ein
Samba-Problem oder ein Windows-Problem? Wie kann ich es lösen?
</quote></para>

<para>
Hier sind ein paar Möglichkeiten:
</para>

<variablelist>
	<varlistentry>
		<term>Schlechte Netzwerk-Hardware</term>
		<listitem><para>
<indexterm><primary>Schlechte Hardware</primary></indexterm>
<indexterm><primary>WebClient</primary></indexterm>
		Die meisten Probleme mit defekter Hardware haben mit billigen oder defekten Hubs, Routern,
		Netzwerkkarten (NICs) und schlechter oder fehlerhafter Verkabelung zu tun. Wenn ein Stück
		Hardware defekt ist, kann das ganze Netzwerk darunter leiden. Schlechte Netzwerk-Hardware
		kann Datenverluste verursachen. Die meisten Probleme mit Netzwerk-Hardware, jedoch nicht alle, gehen mit
		auffällig hohem Netzwerk-Verkehr einher.
		</para></listitem>
	</varlistentry>
	
	<varlistentry>
		<term>Der Windows XP WebClient</term>
		<listitem><para>
		Eine Reihe von Administratoren haben von ähnlichen Problemen mit langsamem Browsing berichtet
		und herausgefunden, dass das Problem verschwindet, wenn der Dienst WebClient abgeschaltet wird.
		Dies sollte auf jeden Fall überprüft werden, weil es eine simple Lösung ist, wenn 
		es funktioniert.
		</para></listitem>
	</varlistentry>
	
	<varlistentry>
		<term>Inkonsistente WINS-Konfiguration</term>
		<listitem><para>
		Diese Art von Problem ist gängig, wenn ein Client so konfiguriert worden ist, dass er einen WINS-Server verwenden soll
		(dies ist eine Einstellung der TCP/IP-Konfiguration) und es keinen WINS-Server im 
		Netzwerk gibt. Dieses Problem kann auch auftreten, wenn es zwar einen WINS-Server gibt, aber Samba nicht zu dessen
		Verwendung konfiguriert ist. Die Verwendung von WINS wird wärmstens empfohlen, wenn das Netzwerk
		das NetBIOS-über-TCP/IP-Protokoll verwendet. Wenn die Verwendung von NetBIOS-über-TCP/IP auf
		allen Clients deaktiviert ist, sollte Samba weder als WINS-Server konfiguriert werden noch zur
		Verwendung eines solchen.
		</para></listitem>
	</varlistentry>
	
	<varlistentry>
		<term>Falsche DNS-Konfiguration</term>
		<listitem><para>
		Dieser Fehler tritt auf, wenn die Verwendung von NetBIOS-über-TCP/IP deaktiviert ist, Active Directory verwendet wird und 
		der DNS-Server fehlerhaft konfiguriert ist. Lesen Sie dazu 
		<link linkend="adsdnstech">DNS and Active Directory</link>.		
		</para></listitem>
	</varlistentry>
</variablelist>

</sect2>
</sect1>
</chapter>

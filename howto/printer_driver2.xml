<?xml version="1.0" encoding="ISO-8859-1"?>

<chapter id="printing">

<chapterinfo>
	<author>
		<firstname>Kurt</firstname><surname>Pfeifle</surname>
		<affiliation>
			<orgname> Danka Deutschland GmbH </orgname>
			<address><email>kpfeifle@danka.de</email></address>
		</affiliation>
	</author>
	&author.jerry;
	&author.jht;
	<author>&person.gherman;<contrib>Deutsche Übersetzung</contrib></author>
</chapterinfo>

<title>Klassische Druckerunterstützung</title>

<sect1>
<title>Eigenschaften und Vorzüge</title>

<para>
Die Möglichkeit, etwas drucken zu können, ist für viele Benutzer oft eine
Dienstleistung von zentraler Bedeutung. Samba kann diese in einem Netz von 
Windows-Clients zuverlässig und nahtlos zur Verfügung stellen.
</para>

<para>
Ein Samba-Druckdienst kann auf einem Stand-alone- oder Domänenmitgliedsserver
betrieben werden, gemeinsam mit Dateiserver-Funktionen, oder auch auf 
einem eigenen Druckserver. Seine Sicherheit kann je nach Bedarf zwischen 
sehr hoch und sehr niedrig gewählt werden. Die Konfiguration kann
einfach oder komplex sein. Die verfügbaren Authentifizierungsschemata sind
im Wesentlichen die gleichen, die in den vorigen Kapiteln auch bei 
Dateidiensten beschrieben wurden. Alles in allem kann die Druckerunterstützung
von Samba einen NT- oder Windows 2000-Druckerserver vollständig ersetzen, oft
mit zusätzlichen Vorteilen. Clients können mit Hilfe des bekannten 
<quote>Point'n'Print</quote>-Mechanismus Treiber herunterladen und sie auf
Druckern installieren. Die Installation von Druckern über 
<quote>Anmeldeskripten</quote> ist kein Problem. Administratoren können Treiber,
die von Clients benutzt werden sollen, mit dem bekannten 
<quote>Assistenten für die Druckerinstallation</quote> 
(engl. <quote>Add Printer Wizard</quote>, APW) hochladen und 
verwalten. Ein weiterer 
Vorteil ist der, dass die Treiber- und Druckerverwaltung über die Kommandozeile 
oder mit Hilfe von Skripten ausgeführt werden kann, was bei einer großen 
Anzahl von Druckern effizienter ist. Falls eine zentrale Buchführung(((Verwaltung?))) der
Druckaufträge benötigt wird (Beobachtung jeder einzelnen Seite und Weitergabe 
der Rohdaten für alle möglichen statistischen Berichte), so wird diese Funktion 
am besten durch das neue Common UNIX Printing System (CUPS), das Drucksubsystem 
unter der Samba-Oberfläche, unterstützt.
</para>

<para>
Dieses Kapitel behandelt die Grundlagen des Druckens mit Samba, wie sie von
den traditionelleren Drucksystemen in UNIX (BSD- und System V-ähnliche)
implementiert sind. Vieles, was in diesem Kapitel abgedeckt wird, gilt auch 
für CUPS.
Falls Sie CUPS benutzen, sind Sie vielleicht versucht, zum nächsten Kapitel
zu springen, aber in dem Fall würden Sie bestimmt einiges verpassen.
Es wird empfohlen, dass Sie dieses Kapitel ebenso wie das Kapitel <link
linkend="CUPS-printing">Unterstützung des CUPS-Drucksystems</link> lesen.
</para>

<note>
<para>
Die meisten der folgenden Beispiele wurden auf Rechnern mit Windows XP
Professional überprüft. Dort, wo dieses Dokument die Antworten zu eingegebenen
Befehlen beschreibt, sollten Sie bedenken, dass Windows 200x/XP-Rechner zwar 
sehr ähnlich sind, sich aber in geringfügigen Details unterscheiden können.
Windows NT ist zusätzlich noch ein wenig anders.
</para>
</note>

</sect1>

<sect1>
<title>Technische Informationen</title>

<para>
Sambas Druckerunterstützung basiert immer auf dem installierten Drucksubsystem
des UNIX-Betriebssystems, auf dem es läuft. Samba nimmt damit die Rolle eines
<quote>Vermittlers</quote> ein. Es nimmt Druckdateien von Windows- (oder anderen
SMB-)Clients an und gibt sie an das eigentliche Drucksystem weiter, das 
sie bearbeitet, d.h., es muss mit beiden Seiten kommunizieren: sowohl mit den 
Drucker-Clients unter Windows als auch mit dem Drucksystem von UNIX. Daher 
müssen wir zwischen verschiedenen Arten von Betriebssystem-Clients 
unterscheiden, die sich alle unterschiedlich verhalten, ebenso wie zwischen
den verschiedenen Drucksystemen von UNIX, die ihrerseits verschiedene 
Eigenschaften haben und unterschiedlich angesprochen werden.
</para>

<para>
An dieser Stelle wird die traditionelle Art des Druckens unter UNIX behandelt.
Das nächste Kapitel behandelt detailliert das modernere <emphasis>Common UNIX
Printing System</emphasis> (CUPS).
</para>

<important><para>CUPS-Benutzer, seien Sie gewarnt: Springen Sie nicht einfach 
zum nächsten Kapitel weiter, sonst verpassen Sie eventuell wichtige Informationen,
die Sie nur hier finden!
</para></important>

<para>
Aus den Beiträgen auf der Samba-Mailingliste geht hervor, dass die
Druckerkonfiguration heute einer der problematischsten Aspekte bei der 
Administration von Samba ist. Viele neue Samba-Administratoren gewinnen
den Eindruck, dass Samba irgendeinen Teil des Druckvorgangs selbst übernimmt.
Seien Sie jedoch versichert, dass Samba keinerlei Verarbeitung beim Drucken
selbst durchführt. Es agiert in keiner Weise als Druckerfilter.
</para>

<para>
Von seinen Clients bekommt Samba einen Datenstrom (den Druckauftrag), den es
an ein lokales Spooling-Verzeichnis leitet. Nachdem der gesamte 
Druckauftrag empfangen wurde, führt Samba einen lokalen UNIX/Linux-Druckbefehl 
aus und übergibt ihm die erhaltene Datei. Es ist die Aufgabe der 
Drucksubsysteme des lokalen Systems, den Druckauftrag korrekt zu bearbeiten 
und ihn an den Drucker zu übergeben.
</para>

<sect2>
<title>Übergabe eines Druckauftrags vom Client an Samba</title>

<para>
Um von einem Windows-Client einen Druckauftrag über einen 
Samba-Druckserver an einen UNIX-Drucker zu senden, sind sechs (manchmal sieben) 
Stadien erforderlich:
</para>

<orderedlist>
<listitem><para>Windows öffnet eine Verbindung zur Druckerfreigabe.</para></listitem>

<listitem><para>Samba muss den Benutzer authentifizieren.</para></listitem>

<listitem><para>Windows sendet eine Kopie der Druckdatei über das Netzwerk
in den Spooling-Bereich von Samba.</para></listitem>

<listitem><para>Windows trennt die Verbindung.</para></listitem>

<listitem><para>Samba führt den Druckbefehl aus, mit dem die Datei in den
Spooling-Bereich des UNIX-Drucksubsystems übergeben wird.</para></listitem>

<listitem><para>Das UNIX-Drucksubsystem bearbeitet den Druckauftrag.</para></listitem>

<listitem><para>Die Druckdatei muss eventuell explizit aus dem Spooling-Bereich 
von Samba gelöscht werden. Dieser Punkt hängt von den Konfigurationseinstellungen 
Ihres Druck-Spoolers ab.</para></listitem>

</orderedlist>
</sect2>

<sect2>
<title>Druckrelevante Konfigurationsparameter</title>

<para>
Es gibt eine Reihe von Konfigurationsparametern, mit denen man Sambas
Druckverhalten steuern kann. Bitte sehen Sie sich die Manpage zu &smb.conf; 
an, um eine Übersicht darüber zu erhalten. Wie bei anderen Parametern gibt es 
auch hier Parameter auf einer globalen Ebene (in den Listings mit einem 
<emphasis>G</emphasis> markiert) und solche auf einer Serviceebene
(<emphasis>S</emphasis>).
</para>

<variablelist>
	<varlistentry><term>Globale Parameter</term>
		<listitem><para> Diese <emphasis>dürfen nicht</emphasis> in die
		individuellen Freigabedefinitionen eingehen. Wenn sie dort irrtümlich 
		eingehen, kann das Utility <command>testparm</command> das
		feststellen und es Ihnen mitteilen (sofern Sie es starten).
		</para></listitem>
	</varlistentry>

	<varlistentry><term>Serviceebenen-Parameter</term>
		<listitem><para> Diese dürfen im Abschnitt 
		<smbconfsection>[global]</smbconfsection> von &smb.conf;
		angegeben werden.
		In diesem Fall definieren sie das Standardverhalten von allen
		individuellen Freigaben oder von Freigaben auf Serviceebene
		(vorausgesetzt, es gibt keine andere Einstellung für den 
		gleichen Parameter, der die globale Voreinstellung überschreibt).
		</para></listitem>
	</varlistentry>
</variablelist>
</sect2>

</sect1>

<sect1>
<title>Einfache Druckkonfiguration</title>

<para>
<link linkend="simpleprc">Das folgende Beispiel</link> zeigt eine einfache
Druckkonfiguration.
Wenn Sie diese mit Ihrer eigenen vergleichen, finden Sie eventuell zusätzliche 
Parameter, die vom Verkäufer Ihres Betriebssystems vorkonfiguriert wurden. 
Darunter befindet sich eine Beschreibung und Erläuterung dieser Parameter. 
In diesem Beispiel werden nur wenige Parameter verwendet.
In vielen Umgebungen reichen sie jedoch aus, um damit eine gültige Datei
&smb.conf; zur Verfügung zu stellen, mit der alle Clients drucken können.
</para>

<para>
<smbconfexample id="simpleprc">
<title>Einfache Konfiguration mit BSD-Drucken</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>printing</name><value>bsd</value></smbconfoption>
<smbconfoption><name>load printers</name><value>yes</value></smbconfoption>

<smbconfsection>[printers]</smbconfsection>
<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption>
<smbconfoption><name>printable</name><value>yes</value></smbconfoption>
<smbconfoption><name>public</name><value>yes</value></smbconfoption>
<smbconfoption><name>writable</name><value>no</value></smbconfoption>
</smbconfexample></para>

<para>
Dies ist lediglich eine Beispielkonfiguration. Samba weist allen 
Konfigurationsparametern Standardwerte zu. Diese Werte sind empfindlich
und wurden mit mit Bedacht gewählt. Wenn ein Parameter in der Datei &smb.conf;
angegeben ist, dann überschreibt er den Standardwert. Das Utility namens
<command>testparm</command> kann alle Einstellungen ausgeben, wenn es unter
root ausgeführt wird - Standardwerte ebenso wie Einträge in der Datei &smb.conf;. 
Für alle fehlerhaft konfigurierten Einstellungen gibt <command>testparm</command> 
eine Warnung aus. Die vollständige Ausgabe erreicht leicht 340 Zeilen und mehr,
d.h., Sie werden sie vermutlich mit einem Programm zum Durchblättern anschauen
wollen.
</para>

<para>
Die Syntax der Konfigurationsdatei ist leicht zu verstehen. Sie sollten 
wissen, dass Samba es mit seiner Syntax nicht sehr genau nimmt. 
Wie schon an anderer Stelle in diesem Dokument erklärt wurde, toleriert
Samba einige Schreibfehler (z.B. 
<smbconfoption><name>browseable</name></smbconfoption> an Stelle von 
<smbconfoption><name>browseable</name></smbconfoption>), wobei die 
Schreibweise (groß/klein) irrelevant ist. Es ist zulässig, für boolesche 
Einstellungen <parameter>Yes/No</parameter> oder 
<parameter>True/False</parameter> zu verwenden. Listen von Namen dürfen
mit Kommas, Leerzeichen oder Tabulatoren getrennt werden.
</para>

<sect2>
<title>Überprüfen der Konfiguration mit <command>testparm</command></title>

<para>
Um alle (oder wenigstens die meisten) druckerrelevanten Einstellungen in 
Samba zu sehen, inklusive derer, die implizit verwendet werden, können Sie
den unten angegebenen Befehl ausprobieren. Dieser sucht nach allen Vorkommen
von <constant>lp, print, spool, driver, ports</constant>
und <constant>[</constant> in der Ausgabe von testparms, was eine bequeme
Übersicht über die aktuelle Druckerkonfiguration von <command>smbd</command>
ergibt. Dieser Befehl zeigt keine individuell erstellten Druckerfreigaben oder
die Spooling-Pfade an, die sie eventuell benutzen. Folgendes ist die Ausgabe meiner 
Samba-Einstellung, mit den Einstellungen, die 
<link linkend="simpleprc"> im vorherigen Beispiel </link> gezeigt wurden:
</para>

<para><screen>
&rootprompt;<userinput>testparm -s -v | egrep "(lp|print|spool|driver|ports|\[)"</userinput>
 Load smb config files from /etc/samba/smb.conf
 Processing section "[homes]"
 Processing section "[printers]"
 
 [global]
        smb ports = 445 139
        lpq cache time = 10
        total print jobs = 0
        load printers = Yes
        printcap name = /etc/printcap
        disable spoolss = No
        enumports command =
        addprinter command = 
        deleteprinter command = 
        show add printer wizard = Yes
        os2 driver map =
        printer admin =
        min print space = 0
        max print jobs = 1000
        printable = No
        printing = bsd
        print command = lpr -r -P'%p' %s
        lpq command = lpq -P'%p'
        lprm command = lprm -P'%p' %j
        lppause command =
        lpresume command =
        printer name =
        use client driver = No

 [homes]

 [printers]
        path = /var/spool/samba
        printable = Yes
</screen>
</para>

<para>
Sie können ganz leicht überprüfen, welche Einstellungen dank Sambas 
Standardverhalten implizit hinzugefügt werden. <emphasis>Nicht vergessen: 
Das könnte für Ihren späteren Umgang mit Samba von Bedeutung sein.</emphasis>
</para>

<note><para>testparm in Samba-3 verhält sich anders als testparm in Samba 2.2.x: 
Ohne den Schalter <quote>-v</quote> zeigt es Ihnen nur die Einstellungen, in
die geschrieben wird! Um die vollständige benutzte Konfiguration zu sehen, 
verwenden Sie bei testparm den Schalter <quote>-v</quote>.</para></note>

</sect2>
<sect2>
<title>Schnelle Validierung der Konfiguration</title>

<para>
Sollten Sie in irgendeinem Stadium Reparaturen vornehmen müssen, kommen Sie
bitte immer erst an diesen Punkt zurück, und überprüfen Sie, ob 
<command>testparm</command> die Parameter anzeigt, die Sie erwarten. 
Aus eigener Erfahrung erhalten Sie hier den Hinweis, es einmal mit dem
Auskommentieren des Parameters 
<smbconfoption><name>load printers</name></smbconfoption> zu versuchen. 
Falls Ihr System 2.2.x sich so verhält wie meines, werden Sie Folgendes sehen:
</para>

<para><screen>
&rootprompt;grep "load printers" /etc/samba/smb.conf
        #  load printers = Yes
        # Diese Einstellung ist auskommentiert!!
 
&rootprompt;testparm -v /etc/samba/smb.conf | egrep "(load printers)"
        load printers = Yes
</screen></para>

<para>
Ich nahm an, dass durch das Auskommentieren dieser Einstellung Samba meine
Drucker nicht mehr anzeigen würde, was es aber weiterhin tat. 
Ich habe eine Weile gebraucht, um den Grund dafür herauszufinden. Aber nun lasse
ich mich nicht mehr foppen... jedenfalls nicht hiervon.
</para>

<para><screen>
&rootprompt;<userinput>grep -A1 "load printers" /etc/samba/smb.conf</userinput>
        load printers = No
        # Obige Einstellung ist, was ich will!
        #  load printers = Yes
        # Diese Einstellung ist auskommentiert!

&rootprompt;<userinput>testparm -s -v smb.conf.simpleprinting | egrep "(load printers)"</userinput>
        load printers = No

</screen></para>

<para>
Nur dann, wenn der Parameter explizit auf
<smbconfoption><name>load printers</name><value>No</value></smbconfoption>
gesetzt ist, wird Samba das tun, was ich möchte. Daher empfehle ich 
wärmstens:
</para>

<itemizedlist>
<listitem><para>Verlassen Sie sich nie auf auskommentierte 
Parameter!</para></listitem>

<listitem><para>Setzen Sie Parameter immer explizit so, wie Sie wollen,
dass sie sich verhalten sollen!</para></listitem>

<listitem><para>Verwenden Sie <command>testparm</command>, um versteckte
Einstellungen aufzudecken, die nicht mit Ihren Absichten 
übereinstimmen!</para></listitem>

</itemizedlist>

<para>
Folgendes ist die minimal kleinste Konfigurationsdatei:
<screen>
&rootprompt;<userinput>cat /etc/samba/smb.conf-minimal</userinput>
        [printers]
</screen></para>

<para>
Dieses Beispiel soll Ihnen zeigen, dass Sie testparm benutzen können, um alle
Konfigurationsdateien von Samba zu testen. Tatsächlich möchten wir Sie dazu 
anhalten, Ihr laufendes System <emphasis>nicht</emphasis> zu verändern 
(es sei denn, Sie wissen genau, was Sie tun). Verlassen Sie sich nicht darauf,
dass die Änderungen erst dann wirksam werden, nachdem Sie smbd neu starten! 
Das ist nicht der Fall. Samba liest sie alle 60 Sekunden erneut ein, und zwar 
auf jeder neuen Client-Verbindung. Möglicherweise werden Sie mit Änderungen
auf Ihren Clients in Produktion konfrontiert, die Sie gar nicht vornehmen 
wollten.
Sie werden nun einige weitere interessante Dinge bemerken: 
<command>testparm</command> hilft Ihnen dabei festzustellen, was die 
Samba-Druckerkonfiguration wäre, wenn Sie diese minimale Konfiguration
benutzen würden. Folgendes können Sie dabei erwarten:
</para>

<para><screen>
&rootprompt;<userinput>testparm -v smb.conf-minimal | egrep "(print|lpq|spool|driver|ports|[)"</userinput>
 Processing section "[printers]"
 WARNING: [printers] service MUST be printable!
 No path in service printers - using /tmp

        lpq cache time = 10
        total print jobs = 0
        load printers = Yes
        printcap name = /etc/printcap
        disable spoolss = No
        enumports command =
        addprinter command =
        deleteprinter command =
        show add printer wizard = Yes
        os2 driver map =
        printer admin =
        min print space = 0
        max print jobs = 1000
        printable = No
        printing = bsd
        print command = lpr -r -P%p %s
        lpq command = lpq -P%p
        printer name =
        use client driver = No

 [printers]
        printable = Yes

</screen></para>

<para>
testparm hat zwei Warnungen ausgegeben:
</para>

<itemizedlist>
	<listitem><para>Wir haben nicht angegeben, dass der Abschnitt 
<smbconfsection>[printers]</smbconfsection> druckbar ist.</para></listitem>
	<listitem><para>Wir haben Samba nicht gesagt, welches Spooling-Verzeichnis 
verwendet werden soll.</para></listitem>
</itemizedlist>

<para>
Beides ist allerdings nicht so schlimm, und Samba greift daher auf funktionierende
Standardwerte zurück. Bitte verlassen Sie sich jedoch nicht darauf, und 
verwenden Sie dieses Beispiel nicht selbst. Es ist hier nur deswegen erwähnt,
um Ihnen zu sagen, dass Sie Ihre Einstellungen vorsichtig entwerfen und 
vornehmen sollen, damit genau das passiert, was Sie haben möchten.
Auf Ihrem System mag das Resultat bei einigen der angegebenen Parameter leicht
abweichen, da Samba möglicherweise mit anderen Optionen kompiliert wurde. 
<emphasis>Warnung: </emphasis> Setzen Sie kein Kommentarzeichen
<emphasis>ans Ende</emphasis> einer gültigen Zeile. Das bewirkt, dass der 
Parameter ignoriert wird (so, als ob Sie das Kommentarzeichen an den Zeilenanfang
gesetzt hätten). Zu Beginn hielt ich das für einen Fehler in meinen 
Samba-Versionen. Aber die Manpage sagt es deutlich:
<quote>Interner Leerraum in einem Parameterwert wird wörtlich erhalten.</quote>
Das bedeutet, dass z.B. eine Zeile, die aus 
</para>

<para><smbconfblock>
<smbconfcomment>Dies definiert LPRng als das Drucksystem</smbconfcomment>
<smbconfoption><name>printing</name><value>lprng</value></smbconfoption>
</smbconfblock></para>

<para>
besteht, den gesamten String nach dem Zeichen <quote><constant>=</constant></quote> 
als den gewünschten Wert betrachtet, den Sie definieren möchten. Dies ist
jedoch ein ungültiger Wert, der ignoriert und durch einen Standardwert ersetzt 
wird.
</para>
</sect2>
</sect1>

<sect1>
<title>Erweiterte Druckerkonfiguration</title>

<para>
<link linkend="extbsdpr">Die nächste Konfiguration</link> zeigt ein etwas
umfangreicheres Beispiel einer Konfiguration von druckrelevanten 
Einstellungen in einer BSD-artigen Druckumgebung. Anschließend werden die verschiedenen Parameter beschrieben und erklärt. Wir haben hier deswegen BSD-artiges 
Drucken ausgewählt, weil es immer noch das am meisten verwendete System 
auf schon vorhandenen UNIX/Linux-Installationen ist. Neue Installationen 
verwenden überwiegend CUPS, das in einem eigenen Kapitel beschrieben wird. 
Das Beispiel führt die Namen vieler Parameter explizit auf, die nicht angegeben
werden müssen, da sie standardmäßig gesetzt werden. Sie könnten auch eine
wesentlich leichtere &smb.conf;-Datei verwenden. Alternativ dazu können Sie
<command>testparm</command> oder <command>SWAT</command> benutzen, um die
Datei &smb.conf; zu optimieren und alle Parameter zu entfernen, die
standardmäßig gesetzt werden.
</para>

<para><smbconfexample id="extbsdpr">
	<title>Erweiterte BSD-Druckerkonfiguration</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>printing</name><value>bsd</value></smbconfoption>
<smbconfoption><name>load printers</name><value>yes</value></smbconfoption>
<smbconfoption><name>show add printer wizard</name><value>yes</value></smbconfoption>
<smbconfoption><name>printcap name</name><value>/etc/printcap</value></smbconfoption>
<smbconfoption><name>printer admin</name><value>@ntadmin, root</value></smbconfoption>
<smbconfoption><name>total print jobs</name><value>100</value></smbconfoption>
<smbconfoption><name>lpq cache time</name><value>20</value></smbconfoption>
<smbconfoption><name>use client driver</name><value>no</value></smbconfoption>

<smbconfsection>[printers]</smbconfsection>
<smbconfoption><name>comment</name><value>Alle Drucker</value></smbconfoption>
<smbconfoption><name>printable</name><value>yes</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption>
<smbconfoption><name>browseable</name><value>no</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>yes</value></smbconfoption>
<smbconfoption><name>public</name><value>yes</value></smbconfoption>
<smbconfoption><name>read only</name><value>yes</value></smbconfoption>
<smbconfoption><name>writable</name><value>no       </value></smbconfoption>

<smbconfsection>[my_printer_name]</smbconfsection>
<smbconfoption><name>comment</name><value>Drucker mit beschraenktem Zugriff</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/spool/samba_my_printer</value></smbconfoption>
<smbconfoption><name>printer admin</name><value>kurt</value></smbconfoption>
<smbconfoption><name>browseable</name><value>yes</value></smbconfoption>
<smbconfoption><name>printable</name><value>yes</value></smbconfoption>
<smbconfoption><name>writable</name><value>no</value></smbconfoption>
<smbconfoption><name>hosts allow</name><value>0.0.0.0</value></smbconfoption>
<smbconfoption><name>hosts deny</name><value>turbo_xp, 10.160.50.23, 10.160.51.60</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>no</value></smbconfoption>
</smbconfexample></para>

<para>
Dies ist eine Beispielkonfiguration. Möglicherweise finden Sie nicht alle
Einstellungen in der Konfigurationsdatei, die vom Betriebssystemhersteller
mitgeliefert wurde. Samba verwendet für Konfigurationsparameter, die nicht 
explizit gesetzt sind, einen sinnvollen Standardwert.
Sie können sich alle Einstellungen anschauen, indem Sie als 
<constant>root</constant> das Utility <command>testparm</command> benutzen. 
Mit Hilfe von <command>testparm</command> erhalten Sie Warnungen bei 
fehlerhaft konfigurierten Einstellungen.
</para>

<sect2>
<title>Detaillierte Erörterung der Einstellungen</title>

<para>
Die folgende Erörterung beschreibt die Einstellungen des obigen Beispiels.
</para>

<sect3>
<title>Der Abschnitt [global]</title>

<para>
Der Abschnitt <smbconfsection>[global]</smbconfsection> ist einer von vier 
besonderen Abschnitten (zusammen mit <smbconfsection>[homes]</smbconfsection>,
<smbconfsection>[printers]</smbconfsection>
und <smbconfsection>[print$]</smbconfsection>...). Unter
<smbconfsection>[global]</smbconfsection> sind alle Parameter enthalten, die für
den Server als Ganzes gelten. Hier stehen Parameter, die nur global eine Bedeutung
haben. Es dürfen auch Parameter auf Serviceebene enthalten sein, die dann 
Standardeinstellungen für alle anderen Abschnitte und Freigaben definieren. 
Auf diese Weise können Sie die Konfiguration vereinfachen und vermeiden, den
gleichen Wert mehrfach zu setzen. (Innerhalb jedes einzelnen Abschnitts bzw. 
jeder Freigabe dürfen Sie diese global gesetzten Freigabeeinstellungen allerdings
überschreiben und andere Werte dafür angeben).
</para>

<variablelist>
	<varlistentry><term><smbconfoption><name>printing</name><value>bsd </value></smbconfoption></term>
		<listitem><para>Bewirkt, dass Samba die Standarddruckbefehle verwendet,
		die im BSD-Drucksystem (auch als RFC 1179 oder LPR/LPD bekannt)
		vorgesehen sind. Im Allgemeinen informiert der Parameter 
		<parameter>printing</parameter> Samba über das Drucksubsystem, mit
		dem es rechnen soll. Samba unterstützt CUPS, LPD, LPRNG,
		SYSV, HPUX, AIX, QNX und PLP. Jedes dieser Systeme hat seinen eigenen
		<smbconfoption><name>Druckbefehl</name></smbconfoption> (sowie andere 
		Befehle zur Steuerung der Druckerschlange).</para>

		<caution><para>Der Parameter 
		<smbconfoption><name>printing</name></smbconfoption> 
		ist normalerweise ein Parameter der Service-Ebene. Da er hier im
		Abschnitt <smbconfsection>[global]</smbconfsection> enthalten ist, 
		wird er für alle Druckerfreigaben wirksam, für die nichts anderes
		definiert ist. Samba-3 unterstützt das Drucksystem SOFTQ nicht mehr.
		</para></caution>
	</listitem></varlistentry>

	<varlistentry><term><smbconfoption><name>load printers</name><value>yes </value></smbconfoption></term>
		<listitem><para>Weist Samba an, automatisch alle verfügbaren Druckerfreigaben
		zu erstellen. Verfügbare Druckerfreigaben werden beim Scannen der Datei 
		printcap entdeckt. Alle erstellten Druckerfreigaben werden auch zum Browsen
		geladen. Falls Sie diesen Parameter verwenden, müssen Sie keine separaten
		Freigaben für jeden Drucker angeben. Jede automatisch erstellte 
		Druckerfreigabe erstellt einen Klon von den Konfigurationsoptionen im Abschnitt 
		<smbconfsection>[printers]</smbconfsection>. (Die Einstellung 
		<parameter>load printers = no</parameter> erlaubt Ihnen, jeden gemeinsam
		genutzten UNIX-Drucker separat anzugeben, wobei Sie einige auslassen
		können, bei denen Sie nicht möchten, dass sie öffentlich sichtbar und 
		verfügbar sind).</para>
	</listitem></varlistentry>

	<varlistentry><term><smbconfoption><name>show add printer wizard</name><value>yes </value></smbconfoption></term>
		<listitem><para>Diese Einstellung ist normalerweise standardmäßig aktiviert
		(sogar dann, wenn der Parameter nicht in &smb.conf; angegeben ist).
		Sie bewirkt, dass das Icon 
		<guiicon>Assistent für die Druckerinstallation</guiicon> im
		Verzeichnis <guiicon>Drucker</guiicon> der Freigabeliste des Samba-Hosts
		erscheint (wie es in <guiicon>Netzwerkumgebung</guiicon> oder vom Befehl
		<command>net view</command> gezeigt wird). Um diese Einstellung zu deaktivieren, müssen
		Sie sie explizit auf <constant>no</constant> setzen (nur auskommentieren
		reicht nicht). 
		Mit dem <parameter>Assistenten für die Druckerinstallation</parameter>
		können Sie
		Druckertreiber auf die Freigabe <smbconfsection>[print$]</smbconfsection> 
		hochladen und sie mit einem Drucker verbinden (falls die entsprechende
		Schlange vorher schon existiert) oder den Treiber eines Drucker gegen 
		einen anderen vorher hochgeladenen Treiber austauschen.</para>
	</listitem></varlistentry>

	<varlistentry><term><smbconfoption><name>total print jobs</name><value>100 </value></smbconfoption></term>
		<listitem><para>Setzt die obere Grenze der gleichzeitig auf dem
		Samba-Server aktiven Druckaufträge auf 100. Sollte ein Client einen
		Auftrag mit einer höheren Nummer absetzen, erhält er von Samba eine 
		Fehlermeldung der Art <quote>no more space available on server</quote>. 
		Der Wert Null (die Voreinstellung) bedeutet, dass es  
		<emphasis>keine</emphasis> Beschränkung gibt.
	</para></listitem></varlistentry>

	<varlistentry><term><smbconfoption><name>printcap name</name><value>/etc/printcap </value></smbconfoption></term>
		<listitem><para>Sagt Samba, wo es nach einer Liste verfügbarer Druckernamen
		suchen soll. Wenn CUPS verwendet wird, sollten Sie sicherstellen, dass eine
		printcap-Datei geschrieben wird, was mit der Direktive 
		<constant>Printcap</constant> in der Datei <filename>cupsd.conf</filename>
		gesteuert wird.
	</para></listitem></varlistentry>

	<varlistentry><term><smbconfoption><name>printer admin</name><value>@ntadmin </value></smbconfoption></term>
		<listitem><para>Mitglieder der Gruppe ntadmin sollten in der Lage sein,
		Treiber hizuzufügen und Druckereigenschaften zu setzen 
		(<constant>ntadmin</constant> ist lediglich ein Beispielname, es muss 
		der Name einer gültigen UNIX-Gruppe sein); root ist implizit immer ein
		<smbconfoption><name>printer admin</name></smbconfoption>. 
		Das Zeichen @ steht vor Gruppennamen in <filename>/etc/group</filename>. 
		Ein printer admin kann mit den MS-RPC-Schnittstellen für die 
		Fernwartung (siehe unten) alles Mögliche mit Druckern anstellen. 
		In größeren Installationen gibt es normalerweise je einen Parameter 
		<smbconfoption><name>printer admin</name></smbconfoption> 
		pro Freigabe. Damit können alle Druckerfreigaben von verschiedenen 
		Gruppen verwaltet werden.
	</para></listitem></varlistentry>

	<varlistentry><term><smbconfoption><name>lpq cache time</name><value>20 </value></smbconfoption></term>
		<listitem><para>Gibt die Cache-Zeit für die Ergebnisse des Befehls
		lpq an. Sie verhindert, dass der lpq-Befehl zu oft aufgerufen wird, und
		reduziert so die Last auf einem stark ausgelastetem Druckserver.
	</para></listitem></varlistentry>

	<varlistentry><term><smbconfoption><name>use client driver</name><value>no </value></smbconfoption></term>
		<listitem><para>Falls er auf <constant>yes</constant> gesetzt ist, wirkt 
		sich dieser Parameter nur auf Windows NT/200x/XP-Clients aus (und 
		nicht auf Win 95/98/ME). Sein Standardwert ist <constant>No</constant>
		(oder <constant>False</constant>). Er darf bei Druckerfreigaben, 
		für die auf dem Samba-Server gültige Treiber installiert sind,
		<emphasis>nicht</emphasis> aktiviert werden (mit der Einstellung 
		<constant>yes</constant> oder <constant>true</constant>). Eine
		detailliertere Erklärung finden Sie in der Manpage zu &smb.conf;.
	</para></listitem></varlistentry>
</variablelist>

</sect3>

<sect3 id="ptrsect">
<title>Der Abschnitt [printers]</title>

<para>
Dies ist der zweite besondere Abschnitt. Falls ein Abschnitt mit diesem Namen in
&smb.conf; vorkommt, können die Benutzer sich mit jedem Drucker verbinden, der
in der printcap-Datei des Samba-Hosts angegeben ist, da Samba dann beim Hochfahren 
eine Druckerfreigabe für jeden Druckernamen erstellt, den es in der Datei printcap 
findet. Das könnte man als allgemeine bequeme Abkürzung dafür sehen, alle Drucker
mit minimaler Konfiguration freizugeben. Dieser Abschnitt ist auch ein Container 
für Einstellungen, die für alle Drucker gelten sollen. (Weitere Details finden Sie
auf der Manpage zu &smb.conf;.) Die Einstellungen in diesem Container müssen 
Parameter auf der Ebene der Freigabe sein.
</para>

<variablelist>
	<varlistentry><term><smbconfoption><name>comment</name><value>Alle Drucker </value></smbconfoption></term>
		<listitem><para>
		Der <smbconfoption><name>Kommentar</name></smbconfoption> wird neben der 
		Freigabe angezeigt, wenn ein Client beim Server anfragt, und zwar entweder mit 
		<guiicon>Netzwerkumgebung</guiicon> oder mit dem Befehl 
		<command>net view</command>, der verfügbare Freigaben auflistet.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>printable</name><value>yes </value></smbconfoption></term>
		<listitem><para>
		Der Dienst <smbconfsection>[printers]</smbconfsection> 
		<emphasis>muss</emphasis> muss als printable, d.h. druckbar deklariert
		werden. Anderenfalls weigert sich smbd, beim Hochfahren etwas zu laden.
		Dieser Parameter ermöglicht es verbundenen Clients, Sppol-Dateien zu öffnen,
		darin zu schreiben und sie in das Verzeichnis zu übertragen, das mit dem
		Parameter <smbconfoption><name>path</name></smbconfoption> für diesen 
		Dienst angegeben wird. Samba verwendet ihn, um Druckerfreigaben von 
		Dateifreigaben zu unterscheiden. 
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>path</name><value>/var/spool/samba </value></smbconfoption></term>
		<listitem><para>
		Das muss der Name eines Verzeichnisses sein, das Samba beim Spoolen ankommender
		Druckdateien verwendet. <emphasis>Es darf nicht identisch sein mit mit dem 
		Spooling-Verzeichnis, das in der Konfiguration Ihres UNIX-Drucksubsystems
		angegeben ist!</emphasis> Der Pfad beschreibt normalerweise ein Verzeichnis, 
		in dem alle Schreibrechte haben und dessen <quote>sticky</quote>-Bit 
		gesetzt ist.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>browseable</name><value>no </value></smbconfoption></term>
		<listitem><para>
		Ist immer auf <constant>no</constant> gesetzt, falls 
		<smbconfoption><name>printable</name><value>yes</value></smbconfoption>.
		Dadurch wird die Freigabe <smbconfsection>[printer]</smbconfsection> 
		selbst in der Liste der verfügbaren Freigaben bei dem Befehl
		<command>net view</command> oder in der Browserliste des Explorers unsichtbar.
		(Natürlich können Sie die einzelnen Drucker noch sehen).
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>guest ok</name><value>yes </value></smbconfoption></term>
		<listitem><para>
		Falls dieser Parameter auf <constant>yes</constant> gesetzt ist, wird 
		kein Passwort für eine Verbindung zu diesem Druckdienst benötigt. Der 
		Zugang erfolgt mit den Rechten des 
		<smbconfoption><name>Gast-Kontos</name></smbconfoption>. Auf vielen 
		Systemen wird das Gast-Konto auf einen Benutzer namens 
		<quote>nobody</quote> abgebildet. Für diesen Benutzer findet UNIX
		normalerweise in der Datei passwd ein leeres Passwort vor, aber kein 
		gültiges UNIX-Login. (Auf manchen Systemen hat das Gast-Konto 
		eventuell keine Druckrechte. Testen Sie das, indem Sie sich mit <command>su - guest</command> als 
		Gastbenutzer anmelden, und geben 
		Sie wie folgt einen Druckbefehl im System ein:
		</para>
	
		<para>
		<userinput>lpr -P printername /etc/motd</userinput>
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>public</name><value>yes </value></smbconfoption></term>
		<listitem><para>
		Ist ein Synonym für 
		<smbconfoption><name>guest ok</name><value>yes</value></smbconfoption>.
		Da wir <smbconfoption><name>guest ok</name><value>yes</value></smbconfoption> haben, 
		muss das hier nicht wirklich stehen. (Das führt zu der interessanten Frage: <quote>Was 
		passiert, falls wir irrtümlicherweise zwei widersprüchliche Einstellungen für die
		gleiche Freigabe haben?</quote> Die Antwort lautet, dass die letzte von Samba gefundene
		Einstellung gewinnt. Testparm beschwert sich nicht über verschiedene Einstellungen
		beim gleichen Parameter für eine Freigabe. Das können Sie testen, indem Sie mehrere
		Zeilen für den Parameter <parameter>guest account</parameter> mit verschiedenen
		Benutzernamen eintragen und dann testparm ausführen, um zu sehen, welchen Samba 
		tatsächlich benutzt.)
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>read only</name><value>yes </value></smbconfoption></term>
		<listitem><para>
		Verhindert normalerweise, d.h. bei anderen Arten von Freigaben, dass
		Benutzer Dateien im Dienstverzeichnis erstellen oder modifizieren. Bei dem Dienst 
		<quote>printable</quote> ist es allerdings <emphasis>immer</emphasis> erlaubt, ins 
		Verzeichnis zu schreiben (falls die Rechte des Benutzers eine Verbindung erlauben), 
		jedoch nur mit Hilfe von Drucker-Spooling-Operationen. Normale Schreiboperationen 
		sind nicht erlaubt.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>writable</name><value>no </value></smbconfoption></term>
		<listitem><para>
		Ist ein Synonym für 
		<smbconfoption><name>read only</name><value>yes</value></smbconfoption>.
		</para></listitem>
	</varlistentry>
</variablelist>
</sect3>

<sect3>
<title>Beliebige Abschnitte [mein_drucker_name]</title>

<para>
Wenn ein Abschnitt in der Datei &smb.conf; vorkommt und den Parameter
<smbconfoption><name>printable</name><value>yes</value></smbconfoption> enthält,
dann konfiguriert ihn Samba als Druckerfreigabe. Windows 9x/Me-Clients haben
eventuell Probleme damit, sich mit Druckertreibern zu verbinden oder sie zu laden,
wenn der Name der Freigabe mehr als acht Zeichen lang ist. Geben Sie einer 
Druckerfreigabe keinen Namen, der mit einer vorhandenen Benutzer- oder 
Dateifreigabe kollidieren könnte. Bei Verbindungsanfragen von Clients versucht
Samba immer zuerst Dateifreigaben mit diesem Namen zu finden. Wenn Samba eine
findet, stellt es damit eine Verbindung her und nicht mit dem gleichnamigen 
Drucker!
</para>

<variablelist>
	<varlistentry><term><smbconfoption><name>comment</name><value>Drucker mit beschraenktem Zugriff </value></smbconfoption></term>
		<listitem><para>
		Der Kommentar sagt alles aus.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>path</name><value>/var/spool/samba_my_printer </value></smbconfoption></term>
		<listitem><para>
		Setzt den Spooling-Bereich für diesen Drucker auf ein Verzeichnis, das sich vom 
		Standardwert unterscheidet. Man muss ihn nicht anders setzen, aber die Möglichkeit ist vorhanden.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>printer admin</name><value>kurt </value></smbconfoption></term>
		<listitem><para>
		Die Definition von printer admin unterscheidet sich für diese explizit definierte
		Druckerfreigabe von der allgemeinen Freigabe <smbconfsection>[printers]</smbconfsection>. 
		Dies ist nicht notwendig, wir machen das nur, um zu zeigen, dass es möglich ist.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>browseable</name><value>yes </value></smbconfoption></term>
		<listitem><para>
		Damit kann man den Drucker aufstöbern, d.h. die Clients können ihn bequem finden,
		wenn sie in der <guiicon>Netzwerkumgebung</guiicon> stöbern.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>printable</name><value>yes </value></smbconfoption></term>
		<listitem><para>
		Siehe <link linkend="ptrsect">Der(((den?))) Abschnitt [printers]</link>.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>writable</name><value>no </value></smbconfoption></term>
		<listitem><para>
		Siehe <link linkend="ptrsect">Der(((den?))) Abschnitt [printers]</link>.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>hosts allow</name><value>10.160.50.,10.160.51. </value></smbconfoption></term>
		<listitem><para>
		Hier führen wir ein gewisses Maß an Zugangskontrolle aus, indem wir die Parameter
		<smbconfoption><name>hosts allow</name></smbconfoption> und 
		<smbconfoption><name>hosts deny</name></smbconfoption> verwenden. 
		Das ist keinesfalls eine sichere Maßnahme. Es ist keine sichere Methode, Ihre
		Drucker abzusichern. Mit dieser Zeile werden alle Clients aus einem bestimmten 
		Subnetz in einer ersten Auswertung der Zugangskontrolle akzeptiert.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>hosts deny</name><value>turbo_xp,10.160.50.23,10.160.51.60 </value></smbconfoption></term>
		<listitem><para>
		Alle hier aufgeführten Hosts sind nicht erlaubt (auch dann nicht, wenn sie zu den
		erlaubten Subnetzen gehören). Wie Sie sehen, können Sie hier IP-Adressen ebenso wie
		NetBIOS-Hostnamen angeben.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>guest ok</name><value>no </value></smbconfoption></term>
		<listitem><para>
		Der Drucker ist für das Gast-Konto nicht verfügbar.
		</para></listitem>
	</varlistentry>
</variablelist>
</sect3>

<sect3>
<title>Druckbefehle</title>

<para>
In jedem Abschnitt, der einen Drucker definiert (oder im Abschnitt 
<smbconfsection>[printers]</smbconfsection>), darf ein Parameter namens 
<parameter>print command</parameter> definiert werden. Er setzt einen Befehl, mit dem die Dateien
bearbeitet werden, die für diesen Drucker in Sambas Drucker-Spooling-Verzeichnis platziert wurden. 
(Wie Sie sich vielleicht erinnern, wurde dieses Spooling-Verzeichnis mit dem Parameter
<smbconfoption><name>path</name></smbconfoption> eingestellt). Üblicherweise übergibt dieser
Befehl die Spool-Datei an das Drucksubsystem des Samba-Hosts, wobei der dem System entsprechende 
Druckbefehl verwendet wird. Aber es gibt keine Notwendigkeit dafür, dass das so sein muss. Bei der
Fehlersuche oder auch aus anderen Gründen möchten Sie eventuell etwas ganz anderes tun, als die Datei
zu drucken. Ein Beispiel könnte ein Befehl sein, der die Druckdatei einfach nur an einen temporären 
Ort kopiert, um sie später untersuchen zu können, wenn Sie Fehler beim Drucken suchen. Wenn Sie an
eigenen Druckbefehlen arbeiten (oder gar Shell-Skripten für Druckbefehle entwickeln), sollten Sie
darauf aufpassen, dass Sie die Dateien aus dem Spool-Verzeichnis von Samba auch wieder entfernen. 
Sonst leidet Ihre Festplatte vielleicht schon bald unter Problemen mit fehlendem freien Platz.
</para>
</sect3>

<sect3>
<title>Standard-Systemdruckbefehle unter UNIX</title>

<para>
Sie haben bereits gelernt, dass Samba in den meisten Fällen für viele Parameter seine eingebauten 
Einstellungen verwendet, wenn es in seiner Konfigurationsdatei keine expliziten Werte dafür findet. 
Das Gleiche gilt bei der Option <smbconfoption><name>print command</name></smbconfoption>. Der 
standardmäßige Druckbefehl variiert abhängig von der Einstellung des Parameters 
<smbconfoption><name>printing</name></smbconfoption>. In den unten aufgeführten Befehlen werden 
Sie einige Parameter der Form <emphasis>%X</emphasis> bemerken, wobei <emphasis>X</emphasis> 
<emphasis>p, s, J</emphasis> und so weiter sein kann. Diese Buchstaben stehen jeweils für den 
Druckernamen, die Spool-Datei und die Job-ID.
Sie werden weiter unten detaillierter erklärt. Die <link linkend="printOptions">nächste Tabelle</link> 
enthält eine Übersicht der wichtigsten Druckoptionen mit Ausnahme des Spezialfalls CUPS, der im Abschnitt
<link linkend="CUPS-printing">Unterstützung des CUPS-Drucksystems</link> diskutiert wird.
</para>

<table frame='all' id="printOptions">
	<title>Standardmäßige Druckereinstellungen</title>
	<tgroup cols='2' align='left' colsep='1' rowsep='1'>
		<colspec align="left"/>
		<colspec align="left"/>
	<thead>
		<row>
		<entry>Einstellung</entry>
		<entry>Standardmäßige Druckbefehle</entry>
		</row>
	</thead>
	<tbody>
		<row>
		<entry><smbconfoption><name>printing</name><value>bsd|aix|lprng|plp</value></smbconfoption></entry>
		<entry>Druckbefehl ist <command>lpr -r -P%p %s</command></entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>sysv|hpux</value></smbconfoption></entry>
		<entry>Druckbefehl ist <command>lp -c -P%p %s; rm %s</command></entry>
		</row>
		<row>
		<entry> <smbconfoption><name>printing</name><value>qnx</value></smbconfoption></entry>
		<entry>Druckbefehl ist <command>lp -r -P%p -s %s</command></entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>bsd|aix|lprng|plp</value></smbconfoption></entry>
		<entry>lpq-Befehl ist <command>lpq -P%p</command></entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>sysv|hpux</value></smbconfoption></entry>
		<entry>lpq-Befehl ist <command>lpstat -o%p</command></entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>qnx</value></smbconfoption></entry>
		<entry>lpq-Befehl ist <command>lpq -P%p</command></entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>bsd|aix|lprng|plp</value></smbconfoption></entry>
		<entry>lprm-Befehl ist <command>lprm -P%p %j</command></entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>sysv|hpux</value></smbconfoption></entry>
		<entry>lprm-Befehl ist <command>cancel %p-%j</command></entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>qnx</value></smbconfoption></entry>
		<entry>lprm-Befehl ist <command>cancel %p-%j</command></entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>bsd|aix|lprng|plp</value></smbconfoption></entry>
		<entry>lppause-Befehl ist <command>lp -i %p-%j -H hold</command></entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>sysv|hpux</value></smbconfoption></entry>
		<entry>lppause-Befehl   (...ist leer)</entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>qnx</value></smbconfoption></entry>
		<entry>lppause-Befehl   (...ist leer)</entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>bsd|aix|lprng|plp</value></smbconfoption></entry>
		<entry>lpresume-Befehl ist <command>lp -i %p-%j -H resume</command></entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>sysv|hpux</value></smbconfoption></entry>
		<entry>lpresume-Befehl   (...ist leer)</entry>
		</row>
		<row>
		<entry><smbconfoption><name>printing</name><value>qnx</value></smbconfoption></entry>
		<entry>lpresume-Befehl   (...ist leer)</entry>
		</row>
	</tbody>
	</tgroup>
</table>

<para>
Wir haben hier den Spezialfall CUPS ausgeklammert, weil er im folgenden Kapitel beschrieben 
wird. Bei <parameter>printing = CUPS</parameter> und falls Samba mit libcups kompiliert 
wurde, verwendet es die CUPS-API, um Druckaufträge einzureichen. (Es ist eine gute Idee, 
auch <smbconfoption><name>printcap</name><value>cups</value></smbconfoption>
zu setzen, falls Ihre <filename>cupsd.conf</filename> so eingestellt ist, dass ihre 
automatisch generierte printcap-Datei an einen ungewöhnlichen Ort geschrieben wird). Sonst 
schaltet Samba auf die Druckbefehle von System V um und verwendet beim Drucken die Option 
-oraw, d.h., es führt den Befehl <command>lp -c -d%p -oraw; rm %s</command> aus. 
Bei <parameter>printing = cups</parameter> und wenn Samba mit libcups kompiliert wurde, 
wird jeder manuell eingestellte Druckbefehl ignoriert!
</para>

</sect3>

<sect3>
<title>Eigene Druckbefehle</title>

<para>
Nachdem das Spoolen eines Druckauftrags an einen Dienst beendet ist, führt
Samba den Druckbefehl in 
<smbconfoption><name>print command</name></smbconfoption>
mit Hilfe eines <emphasis>system()</emphasis>-Aufrufs aus, um die Spool-Datei
zu verarbeiten. Normalerweise übergibt der angegebene Befehl die Spool-Datei
an das Drucksubsystem des Hosts. Aber das muss nicht zwingend der Fall sein.
Möglicherweise entfernt das Drucksubsystem die Spool-Datei nicht von sich aus.
Was immer Sie also angeben, Sie sollten sich vergewissern, dass die Spool-Datei
nach ihrer Bearbeitung gelöscht wird.
</para>

<para>
Bei den traditionellen Druckmethoden ist es kein Problem, eigene Druckbefehle
anzugeben. Wenn Sie jedoch keine eigenen Druckbefehle erstellen möchten, sollten Sie 
sich gut mit den standardmäßig eingebauten Befehlen auskennen, die Samba für
jedes Drucksubsystem verwendet (siehe Tabelle 17.1)(((automatischen Verweis setzen))). Bei allen in den 
vorherigen Absätzen aufgelisteten Befehlen sehen Sie Parameter der Form 
<emphasis>%X</emphasis>. Dies sind so genannte <emphasis>Makros</emphasis> 
bzw. Abkürzungen, die als Platzhalter für die Namen von echten Objekten 
verwendet werden. Zu dem Zeitpunkt, wenn ein Befehl mit einem solchen 
Platzhalter ausgeführt wird, fügt Samba den passenden Wert automatisch ein. 
Druckbefehle können mit allen Makro-Ersetzungen von Samba umgehen. Was das
Drucken angeht, so sind folgende von besonderer Bedeutung:
</para>

<itemizedlist>
	<listitem><para><parameter>%s, %f</parameter> &smbmdash; der Pfad zum Spool-Dateinamen</para></listitem>
	<listitem><para><parameter>%p</parameter> &smbmdash; der passende Druckername</para></listitem>
	<listitem><para><parameter>%J</parameter> &smbmdash; Der vom Client übermittelte Auftragsname</para></listitem>
	<listitem><para><parameter>%c</parameter> &smbmdash; die Anzahl der gedruckten Seiten des gespoolten Auftrags (falls bekannt)</para></listitem>
	<listitem><para><parameter>%z</parameter> &smbmdash; die Größe des gespoolten Druckauftrags (in Bytes)</para></listitem>
</itemizedlist>

<para>
Im Druckbefehl muss mindestens einmal der Parameter 
<parameter>%s</parameter> oder <parameter>%f</parameter> vorkommen. Der 
Parameter <parameter>%p</parameter> ist optional. Falls kein Druckername 
angegeben wird, wird <parameter>%p</parameter> heimlich aus dem Druckbefehl
entfernt. In dem Fall wird der Auftrag an den Standarddrucker geschickt.
</para>

<para>
Falls er im Abschnitt <smbconfsection>[global]</smbconfsection> angegeben ist,
wird der Druckbefehl für alle druckbaren Dienste verwendet, für die kein
eigener Druckbefehl angegeben ist. Sollte es weder einen Druckbefehl für einen
druckbaren Dienst noch einen globalen Druckbefehl geben, werden Spool-Dateien
zwar erzeugt, aber nicht bearbeitet! Vor allem werden Druckdateien dann nicht
gelöscht und verbrauchen Platz auf der Festplatte.
</para>

<para>
Auf manchen UNIX-Systemen kann möglicherweise nicht gedruckt werden, wenn das
Konto <quote>nobody</quote> verwendet wird. Falls das passiert, können Sie
ein alternatives Gast-Konto erstellen und ihm Druckrechte zuweisen. Dieses 
Gast-Konto richten Sie im Abschnitt <smbconfsection>[global]</smbconfsection>
mit dem Parameter <parameter>guest account</parameter> ein.
</para>

<para>
Sie können ziemlich komplexe Druckbefehle erstellen. Sie müssen sich klarmachen,
dass Druckbefehle lediglich an eine UNIX-Shell weitergegeben werden. Die Shell 
vermag die enthaltenen Umgebungsvariablen wie üblich zu erweitern. (Die Syntax 
zum Einbinden einer UNIX-Umgebungsvariable <parameter>$variable</parameter>
in einen Samba-Druckbefehl lautet <parameter>%$variable</parameter>.) Folgendes
Beispiel für einen funktionierenden Wert von 
<smbconfoption><name>print command</name></smbconfoption> trägt den Druckauftrag
in die Logdatei <filename>/tmp/print.log</filename> ein, druckt die Datei und 
löscht sie anschließend. In Shell-Skripten dient das Semikolon 
<quote>;</quote> üblicherweise als Trennzeichen zwischen Befehlen:
</para>

<para><smbconfblock>
<smbconfoption><name>print command</name><value>echo Drucken von %s &gt;&gt; \</value></smbconfoption>
<member><parameter>/tmp/print.log; lpr -P %p %s; rm %s</parameter></member>
</smbconfblock></para>

<para>
Je nachdem, wie Sie auf Ihrem System Dateien normalerweise drucken, müssen
Sie dieses Beispiel stark abwandeln, um zu Ihrem Befehl zu gelangen. Der
Vorgabewert des Parameters 
<smbconfoption><name>print command</name></smbconfoption> variiert je nach 
Einstellung des Parameters <smbconfoption><name>printing</name></smbconfoption>.
Ein weiteres Beispiel lautet:
</para>

<para><smbconfblock>
<smbconfoption><name>print command</name><value>/usr/local/samba/bin/myprintscript %p %s</value></smbconfoption>
</smbconfblock></para>
</sect3>
</sect2>
</sect1>

<sect1>
<title>Die Weiterentwicklung des Druckens seit Samba-2.2</title>

<para>
Vor Samba-2.2.x war die Unterstützung von Druckerservern bei Windows-Clients 
auf <emphasis>LanMan</emphasis>-Druckaufrufe beschränkt. Dies ist die gleiche
Protokollebene, wie sie auch Windows 9x/Me-PCs bei der Freigabe von Druckern
bieten. Ab dem Release 2.2.0 begann Samba damit, die nativen 
Druckmechanismen von Windows NT zu unterstützen. Diese sind mit Hilfe von
<emphasis>MS-RPC</emphasis> (RPC = <emphasis>Remote Procedure Calls</emphasis>)
implementiert. MS-RPCs verwenden beim Drucken immer 
<emphasis>SPOOLSS</emphasis> als benannten Kanal.
</para>

<para>
Durch die neue Unterstützung von SPOOLSS ergibt sich unter anderem folgende 
zusätzliche Funktionalität:
</para>

<itemizedlist>
	<listitem><para>
	Unterstützung beim Herunterladen von Druckertreiberdateien auf 
	Windows 95/98/NT/2000-Clients bei Bedarf 
	(<emphasis>Point'n'Print</emphasis>)
	</para></listitem>

	<listitem><para>
	Hochladen von Druckertreibern mit dem 
	<emphasis>Assistenten für die Druckerinstallation</emphasis> (APW) 
	von Windows NT oder den 
	<ulink url="http://imprints.sourceforge.net/">Imprints</ulink>-Werkzeugen
	</para></listitem>

	<listitem><para>
	Unterstützung der nativen MS-RPC-Druckaufrufe wie
	StartDocPrinter, EnumJobs(), usw. (siehe die 
	<ulink url="http://msdn.microsoft.com/">MSDN-Dokumentation</ulink> 
	für weitere Informationen zur Druck-API von Win32)
	</para></listitem>

	<listitem><para>
	Unterstützung von <emphasis>Access Control Lists</emphasis> (ACL) 
	auf Druckern in NT
	</para></listitem>

	<listitem><para>
	Verbesserte Unterstützung der Manipulation von Druckerschlangen 
	durch Verwendung von internen Datenbanken für Informationen zu
	gespoolten Aufträgen (implementiert durch verschiedene 
	<filename>*.tdb</filename>-Dateien)
	</para></listitem>
</itemizedlist>

<para>
Ein Vorteil einer Aufrüstung ist der, dass Samba-3 in der Lage ist, seine
Drucker über Active Directory (oder LDAP) zu veröffentlichen.
</para>

<para>
Es existiert ein fundamentaler Unterschied zwischen Druckerservern unter 
MS Windows NT und der Arbeitsweise von Samba. Windows NT erlaubt die
Installation lokaler Drucker, die nicht freigegeben sind. Dies ist ein
Überbleibsel dessen, dass jeder Windows NT-Rechner (Server oder Client) 
von einem Benutzer als Workstation benutzt werden kann. Samba veröffentlicht
alle Drucker, die verfügbar gemacht werden - entweder standardmäßig oder 
durch eine spezielle Deklaration mit druckerspezifischen Freigaben.
</para>

<para>
Windows NT/200x/XP Professional-Clients müssen die 
Standard-SMB-Druckerfreigabe nicht benutzen. Sie können direkt auf jedem
Drucker eines anderen Windows NT-Hosts drucken, indem Sie MS-RPC benutzen. 
Das setzt natürlich voraus, dass der Client die nötigen Rechte auf dem 
entfernten Host hat, der den Drucker zur Verfügung stellt. Die Standardrechte,
die Windows NT an einen Drucker zuweist, ergeben die Druckrechte der
wohlbekannten Gruppe <emphasis>Everyone</emphasis>. (Ältere Clients der 
Sorte Windows 9x/Me können nur auf freigegebenen Druckern drucken).
</para>

<sect2>
<title>Point'n'Print-Client-Treiber auf Samba-Servern</title>

<para>
Darüber, was das alles bedeutet, herrscht große Verwirrung. Oft wird die
Frage gestellt: <quote>Müssen Druckertreiber auf einem Samba-Host installiert
sein oder nicht, um von Windows-Clients aus drucken zu können?</quote> Die
Antwort darauf lautet: nein, das ist nicht notwendig.
</para>

<para>
Natürlich können Windows NT/2000-Clients auch ihren APW laufen lassen, um 
Treiber <emphasis>lokal</emphasis> zu installieren (die sich dann mit einer
Samba-basierten Druckerschlange verbinden können). Die gleiche Methode wird
auch von Windows 9x/Me-Clients verwendet. (Ein <emphasis>Fehler</emphasis>
in Samba 2.2.0 führt jedoch dazu, dass auf Windows NT/2000-Clients verlangt wird,
dass der Samba-Server über einen für den Drucker gültigen Treiber verfügt.
In Samba 2.2.1 wurde das korrigiert).
</para>

<para>
Eine neue Möglichkeit ist es jedoch, die Druckertreiber im Abschnitt 
<smbconfsection>[print$]</smbconfsection> in der Freigabe des Samba-Servers
zu installieren, und sehr bequem ist es ebenfalls. Dann wird der Treiber für
<emphasis>alle</emphasis> Clients (inklusive 95/98/ME) installiert, wenn sie
sich zum ersten Mal mit dieser Druckerfreigabe verbinden. Das
<emphasis>Hochladen</emphasis> oder <emphasis>Ablegen</emphasis> des Treibers
in dieser <smbconfsection>[print$]</smbconfsection>-Freigabe sowie die 
folgende Bindung dieses Treibers an eine vorhandene Samba-Druckerfreigabe 
kann mit verschiedenen Mitteln erreicht werden:
</para>

<itemizedlist>
	<listitem><para>
	Ausführen des <emphasis>APW</emphasis> auf einem NT/200x/XP 
	Professional-Client (das funktioniert nicht auf 95/98/ME-Clients)
	</para></listitem>

	<listitem><para>
	Verwenden der <emphasis>Imprints</emphasis>-Werkzeuge
	</para></listitem>

	<listitem><para>
	Verwenden der Kommandozeilenwerkzeuge <emphasis>smbclient</emphasis> 
	und <emphasis>rpcclient</emphasis>
	</para></listitem>

	<listitem><para>
	Verwenden von <emphasis>cupsaddsmb</emphasis> (funktioniert nur beim
	CUPS-Drucksystem, nicht bei LPR/LPD, LPRng usw.)
	</para></listitem>
</itemizedlist>

<para>
Diese hochgeladenen Treiber verwendet Samba in keiner Weise dazu, die 
gespoolten Dateien zu bearbeiten. Diese Treiber werden ausschließlich 
von den Clients benutzt, die sie mit dem von Samba unterstützten 
<quote>Point'n'Print</quote>-Mechanismus heruntergeladen und installiert 
haben. 
Die Clients verwenden diese Treiber dazu, Druckdateien in dem Format zu 
erzeugen, das der Drucker (oder das UNIX-Drucksystem) benötigt. Von Samba 
erhaltene Druckdateien werden an das UNIX-Drucksystem weitergeleitet, das
für die gesamte weitere Bearbeitung zuständig ist.
</para>
</sect2>

<sect2>
<title>Der veraltete Abschnitt [printer$]</title>

	<para>
	In Samba-Versionen vor 2.2 konnte eine Freigabe namens 
	<parameter>[printer$]</parameter> verwendet werden. Dieser Name wurde
	von dem gleichnamigen Dienst übernommen, der von Windows 9x/Me-Clients
	erzeugt wird, die sich einen Drucker teilen. Windows 9x/Me-Druckerserver
	verfügen immer über einen Dienst namens 
	<smbconfsection>[printer$]</smbconfsection>, der einen nur lesenden
	Zugang (ohne Passwort) zum Herunterladen von Druckertreibern bietet.
	Allerdings erlaubte Sambas erste Implementation einen Parameter 
	namens <parameter>printer driver location</parameter> pro Freigabe.
	Dieser gab den Ort der Treiberdateien für diesen Drucker an. Ein
	anderer Parameter namens <parameter>printer driver</parameter> 
	bot die Möglichkeit, einen Namen für den Druckertreiber anzugeben, 
	der an den Client übergeben wird.
	</para>

	<para>
	Diese Parameter, inklusive <parameter>printer driver file</parameter>,
	wurden nun entfernt und können in Samba-3-Installationen nicht mehr
	verwendet werden. Der Freigabename 
	<smbconfsection>[print$]</smbconfsection> wird nun für den Ort
	von herunterladbaren Druckertreibern benutzt. Er wird von dem Dienst
	<smbconfsection>[print$]</smbconfsection> übernommen, der von Windows 
	NT-PCs erstellt wird, wenn sie sich einen Drucker teilen. Windows 
	NT-Druckerserver verfügen immer über einen
	<smbconfsection>[print$]</smbconfsection>-Dienst, der Lese- und 
	Schreibzugriff bietet (im Kontext seiner ACLs), um das Herunter- und
	Hochladen von Druckertreibern zu unterstützen. Das heißt nicht,
	dass Windows 9x/Me-Clients ignoriert werden. Diese können die 
	Samba-Unterstützung der Freigabe 
	<smbconfsection>[print$]</smbconfsection> ganz normal benutzen.
	</para>
</sect2>

<sect2>
<title>Erstellen der Freigabe [print$]</title>

<para>
Um das Hoch- und Herunterladen von Druckertreiberdateien zu unterstützen, 
müssen Sie zunächst eine Dateifreigabe namens 
<smbconfsection>[print$]</smbconfsection> konfigurieren. Der öffentliche
Name dieser Freigabe wird fest in den MS Windows-Clients codiert. Er kann
nicht geändert werden, weil Windows-Clients so programmiert sind, dass sie
nach einem Dienst mit exakt diesem Namen suchen, wenn Sie Druckertreiberdateien
erhalten möchten.
</para>

<para>
Sie sollten die Serverdatei so modifizieren, dass Sie die globalen 
Parameter hinzufügen und die Dateifreigabe 
<smbconfsection>[print$]</smbconfsection> erstellen (natürlich sind einige
der Parameterwerte, z.B. <smbconfoption><name>path</name></smbconfoption> 
beliebig gewählt und sollten durch die für Ihre Site passenden Werte ersetzt
werden; siehe <link linkend="prtdollar">nächstes Beispiel</link>).
</para>

<para>
<smbconfexample id="prtdollar">
<title>Beispiel für [print\$]</title>
<smbconfsection>[global]</smbconfsection>
<smbconfcomment>Mitglieder der Gruppe ntadmin sollten Treiber hinzufügen und </smbconfcomment>
<smbconfcomment>Druckereigenschaften einstellen können. root ist implizit immer ein 'printer admin'.</smbconfcomment>
<smbconfoption><name>printer admin</name><value>@ntadmin</value></smbconfoption>
<member>...</member>
<smbconfsection>[printers]</smbconfsection>
<member>...</member>
<smbconfsection>[print$]</smbconfsection>
<smbconfoption><name>comment</name><value>Druckertreiber-Download-Bereich</value></smbconfoption>
<smbconfoption><name>path</name><value>/etc/samba/drivers</value></smbconfoption>
<smbconfoption><name>browseable</name><value>yes</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>yes</value></smbconfoption>
<smbconfoption><name>read only</name><value>yes</value></smbconfoption>
<smbconfoption><name>write list</name><value>@ntadmin, root</value></smbconfoption>
</smbconfexample>
</para>

<para>
Natürlich müssen Sie auch sicherstellen, dass das Verzeichnis mit dem
Parameterwert <smbconfoption><name>path</name></smbconfoption> im 
UNIX-Dateisystem existiert.
</para>

</sect2>

<sect2>
<title>Parameter im Abschnitt [print$]</title>

<para>
<smbconfsection>[print$]</smbconfsection> ist ein besonderer Abschnitt in 
&smb.conf;. Er enthält Einstellungen, die relevant sind für potenziell
herunterzuladende Druckertreiber und wird von Windows-Clients bei der 
lokalen Installation von Druckertreibern verwendet.
Folgende Parameter werden in diesem Freigabeabschnitt oft benötigt:
</para>

<variablelist>
	<varlistentry><term><smbconfoption><name>comment</name><value>Druckertreiber Download-Bereich</value></smbconfoption></term>
		<listitem><para>
		Der Kommentar erscheint neben dem Freigabenamen, wenn er in der 
		Freigabeliste aufgeführt wird (normalerweise werden 
		Windows-Clients ihn nicht sehen, aber er erscheint auch oben in der
		Ausgabe des Befehls <command>smbclient -L sambaserver</command>).
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>path</name><value>/etc/samba/printers </value></smbconfoption></term>
		<listitem><para>
		Dies ist der Pfad zu dem Ort, an dem die Windows-Druckertreiber
		aufbewahrt werden, aus der Sicht von UNIX.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>browseable</name><value>no </value></smbconfoption></term>
		<listitem><para>
		Macht die Freigabe <smbconfsection>[print$]</smbconfsection>
		für Clients aus der <guimenu>Netzwerkumgebung</guimenu> 
		unsichtbar. Allerdings können Sie sie weiterhin von jedem
		beliebigen Client aus mounten, indem Sie den Befehl
		<command>net use g:\\sambaserver\print$</command> in einer 
		DOS-Shell oder den Menüeintrag
		<guimenu>Netzlaufwerk verbinden ...</guimenu> im Windows
		Explorer verwenden.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>guest ok</name><value>yes </value></smbconfoption></term>
		<listitem><para>
		Gibt allen Gastbenutzern nur Lesezugriff auf diese Freigabe.
		Eventuell besteht die Möglichkeit, Druckertreiber auf Clients 
		herunterzuladen und zu installieren. Ob der Parameter
		<parameter>guest ok = yes</parameter> notwendig ist, hängt
		davon ab, wie Ihre Site konfiguriert ist. Verfügen die Benutzer
		auf jeden Fall über ein Konto auf dem Samba-Host, so ist das 
		kein Problem.
		</para>

		<note><para> 
		Falls all Ihre Windows NT-Benutzer garantiert vom Samba-Server
		authentifiziert werden können (z.B. wenn Samba eine 
		Authentifizierung mittels eines NT-Domainservers vornimmt 
		und der Benutzer vom Domänencontroller beim Anmelden an eine
		Windows NT-Sitzung bereits validiert wurde), so ist kein 
		Gastzugang notwendig. Wenn Sie natürlich in der Umgebung einer
		Arbeitsgruppe einfach nur drucken möchten, ohne sich um
		dumme Konten und Sicherheitsfragen zu kümmern, dann konfigurieren
		Sie die Freigabe so, dass sie einen Gastzugriff erlaubt.
		Eventuell sollten Sie sich überlegen, im Abschnitt
		<smbconfsection>[global]</smbconfsection> auch 
		<smbconfoption><name>map to guest</name><value>Bad
		User</value></smbconfoption> hinzuzufügen. Vorher sollten Sie
		aber verstanden haben, was dieser Parameter bewirkt.
		</para></note>
		</listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>read only</name><value>yes </value></smbconfoption></term>
		<listitem><para>
		Da wir nicht möchten, dass jeder Treiberdateien hochladen
		(oder sogar Treibereinstellungen ändern) kann,
		haben wir diese Freigabe als nicht schreibbar markiert.
		</para></listitem>
	</varlistentry>

	<varlistentry><term><smbconfoption><name>write list</name><value>@ntadmin, root </value></smbconfoption></term>
		<listitem><para>
		In der vorherigen Einstellung wurde 
		<smbconfsection>[print$]</smbconfsection> nur lesbar gemacht,
		damit wir auch den Eintrag <parameter>write list</parameter>
		erstellen konnten. UNIX-Gruppen werden mit einem führenden
		<quote>@</quote>-Zeichen angegeben. Die hier aufgeführten
		Benutzer verfügen über Schreibrechte (eine Ausnahme zu den
		Nur-Lese-Rechten für die Allgemeinheit), die sie für die
		Aktualisierung von Dateien in der Freigabe benötigen. 
		Normalerweise werden Sie hier nur Benutzerkonten 
		von Administratoren auflisten wollen. Prüfen Sie die Rechte im
		Dateisystem, um sicherzugehen, dass diese Konten Dateien
		in die Freigabe kopieren dürfen. Falls dies ein von root
		verschiedenes Konto ist, sollte das Konto im globalen
		Parameter <smbconfoption><name>printer admin</name></smbconfoption> 
		erwähnt werden (siehe auch die Manpage zu &smb.conf; für
		weitere Informationen zur Konfiguration von Dateifreigaben).
		</para></listitem>
	</varlistentry>
</variablelist>

</sect2>

<sect2>
<title>Das Freigabeverzeichnis [print$]</title>

<para>
Damit ein Windows NT-Druckerserver das Herunterladen von Druckertreibern für
Clients von mehreren Architekturen unterstützen kann, müssen Sie mehrere
Unterverzeichnisse für den Dienst <smbconfsection>[print$]</smbconfsection>
erstellen (d.h. das UNIX-Verzeichnis mit dem Namen des Parameters
<smbconfoption><name>path</name></smbconfoption>). Diese entsprechen den
unterstützten Client-Architekturen. Samba verwendet dieses Modell ebenfalls.
Genau wie der Name der Freigabe <smbconfsection>[print$]</smbconfsection> 
selbst müssen die Unterverzeichnisse genau die unten aufgeführten Namen
haben (für Architekturen, die Sie nicht unterstützen müssen, können Sie
die entsprechenden Unterverzeichnisse weglassen).
</para>

<para>
Erstellen Sie daher für jede Architektur, die Sie unterstützen möchten,
einen Verzeichnisbaum unter der Freigabe
<smbconfsection>[print$]</smbconfsection> wie folgt:
</para>

<para><programlisting>
[print$]--+
          |--W32X86           # enthaelt Treiber fuer Windows NT x86
          |--WIN40            # enthaelt Treiber fuer Windows 95/98
          |--W32ALPHA         # enthaelt Treiber fuer Windows NT Alpha_AXP
          |--W32MIPS          # enthaelt Treiber fuer Windows NT R4000
          |--W32PPC           # enthaelt Treiber fuer Windows NT PowerPC
</programlisting>
</para>

<important><title>Erforderliche Rechte</title>
	<para>
	Um einen neuen Treiber zu Ihrem Samba-Host hinzuzufügen, muss eine
	von zwei Bedingungen erfüllt sein:
	</para>

	<itemizedlist>
		<listitem><para>
		Das Konto, mit dem die Verbindung zum Samba-Host erfolgt,
		muss eine UID mit dem Wert 0 haben (d.h. root sein).
		</para></listitem>

		<listitem><para>
		Das Konto, mit dem die Verbindung zum Samba-Host erfolgt,
		muss in der Liste <emphasis>printer admin</emphasis>
		vorkommen.
		</para></listitem>
	</itemizedlist>

	<para>
	Natürlich muss das Konto für die Verbindung außerdem Schreibrechte
	haben, um Dateien in die Unterverzeichnisse von
	<smbconfsection>[print$]</smbconfsection> einzufügen. 
	Denken Sie daran, dass alle Dateifreigaben per Voreinstellung
	auf <quote>nur lesend</quote> gesetzt sind.
	</para>
</important>

<para>
Nachdem Sie den erforderlichen Dienst <smbconfsection>[print$]</smbconfsection>
samt zugehörigen Unterverzeichnissen erstellt haben, können Sie zu einer 
Windows NT 4.0/200x/XP-Client-Workstation gehen. Öffnen Sie dort die
<guiicon>Netzwerkumgebung</guiicon> oder <guiicon>Meine Netzwerkverbindungen</guiicon>,
und finden Sie den Samba-Host. Wenn Sie den Server gefunden haben, navigieren 
Sie zu dessen Ordner <guiicon>Drucker und Faxgeräte</guiicon>. Nun sollten Sie 
eine erste Liste von Druckern sehen, die den Druckerfreigaben entspricht,
die auf Ihrem Samba-Host definiert sind.
</para>
</sect2>
</sect1>

<sect1>
<title>Treiber in [print$] installieren</title>

<para>
Haben Sie die Freigabe <smbconfsection>[print$]</smbconfsection> in &smb.conf;
erfolgreich erstellt und haben Sie Samba dazu gebracht, seine Datei &smb.conf;
neu zu lesen? Gut. Aber noch sind Sie nicht so weit, dass Sie Ihre neuen
Möglichkeiten nutzen können. Noch müssen die Client-Treiberdateien in dieser
Freigabe installiert werden. Bis jetzt ist es nur eine leere Freigabe.
Leider reicht es nicht aus, die Treiberdateien einfach hineinzukopieren.
Sie müssen korrekt installiert werden, damit in den internen Samba-Datenbanken
für jeden Treiber entsprechende Einträge existieren und Samba die korrekten
Treiber zur Verfügung stellen kann, wenn sie von MS Windows-Clients angefordert
werden. Und das ist, gelinge gesagt, ein bischen haarig. Wir besprechen nun
zwei alternative Möglichkeiten, die Treiber in 
<smbconfsection>[print$]</smbconfsection> zu installieren:
</para>

<itemizedlist>
	<listitem><para>
	Mit dem Kommandozeilen-Samba-Utility <command>rpcclient</command> 
	und verschiedenen Unterbefehlen davon (hier:
	<command>adddriver</command> und <command>setdriver</command>) 
	auf beliebigen UNIX-Workstations
	</para></listitem>

	<listitem><para>
	Mit Hilfe der GUI (<guiicon>Druckereigenschaften</guiicon> und des
	<guiicon>Assistenten für die Druckerinstallation</guiicon>) auf einer 
	beliebigen Windows NT/200x/XP-Client-Workstation
	</para></listitem>
</itemizedlist>

<para>
Die zweite Möglichkeit ist wahrscheinlich die einfachere (auch dann,
wenn der Vorgang zu Beginn ein wenig merkwürdig erscheinen mag).
</para>

<sect2>
<title>Treiberinstallation mit dem Assistenten für die Druckerinstallation</title>

<para>
Zu Beginn ist für die Druckerliste im Ordner <guiicon>Drucker</guiicon>
des Samba-Hosts kein echter Druckertreiber mit den Druckern verbunden, wenn Sie mit einem Client-Explorer auf diesen Ordner zugreifen. Per
Voreinstellung ist der Name dieses Treibers auf einen Nullstring gesetzt. 
Das muss nun geändert werden. Dabei wird uns der auf NT/2000/XP-Clients
laufende lokale <guiicon>Assistent für die Druckerinstallation</guiicon> 
(APW) helfen.
</para>

<para>
Die Installation eines gültigen Druckertreibers ist nicht so einfach. 
Sie müssen versuchen, die Druckereigenschaften des Druckers zu sehen, 
dem Sie die Treiber zuordnen möchten. Öffnen Sie den Windows Explorer, 
öffnen Sie die <guiicon>Netzwerkumgebung</guiicon>, finden Sie den
Samba-Host, öffnen Sie den Samba-Ordner <guiicon>Drucker</guiicon>, 
führen Sie einen Rechtsklick auf auf dem Drucker-Icon aus, und wählen 
Sie <guimenu>Eigenschaften...</guimenu> aus. Damit versuchen Sie, die
Drucker- und Treibereigenschaften für eine Schlange anzuschauen, für
die ein solcher <constant>NULL</constant>-Treiber voreingestellt ist. 
Das führt zu folgender Fehlermeldung:
</para>

	<para><errorname>
	Die Geräteeinstellungen können nicht angezeigt werden.
	Der Treiber für den angegebenen Drucker ist nicht installiert.
	(((???
Device settings cannot be displayed. The driver for the specified
	printer is not installed, only spooler properties will be displayed. 
	Do you want to install the driver now?)))
	</errorname></para>

<para>
Klicken Sie nicht auf <guibutton>Ja</guibutton>! Klicken Sie stattdessen
im Fehlerdialogfeld auf <guibutton>Nein</guibutton>.
Erst jetzt erhalten Sie ein Fenster mit den Druckereigenschaften. Von hier aus
können wir nun überlegen, wie wir dem Drucker einen Treiber zuordnen wollen.
Dabei haben Sie folgende Möglichkeiten:
</para>

<itemizedlist>
	<listitem><para>
	Wählen Sie einen Treiber aus der Pop-Up-Liste der installierten
	Treiber aus. Zu Beginn ist diese Liste leer.
	</para></listitem>

	<listitem><para>
	Klicken Sie auf <guibutton>Neuer Treiber ...</guibutton>, um einen
	neuen Druckertreiber zu installieren (daraufhin wird der APW
	gestartet).
	</para></listitem>
</itemizedlist>

<para>
Nachdem der APW gestartet worden ist, ist die Prozedur genau die gleiche wie 
jene, die Sie von Windows her kennen (wir nehmen hier an, dass Sie mit
der Installation von Druckertreibern unter Windows NT vertraut sind). 
Vergewissern Sie sich, dass Ihre Verbindung tatsächlich als Benutzer
mit <smbconfoption><name>printer admin</name></smbconfoption>-Privilegien
eingerichtet ist (wenn Sie daran zweifeln, überprüfen Sie es mit 
<command>smbstatus</command>). Wenn Sie Druckertreiber für andere 
Betriebssysteme als <application>Windows NT x86</application> installieren
möchten, müssen Sie im Dialogfeld <guilabel>Druckereigenschaften</guilabel> den Reiter
<guilabel>Freigabe</guilabel> verwenden.
</para>

<para>
Wenn Sie eine Verbindung unter einem Administrator- (oder root-)Konto 
hergestellt haben (wie durch den Parameter 
<smbconfoption><name>printer admin</name></smbconfoption> angegeben wird), 
dürfen Sie auch andere Druckereigenschaften wie ACLs und Vorgabewerte für
Geräteeigenschaften in diesem Dialogfeld ändern. Was die Vorgabewerte von
Geräteeigenschaften angeht, sollten Sie die Ratschläge befolgen, die im Abschnitt 
<link linkend="inst-rpc">Druckertreiber installieren mit <command>rpcclient</command></link>
gegebenen werden.
</para>
</sect2>

<sect2 id="inst-rpc">
<title>Druckertreiber installieren mit <command>rpcclient</command></title>

<para>
Die zweite Möglichkeit, Druckertreiber in 
<smbconfsection>[print$]</smbconfsection> zu installieren und als gültige
Treiber einzurichten, besteht darin, die UNIX-Kommandozeile zu benutzen. 
Dazu gehören vier verschiedene Schritte:
</para>

<orderedlist>
	<listitem><para>
	Verschaffen Sie sich Information über die benötigten Treiberdateien,
	und besorgen Sie sich diese Dateien.
	</para></listitem>

	<listitem><para>
	Legen Sie die Treiberdateien in die korrekten Unterverzeichnisse
	der Freigabe <smbconfsection>[print$]</smbconfsection> 
	(eventuell mit dem Befehl <command>smbclient</command>).
	</para></listitem>

	<listitem><para>
	Führen Sie das Kommandozeilen-Utility <command>rpcclient</command>
	mit dem Unterbefehl <command>adddriver</command> einmal aus.
	</para></listitem>

	<listitem><para>
	Führen Sie <command>rpcclient</command> ein zweites Mal mit dem
	Unterbefehl <command>setdriver</command> aus.
	</para></listitem>
</orderedlist>

<para>
In den folgenden Abschnitten erhalten Sie detaillierte Hinweise zu jedem
einzelnen dieser Schritte.
</para>

<sect3>
<title>Identifizieren von Treiberdateien</title>

<para>
Um die Treiberdateien zu finden, haben Sie zwei Möglichkeiten. Sie können
den Inhalt der Treiber-CD-ROM durchsuchen, die mit Ihrem Drucker geliefert 
wurde. Sehen Sie sich die <filename>*.inf</filename>-Dateien auf der CD-ROM an. 
Das ist manchmal nicht möglich, weil die <filename>*.inf</filename>-Dateien 
eventuell fehlen. Leider haben die Hersteller angefangen, ihre eigenen
Installationsprogramme zu benutzen. Diese Installationspakete liegen oft in 
irgendeinem Archivformat für die Windows-Plattform vor. Außerdem werden
die Dateien während der Installation manchmal auch umbenannt. Leider wird 
es dadurch extrem schwierig, die benötigten Treiberdateien zu identifizieren.
</para>

<para>
In dem Fall steht Ihnen nur die zweite Möglichkeit zur Verfügung. Installieren
Sie den Treiber lokal auf einem Windows-Client, und finden Sie heraus, welche
Dateinamen und -pfade er nach dieser Installation benutzt. (Dieses Vorgehen
müssen Sie für jede zu unterstützende Client-Plattform wiederholen. An dieser
Stelle zeigen wir das nur für die Plattform <application>W32X86</application>,
ein Name, der von Microsoft für alle Windows NT/200x/XP-Clients verwendet
wird.)
</para>

<para>
Eine gute Methode zum Aufspüren der Treiberdateien besteht darin, aus dem
Dialogfeld <guilabel>Eigenschaften</guilabel> des Treibers 
(Reiter <guilabel>Allgemein</guilabel>)
eine Testseite auszudrucken. Wenn Sie dann in der Druckausgabe nach
der Liste der Treiberdateien suchen, werden Sie feststellen, dass 
Windows (und Samba) folgende Dateien verwenden:
<guilabel>Treiberdatei</guilabel>, <guilabel>Datendatei</guilabel>, 
<guilabel>Konfig.-Datei</guilabel>, <guilabel>Hilfedatei</guilabel> und 
(optional) <guilabel>Abhängige Treiberdateien</guilabel>
(bei Windows NT kann das leicht anders sein). 
Für die weiteren Schritte müssen Sie sich alle Dateinamen notieren.
</para>

<para>
Eine andere Methode zum schnellen Testen der Treiberdateinamen und 
entsprechenden Pfade steht mit dem Utility <command>rpcclient</command> 
zur Verfügung. Starten Sie es mit <command>enumdrivers</command> oder mit
dem Unterbefehl <command>getdriver</command>, die beide auf der Informationsebene 
<filename>3</filename> liegen. Im folgenden Beispiel ist <emphasis>TURBO_XP</emphasis>
der Name eines Windows-PCs (in diesem Fall war es ein Laptop mit Windows XP
Professional). Ich habe den Treiber lokal auf TURBO_XP installiert, und zwar
von einem Samba-Server namens <constant>KDE-BITSHOP</constant>.
Wir könnten eine interaktive <command>rpcclient</command>-Sitzung ausführen,
wobei wir einen <command>rpcclient /></command>-Prompt bekämen und dort die
Unterbefehle eingeben würden. Dies überlasse ich Ihnen, da es eine gute Übung ist. 
Im Moment benutzen wir <command>rpcclient</command> mit dem Parameter 
<option>-c</option>, um eine einzelne Unterbefehlszeile auszuführen, und 
sind dann fertig. Diese Methode würden Sie benutzen, wenn Sie Skripten 
erstellen möchten, um den Vorgang für eine große Anzahl von Druckern und
Treibern zu automatisieren. Beachten Sie die verschiedenen Anführungszeichen,
mit denen unterschiedliche Leerzeichen zwischen einzelnen Worten respektiert 
werden:
</para>

<para><screen>
&rootprompt;<userinput>rpcclient -U'Danka%xxxx' -c \
	'getdriver "Heidelberg Digimaster 9110 (PS)" 3' TURBO_XP</userinput>
cmd = getdriver "Heidelberg Digimaster 9110 (PS)" 3

[Windows NT x86]
Printer Driver Info 3:
  Version: [2]
  Driver Name: [Heidelberg Digimaster 9110 (PS)]
  Architecture: [Windows NT x86]
  Driver Path: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\HDNIS01_de.DLL]
  Datafile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.ppd]
  Configfile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\HDNIS01U_de.DLL]
  Helpfile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\HDNIS01U_de.HLP]
  
  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.DLL]
  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.INI]
  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.dat]
  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.cat]
  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.def]
  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.hre]
  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.vnd]
  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\Hddm91c1_de.hlp]
  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\HDNIS01Aux.dll]
  Dependentfiles: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\HDNIS01_de.NTF]
  
  Monitorname: []
  Defaultdatatype: []
</screen></para>

<para>
Vielleicht bemerken Sie, dass dieser Treiber eine ziemlich große Anzahl von
Dateien in der Kategorie <guilabel>Dependentfiles</guilabel> hat (es gibt
aber auch schlimmere Fälle). Außerdem ist hier seltsamerweise 
<guilabel>Driver File</guilabel> mit <guilabel>Driver Path</guilabel>
markiert. Wir haben noch keine Unterstützung für die so genannte 
<application>WIN40</application>-Architektur installiert. Dieser Name wird
von Microsoft für die Plattformen Windows 9x/Me verwendet. Wenn wir diese
unterstützen möchten, müssen wir auf einem Windows-PC die Treiberdateien 
für Windows 9x/Me zusätzlich zu denen für <application>W32X86</application>, 
d.h. für Windows NT/2000/XP-Clients installieren. Dieser PC kann ebenfalls 
die Windows 9x/Me-Treiber beherbergen, selbst dann, wenn er unter Windows NT,
2000 oder XP läuft.
</para>

<para>
Da die Freigabe <smbconfsection>[print$]</smbconfsection> normalerweise über 
die <guiicon>Netzwerkumgebung</guiicon> erreichbar ist, können Sie
vom Windows Explorer aus auch die UNC-Notation benutzen, um darin
herumzustochern. Die Windows 9x/Me-Treiberdateien werden im Unterverzeichnis
<filename>0</filename> des Verzeichnisses <filename>WIN40</filename> abgelegt.
Der vollständige Pfad für den Zugriff darauf lautet dann 
<filename>\\WINDOWSHOST\print$\WIN40\0\</filename>.
</para>

<note><para>
Neuere Treiber auf Windows 2000 und Windows XP werden im Unterverzeichnis 
<quote>3</quote> statt <quote>2</quote> installiert. Version 2 der Treiber, 
wie sie in Windows NT benutzt werden, liefen vorher im Kernel-Modus. Mit
Windows 2000 hat sich das verändert. Zwar kann es weiterhin die Treiber im 
Kernel-Modus benutzen (falls das vom Administrator erlaubt ist), aber der
native Modus für seine Druckertreiber ist die Ausführung im User-Modus. 
Dafür sind speziell entworfene Treiber notwendig. Diese Art von Treibern
werden im Unterverzeichnis <quote>3</quote> installiert.
</para></note>
</sect3>

<sect3>
<title>Treiberdateien aus [print$]-Freigaben von Windows-Clients erhalten</title>

<para>
Nun müssen wir alle im vorherigen Schritt gefundenen Treiberdateien 
zusammentragen. Wo bekommen wir die aber her? Nun, warum nehmen wir sie nicht einfach 
vom gleichen PC und der gleichen Freigabe 
<smbconfsection>[print$]</smbconfsection>, die wir in unserem 
letzten Schritt untersucht haben, um die Dateien zu finden? Dazu können
wir <command>smbclient</command> verwenden. Wir benutzen dabei die Pfade 
und Namen, die uns <command>getdriver</command> verraten hat. Das folgende Listing
ist leicht editiert, damit es durch zusätzliche Umbrüche leichter lesbar 
wird:
</para>

<para><screen>
&rootprompt;<userinput>smbclient //TURBO_XP/print\$ -U'Danka%xxxx' \ 
   -c 'cd W32X86/2;mget HD*_de.* hd*ppd Hd*_de.* Hddm*dll HDN*Aux.DLL'</userinput>

added interface ip=10.160.51.60 bcast=10.160.51.255 nmask=255.255.252.0
Got a positive name query response from 10.160.50.8 ( 10.160.50.8 )
Domain=[DEVELOPMENT] OS=[Windows 5.1] Server=[Windows 2000 LAN Manager]
<prompt>Get file Hddm91c1_de.ABD? </prompt><userinput>n</userinput>
<prompt>Get file Hddm91c1_de.def? </prompt><userinput>y</userinput>
getting file \W32X86\2\Hddm91c1_de.def of size 428 as Hddm91c1_de.def
<prompt>Get file Hddm91c1_de.DLL? </prompt><userinput>y</userinput>
getting file \W32X86\2\Hddm91c1_de.DLL of size 876544 as Hddm91c1_de.DLL
[...]
</screen></para>

<para>
Nach der Ausführung dieses Befehls befinden sich die Dateien in unserem
aktuellen lokalen Verzeichnis. Vermutlich haben Sie bemerkt, dass wir
dieses Mal mehrere durch Semikola getrennte Befehle mit dem Parameter 
<option>-c</option> übergeben haben.
Das bewirkt, dass auf dem entfernten Windows-Server alle Befehle nacheinander
ausgeführt werden, bevor smbclient wieder beendet wird.
</para>

<para>
Vergessen Sie nicht, diese Prozedur für die 
<application>WIN40</application>-Architektur zu wiederholen, falls Sie
Windows 9x/Me/XP-Clients unterstützen müssen. Denken Sie dabei auch daran,
dass die Dateien für diese Architekturen sich im Unterverzeichnis
<filename>WIN40/0/</filename> befinden. Wenn das erledigt ist, können wir 
<command>smbclient ... put</command> starten, um die gesammelten Dateien 
in der Freigabe <smbconfsection>[print$]</smbconfsection> des Samba-Servers 
zu speichern.
</para>
</sect3>

<sect3>
<title>Treiberdateien in [print$] installieren</title>

<para>
Nun werden wir die Treiberdateien in der Freigabe 
<smbconfsection>[print$]</smbconfsection> platzieren. Denken Sie daran, dass 
der UNIX-Pfad zu dieser Freigabe zuvor in Ihren eigenen Worten
definiert wurde, die hier aber fehlen. Außerdem haben Sie Unterverzeichnisse für die verschiedenen 
zu unterstützenden Arten von Windows-Clients angelegt. Wenn wir annehmen, dass
Ihre Freigabe <smbconfsection>[print$]</smbconfsection> auf den UNIX-Pfad
<filename>/etc/samba/drivers/</filename> abgebildet wird, dann sollten Ihre
Treiberdateien an folgende Orte gelangen:
</para>

<itemizedlist>
	<listitem><para>
	Für alle Windows NT-, 2000- und XP-Clients nach 
	<filename>/etc/samba/drivers/W32X86/</filename>, aber (noch)
	nicht in das Verzeichnis <filename>2</filename>
	</para></listitem>

	<listitem><para>
	Für alle Windows 95-, 98- und ME-Clients nach 
	<filename>/etc/samba/drivers/WIN40/</filename> aber (noch)
	nicht in das Verzeichnis <filename>0</filename>
	</para></listitem>
</itemizedlist>

<para>
Wieder benutzen wir smbclient für die Übertragung der Treiberdateien über 
das Netzwerk. Wir geben die gleichen Dateien und Pfade an, die wir bei der
Ausführung von <command>getdriver</command> im Vergleich mit der 
Originalinstallation von <emphasis>Windows</emphasis> erhalten haben. 
Nun aber werden wir die Dateien in der Freigabe 
<smbconfsection>[print$]</smbconfsection> eines 
<emphasis>Samba/UNIX</emphasis>-Druckerservers speichern.
</para>

<para><screen>
&rootprompt;<userinput>smbclient //SAMBA-CUPS/print\$ -U'root%xxxx' -c \
  'cd W32X86; put HDNIS01_de.DLL; \
  put Hddm91c1_de.ppd; put HDNIS01U_de.DLL;        \
  put HDNIS01U_de.HLP; put Hddm91c1_de.DLL;        \
  put Hddm91c1_de.INI; put Hddm91c1KMMin.DLL;      \
  put Hddm91c1_de.dat; put Hddm91c1_de.dat;        \
  put Hddm91c1_de.def; put Hddm91c1_de.hre;        \
  put Hddm91c1_de.vnd; put Hddm91c1_de.hlp;        \
  put Hddm91c1_de_reg.HLP; put HDNIS01Aux.dll;     \
  put HDNIS01_de.NTF'</userinput>

added interface ip=10.160.51.60 bcast=10.160.51.255 nmask=255.255.252.0
Got a positive name query response from 10.160.51.162 ( 10.160.51.162 )
Domain=[CUPS-PRINT] OS=[UNIX] Server=[Samba 2.2.7a]
putting file HDNIS01_de.DLL as \W32X86\HDNIS01_de.DLL
putting file Hddm91c1_de.ppd as \W32X86\Hddm91c1_de.ppd
putting file HDNIS01U_de.DLL as \W32X86\HDNIS01U_de.DLL
putting file HDNIS01U_de.HLP as \W32X86\HDNIS01U_de.HLP
putting file Hddm91c1_de.DLL as \W32X86\Hddm91c1_de.DLL
putting file Hddm91c1_de.INI as \W32X86\Hddm91c1_de.INI
putting file Hddm91c1KMMin.DLL as \W32X86\Hddm91c1KMMin.DLL
putting file Hddm91c1_de.dat as \W32X86\Hddm91c1_de.dat
putting file Hddm91c1_de.dat as \W32X86\Hddm91c1_de.dat
putting file Hddm91c1_de.def as \W32X86\Hddm91c1_de.def
putting file Hddm91c1_de.hre as \W32X86\Hddm91c1_de.hre
putting file Hddm91c1_de.vnd as \W32X86\Hddm91c1_de.vnd
putting file Hddm91c1_de.hlp as \W32X86\Hddm91c1_de.hlp
putting file Hddm91c1_de_reg.HLP as \W32X86\Hddm91c1_de_reg.HLP
putting file HDNIS01Aux.dll as \W32X86\HDNIS01Aux.dll
putting file HDNIS01_de.NTF as \W32X86\HDNIS01_de.NTF
</screen>

Puh, das war viel zu tippen! Die meisten Treiber sind wesentlich
kleiner &smbmdash; viele haben sogar nur drei generische 
PostScript-Treiberdateien plus eine PPD-Datei. Obwohl wir die Dateien aus
dem Unterverzeichnis <filename>2</filename> des Verzeichnisses 
<filename>W32X86</filename> von der Windows-Kiste geholt haben, platzieren 
wie sie (vorläufig) nicht in das gleiche Unterverzeichnis der Samba-Kiste. 
Dieses Umkopieren wird automatisch vom Befehl <command>adddriver</command>
erledigt, den wir gleich ausführen werden (und vergessen Sie ebenfalls nicht,
auch die Dateien für die Windows 9x/Me-Architektur in das Unterverzeichnis
<filename>WIN40/</filename> zu legen, falls Sie diese brauchen sollten).
</para>
</sect3>

<sect3>
<title>Bestätigen der Treiberinstallation mit <command>smbclient</command></title>

<para>
Im Moment überprüfen wir nur, dass unsere Dateien vorhanden sind. Das kann
ebenfalls mit dem Befehl <command>smbclient</command> bewerkstelligt werden
(aber Sie können sich natürlich auch mit SSH anmelden und das mit einem 
Zugriff über eine UNIX-Shell erledigen):
</para>

<para><screen>
&rootprompt;<userinput>smbclient //SAMBA-CUPS/print\$ -U 'root%xxxx' \
	-c 'cd W32X86; pwd; dir; cd 2; pwd; dir'</userinput>
 added interface ip=10.160.51.60 bcast=10.160.51.255 nmask=255.255.252.0
Got a positive name query response from 10.160.51.162 ( 10.160.51.162 )
Domain=[CUPS-PRINT] OS=[UNIX] Server=[Samba 2.2.8a]

Current directory is \\SAMBA-CUPS\print$\W32X86\
.                                  D        0  Sun May  4 03:56:35 2003
..                                 D        0  Thu Apr 10 23:47:40 2003
2                                   D        0  Sun May  4 03:56:18 2003
HDNIS01Aux.dll                      A    15356  Sun May  4 03:58:59 2003
Hddm91c1KMMin.DLL                   A    46966  Sun May  4 03:58:59 2003
HDNIS01_de.DLL                      A   434400  Sun May  4 03:58:59 2003
HDNIS01_de.NTF                      A   790404  Sun May  4 03:56:35 2003
Hddm91c1_de.DLL                     A   876544  Sun May  4 03:58:59 2003
Hddm91c1_de.INI                     A      101  Sun May  4 03:58:59 2003
Hddm91c1_de.dat                     A     5044  Sun May  4 03:58:59 2003
Hddm91c1_de.def                     A      428  Sun May  4 03:58:59 2003
Hddm91c1_de.hlp                     A    37699  Sun May  4 03:58:59 2003
Hddm91c1_de.hre                     A   323584  Sun May  4 03:58:59 2003
Hddm91c1_de.ppd                     A    26373  Sun May  4 03:58:59 2003
Hddm91c1_de.vnd                     A    45056  Sun May  4 03:58:59 2003
HDNIS01U_de.DLL                     A   165888  Sun May  4 03:58:59 2003
HDNIS01U_de.HLP                     A    19770  Sun May  4 03:58:59 2003
Hddm91c1_de_reg.HLP                 A   228417  Sun May  4 03:58:59 2003
              40976 blocks of size 262144. 709 blocks available

Current directory is \\SAMBA-CUPS\print$\W32X86\2\
.                                  D        0  Sun May  4 03:56:18 2003
..                                 D        0  Sun May  4 03:56:35 2003
ADOBEPS5.DLL                        A   434400  Sat May  3 23:18:45 2003
laserjet4.ppd                       A     9639  Thu Apr 24 01:05:32 2003
ADOBEPSU.DLL                        A   109568  Sat May  3 23:18:45 2003
ADOBEPSU.HLP                        A    18082  Sat May  3 23:18:45 2003
PDFcreator2.PPD                     A    15746  Sun Apr 20 22:24:07 2003
              40976 blocks of size 262144. 709 blocks available
</screen></para>

<para>
Beachten Sie, dass in dem Unterverzeichnis <filename>2</filename> schon 
Treiberdateien vorhanden sind (vermutlich aus einer früheren Installation). 
Nachdem die Dateien für den neuen Treiber ebenfalls dort sind, sind es noch
einige wenige Schritte, bevor Sie sie auf einem Client benutzen können. 
Das einzige, was Sie nun tun könnten, ist, sie von einem Client zu bekommen,
so wie Sie auch normale Dateien von einer Dateifreigabe bekommen würden, 
indem Sie print$ im Windows Explorer öffnen. Aber dabei würden sie nicht per
Point'n'Print installiert. Der Grund ist folgender: Samba weiß noch nicht,
dass diese Dateien etwas Besonderes sind, nämlich 
<emphasis>Druckertreiberdateien</emphasis>, und es weiß nicht, zu welcher
Druckerschlange bzw. zu welchen Druckerschlangen diese Treiberdateien 
gehören.
</para>
</sect3>

<sect3>
<title>Ausführen von <command>rpcclient</command> mit <command>adddriver</command></title>

<para>
Als Nächstes müssen Sie Samba sagen, dass es sich um eine spezielle Sorte von 
Dateien handelt, die Sie gerade in der Freigabe 
<smbconfsection>[print$]</smbconfsection> hochgeladen haben. Das tun Sie mit dem
Befehl <command>adddriver</command>. Dieser bringt Samba dazu, die Treiberdateien 
in seiner internen TDB-Datenbank zu registrieren. Der folgende Befehl und seine
Ausgabe wurden wieder zwecks besserer Lesbarkeit editiert:
</para>

<para><screen>
&rootprompt;<userinput>rpcclient -Uroot%xxxx -c 'adddriver "Windows NT x86" \
  "dm9110:HDNIS01_de.DLL: \
  Hddm91c1_de.ppd:HDNIS01U_de.DLL:HDNIS01U_de.HLP:   \
  NULL:RAW:Hddm91c1_de.DLL,Hddm91c1_de.INI,          \
  Hddm91c1_de.dat,Hddm91c1_de.def,Hddm91c1_de.hre,   \
  Hddm91c1_de.vnd,Hddm91c1_de.hlp,Hddm91c1KMMin.DLL, \
  HDNIS01Aux.dll,HDNIS01_de.NTF,                     \
  Hddm91c1_de_reg.HLP' SAMBA-CUPS</userinput>

cmd = adddriver "Windows NT x86" \
  "dm9110:HDNIS01_de.DLL:Hddm91c1_de.ppd:HDNIS01U_de.DLL:   \
  HDNIS01U_de.HLP:NULL:RAW:Hddm91c1_de.DLL,Hddm91c1_de.INI, \
  Hddm91c1_de.dat,Hddm91c1_de.def,Hddm91c1_de.hre,          \
  Hddm91c1_de.vnd,Hddm91c1_de.hlp,Hddm91c1KMMin.DLL,        \
  HDNIS01Aux.dll,HDNIS01_de.NTF,Hddm91c1_de_reg.HLP"

Printer Driver dm9110 successfully installed.
</screen></para>

<para>
Nach diesem Schritt sollte der Treiber von Samba auf dem Druckerserver erkannt
werden. Bei der Eingabe des Befehls müssen Sie sehr vorsichtig sein. Vertauschen
Sie nicht die Reihenfolge der Felder. Manche Änderungen würden zu der Fehlermeldung
<computeroutput>NT_STATUS_UNSUCCESSFUL</computeroutput> führen. Diese Fehler sind
offensichtlich. Bei anderen Änderungen werden die Treiberdateien erfolgreich 
installiert, aber ohne dass der Treiber selbst funktioniert. Also passen Sie auf!
Hinweise zur Syntax des Befehls <command>adddriver</command> finden Sie in der Manpage. Das Kapitel
über das Drucken mit CUPS enthält eine detailliertere Beschreibung, falls Sie eine
solche brauchen sollten.
</para>
</sect3>

<sect3>
<title>Ende von <command>adddriver</command> überprüfen</title>

<para>
Ein Hinweis darauf, dass Samba die Dateien als Treiberdateien erkennt, ist die
Meldung <computeroutput>successfully installed</computeroutput>. Ein weiterer ist
die Tatsache, dass unsere Dateien vom Befehl <command>adddriver</command> 
in das Unterverzeichnis <filename>2</filename> verschoben wurden. Das können 
Sie erneut mit <command>smbclient</command> überprüfen:
</para>

<para><screen>
&rootprompt;<userinput>smbclient //SAMBA-CUPS/print\$ -Uroot%xx \
	-c 'cd W32X86;dir;pwd;cd 2;dir;pwd'</userinput>
 added interface ip=10.160.51.162 bcast=10.160.51.255 nmask=255.255.252.0
 Domain=[CUPS-PRINT] OS=[UNIX] Server=[Samba 2.2.7a]

  Current directory is \\SAMBA-CUPS\print$\W32X86\
  .                                  D        0  Sun May  4 04:32:48 2003
  ..                                 D        0  Thu Apr 10 23:47:40 2003
  2                                   D        0  Sun May  4 04:32:48 2003
                40976 blocks of size 262144. 731 blocks available 

  Current directory is \\SAMBA-CUPS\print$\W32X86\2\
  .                                  D        0  Sun May  4 04:32:48 2003
  ..                                 D        0  Sun May  4 04:32:48 2003
  DigiMaster.PPD                      A   148336  Thu Apr 24 01:07:00 2003
  ADOBEPS5.DLL                        A   434400  Sat May  3 23:18:45 2003
  laserjet4.ppd                       A     9639  Thu Apr 24 01:05:32 2003
  ADOBEPSU.DLL                        A   109568  Sat May  3 23:18:45 2003
  ADOBEPSU.HLP                        A    18082  Sat May  3 23:18:45 2003
  PDFcreator2.PPD                     A    15746  Sun Apr 20 22:24:07 2003
  HDNIS01Aux.dll                      A    15356  Sun May  4 04:32:18 2003
  Hddm91c1KMMin.DLL                   A    46966  Sun May  4 04:32:18 2003
  HDNIS01_de.DLL                      A   434400  Sun May  4 04:32:18 2003
  HDNIS01_de.NTF                      A   790404  Sun May  4 04:32:18 2003
  Hddm91c1_de.DLL                     A   876544  Sun May  4 04:32:18 2003
  Hddm91c1_de.INI                     A      101  Sun May  4 04:32:18 2003
  Hddm91c1_de.dat                     A     5044  Sun May  4 04:32:18 2003
  Hddm91c1_de.def                     A      428  Sun May  4 04:32:18 2003
  Hddm91c1_de.hlp                     A    37699  Sun May  4 04:32:18 2003
  Hddm91c1_de.hre                     A   323584  Sun May  4 04:32:18 2003
  Hddm91c1_de.ppd                     A    26373  Sun May  4 04:32:18 2003
  Hddm91c1_de.vnd                     A    45056  Sun May  4 04:32:18 2003
  HDNIS01U_de.DLL                     A   165888  Sun May  4 04:32:18 2003
  HDNIS01U_de.HLP                     A    19770  Sun May  4 04:32:18 2003
  Hddm91c1_de_reg.HLP                 A   228417  Sun May  4 04:32:18 2003
                40976 blocks of size 262144. 731 blocks available
</screen></para>

<para>
Sie können auch noch prüfen, ob der Zeitstempel der Druck-TDB-Dateien 
nun aktualisiert ist (und eventuell, ob deren Dateigröße zugenommen hat).
</para>
</sect3>

<sect3>
<title>Treibererkennung in Samba überprüfen</title>

<para>
Nun sollte der Treiber in Samba registriert sein. Das können wir leicht
nachprüfen und werden es auch gleich tun. Allerdings ist dieser Treiber noch
nicht mit einem bestimmten Drucker verbunden. Den Status der Treiberdateien
können wir auf mindestens dreierlei Weise überprüfen:
</para>

<itemizedlist>
	<listitem><para>
	Stöbern Sie auf einem beliebigen Windows-Client in der Netzwerkumgebung,
	finden Sie dort den Samba-Host, und öffnen Sie den Samba-Ordner
	<guiicon>Drucker und Faxgeräte</guiicon>. Wählen Sie ein beliebiges
	Drucker-Icon, und führen Sie einen Rechtsklick aus, um die
	Drucker-<guimenuitem>Eigenschaften</guimenuitem> zu wählen. Klicken Sie auf den
	Reiter <guilabel>Erweitert</guilabel>. Dort ist ein Feld, das den
	Treiber für diesen Drucker angibt. In einem Drop-Down-Menü können Sie
	diesen Treiber ändern (achten Sie aber darauf, das nicht unabsichtlich
	zu tun). 
	Mit dieser Liste haben Sie eine Übersicht aller Treiber, die Samba
	kennt. Ihr neuer Treiber sollte nun auch darunter sein. (Dabei sieht 
	jede Sorte von Client nur die Liste für ihre eigene Architektur. Wenn
	Sie nicht alle Treiber für alle Plattformen installiert haben, sieht
	die Liste unterschiedlich aus, je nachdem, ob Sie sie unter 
	Windows95/98/ME oder Windows NT/2000/XP anschauen.)
	</para></listitem>

	<listitem><para>
	Stöbern Sie auf einem Windows 200x/XP-Client (nicht Windows NT) die
	<guiicon>Netzwerkumgebung</guiicon> auf, suchen Sie den 
	Samba-Server, öffnen Sie den Ordner <guiicon>Drucker</guiicon>
	des Servers, und führen Sie einen Rechtsklick auf dem weißen Hintergrund
	aus (ohne markierten Drucker). Wählen Sie  
	<guimenuitem>Server-Eigenschaften</guimenuitem> im Menü aus. Unter dem Reiter
	<guilabel>Treiber</guilabel> werden Sie den neuen Treiber aufgelistet
	sehen. In dieser Ansicht können Sie auch die Liste der zu diesem
	Treiber gehörenden Dateien inspizieren. (Das funktioniert nicht unter
	Windows NT, sondern nur unter Windows 2000 und Windows XP; Windows NT
	verfügt nicht über den Reiter <guimenuitem>Treiber</guimenuitem>.) 
	Eine alternative und wesentlich schnellere Methode, dieses Dialogfeld
	unter Windows 2000/XP zu starten, besteht darin, in einer DOS-Shell 
	Folgendes einzugeben (natürlich müssen Sie 
	<replaceable>SAMBA-CUPS</replaceable> durch den Namen Ihres Samba-Servers
	ersetzen):
	</para>

	<para><userinput>rundll32 printui.dll,PrintUIEntry /s /t2 /n\\<replaceable>SAMBA-CUPS</replaceable></userinput></para>
	</listitem>

	<listitem><para>
	Führen Sie unter einem UNIX-Prompt folgenden Befehl (oder eine Variante
	davon) aus, wobei <replaceable>SAMBA-CUPS</replaceable> der Name des
	Samba-Hosts ist und xxxx für das aktuelle an root zugewiesene 
	Samba-Passwort steht:
	</para>

	<para><userinput>rpcclient -U'root%xxxx' -c 'enumdrivers' <replaceable>SAMBA-CUPS</replaceable></userinput></para>

	<para>
	Dann sehen Sie eine Liste aller Samba bekannten Treiber. Darunter 
	sollte auch ihr neuer sein. Er wird allerdings nur unter der
	Überschrift <parameter>[Windows NT x86]</parameter> aufgeführt, nicht
	unter <smbconfsection>[Windows 4.0]</smbconfsection>, weil Sie diesen
	Teil nicht installiert haben. Oder haben Sie es doch getan?
	In unserem Beispiel hat der Treiber den Namen 
	<constant>dm9110</constant>. Beachten Sie, dass in der dritten Spalte
	die anderen installierten Treiber doppelt erscheinen: je einmal für
	jede unterstützte Architektur. Unser neuer Treiber erscheint nur unter
	<application>Windows NT 4.0 oder 2000</application>. Um ihn auch unter
	<application>Windows 95, 98 und ME</application> zu sehen, müssen Sie
	die gesamte Prozedur mit der WIN40-Architektur und dem 
	WIN40-Unterverzeichnis wiederholen.
	</para></listitem>
</itemizedlist>
</sect3>

<sect3>
<title>Spezifische Flexibilität von Treibernamen</title>

<para>
Sie können den Treiber nennen, wie Sie möchten. Wenn Sie den Schritt
<command>adddriver</command> mit den gleichen Dateien wie vorher, aber mit
einem anderen Treibernamen wiederholen, funktioniert es genauso:
</para>

<para><screen>
&rootprompt;<userinput>rpcclient -Uroot%xxxx         \
  -c 'adddriver "Windows NT x86"                     \
  "mydrivername:HDNIS01_de.DLL:              \
  Hddm91c1_de.ppd:HDNIS01U_de.DLL:HDNIS01U_de.HLP:   \
  NULL:RAW:Hddm91c1_de.DLL,Hddm91c1_de.INI,          \
  Hddm91c1_de.dat,Hddm91c1_de.def,Hddm91c1_de.hre,   \
  Hddm91c1_de.vnd,Hddm91c1_de.hlp,Hddm91c1KMMin.DLL, \
  HDNIS01Aux.dll,HDNIS01_de.NTF,Hddm91c1_de_reg.HLP' SAMBA-CUPS
  </userinput>

cmd = adddriver "Windows NT x86" \
 "mydrivername:HDNIS01_de.DLL:Hddm91c1_de.ppd:HDNIS01U_de.DLL:\
  HDNIS01U_de.HLP:NULL:RAW:Hddm91c1_de.DLL,Hddm91c1_de.INI,           \
  Hddm91c1_de.dat,Hddm91c1_de.def,Hddm91c1_de.hre,                    \
  Hddm91c1_de.vnd,Hddm91c1_de.hlp,Hddm91c1KMMin.DLL,                  \
  HDNIS01Aux.dll,HDNIS01_de.NTF,Hddm91c1_de_reg.HLP"

Printer Driver mydrivername successfully installed.
</screen></para>

<para>
Diesen Treiber können Sie mit einer beliebigen Druckerschlange verbinden
(allerdings sind Sie dafür verantwortlich, Treiber mit Schlangen zu verbinden,
die in Hinblick auf die anvisierten Drucker auch Sinn machen). Den Befehl
<command>rpcclient</command> <command>adddriver</command> können Sie nicht
mehrfach wiederholen. Bei jeder Ausführung werden die Dateien verbraucht, die 
Sie in die Freigabe <smbconfsection>[print$]</smbconfsection> gelegt,
d.h. in die entsprechenden Unterverzeichnisse verschoben haben. Daher müssen Sie 
vor jedem <command>rpcclient ... adddriver</command>-Befehl den Befehl
<command>smbclient ... put</command> ausführen.
</para>
</sect3>

<sect3>
<title>Ausführen von <command>rpcclient</command> mit <command>setdriver</command></title>

<para>
Samba muss darüber Bescheid wissen, welcher Treiber zu welchem Drucker gehört. 
Erstellen Sie eine Zuordnung der Treiber zu ihren Druckern, und speichern Sie diese
Information in Sambas Speicher, den TDB-Dateien. Genau dies bewerkstelligt der
Befehl <command>rpcclient setdriver</command>:
</para>

<para><screen>
&rootprompt;<userinput>rpcclient -U'root%xxxx' -c 'setdriver dm9110 mydrivername' <replaceable>SAMBA-CUPS</replaceable></userinput>
 cmd = setdriver dm9110 mydrivername

Successfully set dm9110 to driver mydrivername.
</screen></para>

<para>
Ähm, nein, das wollte ich eigentlich gar nicht tun. Also noch einmal, jetzt mit
dem beabsichtigten Namen: 
</para>

<para><screen>
&rootprompt;<userinput>rpcclient -U'root%xxxx' -c 'setdriver dm9110 dm9110' <replaceable>SAMBA-CUPS</replaceable></userinput>
 cmd = setdriver dm9110 dm9110
Successfully set dm9110 to driver dm9110.
</screen></para>

<para>
Die Syntax des Befehls lautet:
<screen>
<userinput>rpcclient -U'root%<replaceable>sambapassword</replaceable>' -c 'setdriver <replaceable>printername</replaceable> \
 <replaceable>drivername</replaceable>' <replaceable>SAMBA-Hostname</replaceable></userinput>. 
</screen>
Nun haben wir den größten Teil der Arbeit erledigt, aber noch nicht alles.
</para>

<note><para>
Der Befehl <command>setdriver</command> ist nur dann erfolgreich, wenn Samba
den Drucker bereits kennt. Ein Fehler in 2.2.x verhindert, dass Samba frisch
installierte Drucker erkennt. Dort müssen Sie Samba neu starten oder zumindest
ein HUP-Signal an alle laufenden smbd-Prozesse schicken, um dieses Problem zu
umgehen: <userinput>kill -HUP
`pidof smbd`</userinput>.
</para></note>
</sect3>
</sect2>
</sect1>

<sect1>
<title>Installationsvorgang bei Client-Treibern</title>

<para>
Wie Don Quixote schon sagte, geht Probieren über Studieren: 
<quote>The proof of the pudding is in the eating.</quote> Die Prüfung unserer
Einstellungen besteht im erfolgreichen Drucken. Installieren wir also den
Druckertreiber auf den Client-PCs. Das ist nicht ganz so einfach, wie es 
erscheinen mag. Lesen Sie also weiter.
</para>

<sect2>
<title>Treiberinstallation auf dem ersten Client</title>

<para>
Besonders wichtig ist die Installation auf dem ersten Client-PC (für jede
Architektur einzeln). Sobald diese korrekt erfolgt ist, sind alle weiteren 
Clients leicht einzurichten und sollten keine weitere Aufmerksamkeit 
benötigen. Es folgt nun eine Beschreibung der Prozedur, die für das erste
Mal empfohlenen wird. Sie arbeiten nun auf einer Client-Workstation. Sie
sollten sicherstellen, dass Ihre Verbindung nicht unabsichtlich unter dem
<emphasis>ungeeigneten Benutzer</emphasis> <quote>nobody</quote> erfolgt. Geben Sie nun in
einer DOS-Shell Folgendes ein:
</para>

<para><userinput>net use \\<replaceable>SAMBA-SERVER</replaceable>\print$ /user:root</userinput></para>

<para>
Ersetzen Sie, falls erforderlich, root durch einen anderen gültigen 
<smbconfoption><name>printer admin</name></smbconfoption>-Benutzer, der in der
Definition angegeben ist. Sollten Sie bereits als anderer Benutzer verbunden sein,
so erhalten Sie eine Fehlermeldung. Eine einfache Möglichkeit, diese Verbindung
loszuwerden, gibt es nicht, da Windows anscheinend das Konzept des Abmeldens von 
einer Freigabeverbindung nicht kennt (verwechseln Sie das nicht mit dem Abmelden
von der lokalen Workstation, was eine völlig andere Sache ist). Unter Windows NT/2K
können Sie ein Abmelden von allen smb/cifs-Verbindungen erzwingen, indem Sie den
Dienst <quote>workstation</quote> neu starten. Sie können versuchen, alle 
Dateiexplorer- und Internet Explorer-Fenster unter Windows zu schließen. Als letzte
Möglichkeit müssen Sie möglicherweise einen Neustart durchführen. Vergewissern Sie
sich, dass nicht automatisch eine Verbindung neu hergestellt wird. Es ist eventuell
leichter, zu einer anderen Workstation zu gehen und es von dort auszuprobieren.
Wenn Sie sicher sind, dass Sie als Benutzer <smbconfoption><name>printer admin</name></smbconfoption> verbunden sind (das
können Sie in Samba mit dem Befehl <command>smbstatus</command> prüfen), führen
Sie folgende Schritte auf der Windows-Workstation aus:
</para>

<procedure>
	<step><para>
	Öffnen Sie die <guiicon>Netzwerkumgebung</guiicon>.
	</para></step>

	<step><para>
	Gehen Sie zum Samba-Server.
	</para></step>

	<step><para>
	Öffnen Sie dessen Ordner <guiicon>Drucker und Faxgeräte</guiicon>.
	</para></step>

	<step><para>
	Wählen Sie den Drucker, und führen Sie einen Rechtsklick darauf aus.
	</para></step>

	<step><para>
	Wählen Sie <guimenuitem>Verbinden</guimenuitem> (unter Windows NT4/200x
	heißt es eventuell <guimenuitem>Installieren</guimenuitem>).
	</para></step>
</procedure>

<para>
Ein neuer Drucker (namens <replaceable>printername</replaceable> auf dem 
Samba-Server) sollte nun in Ihrem <emphasis>lokalen</emphasis> Druckerordner 
erschienen sein (prüfen Sie das mit <guimenu>Start</guimenu> --
<guimenuitem>Einstellungen</guimenuitem> -- 
<guimenuitem>Systemsteuerung</guimenuitem> -- <guiicon>Drucker und 
Faxgeräte</guiicon>).
</para>

<para>
Sehr wahrscheinlich möchten Sie nun versuchen, eine Testseite auszudrucken. 
Schließlich können Sie nun die Druckereigenschaften öffnen, und unter dem 
Reiter <guimenu>Allgemein</guimenu> gibt es einen Knopf genau dafür. Aber sehr 
wahrscheinlich würden Sie eine Fehlermeldung namens 
<errorname>Unable to print Test Page</errorname> erhalten. 
Der Grund könnte sein, dass noch kein 
gültiger Device-Modus für den Drucker gesetzt ist oder dass der Satz an 
<quote>Druckertreiberdaten</quote> noch immer unvollständig ist.
</para>

<para>
Sie müssen sicherstellen, dass für den Drucker ein gültiger 
<parameter>Device-Modus</parameter> gesetzt ist. Wir wollen nun erklären, 
was das bedeutet.
</para>
</sect2>

<sect2>
<title>Device-Modus auf neuen Druckern setzen</title>

<para>
Damit ein Drucker wirklich von einem Windows NT/200x/XP-Client benutzt werden
kann, muss er über Folgendes verfügen:
</para>

<itemizedlist>
	<listitem><para>
	Einen gültigen <emphasis>Device-Modus</emphasis>, der von dem 
	Druckertreiber generiert wird (und Dinge wie die Papiergröße,
	-ausrichtung und Duplex-Einstellungen definiert)
	</para></listitem>

	<listitem><para>
	Einen kompletten Satz an <emphasis>Druckertreiberdaten</emphasis>, 
	der vom Treiber generiert wird
	</para></listitem>
</itemizedlist>

<para>
Ist eine dieser Angaben unvollständig, so können die Clients bestenfalls eine 
suboptimale Ausgabe produzieren. Im schlimmsten Fall kommt unlesbarer
Müll oder gar nichts aus dem Drucker. Oder er produziert eine Unmenge 
Fehlermeldungen beim Versuch, etwas auszudrucken. Samba speichert die 
genannten Werte sowie alle druckrelevanten Informationen in seinen 
internen TDB-Datenbankdateien <filename>(ntprinters.tdb</filename>, 
<filename>ntdrivers.tdb</filename>, <filename>printing.tdb</filename> 
und <filename>ntforms.tdb</filename>).
</para>

<para>
Wofür stehen diese beiden Begriffe? Im Grunde genommen stellen der Device-Modus 
und der Satz an Druckertreiberdaten eine Ansammlung von Einstellungen für
alle Eigenschaften einer Druckerschlange dar, die mit vernünftigen Anfangswerten 
versehen sind. Device-Modi und Druckertreiberdaten sollten auf dem 
Druckerserver (dem Samba-Host) vernünftige Anfangswerte haben, damit die Clients 
sie sofort benutzen können. Wie aber stellen wir diese vernünftigen Werte ein? 
Das kann man dadurch erreichen, dass man auf die Treiber von einem entfernten 
NT- (oder 200x/XP-) Client aus zugreift, was in den folgenden Abschnitten beschrieben 
wird.
</para>

<para>
Sie sollten sich darüber im Klaren sein, dass ein gültiger Device-Modus nur von einem
<smbconfoption><name>printer admin</name></smbconfoption> oder von root eingestellt
werden kann (aus offensichtlichen Gründen). Device-Modi können nur durch die 
Ausführung des Druckertreiberprogramms selbst korrekt eingestellt werden. Da Samba
den Treibercode für diese Win32-Plattform nicht ausführen kann, setzt es dieses 
Feld anfangs auf NULL (was für Clients kein gültiger verwendbarer Wert ist). 
Zum Glück generieren die meisten Treiber die Druckertreiberdaten
automatisch, die beim Hochladen auf die Freigabe 
<smbconfsection>[print$]</smbconfsection> mit APW oder <command>rpcclient</command> benötigt werden.
</para>

<para>
Das Generieren und Einstellen eines ersten gültigen Device-Modus erfordert jedoch
einige Kitzelei auf dem Client, um ihn auf dem Samba-Server zu setzen.
Die einfachste Art, das zu tun, besteht darin, die Papierausrichtung auf dem Drucker
des Servers zu ändern. Dabei wird genug vom Druckertreiberprogramm auf dem Client
ausgeführt, damit der gewünschte Effekt eintritt und der neue Device-Modus auf 
unserem Samba-Server eingestellt wird. Dazu können Sie die Seite <guilabel>Druckereigenschaften</guilabel>
von Windows NT/200x/XP auf einem Windows-Client benutzen:
</para>

<procedure>
	<step><para>
	Stöbern Sie in der <guiicon>Netzwerkumgebung.</guiicon>
	</para></step>

	<step><para>
	Finden Sie den Samba-Server.
	</para></step>

	<step><para>
	Öffnen Sie den Ordner <guiicon>Drucker und Faxgeräte</guiicon> des 
	Samba-Servers.
	</para></step>

	<step><para>
	Selektieren Sie den entsprechenden freigegebenen Drucker.
	</para></step>

	<step><para>
	Führen Sie einen Rechtsklick auf dem Drucker aus (wenn Sie die 
	Beschreibung im letzten Abschnitt befolgt haben, sind Sie eventuell 
	schon hier).
	</para></step>

	<step><para>
	Selektieren Sie unten im Kontextmenü <guimenu>Eigenschaften</guimenu> 
	(wenn das Menü weiter oben noch den Eintrag 
	<guimenuitem>Verbinden</guimenuitem> zeigt, müssen Sie zuerst darauf klicken,
	um die Treiberinstallation so durchzuführen, wie im letzten Abschnitt
	gezeigt).
	</para></step>

	<step><para>
	Klicken Sie auf den Reiter <guilabel>Erweitert</guilabel>, dann auf
	<guibutton>Standardwerte</guibutton>.
	</para></step>

	<step><para>
	Ändern Sie die Seiteneinstellungen für 
	<guimenuitem>Hochformat</guimenuitem> auf 
	<guimenuitem>Querformat</guimenuitem> (und zurück).
	</para></step>

	<step><para>
	Vergewissern Sie sich, dass Sie die Änderungen zwischen dem Umschalten
	der Seitenausrichtung auch anwenden, damit die Änderung auch wirksam
	wird.
	</para></step>

	<step><para>
	Wenn Sie schon dabei sind, möchten Sie hier eventuell auch die gewünschten 
	Druckvoreinstellungen setzen, die dann bei allen zukünftigen
	Treiberinstallationen auf den verbleibenden Clients angewendet werden.
	</para></step>
</procedure>

<para>
Diese Prozedur hat das Druckertreiberprogramm auf der Client-Plattform ausgeführt 
und den korrekten Device-Modus an Samba zurückgegeben, das ihn nun in seinen 
TDB-Dateien gespeichert hat. Nachdem der Treiber einmal auf dem Client installiert
ist, können Sie analoge Schritte befolgen und auf den <emphasis>lokalen</emphasis>
Ordner <guiicon>Drucker</guiicon> ebenfalls zugreifen, sofern Sie ein 
printer admin-Benutzer von Samba sind. Von nun an sollte das Drucken wie erwartet
funktionieren.
</para>

<para>
Samba verfügt auf der Serviceebene über einen Parameter namens 
<parameter>default devmode</parameter> zum Generieren eines Standard-Device-Modus für einen Drucker. Manche Treiber funktionieren gut mit Sambas
Standardeigenschaften, andere können eventuell den Spooling-Dienst des Clients
zum Absturz bringen. Daher sollten Sie diesen Parameter mit Vorsicht verwenden.
Es ist immer besser, den Client einen gültigen Device-Modus für den Drucker
erstellen zu lassen und für Sie auf dem Server zu speichern.
</para>
</sect2>

<sect2>
<title>Installation weiterer Client-Treiber</title>

<para>
Jeder weiterer Treiber kann wie oben beschrieben installiert werden: im 
Netzwerk stöbern, den Ordner <guiicon>Drucker</guiicon> auf dem Samba-Server
öffnen, auf <guiicon>Drucker</guiicon> rechts-klicken und 
<guimenuitem>Verbinden...</guimenuitem> auswählen. Sobald das fertig ist 
(es sollte nicht länger als ein paar Sekunden dauern, kann aber je nach 
Netzwerkverhältnissen auch eine Minute dauern), sollten Sie den neuen Drucker
im lokalen Ordner <guiicon>Drucker und Faxgeräte</guiicon> Ihrer 
Client-Workstation finden.
</para>

<para>
Ihren lokalen Ordner <guiicon>Drucker und Faxgeräte</guiicon> können Sie auf 
Windows 200x/XP Professional-Workstations auch mit dem folgenden Befehl öffnen:
</para>

<para><userinput>rundll32 shell32.dll,SHHelpShortcuts_RunDLL PrintersFolder</userinput></para>

<para>
oder mit diesem Befehl auf Windows NT 4.0-Workstations:
</para>

<para><userinput>
rundll32 shell32.dll,Control_RunDLL MAIN.CPL @2
</userinput></para>

<para>
Sie können diese Befehle entweder in einer <guilabel>DOS-Shell</guilabel> 
eingeben oder im Feld <guimenuitem>Ausführen...</guimenuitem>
des <guimenu>Start</guimenu>-Menüs.
</para>
</sect2>

<sect2>
<title>Erste Client-Verbindung immer als root oder <quote>printer admin</quote> herstellen</title>

<para>
Nachdem Sie den Treiber auf dem Samba-Server installiert haben (in dessen
Freigabe <smbconfsection>[print$]</smbconfsection>, sollten Sie immer sichergehen,
dass Ihre erste Client-Installation korrekt beendet wurde. Machen Sie es sich zur
Gewohnheit, die allererste Verbindung von einem Client als
<smbconfoption><name>printer admin</name></smbconfoption> zu machen. Damit wird
Folgendes garantiert:
</para>

<itemizedlist>
	<listitem><para>
	Ein erster gültiger <emphasis>Device-Modus</emphasis> wird tatsächlich
	initialisiert (siehe oben für erklärende Details).
	</para></listitem>

	<listitem><para>	
	Die Standarddruckeinstellungen Ihres Druckers sind für alle weiteren 
	Client-Installationen so, wie Sie es wünschen.
	</para></listitem>
</itemizedlist>

<para>
Tun Sie dies durch eine Änderung der Papierausrichtung auf Querformat, klicken
Sie auf <guiicon>Anwenden</guiicon>, und machen Sie die Einstellung anschließend wieder
rückgängig. Als Nächstes ändern Sie die anderen Einstellungen (Sie wollen z.B. die
Standardpapiergröße nicht auf <guiicon>Letter</guiicon> setzen, wenn Sie immer
<guiicon>A4</guiicon> benutzen, oder? Vielleicht möchten Sie den Drucker
standardmäßig <guiicon>duplex</guiicon> drucken lassen usw.).
</para>

<para>
Probieren Sie folgenden Befehl beim Prompt einer Windows 200x/XP-DOS-Shell aus, 
um sich als root mit einem Samba-Drucker zu verbinden:
</para>

<para><screen>
&dosprompt;<userinput>runas /netonly /user:root "rundll32 printui.dll,PrintUIEntry /p /t3 /n 
	\\<replaceable>SAMBA-SERVER</replaceable>\<replaceable>printername</replaceable>"</userinput>
</screen>
</para>

<para>
Sie werden nun nach dem Samba-Passwort von root gefragt. Geben Sie es ein, warten
Sie einige Sekunden, klicken Sie auf <guibutton>Standardwerte</guibutton>,
und fahren Sie mit der Einstellung der Standardoptionen für Druckaufträge fort,
die von allen Clients benutzt werden sollen. Alternativ zu root können Sie ein 
anderes Mitglied von <smbconfoption><name>printer admin</name></smbconfoption> 
angeben.
</para>

<para>
Nun haben alle anderen Benutzer, die den Treiber auf die gleiche Weise (genannt
<quote>Point'n'Print</quote>) herunterladen und installieren, dieselben 
voreingestellten Werte dafür. Wenn Sie diesen Schritt auslassen, wird Ihre
Telefonauskunft eine Menge Anrufe von Ihren Benutzern bekommen, aber vielleicht
lieben Sie es ja auch, mit diesen zu sprechen.
</para>
</sect2>
</sect1>

<sect1>
<title>Andere Fallstricke</title>

<para>
Ihr Treiber ist installiert und bereit für die Installation per Point'n'Print durch
die Clients. Vielleicht haben Sie versucht, ihn auf Ihrem ersten Client-Rechner
herunterzuladen und zu benutzen, aber warten Sie noch. Stellen wir erst sicher,
dass Sie mit ein paar Tipps und Tricks vertraut sind, die eventuell hilfreich 
für Sie sein werden. Nehmen wir z.B. an, Sie haben auf dem Drucker keine 
Standardwerte eingestellt, wie es Ihnen in den vorherigen Absätzen geraten wurde. 
Ihre Benutzer beklagen sich über verschiedene Probleme, z.B. 
<quote>Wir müssen für jeden Druckauftrag die Papiergröße von Letter auf A4 
umstellen, und das wird nicht gespeichert.</quote>)
</para>

<sect2>
<title>Standarddruckeroptionen für Client-Treiber einstellen</title>

<para>
Der letzte Satz mag von einigen Benutzern und Admins mit gemischten Gefühlen
betrachtet werden. Sie haben stundenlang gekämpft und es nicht geschafft, an
einen Punkt zu kommen, an dem ihre Einstellungen anscheinend gespeichert 
werden. Es ist nicht deren Schuld. Das Verwirrende ist, dass Sie in dem Dialogfeld
mit mehreren Reitern, das nach einem Rechtsklick auf dem Druckernamen und der
Auswahl von <guimenuitem>Eigenschaften</guimenuitem> erscheint, zu
zwei scheinbar identischen Dialogfeldern gelangen können, die beide behaupten,
Ihnen zu helfen, Druckereigenschaften auf dreierlei Art einzustellen. 
Hier ist die definitive Antwort zu dieser FAQ über die 
Samba-Standarddruckereinstellungen:
</para>

<formalpara><title><quote>Ich kann für alle Benutzer von Windows 200x/XP 
keine Standarddruckoptionen einstellen und speichern. Warum nicht?</quote></title>

<para>
Wie haben Sie es versucht? Ich wette, auf die falsche Art. (Aber es ist nicht
leicht, das herauszufinden). Es gibt drei verschiedene Wege, auf denen Sie zu 
einem Dialogfeld gelangen, das scheinbar alles einstellt. Alle drei Dialogfelder 
sehen gleich aus, aber nur eines davon tut das, was Sie möchten. Um dies für
alle Benutzer zu machen, müssen Sie Administrator oder Print Administrator
sein. Auf folgende Weise kann ich es unter XP Professional reproduzieren:
</para>

<orderedlist numeration="upperalpha">
	<listitem><para>Der erste <quote>falsche</quote> Weg:
	<orderedlist numeration="arabic">
		<listitem><para>Öffnen Sie den Ordner <guiicon>Drucker</guiicon>.</para></listitem>

		<listitem><para>Führen Sie einen Rechtsklick auf dem Drucker 
		aus (<emphasis>entfernterdrucker(((Schreibweise okay so?))) auf cupshost</emphasis>), und
		wählen Sie im Kontextmenü <guimenu>Druckereinstellungen...</guimenu>
		aus.</para></listitem>

		<listitem><para>Sehen Sie sich dieses Dialogfeld genau an, 
		und prägen Sie sich ein, wie es aussieht.</para></listitem>
	</orderedlist></para></listitem>

	<listitem><para>Der zweite <quote>falsche</quote> Weg:
	<orderedlist numeration="arabic">
		<listitem><para>Öffnen Sie den Ordner 
		<guimenu>Drucker</guimenu>.</para></listitem>

		<listitem><para>Führen Sie einen Rechtsklick auf dem Drucker 
		aus (<emphasis>entfernterdrucker(((s.o.))) auf cupshost</emphasis>), und
		wählen Sie im Kontextmenü <guimenu>Einstellungen</guimenu>
		aus.</para></listitem>.

		<listitem><para>Klicken Sie auf den Reiter <guilabel>Allgemein</guilabel>
		tab</para></listitem>.

		<listitem><para>Klicken Sie auf 
		<guibutton>Druckereigenschaften...</guibutton></para></listitem>.

		<listitem><para>Ein neues Dialogfeld wird geöffnet. Halten Sie es
		geöffnet, und gehen Sie zurück zu seinem 
		Elterndialogfeld.</para></listitem>
	</orderedlist></para></listitem>

	<listitem><para>
	Der dritte und korrekte Weg: (Sollten Sie das von Anfang an tun, 
	führen Sie einfach die Schritte 1 und 2 aus der obigen zweiten 
	Methode aus).
	</para>

	<orderedlist numeration="arabic">
		<listitem><para>Klicken Sie auf den Reiter <guilabel>Erweitert</guilabel>.
		(Falls alles <quote>grau hinterlegt</quote> ist, so sind Sie nicht
		als Benutzer mit ausreichenden Rechten angemeldet.)</para></listitem>

		<listitem><para>Klicken Sie auf 
		<guibutton>Standardwerte</guibutton>.</para></listitem>

		<listitem><para>Klicken Sie auf einem beliebigen der beiden neuen
		Reiter auf den Button <guilabel>Erweitert</guilabel>.</para></listitem>

		<listitem><para>Ein neues Dialogfeld wird geöffnet. Vergleichen Sie
		dieses mit dem anderen. Sehen Sie gleich aus, wenn Sie das eine aus
		<quote>B.5</quote> mit dem aus <quote>A.3</quote> 
		vergleichen?</para></listitem>
	</orderedlist>
	</listitem>
</orderedlist>

<para>
Sehen Sie irgendeinen Unterschied in den beiden Dialogfeldern? Ich auch nicht.
Aber nur im letzten, zu dem Sie mit den Schritten C.1 bis 6 gelangt sind, werden
Einstellungen permanent gespeichert und werden daher zu Vorgabewerten bei neuen
Benutzern. Wenn Sie möchten, dass diese Vorgabewerte für alle Clients gleich sind, 
müssen Sie diese Schritte als Administrator 
(<smbconfoption><name>printer admin</name></smbconfoption> in &smb.conf;) ausführen, bevor
ein Client den Treiber herunterlädt (später können die Clients ihre eigenen 
benutzerspezifischen Vorgabewerte mit Hilfe der obigen Prozeduren A oder B 
einstellen). Windows 200x/XP erlaubt benutzerspezifische Vorgabewerte und solche,
die die Rechner vom Administrator erhalten, bevor die Benutzer ihre eigenen Werte einstellen. 
Die Dialogfelder, die diesen identisch aussehenden Dialogfeldern vorausgehen, 
unterscheiden sich geringfügig in den Namen ihrer Fenster: eines heißt 
<computeroutput>Default Print Values for 
Printer Foo on Server Bar</computeroutput>(((???))) 
(das ist das Fenster, das Sie benötigen), und ein anderes heißt 
<quote><computeroutput>Print Settings for 
Printer Foo on Server Bar</computeroutput></quote>(((???))). 
Zu letzterem gelangen Sie, wenn Sie auf den Drucker rechts-klicken 
und <guimenuitem>Druckereinstellungen...</guimenuitem> auswählen. Weil man Ihnen
zur Zeit von Windows NT gesagt hat, Sie sollten dieses Fenster benutzen, ist es 
nur natürlich, es unter Windows 200x/XP genauso auszuprobieren. Man würde nicht
im Traum daran denken, dass man nun einen anderen Weg gehen muss, um zu einem
identisch aussehenden, aber funktional verschiedenen Dialogfeld zu gelangen,
um Vorgabewerte für alle Benutzer zu setzen.
</para></formalpara>

<tip><para>Versuchen Sie (unter Windows 200x/XP), diesen Befehl auszuführen
(als Benutzer mit den nötigen Rechten):
</para>

<para><userinput>
rundll32 printui.dll,PrintUIEntry /p /t3 /n\\<replaceable>SAMBA-SERVER</replaceable>\<replaceable>printersharename</replaceable>
</userinput></para>

<para>
Um den Reiter mit dem Knopf <guilabel>Standardwerte</guilabel> zu sehen 
(den Sie benötigen), führen Sie auch diesen Befehl aus:
</para>

<para><userinput>
rundll32 printui.dll,PrintUIEntry /p /t0 /n\\<replaceable>SAMBA-SERVER</replaceable>\<replaceable>printersharename</replaceable>
</userinput></para>

<para>
Um den Reiter mit dem Button <guilabel>Printing Preferences</guilabel>
zu sehen (derjenige, der keine systemweiten Vorgabewerte setzt), können 
Sie die Befehle aus einer DOS-Shell oder mit <guimenu>Start</guimenu> ->
<guimenuitem>Ausführen</guimenuitem> ausführen.
</para>
</tip>

</sect2>

<sect2>
<title>Unterstützung einer großen Anzahl von Druckern</title>

<para>
Während der letzten Entwicklungsphase von Samba ist ein Problem aufgetaucht,
das die Unterstützung beim Herunterladen von Treibern für Hunderte von Druckern
betrifft. Den APW in Windows NT dafür zu benutzen ist, gelinde gesagt, ein wenig
umständlich. Wenn Sie sich keine Sehnenscheidenentzündung allein von der Klick-Orgie bei der 
Druckerinstallation holen möchten, müssen Sie über ein nicht-interaktives Skript
nachdenken.
</para>

<para>
Wenn mehr als ein Drucker den gleichen Treiber verwendet, kann man den Befehl
<command>rpcclient setdriver</command> benutzen, um den mit einer Druckerschlage
verbundenen Treiber zu setzen. Wenn der Treiber einmal nach
<smbconfsection>[print$]</smbconfsection> hochgeladen und in den Drucker-TDBs
registriert ist, kann er von mehreren Druckerschlangen verwendet werden. In 
diesem Fall müssen Sie nur den Unterbefehl <command>setprinter</command> von
<command>rpcclient</command> bei jeder Schlange wiederholen (ohne, dass Sie 
<command>adddriver</command> wiederholt ausführen müssen). Das Folgende ist ein Beispiel
dafür, wie man das machen kann:
</para>

<para><screen>
&rootprompt;<userinput>rpcclient <replaceable>SAMBA-CUPS</replaceable> -U root%<replaceable>secret</replaceable> -c 'enumdrivers'</userinput>
 cmd = enumdrivers
 
 [Windows NT x86]
 Printer Driver Info 1:
   Driver Name: [infotec  IS 2075 PCL 6]
 
 Printer Driver Info 1:
   Driver Name: [DANKA InfoStream]
 
 Printer Driver Info 1:
   Driver Name: [Heidelberg Digimaster 9110 (PS)]
 
 Printer Driver Info 1:
   Driver Name: [dm9110]

 Printer Driver Info 1:
   Driver Name: [mydrivername]

 [....]
</screen>

<screen>
&rootprompt;<userinput>rpcclient <replaceable>SAMBA-CUPS</replaceable> -U root%<replaceable>secret</replaceable> -c 'enumprinters'</userinput>
 cmd = enumprinters
   flags:[0x800000]
   name:[\\SAMBA-CUPS\dm9110]
   description:[\\SAMBA-CUPS\dm9110,,110ppm HiVolume DANKA Stuttgart]
   comment:[110 ppm HiVolume DANKA Stuttgart]
 [....]
</screen>

<screen>
&rootprompt;<userinput>rpcclient <replaceable>SAMBA-CUPS</replaceable> -U root%<replaceable>secret</replaceable> -c \
  'setdriver <replaceable>dm9110</replaceable> "<replaceable>Heidelberg Digimaster 9110 (PS)</replaceable>"'</userinput>
 cmd = setdriver dm9110 Heidelberg Digimaster 9110 (PPD)
 Successfully set dm9110 to driver Heidelberg Digimaster 9110 (PS).
</screen>

<screen>
&rootprompt;<userinput>rpcclient <replaceable>SAMBA-CUPS</replaceable> -U root%<replaceable>secret</replaceable> -c 'enumprinters'</userinput>
 cmd = enumprinters
   flags:[0x800000]
   name:[\\SAMBA-CUPS\dm9110]
   description:[\\SAMBA-CUPS\dm9110,Heidelberg Digimaster 9110 (PS),\
     110ppm HiVolume DANKA Stuttgart]
   comment:[110ppm HiVolume DANKA Stuttgart]
 [....]
</screen>

<screen>
&rootprompt;<userinput>rpcclient <replaceable>SAMBA-CUPS</replaceable> -U root%<replaceable>secret</replaceable> -c 'setdriver <replaceable>dm9110</replaceable> <replaceable>mydrivername</replaceable>'</userinput>
 cmd = setdriver dm9110 mydrivername
 Successfully set dm9110 to mydrivername.
</screen>

<screen>
&rootprompt;<userinput>rpcclient <replaceable>SAMBA-CUPS</replaceable> -U root%<replaceable>secret</replaceable> -c 'enumprinters'</userinput>
 cmd = enumprinters
   flags:[0x800000]
   name:[\\SAMBA-CUPS\dm9110]
   description:[\\SAMBA-CUPS\dm9110,mydrivername,\
     110ppm HiVolume DANKA Stuttgart]
   comment:[110ppm HiVolume DANKA Stuttgart]
 [....]
</screen></para>

<para>
Es ist vielleicht nicht so einfach festzustellen, dass der erste Aufruf von
<command>enumprinters</command> den Drucker <quote>dm9110</quote> mit einem
leeren String angezeigt hat, wo der Treiber aufgeführt sein sollte (zwischen
den zwei Kommas im Beschreibungsfeld). Nachdem der Befehl 
<command>setdriver</command> ausgeführt wurde, ist alles in Ordnung.
</para>
</sect2>

<sect2>
<title>Neue Drucker mit dem Windows NT-APW hinzufügen</title>

<para>
Standardmäßig zeigt Samba im Ordner <guiicon>Drucker</guiicon> alle 
Druckerfreigaben an, die in &smb.conf; definiert sind. Außerdem befindet
sich in diesem Ordner das Icon für den Assistent für die Druckerinstallation 
in Windows NT. Der APW wird nur dann gezeigt, wenn:
</para>

<itemizedlist>
	<listitem><para>
	Der verbundene Benutzer erfolgreich ein 
	<command>OpenPrinterEx(\\server)</command> mit Administratorrechten, d.h. 
	als root oder <smbconfoption><name>printer admin</name></smbconfoption>,
	ausführen kann.
	</para>

	<tip><para>Versuchen Sie Folgendes beim Prompt einer DOS-Shell 
	unter Windows 200x/XP:
	</para>

	<para><userinput>
	runas /netonly /user:root rundll32 printui.dll,PrintUIEntry /p /t0 /n \\<replaceable>SAMBA-SERVER</replaceable>\<replaceable>printersharename</replaceable>
	</userinput></para>

	<para>
	Klicken Sie auf <guibutton>Druckereinstellungen</guibutton>.
	</para></tip></listitem>

	<listitem><para>... die Einstellung
	<smbconfoption><name>show add printer wizard</name><value>yes</value></smbconfoption> enthält (das ist der Vorgabewert).</para></listitem>
</itemizedlist>

<para>
Der APW kann verschiedene Dinge erledigen:
</para>

<itemizedlist>
	<listitem><para>
	Einen Treiber auf der Freigabe <smbconfsection>[print$]</smbconfsection>
	von Samba hochladen.
	</para></listitem>

	<listitem><para>
	Einen hochgeladenen Treiber mit einer vorhandenen (noch treiberlosen) 
	Druckerschlange verbinden.
	</para></listitem>

	<listitem><para>
	Den aktuell verwendeten Treiber für eine vorhandene
	Druckerschlange durch einen zuvor hochgeladenen Treiber ersetzen.
	</para></listitem>

	<listitem><para>
	Einen völlig neuen Drucker auf dem Samba-Host hinzufügen (nur in 
	Verbindung mit einem funktionierenden 
	<smbconfoption><name>add printer command</name></smbconfoption>. 
	Ein entsprechendes
	<smbconfoption><name>delete printer command</name></smbconfoption> 
	zum Entfernen von Einträgen aus dem Ordner
	<guiicon>Drucker</guiicon> wird eventuell auch angeboten).
	</para></listitem>
</itemizedlist>

<para>
Für den letzten Punkt, einen neuen Drucker hinzuzufügen, ist mehr Aufwand nötig 
als für die anderen. Um mit dem APW einen Drucker zu einem 
Samba-Server erfolgreich hinzufügen zu können, muss für  
<smbconfoption><name>add printer command</name></smbconfoption> ein Wert
definiert sein. Das Programm muss den Drucker mittels eines so genannten <quote>hooks</quote>
erfolgreich ins 
UNIX-Drucksystem einhängen (d.h. in die Dateien 
<filename>/etc/printcap</filename>, <filename>/etc/cups/printers.conf</filename> 
oder andere entsprechende Dateien) sowie in &smb.conf;, falls nötig.
</para>

<para>
Wenn Sie APW auf einem Client benutzen und die genannte Druckerfreigabe nicht 
existiert, wird smbd <smbconfoption><name>add printer command</name></smbconfoption> 
ausführen und versuchen, die neue Druckerfreigabe zu finden. Wenn die Freigabe
weiterhin nicht definiert ist, wird ein Fehler namens  
<errorname>Access Denied</errorname> an den Client zurückgegeben. 
<smbconfoption><name>add printer command</name></smbconfoption> wird im Kontext 
des verbundenen Benutzers ausgeführt, was nicht notwendigerweise der von root ist. 
Mit <smbconfoption><name>map to guest</name><value>bad user</value></smbconfoption>
wurden Sie vielleicht unabsichtlich mit den falschen Rechten verbunden. Sie sollten
das mit dem Befehl <command>smbstatus</command> überprüfen.
</para>

</sect2>

<sect2>
<title>Fehlermeldung: <quote><errorname>Cannot connect under a different Name</errorname></quote></title>

<para>
Wenn Sie erst einmal mit den falschen Angaben verbunden sind, gibt es keine 
andere Möglichkeit, die Situation zu ändern, als alle Explorer-Fenster zu 
schließen und vielleicht einen Neustart durchzuführen.
</para>

<itemizedlist>
	<listitem><para>
	Der Befehl <command>net use \\SAMBA-SERVER\sharename /user:root</command>
	gibt Ihnen folgende Fehlermeldung:
	<quote>Multiple connections to a server or a shared resource by the 
	same user utilizing the several user names are not allowed. Disconnect 
	all previous connections to the server, esp. the shared resource, 
	and try again.</quote>
	</para></listitem>

	<listitem><para>
	Jeder Versuch einer <quote>Verbindung eines Netzwerklaufwerks</quote> von
	<filename>\\SAMBASERVER\\print$</filename> mit <constant>z:</constant> 
	wird mit dieser hartnäckigen Meldung quittiert: <quote>This network 
	folder is currently connected under different credentials (username 
	and password). Disconnect first any existing connection to this network 
	share in order to connect again under a different username and 
	password</quote>.
	</para></listitem>
</itemizedlist>

<para>
Also beenden Sie alle Verbindungen. Sie versuchen es erneut. Wieder erhalten
Sie die gleiche Meldung. Sie überprüfen die Einstellungen auf der Seite von Samba mit dem Befehl
<command>smbstatus</command>. Ja, es gibt weitere Verbindungen. Sie terminieren
sie alle. Der Client gibt Ihnen weiterhin die gleiche Fehlermeldung aus. Sie
sehen sich die Datei smbd.log mit einem hohen Debug-Level an und versuchen eine
neue Verbindung: die gleiche Fehlermeldung, aber keine einzige Zeile in der 
Log-Datei. Sie beginnen sich zu fragen, ob es überhaupt einen Verbindungsversuch
gab. Sie führen <command>ethereal</command> und <command>tcpdump</command> aus, während Sie einen neuen 
Verbindungsversuch starten. Ergebnis: Kein einziges Byte wird übertragen. 
Windows gibt immer noch die Fehlermeldung aus. Sie schließen alle Explorer-Fenster 
und starten es neu. Sie versuchen eine Verbindung zu &smbmdash; und dieses Mal
funktioniert es! Anscheinend speichert Windows irgendwo Verbindungsinformationen
zwischen, ohne diese zu aktualisieren (und wenn Sie Pech haben, müssen Sie einen
Neustart durchführen, um die Fehlermeldung loszuwerden).
</para>

<para>
Die einfachste Art, alle Verbindungen von Ihrem Client zu einem Server gewaltsam 
zu terminieren, besteht im Ausführen von:
<screen>
&dosprompt; net use * /delete
</screen>
Dadurch werden auch alle abgebildeten Laufwerke getrennt, so dass Sie neue
Verbindungen nach Bedarf erstellen können.
</para>
</sect2>

<sect2>
<title>Passen Sie beim Zusammenstellen von Treiberdateien auf</title>

<para>
Sie müssen extrem vorsichtig ein, wenn Sie sich Notizen zu den Dateien machen,
die zu einem bestimmten Treiber gehören. Verwechseln Sie nicht die Dateien für
die Treiberversion <quote>0</quote> (für Windows 9x/Me gehen diese nach
<filename>[print$]/WIN/0/</filename>), Treiberversion <filename>2</filename> 
(Kernel-Modus-Treiber für Windows NT, die nach 
<filename>[print$]/W32X86/2/</filename> gehen und eventuell auch unter Windows 
200x/XP benutzt werden können) und Treiberversion <quote>3</quote> 
(Nicht-Kernel-Modus-Treiber unter <filename>[print$]/W32X86/3/</filename>,
können nicht unter Windows NT benutzt werden). Diese verschiedenen 
Treiberversionen enthalten recht oft Dateien, die den gleichen Namen haben, 
aber sehr verschieden sind. Wenn Sie diese im Windows Explorer betrachten
(Sie finden sie in <filename>%WINDOWS%\system32\spool\drivers\W32X86\</filename>),
sehen Sie wahrscheinlich Namen in Großbuchstaben, während der Befehl
<command>enumdrivers</command> aus Samba große und kleine oder nur kleine
Buchstaben anzeigen würde. Daher ist es leicht, sie zu verwechseln. Wenn Sie sie
manuell mit <command>rpcclient</command> und dessen Unterbefehlen installieren, 
bekommen Sie vielleicht nicht einmal eine Fehlermeldung. Erst bei der späteren
Installation auf einem Client werden Sie Fehlermeldungen wie
<computeroutput>This server has no appropriate driver for the 
printer</computeroutput> fnden.
</para>

<para>
Hier ist ein Beispiel. Sie sollten sich die verschiedenen Dateien sehr genau
anschauen und ihre Namen und Schreibweise vergleichen, um die Unterschiede
in der Zusammensetzung von Version 2 und 3 der zwei Sätze zu bemerken. 
Man beachte: Da Version 0 des Satzes 40 <parameter>Dependentfiles</parameter>
enthielt, habe ich diese aus Platzgründen ausgelassen:
</para>

<para><screen>
&rootprompt;<userinput>rpcclient -U 'Administrator%<replaceable>secret</replaceable>' -c 'enumdrivers 3' 10.160.50.8 </userinput>

 Printer Driver Info 3:
         Version: [3]
         Driver Name: [Canon iR8500 PS3]
         Architecture: [Windows NT x86]
         Driver Path: [\\10.160.50.8\print$\W32X86\3\cns3g.dll]
         Datafile: [\\10.160.50.8\print$\W32X86\3\iR8500sg.xpd]
         Configfile: [\\10.160.50.8\print$\W32X86\3\cns3gui.dll]
         Helpfile: [\\10.160.50.8\print$\W32X86\3\cns3g.hlp]
 
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\aucplmNT.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\ucs32p.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\tnl32.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\aussdrv.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cnspdc.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\aussapi.dat]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cns3407.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\CnS3G.cnt]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\NBAPI.DLL]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\NBIPC.DLL]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcview.exe]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcdspl.exe]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcedit.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcqm.exe]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcspl.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cfine32.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcr407.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\Cpcqm407.hlp]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cpcqm407.cnt]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\3\cns3ggr.dll]
 
         Monitorname: []
         Defaultdatatype: []

 Printer Driver Info 3:
         Version: [2]
         Driver Name: [Canon iR5000-6000 PS3]
         Architecture: [Windows NT x86]
         Driver Path: [\\10.160.50.8\print$\W32X86\2\cns3g.dll]
         Datafile: [\\10.160.50.8\print$\W32X86\2\IR5000sg.xpd]
         Configfile: [\\10.160.50.8\print$\W32X86\2\cns3gui.dll]
         Helpfile: [\\10.160.50.8\print$\W32X86\2\cns3g.hlp]
 
         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\AUCPLMNT.DLL]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\aussdrv.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\cnspdc.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\aussapi.dat]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\cns3407.dll]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\CnS3G.cnt]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\NBAPI.DLL]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\NBIPC.DLL]
         Dependentfiles: [\\10.160.50.8\print$\W32X86\2\cns3gum.dll]
 
         Monitorname: [CPCA Language Monitor2]
         Defaultdatatype: []

</screen></para>

<para>
Wenn wir die Dateien der <quote>Version 2</quote> und der <quote>Version 3</quote>
in verschiedene Textdateien schreiben und das Ergebnis vergleichen, erhalten wir 
folgendes Bild:
</para>

<para><screen>
&rootprompt;<userinput>sdiff 2-files 3-files</userinput>

<![CDATA[
 cns3g.dll                     cns3g.dll
 iR8500sg.xpd                  iR8500sg.xpd
 cns3gui.dll                   cns3gui.dll
 cns3g.hlp                     cns3g.hlp
 AUCPLMNT.DLL                | aucplmNT.dll
                             > ucs32p.dll
                             > tnl32.dll
 aussdrv.dll                   aussdrv.dll
 cnspdc.dll                    cnspdc.dll
 aussapi.dat                   aussapi.dat
 cns3407.dll                   cns3407.dll
 CnS3G.cnt                     CnS3G.cnt
 NBAPI.DLL                     NBAPI.DLL
 NBIPC.DLL                     NBIPC.DLL
 cns3gum.dll                 | cpcview.exe
                             > cpcdspl.exe 
                             > cpcqm.exe
                             > cpcspl.dll
                             > cfine32.dll
                             > cpcr407.dll
                             > Cpcqm407.hlp
                             > cpcqm407.cnt
                             > cns3ggr.dll
]]>
</screen>

Lassen Sie sich nicht foppen! Treiberdateien mit identischen Namen für jede 
Version können sich inhaltlich unterscheiden, wie Sie aus diesem Größenvergleich
erkennen können:
</para>

<para><screen>
&rootprompt;<userinput>for i in cns3g.hlp cns3gui.dll cns3g.dll; do                  \
           smbclient //10.160.50.8/print\$ -U 'Administrator%xxxx' \
           -c "cd W32X86/3; dir $i; cd .. ; cd 2; dir $i";      \
		   done</userinput>

  CNS3G.HLP               A   122981  Thu May 30 02:31:00 2002
  CNS3G.HLP               A    99948  Thu May 30 02:31:00 2002

  CNS3GUI.DLL             A  1805824  Thu May 30 02:31:00 2002
  CNS3GUI.DLL             A  1785344  Thu May 30 02:31:00 2002

  CNS3G.DLL               A  1145088  Thu May 30 02:31:00 2002
  CNS3G.DLL               A    15872  Thu May 30 02:31:00 2002
</screen></para>

<para>
In meinem Beispiel gab es sogar noch mehr Unterschiede, als hier gezeigt werden.
Die Schlussfolgerung lautet: Sie müssen sehr vorsichtig sein, um die korrekten
Treiberdateien für jede Treiberversion auszuwählen. Verlassen Sie sich nicht
allein auf die Namen, und tauschen Sie keine Dateien aus, die zu verschiedenen
Treiberversionen gehören!
</para>
</sect2>

<sect2>
<title>Samba- und Drucker-Ports</title>

<para>
Windows NT/2000-Druckerserver verbinden mit jedem Drucker einen Port. Diese 
haben normalerweise die Form <filename>LPT1:</filename>, 
<filename>COM1:</filename>, <filename>FILE:</filename> usw. Samba muss das 
Konzept von Ports, die mit einem Drucker verbunden sind, ebenfalls unterstützen. 
Standardmäßig existiert auf einem System nur ein Drucker-Port namens 
<quote>Samba Printer Port</quote>. Um zu drucken, braucht Samba einen solchen
<quote>port</quote> nicht wirklich, er wird lediglich von Windows-Clients
benötigt. Diese bestehen darauf, dass man ihnen einen verfügbaren Port mitteilt,
wenn sie danach fragen, sonst erhalten Sie von ihnen eine Fehlermeldung. Daher 
fingiert Samba die Port-Informationen, damit Windows-Clients glücklich sind.
</para>

<para>
Auch das Konzept des <constant>Printer Poolings</constant> wird intern von 
Samba nicht unterstützt. Beim Printer Pooling wird ein logischer Drucker mit 
mehreren Ports für eine Art Lastausgleich oder Überlauf verbunden.
</para>

<para>
Wenn Sie aus dem einen oder anderen Grunde mehrere Ports definiert haben müssen 
(meine Benutzer und mein Chef sollten nicht wissen, dass sie mit Samba arbeiten), 
konfigurieren Sie <smbconfoption><name>enumports command</name></smbconfoption>,
mit dem ein externes Programm definiert werden kann, das eine Liste von Ports
auf einem System generieren kann.
</para>
</sect2>

<sect2>
<title>Wie Sie übliche Fehlkonfigurationen von Client-Treibern vermeiden</title>

<para>
Nun können Sie also ausdrucken, aber es gibt weiterhin noch Probleme. Die meisten
Druckaufträge werden prima ausgedruckt, einige werden aber gar nicht gedruckt. 
Manche Aufträge haben Probleme mit Fonts, die nicht gut aussehen. Manche Aufträge
werden sehr schnell gedruckt, andere extrem langsam. Wir können es nicht gänzlich
abhandeln, aber wir möchten Sie dazu ermuntern, den kurzen Absatz über 
<quote>Das Vermeiden von kritischen PostScript-Treiber-Einstellungen auf dem
Client</quote> in dem Kapitel über das Drucken mit CUPS zu lesen.
</para>
</sect2>
</sect1>

<sect1>
<title>Das Tool-Set Imprints</title>

<para>
Das Tool-Set namens Imprints bietet ein UNIX-Äquivalent des 
Assistenten für die Druckerinstallation
von Windows NT. Vollständige Informationen dazu entnehmen Sie bitte der Website
von <ulink url="http://imprints.sourceforge.net/">Imprints</ulink> wie auch der
Dokumentation, die in der Quelldistribution von Imprints enthalten ist. Dieser
Abschnitt enthält nur eine kurze Einführung zu den Möglichkeiten von Imprints.
</para>

<para>
Leider wird das Tool-Set Imprints nicht mehr weiter gepflegt. Seit Dezember 2000
sucht das Projekt einen neuen Leiter. Die wichtigsten Fähigkeiten dafür
sind Perl-Kenntnisse und Interesse am Drucken auf Basis von MS-RPC in Samba. 
Wenn Sie sich freiwillig melden möchten, koordinieren Sie das bitte auf der
technischen Mailingliste zu Samba. Das Tool-Set ist noch immer in einem 
benutzbaren Zustand, allerdings nur für eine Reihe älterer Druckermodelle, 
für die man vorbereitete Pakete benutzen kann. Wenn Imprints eine Zukunft haben
soll, dann werden Pakete auch für aktuellere Drucker benötigt.
</para>

<sect2>
<title>Was ist Imprints?</title>

<para>
Imprints ist eine Sammlung von Werkzeugen, die folgende Ziele unterstützen:
</para>

<itemizedlist>
	<listitem><para>
	Bereitstellen einer zentralen Informationsstelle für Druckertreiberpakete
	zu Windows NT und 95/98
	</para></listitem>

	<listitem><para>
	Bereitstellen der notwendigen Werkzeuge zum Erstellen von 
	Imprints-Druckertreiberpaketen
	</para></listitem>

	<listitem><para>
	Bereitstellen eines Installationsprogramms, das Druckertreiber von einer
	zentralen Internet- (oder Intranet-)Datenbank eines Imprints-Servers
	erhält und sie auf entfernten Samba- und Windows NT4-Druckerservern
	installiert
	</para></listitem>
</itemizedlist>
</sect2>

<sect2>
<title>Druckertreiberpakete erstellen</title>

<para>
Die Erstellung von Druckertreiberpaketen darzustellen 
übersteigt den Rahmen dieses Kapitels bei weitem (weitere Information darüber entnehmen Sie bitte
der Datei Imprints.txt in der Samba-Distribution). Ein Imprints-Treiberpaket 
ist, kurz gesagt, ein gzip-komprimiertes tar-Archiv mit den Treiberdateien, den
relevanten INF-Dateien sowie einer Steuerdatei, die das Installationsprogramm
benötigt.
</para>
</sect2>

<sect2>
<title>Der Imprints-Server</title>

<para>
Der Imprints-Server ist eigentlich ein Datenbankserver, der über standardisierte
HTTP-Mechanismen abgefragt werden kann. Zu jedem Druckereintrag in der Datenbank 
gehört eine URL für das eigentliche Herunterladen des Pakets. Jedes Paket ist 
mit Hilfe von GnuPG digital signiert, so dass man überprüfen kann, ob das 
heruntergeladene Paket wirklich dasjenige in der Imprints-Datenbank ist. Es wird
sehr empfohlen, diese Sicherheitsüberprüfung nicht zu deaktivieren.
</para>
</sect2>

<sect2>
<title>Das Installationsprogramm</title>

<para>
Weitergehende Informationen zum Imprints-Installationsprogramm finden Sie in 
der Dokumentationsdatei <filename>Imprints-Client-HOWTO.ps</filename>, die im
Imprints-Quellpaket enthalten ist. Das Imprints-Installationsprogramm gibt es
in zwei verschiedenen Ausführungen:
</para>

<itemizedlist>
	<listitem><para>Als eine Anzahl von Perl-Kommandozeilenskripten</para></listitem>
	<listitem><para>Als eine auf GTK+ basierende grafische Schnittstelle zu den 
Perl-Kommandozeilenskripten</para></listitem>
</itemizedlist>

<para>
Das Installationsprogramm bietet (in beiden Ausführungen) die Möglichkeit, den
Imprints-Datenbankserver nach einer Namensliste passender Druckermodelle 
abzufragen, ebenso wie die Möglichkeit, die Treiber auf entfernten Samba- und 
Windows NT-Druckerservern herunterzuladen und zu installieren.
</para>

<para>
Der grundlegende Installationsvorgang besteht aus vier Schritten, und der Perl-Code 
ist um &smbclient; und <command>rpcclient</command> herum aufgebaut.
</para>

<itemizedlist>
	<listitem><para>
	Für jede unterstützte Architektur eines gegebenen Druckers:
	<orderedlist>
		<listitem><para>rpcclient: Hole das passende Verzeichnis zum
		Hochladen auf dem entfernten Server.</para></listitem>
		<listitem><para>smbclient: Lade die Treiberdateien hoch.</para></listitem>
		<listitem><para>rpcclient: Setze ein AddPrinterDriver() MS-RPC ab.</para></listitem>
	</orderedlist>
	</para></listitem>

	<listitem><para>rpcclient: Setze ein AddPrinterEx() MS-RPC ab, um den 
	Drucker tatsächlich zu erstellen.</para></listitem>
</itemizedlist>

<para>
Eines der Probleme bei der Implementierung des Imprints-Tool-Sets bestand in den
Namensräumen zwischen verschiedenen unterstützten Client-Architekturen. 
Windows NT zum Beispiel enthält einen Treiber namens 
<quote>Apple LaserWriter II NTX v51.8</quote>, und Windows 95 nennt seine Version
dieses Treibers <quote>Apple LaserWriter II NTX</quote>.
</para>

<para>
Das Problem besteht darin zu wissen, welche Client-Treiber für einen Drucker
hochgeladen wurden Aufmerksame Leser werden sich erinnern, dass das Dialogfeld 
<guilabel>Druckereingeschaften</guilabel> in Windows NT nur Platz für den Namen eines
Druckertreibers enthält. Ein schneller Blick auf die System-Registry von 
Windows NT 4.0
</para>

<para><filename>
 HKLM\System\CurrentControlSet\Control\Print\Environment
</filename></para>

<para>
genügt, um festzustellen, dass Windows NT immer den NT-Treibernamen benutzt. 
Das ist in Ordnung, da Windows NT immer verlangt, dass mindestens die 
Windows NT-Version des Druckertreibers vorhanden ist. Samba verlangt das 
intern nicht, also: <quote>Wie kann man den NT-Treibernamen benutzen, falls 
er noch nicht installiert wurde?</quote>
</para>

<para>
Man umgeht diese Einschränkung dadurch, dass man verlangt, dass alle 
Imprints-Druckertreiberpakete sowohl für Intel Windows NT als auch für 95/98
Druckertreiber enthalten und dass der NT-Treiber als Erstes installiert wird.
</para>
</sect2>
</sect1>

<sect1>
<title>Netzwerkdrucker ohne Benutzerinteraktion hinzufügen</title>

<para>
Folgender Artikel aus der MS Knowledge-Base kann eventuell hilfreich sein, wenn Sie 
mit Clients unter Windows 2000 umgehen müssen: <emphasis>How to Add Printers with 
No User Interaction in Windows 2000,</emphasis> (<ulink
url="http://support.microsoft.com/default.aspx?scid=kb;en-us;189105">http://support.microsoft.com/default.aspx?scid=kb;en-us;189105</ulink>).
Er gilt auch für Clients unter Windows XP Professional.
Die in diesem Abschnitt skizzierten Ideen wurden von diesem Artikel inspiriert, 
der eine Methode auf der Kommandozeile beschreibt, mit der Netzwerk- und lokale
Drucker und ihre Treiber installiert werden können. Am nützlichsten ist sie, wenn
sie in Anmeldeskripten integriert wird. Welche Optionen verfügbar sind, können
Sie sehen, wenn Sie folgenden Befehl in einer <command>DOS-Shell</command> eingeben:
</para>

<para><userinput>rundll32 printui.dll,PrintUIEntry /?</userinput></para>

<para>
Es erscheint ein Fenster, das Ihnen alle verfügbaren Kommandozeilenschalter
anzeigt. Eine umfangreiche Beispielliste ist ebenfalls vorhanden. Das geht nur
bei Windows 200x/XP, aber nicht bei Windows NT. Windows NT verfügt vermutlich
über einige andere Werkzeuge im entsprechenden Resource Kit. Hier ist ein
Vorschlag dafür, was ein Client-Anmeldeskript enthalten könnte, mit einer kurzen
Erklärung dessen, was die Zeilen wirklich tun (es funktioniert, wenn Windows 
200x/XP-Clients über Samba auf Drucker zugreifen, und für Windows-basierte
Druckerserver funktioniert es auch):
</para>

<para><screen>
<userinput>rundll32 printui.dll,PrintUIEntry /dn /n "\\cupsserver\infotec2105-IPDS" /q</userinput>
<userinput>rundll32 printui.dll,PrintUIEntry /in /n "\\cupsserver\infotec2105-PS"</userinput>
<userinput>rundll32 printui.dll,PrintUIEntry /y /n "\\cupsserver\infotec2105-PS"</userinput>
</screen></para>

<para>
Dies ist eine Liste der verwendeten Kommandozeilen-Parameter: 
</para>

<variablelist>
	<varlistentry><term>/dn</term>
		<listitem><para>löscht einen Netzwerkdrucker.</para></listitem>
	</varlistentry>
	<varlistentry><term>/q</term>
		<listitem><para>stiller Modus.</para></listitem>
	</varlistentry>
	<varlistentry><term>/n</term>
		<listitem><para>benennt einen Drucker.</para></listitem>
	</varlistentry>
	<varlistentry><term>/in</term>
		<listitem><para>fügt eine Netzwerkdruckerverbindung hinzu.</para></listitem>
	</varlistentry>
	<varlistentry><term>/y</term>
		<listitem><para>stellt den Drucker als Standarddrucker ein.</para></listitem>
	</varlistentry>
</variablelist>

<itemizedlist>
	<listitem><para>
	Zeile 1 löscht einen vorher eventuell vorhandenen Netzwerkdrucker 
	<emphasis>infotec2105-IPDS</emphasis>
	(der native Windows-Treiber mit LPRng benutzt hatte, die vom Server entfernt
	wurden, als der Server auf CUPS umgestellt wurde). Das <command>/q</command> am Ende
	verhindert, dass Bestätigungs- oder Fehlerdialogfelder eingeblendet werden.
	Diese sollten bei einem Benutzer nicht erscheinen, der sich gerade anmeldet.
	</para></listitem>

	<listitem><para>	
	Zeile 2 fügt den neuen Drucker
	<emphasis>infotec2105-PS</emphasis> hinzu (der tatsächlich das gleiche
	physische Gerät ist, aber nun vom neuen CUPS-Drucksystem betrieben wird
	und mit den CUPS/Adobe-PS-Treibern verbunden ist). Der Drucker und sein
	Treiber müssen in Samba hinzugefügt worden sein, bevor der Benutzer sich 
	anmeldet (z.B. durch eine Prozedur, wie sie oben in diesem Kapitel 
	beschrieben wurde, oder durch die Ausführung von
	<command>cupsaddsmb</command>). Der Treiber wird nun automatisch 
	auf den Client-PC heruntergeladen, auf dem der Benutzer sich gerade
	anmeldet.
	</para></listitem>

	<listitem><para>
	Zeile 3 setzt den Standarddrucker auf diesen neuen Netzwerkdrucker (es
	mag mehrere andere auf die gleiche Art installierte Drucker geben, und 
	einige können auch lokal sein, daher haben wir uns für einen 
	Standarddrucker entschieden). Die Wahl des Standarddruckers darf 
	für verschiedene Benutzer natürlich unterschiedlich sein.
	</para></listitem>
</itemizedlist>

<para>
Die zweite Zeile funktioniert nur, wenn der Drucker 
<emphasis>infotec2105-PS</emphasis> eine bereits funktionierende Druckerschlange
auf dem <constant>cupsserver</constant> hat und wenn die Druckertreiber 
erfolgreich ins Treiber-Repository <smbconfsection>[print$]</smbconfsection> 
von Samba hochgeladen wurden (mit <command>APW</command>, 
<command>smbclient/rpcclient</command> oder <command>cupsaddsmb</command>). 
Manche Samba-Versionen vor der Version 3.0 verlangten nach der Druckerinstallation 
und dem Hochladen des Treibers einen Neustart von smbd, wenn das Skript 
(oder irgendein anderer Vorgang, bei dem ein Treiber heruntergeladen wurde) 
nicht versagen sollte.
</para>

<para>
Da es keine einfache Methode gibt, aus dem Anmeldeskript heraus zu testen, ob ein
installierter Netzwerkdrucker vorhanden ist, sollten Sie es erst gar nicht versuchen, sondern 
 die Deinstallation/Reinstallation jedes Mal gestatten, wenn ein Benutzer sich 
anmeldet. Es passiert sowieso sehr schnell (in 1 bis 2 Sekunden).
</para>

<para>
Weitere Vorteile hiervon sind:
</para>

<itemizedlist>
	<listitem><para>
	Alle Änderungen an den Standardeinstellungen des Druckers werden 
	automatisch bei jeder Benutzeranmeldung weitergegeben.
	</para></listitem>

	<listitem><para>
	Benutzer haben die gleichen Einstellungen auch bei der Anmeldung von
	verschiedenen Workstations in die Domäene (<quote>roaming</quote>).
	</para></listitem>
</itemizedlist>

<para>
Da Netzwerkdrucker pro Benutzer installiert werden, erleichtert es das ungemein, 
die Installation immer aktuell zu halten. Die wenigen zusätzlichen Sekunden 
bei der Anmeldung sind kaum bemerken. Drucker können nach Belieben auf dem 
Server zentral hinzugefügt, verändert und gelöscht werden, ohne dass auf den 
Clients ein Eingriff von Benutzerseite nötig wäre (Sie müssen lediglich die 
Anmeldeskripten aktualisieren).
</para>
</sect1>

<sect1>
<title>Der Befehl <command>addprinter</command></title>

<para>
Der Befehl <command>addprinter</command> kann so konfiguriert werden, dass er von
Samba als Shell-Skript oder als Programm ausgeführt wird. Er wird dann aufgerufen, 
wenn APW 
von einem Client auf dem Samba-Druckerserver ausgeführt wird. Der APW bittet den
Benutzer, mehrere Felder auszufüllen, z.B. Druckername, verwendeter Treiber, 
Kommentar, Port-Monitor usw. Diese Parameter werden vom APW an Samba weitergegeben.
Falls der Befehl <command>addprinter</command> so entworfen ist, dass er einen neuen Drucker erstellen
kann (dadurch, dass auf älteren Systemen korrekte printcap-Einträge geschrieben
werden oder auf moderneren Systemen der Befehl <command>lpadmin</command> 
ausgeführt wird) und die entsprechende Freigabe erstellen kann, dann erzeugt der 
APW in Samba und dem UNIX-Drucksubsystem tatsächlich einen neuen Drucker!
</para>
</sect1>

<sect1>
<title>Migration von klassischem Drucken zu Samba</title>

<para>
Die grundlegende NT-artige Druckertreiberverwaltung hat sich in Version 3.0 nicht
wesentlich gegenüber den Versionen 2.2.x verändert (abgesehen von vielen kleinen
Verbesserungen). Hier sollte die Migration sehr einfach sein, besonders, wenn Sie
den obigen Ratschlag befolgt haben, veraltete Parameter in Ihren Einstellungen
nicht mehr zu benutzen. Mehr Aufwand ist es bei der Migrationen einer vorhandenen
Einstellung unter 2.0.x oder wenn Sie in Ihren Samba 2.2-Installationen weiterhin 
auf die Art von Windows 9x/Me gedruckt haben. Lesen Sie bitte die entsprechenden
Release Notes und die HOWTO-Collection für Samba-2.2.x. Sie können mehrere Wege
einschlagen. Hier sind einige mögliche Migrationsszenarien:
</para>

<itemizedlist>
	<listitem><para>
	Sie müssen die neue Drucker- und Treiberunterstützung für Windows NT 
	studieren und anwenden. Die vorher benutzten Parameter 
	<parameter>printer driver file</parameter>, 
	<parameter>printer driver</parameter> und 
	<parameter>printer driver location</parameter> werden nicht mehr unterstützt.
	</para></listitem>

	<listitem><para>
	Wenn Sie von der Druckertreiberunterstützung in Windows NT profitieren
	möchten, müssen Sie auch die Windows 9x/Me-Treiber auf die neuen
	Einstellungen migrieren.
	</para></listitem>

	<listitem><para>
	Eine vorhandene Datei <filename>printers.def</filename> (die in dem nun
	entfernten Parameter <parameter>printer driver file</parameter> angegeben
	wird) wird in Samba-3 nicht mehr funktionieren. In 3.0 versucht smbd, 
	Treiberdateien für Windows 9x/Me für den Drucker in 
	<smbconfsection>[print$]</smbconfsection> sowie weitere Einstellungen
	in der TDB zu finden, und zwar nur dort. Schlägt das fehl, weicht es 
	<emphasis>nicht</emphasis> darauf aus, ein <filename>printers.def</filename>
	(und alle dazugehörigen Parameter) zu benutzen (so wie es in 2.2.x der 
	Fall war). Das Werkzeug <command>make_printerdef</command> ist entfernt worden, und es gibt
	dafür nichts, was rückwärtskompatibel wäre.
	</para></listitem>

	<listitem><para>Sie müssen einen Windows 9x/Me-Treiber in die Freigabe
	<smbconfsection>[print$]</smbconfsection> für einen Drucker auf Ihrem 
	Samba-Host installieren. Die Treiberdateien werden in dem Unterverzeichnis
	<quote>WIN40/0</quote> von <smbconfsection>[print$]</smbconfsection>
	gespeichert, und einige andere Einstellungen und Informationen gehen
	in die druckrelevanten TDBs ein.</para></listitem>

	<listitem><para>Wenn Sie eine vorhandene Datei 
	<filename>printers.def</filename> in die neue Einstellung migrieren 
	möchten, besteht die einzige aktuelle Lösung darin, den APW von 
	Windows NT für die Installation der NT- und 9x/Me-Treiber zu benutzen. 
	Mit smbclient und rpcclient kann das auch aus Skripten heraus geschehen, wie das folgende Imprints-Installationsprogramm an einem Beispiel zeigt:
	</para>

	<para>
		<ulink noescape="1" url="http://imprints.sourceforge.net/">http://imprints.sourceforge.net/</ulink>
	</para>

	<para>
	Lesen Sie auch im Abschnitt <quote>Unterstützung des CUPS-Drucksystems</quote> nach, wie <command>rpcclient</command> benutzt wird.</para></listitem>
</itemizedlist>
</sect1>

<sect1>
<title>Druckerinformation in Active Directory oder LDAP veröffentlichen</title>

<para>
Dieser Punkt wird in einer späteren Fassung dieses Dokuments behandelt. Wenn Sie
gern Ihre Hilfe anbieten möchten, um das zu dokumentieren, kontaktieren Sie bitte
<ulink url="mail://jht@samba.org">John H. Terpstra.</ulink>
</para>
</sect1>

<sect1>
<title>Häufige Fehler</title>

<sect2>
<title>Ich gebe mein root-Passwort ein, erhalte aber keinen Zugang</title>

<para>
Verwechseln Sie nicht das root-Passwort, das im UNIX-System gültig ist (und in den
meisten Fällen in Form eines Einweg-Hashes in einer Datei namens 
<filename>/etc/shadow</filename> gespeichert ist), mit dem Passwort bei der
Identifikation durch Samba. Samba kennt das UNIX-Passwort nicht. Ein root-Zugang
zu Samba-Ressourcen erfordert, dass zuerst ein Samba-Konto für root erstellt 
wird. Dies erledigt man wie folgt mit dem Befehl 
<command>smbpasswd</command>:
</para>

<para><screen>
&rootprompt; smbpasswd -a root
New SMB password: secret
Retype new SMB password: secret
</screen></para>

</sect2>

<sect2>
<title>Mein Druckauftrag gelangt ins Spooling-Verzeichnis, geht dann aber verloren</title>

<para>
Benutzen Sie nicht das vorhandene spool-Verzeichnis des UNIX-Drucksystems 
als spool-Verzeichnis für Samba. Es mag bequem und platzsparend erscheinen, 
führt aber nur zu Problemen. Die zwei Verzeichnisse müssen verschieden sein.
</para>

</sect2>
</sect1>

<sect1>
<title>Aktualisierung</title>


<para>Seit Erst-Veröffentlichung dieses Buches in Englisch haben die 
Samba-Versionen 3.0.1 bis 3.0.7 wichtige Aktualisierungen und Änderungen 
erfahren. Die Entwickler beseitigten verschiedene Fehler und schlossen 
Sicherheitslücken. Viele Modifikationen betrafen auch die 
Druckfunktionen. Hier eine kurze Übersicht:
</para>

<variablelist>
<varlistentry><term><smbconfoption><name>'rpcclient adddriver'</name></smbconfoption></term>
    <listitem>
    <para>akzeptiert jetzt die Angabe der Treiber-Version. Dies ermöglicht die
    kontrollierte Installation von 'Kernel Mode'- und 'User Mode'-Druckertreibern. 
    (Änderung seit 3.0.1)</para>
    <para>Beispiel: 
    <screen>
 &rootprompt;rpcclient localhost -N   \
            -U'root%secret' \
            -c 'adddriver "Windows NT x86"  \
            "infotec_2105:cupsdrv5.dll:infotec_2105.ppd:\
            cupsui5.dll:cups5.hlp:NULL:RAW:NULL" \
            2'
    </screen>
    </para>
    </listitem>
    </varlistentry>

<varlistentry><term><smbconfoption><name>'printing = .....'</name></smbconfoption></term> 
    <listitem>
    <para>ist jetzt nicht mehr 'globaler', sondern 'service level'-Parameter. Dies
    erlaubt mehr Flexibilität und eine bequemere Verwirklichung eigener
    Druckbefehle ('print command' in smb.conf), unterschiedlich pro 
    Druckerwarteschlange. 
    (Änderung seit 3.0.3)</para>
    <para>Beispiel: 
    <screen>
 <smbconfoption><name>printing = sysv</name></smbconfoption>
    </screen>
    </para>
    </listitem>
    </varlistentry>

<varlistentry><term><smbconfoption><name>'cups options = .....'</name></smbconfoption></term>
    <listitem>
    <para>erlaubt die Angabe von Druckuptionen wie z.B '-o raw' ohne in die Konfiguration
    des CUPS-Servers eingreifen zu müssen.
    (neuer Parameter seit 3.0.3)</para>
    <para>Beispiel: 
    <screen>
 <smbconfoption><name>cups options = 'raw,media=a4,job-sheets=secret,secret'</name></smbconfoption>
    </screen>
    </para>
    </listitem>
    </varlistentry>

<varlistentry><term><smbconfoption><name>'printcap cache time = .....'</name></smbconfoption></term>
    <listitem>
    <para>legt das Zeitintervall in Sekunden fest, in dem Samba die 'printcap' nach
    neu hinzugekommenen (oder gelöschten) Druckerwarteschlangen untersucht.
    (neuer Parameter seit 3.0.6)</para>
    <para>Beispiel: 
    <screen>
 <smbconfoption><name>printcap cache time = 60</name></smbconfoption>
    </screen>
    </para>
    </listitem>
    </varlistentry>

<varlistentry><term><smbconfoption><name>'rpcclient setprintername'</name></smbconfoption></term>
    <listitem>
    <para>ermöglicht die Zuordnung eines anderen Namens zu einer Druckerwarteschlange.
    Dieser Name wird den Windows-Clients gezeigt (Unix-Benutzer sehen den 
    ursprünglichen Namen).
    (neuer Parameter seit 3.0.6)</para>
    <para>Beispiel: 
    <screen>
&rootprompt;rpcclient localhost -N   \
    -U'root%secret' \
    -c 'setprintername cups_printer "Drucker für Gruppe Marketing"'
    </screen>
    </para>
    </listitem>
    </varlistentry>

<varlistentry><term><smbconfoption><name>'cups server = .....'</name></smbconfoption></term>
    <listitem>
    erlaubt die Verwendung eines von 'localhost' unterschiedlichen CUPS-Servers.
    Unterschiedliche virtuellen smbds können sogar unterschiedliche cups server
    verwenden.
    (neuer Parameter seit 3.0.6)
    <para>Beispiele: 
    <screen>
 <smbconfoption><name>cups server = 10.160.61.60</name></smbconfoption>
 <smbconfoption><name>cups server = cups2.domain.com</name></smbconfoption>
    </screen>
    </para>
    </listitem>
    </varlistentry>

<varlistentry><term><smbconfoption><name>'VampireDriverFunctions'</name></smbconfoption></term>
    <listitem>
    <para>ist ein neues Migrationstool seit 3.0.3 zum zeitsparenden Klonen und Transfer 
    von Windows-Druckertreibern von einem (Windows- oder Samba-)Printserver zu
    einem anderen.
    (neu enthalten seit 3.0.3)</para>
    <para>Nähere Erläuterungen siehe unten.
    </para>
    </listitem>
    </varlistentry>

</variablelist>

<para>Eine ausführliche Beschreibung zu den einzelnen Punkten finden Sie am 
Ende des nächsten Kapitels, 'Ünterstützung des CUPS-Drucksystems'.
</para> 

</sect1>

</chapter>

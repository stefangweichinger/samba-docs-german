<?xml version="1.0" encoding="ISO-8859-1"?>
<chapter id="CUPS-printing">

<chapterinfo>

	<author>
		<firstname>Kurt</firstname><surname>Pfeifle</surname>
		<affiliation>
			<orgname>Danka Deutschland GmbH </orgname>
                        <address><email>kpfeifle@danka.de</email></address>
		</affiliation>
	</author>
	<author>
		<firstname>Ciprian</firstname><surname>Vizitiu</surname>
		<affiliation>
			<address><email>CVizitiu@gbif.org</email></address>
		</affiliation>
		<contrib>drawings</contrib>
	</author>

	<author>&person.jelmer;<contrib>drawings</contrib></author>
        <author>&person.sgw;<contrib>Deutsche Übersetzung</contrib></author>
</chapterinfo>

<title>Unterstützung des CUPS-Drucksystems</title>

<sect1>

	<title>Einleitung</title>

	<sect2>
		<title>Eigenschaften und Vorzüge</title>

		<para>
		Das Common UNIX Print System (<ulink url="http://www.cups.org/">CUPS</ulink>)
		ist mittlerweile sehr populär geworden. Alle großen
		Linux Distributionen liefern dieses als das Standard-Drucksystem
		aus. Für viele ist es ein mystisches Tool.
		Meistens funktioniert es einfach. Daher wird es
		oft als <quote>Black Box</quote> angesehen, und solange
		es funktioniert, möchte sich auch niemand damit
		befassen. Sobald aber ein kleines Problem auftritt,
		bekommt man Schwierigkeiten damit, herauszufinden, wie man mit
		der Fehlersuche beginnt. Sehr viele Informationen, welche
		auch für CUPS relevant sind, finden Sie im Kapitel
		<quote>Klassische Druckerunterstützung</quote>.
		</para>

		<para>
		CUPS bietet einige mächtige und einmalige Möglichkeiten.
		Neu ist auch die sehr einfache Handhabung der
		grundsätzlichen Funktionen. Da diese Funktionen anders
		sind als in den mehr traditionell orientierten
		Drucksystemen, wenden Sie am besten nicht ihr
		bisheriges Wissen bzgl. Drucken an.
		Versuchen Sie eher, CUPS von Grund auf zu
		vestehen. Diese Dokumentation möchte Sie zu einem
		kompletten Verständniss von CUPS führen.
		Beginnen wir mit den grundsätzlichen Dingen.
		</para>


	</sect2>

	<sect2>
		<title>Überblick</title>

		<para>
		CUPS ist mehr als nur ein System für das Printspooling. Es ist
		ein komplettes Drucker-Management-System, welches das
		neue Internet Printing Protocol (IPP) erfüllt. IPP ist
		ein IETF- (Industry-and-Internet-Engineering Task Force) Standard für
		das Drucken in Netzwerken. Viele seiner Funktionen können
		remote oder lokal über einen Webbrowser verwaltet
		werden (Bereitstellung eines plattform-unabhängigen
		Zugriffs auf den CUPS-Printserver). Zusätzlich hat es die
		traditionellen Kommandozeilen-Tools und weitere moderne
		GUI-Schnittstellen. (GUI-Schnittstellen von
		Drittherstellern, wie etwa das überwältigende, in KDE
		enthaltene <ulink url="http://printing.kde.org/">KDEPrint</ulink>).
		</para>
		
		<para>
		CUPS erlaubt das Anlegen von <quote>raw</quote>-
		Druckern (keine Übersetzung der Druckdaten) genauso wie
		von <quote>smarten</quote> Druckern (Cups übersetzt das
		Dateiformat in das benötigte Druckerformat). Diese
		gibt CUPS auf vielfache Arten ähnliche Fähigkeiten wie das MS
		Windows Print Monitoring System. Sind Sie ein CUPS-
		Verfechter, dann werden Sie sicher argumentieren, daß CUPS
		sogar besser ist! Wie auch immer, lassen Sie uns
		damit weitermachen, wie man CUPS für eine Zusammenarbeit
		mit MS Windows Druckclients über SAMBA konfigurieren kann.
		</para>

	</sect2>
</sect1>

<sect1>
	<title>Grundlegende Konfiguration für die CUPS-Unterstützung</title>

	<para>
	In Samba-3.0 (gilt auch für 2.2.x) sind für das grundlegende
	Drucken mit CUPS nur 2 Einträge nötig:
	<smbconfoption><name>printing</name><value>cups</value></smbconfoption>
	and
	<smbconfoption><name>printcap</name><value>cups</value></smbconfoption>.
	CUPS benötigt keine printcap-Datei.
	Dennoch gibt es in der Konfigurationsdatei
	<filename>cupsd.conf</filename> zwei zugehörige Einträge, die
	kontrollieren, wie diese Datei anzulegen und zu verwalten ist, damit
	Anwendungen von Drittherstellern damit umgehen können (Beispiel:
	<parameter>Printcap /etc/printcap</parameter> and
	<parameter>PrintcapFormat BSD</parameter>).
	Ältere Programme benötigen oft diese printcap-Datei mit den
	Namen der Drucker, um drucken zu können. Stellen Sie daher sicher, daß CUPS so
	konfiguriert wurde, daß diese printcap-Datei erstellt und
	gewartet wird. Für Details sehen Sie die man-Page
	<command>man cupsd.conf</command>, die CUPS-relevanten
	Dokumentationen, sowie die vielen Infos vom CUPS Server
	selbst: <ulink noescape="1" url="http://localhost:631/documentation.html">http://localhost:631/documentation.html</ulink>.
	</para>

	<sect2>
		<title>Das Verlinken von smbd mit libcups.so</title>

		<para>
		Samba hat eine spezielle Beziehung zu CUPS. Samba kann
		mit Unterstützung für die CUPS-Library übersetzt werden. Die meisten
		aktuellen Installationen haben diesen Support bereits
		per default in smbd und den anderen Samba-Binaries
		integriert. Sie können CUPS auch benutzen, wenn Samba
		nicht gegen die <filename>libcups.so</filename>
		&smbmdash; gelinkt ist, aber es gibt einige Unterschiede in
		den benötigten oder unterstützten Konfigurationen.
		</para>
		
		<para>
		Wenn Samba mit <filename>libcups</filename> kompiliert
		wurde, verwendet <smbconfoption><name>printcap</name><value>cups</value></smbconfoption>
		die CUPS-API, um Drucker aufzufinden, Jobs zu übergeben,
		Queues abzufragen usw.
		Sonst wird dies auf die System V Druck-Kommandos mit der zusätzlichen
		<command>-oraw</command>-Option umgesetzt.
		Auf einem Linux-System können Sie mit dem
		<command>ldd</command> Utility nähere Details erfahren
		(ldd muss nicht auf allen Plattformen vorhanden sein,
		oder dessen Funktion kann in einem vergleichbarem
		Programm inkludiert sein).
		</para>


<para><screen>
&rootprompt;<userinput>ldd `which smbd`</userinput>
libssl.so.0.9.6 =&gt; /usr/lib/libssl.so.0.9.6 (0x4002d000)
libcrypto.so.0.9.6 =&gt; /usr/lib/libcrypto.so.0.9.6 (0x4005a000)
libcups.so.2 =&gt; /usr/lib/libcups.so.2 (0x40123000)
[....]
</screen></para>

		<para>
		Die Zeile
		<computeroutput>libcups.so.2 =&gt; /usr/lib/libcups.so.2 (0x40123000)</computeroutput>
		bedeutet, daß der CUPS-Support in Samba einkompiliert wurde.
		In diesem Fall, und bei gesetztem printing = cups,
		<emphasis>werden anderweitige manuell gesetzte print
		Kommandos in &smb.conf; ignoriert</emphasis>.
		Bitte merken Sie sich diesen wichtigen Punkt !
		</para>

		<tip><para>Sollte es aus irgendeinem Grund nötig sein,
		Ihre eigenen Druck-Kommandos zu setzen, können sie
		dies erreichen, in dem sie die Option
		<smbconfoption><name>printing</name><value>sysv</value></smbconfoption>
		verwenden.
		Sie verlieren so jedoch die Unterstützung der engen CUPS/Samba-Integration.
		Wenn Sie das vorhaben, müssen Sie folgende Druckkommandos manuell konfigurieren
		(am wichtigsten:	
		<smbconfoption><name>print command</name></smbconfoption>; andere Kommandos sind
		<smbconfoption><name>lppause command</name></smbconfoption>,
	        <smbconfoption><name>lpresume command</name></smbconfoption>,
                <smbconfoption><name>lpq command</name></smbconfoption>,
	        <smbconfoption><name>lprm command</name></smbconfoption>,
                <smbconfoption><name>queuepause command</name></smbconfoption> und
                <smbconfoption><name>queue resume command</name></smbconfoption>).</para></tip>
        </sect2>

	<sect2>
		<title>Einfache &smb.conf; Einstellungen für CUPS</title>

		<para>
		Als Zusammenfassung <link linkend="cups-exam-simple">
		zeigt das folgende Beispiel</link>
		ein einfaches Drucker-relevantes Setup
		für &smb.conf;, um den grundlegenden Support für CUPS zu erhalten:
		</para>


		<para><smbconfexample id="cups-exam-simple">
		<title>Einfachste Drucker-bezogene smb.conf</title>
		<smbconfsection>[global]</smbconfsection>
		<smbconfoption><name>load printers</name><value>yes</value></smbconfoption>
		<smbconfoption><name>printing</name><value>cups</value></smbconfoption>
		<smbconfoption><name>printcap name</name><value>cups</value></smbconfoption>

		<smbconfsection>[printers]</smbconfsection>
		<smbconfoption><name>comment</name><value>Alle Drucker</value></smbconfoption>
		<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption>
		<smbconfoption><name>browseable</name><value>no</value></smbconfoption>
		<smbconfoption><name>public</name><value>yes</value></smbconfoption>
		<smbconfoption><name>guest ok</name><value>yes</value></smbconfoption>
		<smbconfoption><name>writable</name><value>no</value></smbconfoption>
		<smbconfoption><name>printable</name><value>yes</value></smbconfoption>
		<smbconfoption><name>printer admin</name><value>root, @ntadmins</value></smbconfoption>

		</smbconfexample></para>

		<para>
		Das ist alles, was Sie an grundlegenden Einstellungen
		zum Drucken mit CUPS benötigen. Dies wird alle Grafik-,
		Text-, PDF-, und Postscript-Dateien drucken, die von Ihren Windows-Clients
		übermittelt werden. Aber die meisten Ihrer Windows-Benutzer
		würden nicht wissen, wie sie solche Dateien ohne einen
		grafischen Druckerdialog übermitteln können. Windows
		Clients haben meist lokale Druckertreiber
		installiert, welche in den Anwendungen durch den Druck-Button
		aktiviert werden. Ihre Benutzer drucken auch selten
		Dateien aus der Kommandozeile. Im Gegensatz zu Unix
		Client's senden sie kaum Grafik-, Text- oder PDF-
		formatierte Dateien direkt zum Spooler. Sie
		drucken fast ausschließlich aus GUI-Anwendungen über den
		<quote>Druckertreiber</quote>, welcher zwischen der
		nativen Ausgabe des Programms und dem Druckdatenstrom
		sitzt. Ist das Ausgabegerät kein PostScript-Drucker, so
		ist der Druckdatenstrom in einem <quote>Binärformat</quote>
		welches nur der betreffende Drucker versteht.
		Lesen Sie bitte weiter, um zu verstehen, welche Probleme
		dabei entstehen und wie Sie diese vermeiden.	
		</para>
	</sect2>

	<sect2>
	<title>Komplexere CUPS-Einstellungen in der &smb.conf;</title>
	<para>
	<link linkend="overridesettings">Die nächste Konfiguration</link>
	beschreibt ein etwas komplexeres Drucker-Setup der &smb.conf;.
	Es aktiviert generellen CUPS-Druck-Support für alle Drucker, definiert aber einen
	Drucker, der davon abweichend konfiguriert wird.
	</para>

	<para><smbconfexample id="overridesettings">
	<title>Das Aufheben globaler CUPS-Einstellungen für einen Drucker</title>
	<smbconfsection>[global]</smbconfsection>
	<smbconfoption><name>printing</name><value>cups</value></smbconfoption>
	<smbconfoption><name>printcap name</name><value>cups</value></smbconfoption>
	<smbconfoption><name>load printers</name><value>yes</value></smbconfoption>

	<smbconfsection>[printers]</smbconfsection>
	<smbconfoption><name>comment</name><value>Alle Drucker</value></smbconfoption>
	<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption>
	<smbconfoption><name>public</name><value>yes</value></smbconfoption>
	<smbconfoption><name>guest ok</name><value>yes</value></smbconfoption>
	<smbconfoption><name>writable</name><value>no</value></smbconfoption>
	<smbconfoption><name>printable</name><value>yes</value></smbconfoption>
	<smbconfoption><name>printer admin</name><value>root, @ntadmins</value></smbconfoption>

	<smbconfsection>[special_printer]</smbconfsection>
	<smbconfoption><name>comment</name><value>Ein spezieller Drucker mit seinen eigenen Einstellungen</value></smbconfoption>
	<smbconfoption><name>path</name><value>/var/spool/samba-special</value></smbconfoption>
	<smbconfoption><name>printing</name><value>sysv</value></smbconfoption>
	<smbconfoption><name>printcap</name><value>lpstat</value></smbconfoption>
	<smbconfoption><name>print command</name><value>echo "NEW: `date`: printfile %f" \</value></smbconfoption>
	<member><parameter> >> /tmp/smbprn.log ; \</parameter></member>
	<member><parameter>echo "     `date`: p-%p s-%s f-%f" >> /tmp/smbprn.log ; \</parameter></member>
	<member><parameter>echo "     `date`: j-%j J-%J z-%z c-%c" >> /tmp/smbprn.log : rm %f</parameter></member>
	<smbconfoption><name>public</name><value>no</value></smbconfoption>
	<smbconfoption><name>guest ok</name><value>no</value></smbconfoption>
	<smbconfoption><name>writable</name><value>no</value></smbconfoption>
	<smbconfoption><name>printable</name><value>yes</value></smbconfoption>
	<smbconfoption><name>printer admin</name><value>kurt</value></smbconfoption>
	<smbconfoption><name>hosts deny</name><value>0.0.0.0</value></smbconfoption>
	<smbconfoption><name>hosts allow</name><value>turbo_xp, 10.160.50.23, 10.160.51.60</value></smbconfoption>
	</smbconfexample></para>

	<para>
	Diese spezielle Freigabe ist nur für Testzwecke gedacht. Sie schreibt den Druckauftrag nicht
	in eine Datei, sondern protokolliert nur die Auftrags-Parameter, die Samba bekannt sind, in die
	Datei <filename>/tmp/smbprn.log</filename> und löscht die Auftrags-Datei. Außerdem ist der
	Parameter <smbconfoption><name>printer admin</name></smbconfoption> dieser Freigabe
	<quote>kurt</quote> (nicht die Gruppe <quote>@ntadmins</quote>), Gast-Zugriff ist nicht erlaubt,
	die Freigabe wird nicht in der Netzwerkumgebung angezeigt (also müssen Sie wissen, daß es sie
	gibt), und sie erlaubt nur den Zugriff von nur drei Hosts. Um CUPS daran zu hindern, sich
	hier einzumischen und die Druckjobs dieser Freigabe zu übernehmen, müssen wir dies setzen:
	<smbconfoption><name>printing</name><value>sysv</value></smbconfoption> und
	<smbconfoption><name>printcap</name><value>lpstat</value></smbconfoption>.
	</para>
	</sect2>
</sect1>

<sect1>
	<title>Erweiterte Konfiguration</title>

	<para>
	Bevor wir in all die Konfigurations-Optionen eintauchen, lassen Sie uns ein paar Punkte
	klären. <emphasis>Netzwerk-Druck muß organisiert und korrekt eingerichtet werden</emphasis>.
	Dies passiert meistens nicht. Bestehenden alten Systemen oder
	LAN-Umgebungen in kleinen Firmen mangelt es oft an Design und guter Wartung.
	</para>


	<sect2>
	<title>Zentrales Spooling vs. <quote>Peer-to-Peer</quote>-Druck</title>


	<para>
<indexterm><primary>spooling</primary><secondary>central</secondary></indexterm>
<indexterm><primary>spooling</primary><secondary>peer-to-peer</secondary></indexterm>
	Viele kleine Büro- oder Heim-Netzwerke, genauso wie schlecht organisierte grössere
	Umgebungen, erlauben jedem Client direkten Zugriff auf verfügbare Netzwerkdrucker.
	Dies ist im Allgemeinen eine schlechte Idee. Es blockiert oft den Zugriff eines Clients
	auf den Drucker, wenn der Auftrag eines anderen Clients gedruckt wird. Dies könnte
	die Applikation des ersten Clients "einfrieren", während diese darauf wartet, den
	Auftrag loszuwerden. Es gibt auch immer wieder Beschwerden darüber, daß Aufträge
	gedruckt werden, deren Seiten miteinander vermischt sind. Ein besseres Konzept
	ist die Verwendung eines Druck-Servers; er routet alle Aufträge durch ein zentrales
	System, welches unverzüglich antwortet, Aufträge von mehreren verschiedenen Clients
	zur selben Zeit annimmt, und diese danach in der korrekten Reihenfolge an die Drucker
	weiterleitet.
	</para>
	</sect2>

	<sect2>
	<title>"Raw" Print Serving &smbmdash; Hersteller-Treiber auf den Windows Clients</title>


	<para>
	<indexterm><primary>spooling-only</primary></indexterm>
	<indexterm><primary>"raw" printing</primary></indexterm>
	Die meisten traditionell konfigurierten UNIX-Druck-Server, die für Samba's Windows clients
	arbeiten, zeigen ein wirklich simples Setup. Ihre einzige Aufgabe war die Verwaltung des
	<quote>raw spooling</quote> aller Jobs, die ihnen von Samba übergeben wurde. Dieser Ansatz bedeutete,
	daß von den Windows Clients erwartet wurde, daß sie die Druckauftrags-Datei so vorbereiten, daß
	diese bereit zum Versenden an das Drucker-Gerät ist. Hier muß ein nativer (vom Hersteller
	bereitgestellter) Windows Druckertreiber für das Zielgerät auf jedem einzelnen Client installiert werden.
	</para>

	<para>
	Es ist möglich, CUPS, Samba und Ihre Windows Clients in derselben traditionellen und simplen Art zu
	konfigurieren. Wenn CUPS-Drucker für RAW-print-through Betriebsart konfiguriert sind, ist es die
	Verantwortung des Samba-Clients, den Druckauftrag (die Datei) vollständig wiederzugeben. Die Datei muß in
	einem Format gesendet werden, die passend für die direkte Weitergabe an den Drucker ist. Clients müssen
	dafür die vom Hersteller bereitgestellten Treiber verwenden, CUPS wird keinerlei Format-Wandlung
	durchführen.
	</para>

	<para>
	Die einfachste mögliche Druck-Konfiguration ist die Verwendung von "raw print-through".	
	Dies wird dadurch erreicht, daß der Drucker so installiert wird, als ob er physisch an den
	Windows client angeschlossen wäre. Sie leiten dann die Ausgabe auf eine raw-Netzwerk-Druck-Warteschlange
	um. Folgender Ablauf erzielt dies:
	</para>

	<procedure>
		<step><para>
		Editieren Sie <filename>/etc/cups/mime.types</filename>, um die Zeile nahe dem Dateiende
		auszukommentieren, die dies enthält:
<screen>
#application/octet-...
</screen>
		</para></step>

		<step><para>
		Machen Sie dasselbe mit der Datei <filename>/etc/cups/mime.convs</filename>.
		</para></step>

		<step><para>
		Fügen Sie mittels Web interface einen raw-Drucker hinzu. Gehen Sie mit Ihrem Browser auf
		<constant>http://localhost:631</constant>. Klicken Sie auf Administration und fügen Sie den
		Drucker gemäß der Aufforderungen hinzu. Installieren Sie keine Treiber dafür. Wählen Sie Raw.
		Wählen Sie den Queue-Namen <constant>Raw Queue</constant>.
                </para></step>

		<step><para>
		Im Abschnitt <constant>[printers]</constant> der Datei &smb.conf; fügen Sie hinzu:
		<smbconfoption><name>use client driver</name><value>Yes</value></smbconfoption>,
		und im Abschnitt <constant>[global]</constant>:
		<smbconfoption><name>printing</name><value>CUPS</value></smbconfoption>, plus
		<smbconfoption><name>printcap</name><value>CUPS</value></smbconfoption>.
		</para></step>

		<step><para>
		Installieren Sie den Drucker, als ob er ein lokaler Drucker wäre. Z.B.:
		Drucken auf <constant>LPT1:</constant>.
                </para></step>

		<step><para>
		Editieren Sie die Konfiguration im Tab <guimenu>Detail</guimenu>, legen Sie einen
		<constant>local port</constant> an, der auf die raw-Druck-Queue zeigt, die Sie oben
		angelegt haben. Beispiel: <constant>\\server\raw_q</constant>.
		Hier ist <constant>raw_q</constant> der Name, den Sie der Drucker-Warteschlange in der
		CUPS-Umgebung gegeben haben.
		</para></step>
	</procedure>

	</sect2>

	<sect2>
	<title>Installation von Windows Client Treibern</title>

	<para>
	Die Druckertreiber auf den Windows Clients können auf zwei funktional verschiedene Arten
	installiert werden:
	</para>

	<itemizedlist>
	<listitem><para>Manuelles Installieren der Treiber, lokal auf jedem Client, einer nach dem anderen;
	dies ergibt Drucken im alten <emphasis>LanMan</emphasis>-Stil und verwendet eine Verbindung vom Typ
	<filename>\\sambaserver\druckerfreigabe</filename>.
	</para></listitem>


	<listitem><para>
	<indexterm><primary>point 'n' print</primary></indexterm>
	Ablegen und Vorbereiten der Treiber (für den späteren Download) auf dem Druckserver (Samba); dies
	befähigt die Clients, <quote>Point'n'Print</quote> zu verwenden, um Treiber semi-automatisch
	installiert zu bekommen, wenn sie das erste Mal auf den Drucker zugreifen; bei dieser Methode verwenden
	NT/200x/XP-Clients Druckaufrufe vom Typ <emphasis>SPOOLSS/MS-RPC</emphasis>.</para></listitem>
        </itemizedlist>

	<para>
	Die zweite Methode wird zur Verwendung empfohlen.
	</para>
	</sect2>

	<sect2 id="cups-raw">
	<title>Explizites Aktivieren von <quote>raw</quote>-Druck für <emphasis>application/octet-stream</emphasis></title>


	<para>
	<indexterm><primary>application/octet-stream</primary></indexterm>
	<indexterm><primary>raw printing</primary></indexterm>
	<indexterm><primary>MIME</primary><secondary>raw</secondary></indexterm>
	Wenn Sie die erste Variante verwenden (Treiber werden auf Client-Seite installiert), ist dies eine
	Einstellung, die sie beachten müssen: CUPS muß mitgeteilt werden, daß es <quote>raw</quote>-Druck von
	Binär-Dateiformaten erlauben soll. Die CUPS-Dateien, die korrekt für RAW-Modus-Drucker gesetzt sein
	müssen, sind:	
	</para>

	<itemizedlist>
		<listitem><para><filename>/etc/cups/mime.types</filename></para></listitem>
		<listitem><para><filename>/etc/cups/mime.convs</filename></para></listitem>
	</itemizedlist>

	<para>
	Beide enthalten Einträge (am Ende der jeweiligen Datei), die auskommentiert werden müssen, um
	RAW-Modus-Betrieb zu erlauben. In <filename>/etc/cups/mime.types</filename> muß diese Zeile vorhanden
	sein:

	<filterline>
	 application/octet-stream
	</filterline>

	<indexterm><primary>/etc/cups/mime.convs</primary></indexterm>
	<indexterm><primary>/etc/cups/mime.types</primary></indexterm>

	In <filename>/etc/cups/mime.convs</filename> müssen Sie diese Zeile haben:

	<indexterm><primary>application/vnd.cups-raw</primary></indexterm>

	<filterline>
		application/octet-stream   application/vnd.cups-raw   0   -
	</filterline>

	Wenn diese beiden Dateien nicht korrekt für RAW-Windows-CLient-Druck konfiguriert sind, kann es sein, daß
	Sie die gefürchtete Meldung <computeroutput>Unable to
        convert file 0</computeroutput> in Ihrer CUPS error_log Datei vorfinden.
	</para>

	<note><para>Das Editieren von <filename>mime.convs</filename> und
	<filename>mime.types</filename>
	<emphasis>erwingt</emphasis> den <quote>raw</quote>-Druck nicht, es
	<emphasis>erlaubt</emphasis> ihn nur.
	</para></note>

	<formalpara><title>Hintergrund</title>


	<para>
	<indexterm><primary>application/octet-stream</primary></indexterm>
	Da CUPS ein mehr sicherheitsbewußtes Drucksystem ist als die traditionellen Systeme, erlaubt es
	in der Voreinstellung nicht, daß ein Benutzer beliebige (möglicherweise binäre) Daten an
	Druck-Geräte sendet. Dies könnte leicht dazu benutzt werden, um einen
	<quote>Denial of Service</quote>-Angriff auf Ihre(n) Drucker zu starten, was zumindest den Verlust von
	einer Menge Papier und Tinte nach sich ziehen würde. <quote>Unbekannte</quote> Daten werden von CUPS
	als <parameter>MIME type: application/octet-stream</parameter> gekennzeichnet, und es wird ihnen nicht
	erlaubt, zum Drucker zu gelangen. In der Voreinstellung können Sie nur andere (bekannte) MIME-Typen
	 <quote>raw</quote> senden. Das <quote>raw</quote>-Senden von Daten bedeutet, daß CUPS nicht versucht,
	die Daten zu konvertieren und sie einfach unangetastet an den Drucker weiterleitet (sehen Sie das nächste
	Kapitel für noch mehr Hintergrund-Erklärungen dazu).
	</para>
	</formalpara>

	<para>
	Dies ist alles, was Sie darüber wissen müssen, um die CUPS/Samba-Combo zum <quote>raw</quote>-Druck
	der von Windows-Clients, die Herstellertreiber lokal installiert haben, vorbereiteten Dateien
	zu bringen. Wenn Sie nicht an Hintergrund-Informationen zu erweitertem CUPS/Samba-Druck interessiert
	sind, überspringen Sie einfach die restlichen Abschnitte dieses Kapitels.
	</para>
	</sect2>

	<sect2>
	<title>Die Methoden, um Treiber auf den Server zu laden</title>

	<para>
	Dieser Abschnitt beschreibt drei übliche Methoden, zuzüglich einer neuen, mit denen Druckertreiber
	auf den Server geladen werden können ("Upload").
	</para>

	<para>
	<indexterm><primary>point 'n' print</primary></indexterm>
	Wenn Sie Druck vom Typ MS-RPC verwenden wollen, müssen Sie die Treiber zuerst auf den Samba-Server
	hochladen (Freigabe <smbconfsection>[print$]</smbconfsection>). Für die Behandlung des Themas, wie
	man Druckertreiber auf dem Samba-Host ablegt (damit die Windows-Clients diese via
	<quote>Point'n'Print</quote> herunterladen und verwenden können, lesen Sie bitte das vorhergehende
	Kapitel dieser HOWTO-Sammlung. Dort finden Sie Beschreibungen und Referenzen zu drei Methoden, um
	Druckertreiber auf dem Samba-Server vorzubereiten:
	</para>
	<itemizedlist>
		<listitem><para>
	<indexterm><primary>Druckerinstallations-Assistent</primary></indexterm>
				Die GUI, <quote>Druckerinstallations-Assistent</quote>
	<emphasis>upload-von-einem-Windows-Client</emphasis> Methode.</para></listitem>

	<listitem><para>Die Befehlszeilen, <quote>smbclient/rpcclient</quote>
	upload-von-einer-UNIX-Workstation Methode.</para></listitem>


	<listitem><para>
	<indexterm><primary>imprints</primary></indexterm>
			Die Imprints Toolset Methode.</para></listitem>
	</itemizedlist>

	<para>
	Diese drei Methoden können genauso auf CUPS angewendet werden. Ein neuer und praktischerer Weg, um
	Windows-Treiber in Samba zu laden, steht zur Verfügung, wenn Sie CUPS verwenden:
	</para>


	<itemizedlist>
		<listitem><para>
	<indexterm><primary>cupsaddsmb</primary></indexterm>
				Das <parameter>cupsaddsmb</parameter> Werkzeug.</para></listitem>
	</itemizedlist>

	<para>
	<command>cupsaddsmb</command> wird weiter unten im Detail behandelt. Zuerst erkunden wir aber das
	CUPS-Filter-System und vergleichen die Windows- und UNIX-Druck-Architektur.
	</para>
	</sect2>
</sect1>

<sect1>
	<title>Erweitertes intelligentes Drucken mit Download von Postscript-Treibern</title>


	<para>
	<indexterm><primary>PostScript</primary><seealso>Ghostscript</seealso></indexterm>
	Wir wissen nun, wie man einen <quote>dump</quote>-Druckserver aufsetzt, das ist ein Server, der
	Druckaufträge <quote>raw</quote> verwaltet, also die Druckdaten unberührt läßt.
	</para>

	<para>
	Möglicherweise müssen Sie CUPS auf eine	intelligentere Art installieren. Die Gründe können mannigfaltig
	sein:
	</para>

	<itemizedlist>
	<listitem><para>
	Vielleicht will Ihr Chef monatliche Statistiken: Welcher Drucker hat wieviele Seiten gedruckt?
	Was war die durchschnittliche Grösse eines Druckauftrags? Wieviele Druckaufträge gab es im Durchschnitt
	pro Tag? Welche Abteilung druckt wieviel?</para></listitem>

	<listitem><para>
	Vielleicht sollen Sie ein Druck-Quota-System aufbauen: Benutzer sollten nicht mehr drucken können, als
	ein vorgeschriebenes Limit pro Periode.</para></listitem>

	<listitem><para>
	Vielleicht ist Ihr Netzwerkdruck-Setup ein komplettes Durcheinander und muß von Grund auf
	reorganisiert werden.</para></listitem>

	<listitem><para>
	Vielleicht haben Sie bereits zu viele <quote>blue screens</quote> gesehen, die von Druckertreibern
	herrühren, die unvollständig "debugged" wurden und in NT
	<quote>kernel mode</quote> laufen?</para></listitem>
	
	</itemizedlist>

	<para>
	Diese Ziele können nicht mit einem RAW-Druckserver erreicht werden. Um einen Server aufzubauen, der
	diesen Anforderungen entspricht, müssen Sie zuerst lernen, wie CUPS arbeitet, und wie Sie seine
	Features aktivieren.
	</para>

	<para>
	Was nun folgt, ist der Vergleich von einigen fundamentalen Konzepten des Windows- und UNIX-Drucks;
	danach folgt eine Beschreibung des CUPS-Filter-Systems, wie es arbeitet, und wie Sie es beeinflussen
	können.
	</para>

	<sect2 id="gdipost">
	<title>GDI unter Windows -- PostScript auf UNIX</title>


	<para>
	<indexterm><primary>GDI</primary></indexterm>
	<indexterm><primary>PostScript</primary></indexterm>
	Netzwerkdurck ist eine der kompliziertesten und fehlerträchtigsten Alltags-Aufgaben, die ein Benutzer
	oder Administrator zu bewältigen hat. Dies gilt für alle Betriebssysteme. Und hier sind die Gründe dafür.
	</para>


	<para>
	<indexterm><primary>PCL</primary></indexterm>
	<indexterm><primary>PDL</primary></indexterm>
	Bei den meisten Dateiformaten können Sie nicht erwarten, sie einfach in den Drucker zu schmeissen, und
	sie werden gedruckt. Es muß eine Wandlung des Dateiformats passieren. Das Problem dabei ist, daß es
	keinen gemeinsamen Standard für Druck-Datei-Formate über alle Hersteller und Druckertypen gibt.
	Während sich PostScript (Handelsmarke von Adobe) und, zu einem gewissen Teil, PCL (Handelsmarke von HP)
	zu halb-offiziellen <quote>Standards</quote> entwickelt haben, indem sie die weitest verbreiteten
	PDLs (Page Description Languages) sind, gibt es nach wie vor viele Hersteller, die
	<quote>ihr eigenes Süppchen kochen</quote> (der Grund dafür können inakzeptabel hohe Lizenzgebühren
	für Drucker-interne PostScript-Interpreter sein, usw.).
	</para>
	</sect2>

	<sect2>
	<title>Windows Drivers, GDI and EMF</title>


	<para>
	<indexterm><primary>GDI</primary></indexterm>
	<indexterm><primary>EMF</primary></indexterm>
	<indexterm><primary>WYSIWYG</primary></indexterm>
	Im Windows OS wird die Formatwandlung von den Druckertreibern erledigt. Auf der Windows-Plattform
	haben alle Anwendungs-Programmierer eine eingebaute API zur Verfügung, das Graphical Device
        Interface (GDI), als Teil und Paket des Betriebssystems selbst, um darauf aufzubauen. Dieser GDI-Kern
	wird als gemeinsame einheitliche Grundlage für alle Windows-Programme verwendet, um Bilder,
	Schriften und Dokumente <emphasis>am Bildschirm "on screen"</emphasis> darzustellen, genauso wie
	<emphasis>auf Papier "on paper"</emphasis> (Druck). Daher können Druckertreiber-Hersteller sich mit ihrem
	Druckertreiber-Input auf einen wohldefinierten GDI-Output standardisieren. Das Erreichen von
	WYSIWYG (<quote>What You See Is What You Get</quote>) ist relativ einfach, weil die on-screen
	Grafik-Primitive, genauso wie die on-paper gezeichneten Objekte von einer gemeinsamen Quelle stammen.
	Diese Quelle, die GDI, erzeugt oft ein Dateiformat namens Enhanced MetaFile (EMF). EMF wird vom
	Druckertreiber verarbeitet und in ein Drucker-spezifisches Format konvertiert.
	</para>

	<note><para>
	<indexterm><primary>PDF</primary></indexterm>
	Zusätzlich zur GDI-Basis in MS Windows, hat Apple sich entschieden, Papier- und Bildschirmausgaben
	für seine (auf BSD-UNIX basierende, wußten Sie das?) Betriebssysteme Mac OS X und Darwin auf
	eine gemeinsame Basis zu stellen.
	<indexterm><primary>X Window System</primary></indexterm>
	<indexterm><primary>PostScript</primary></indexterm>
	<indexterm><primary>PCL</primary></indexterm>
	<indexterm><primary>Xprint</primary></indexterm>
	Apples <emphasis>Core Graphic Engine</emphasis> verwendet eine Abwandlung von <emphasis>PDF</emphasis>
	für alle Anzeigen.	
	</para></note>

	<para>

	<image><imagedescription>Windows druckt auf einen lokalen Drucker.</imagedescription><imagefile>1small</imagefile></image>
	</para>
	</sect2>

	<sect2>
	<title>UNIX Druckdatei-Konvertierung und GUI-Grundlagen</title>


	<para>
	<indexterm><primary>X Window System</primary></indexterm>
	<indexterm><primary>PostScript</primary></indexterm>
	<indexterm><primary>PCL</primary></indexterm>
	<indexterm><primary>Xprint</primary></indexterm>
	In UNIX and Linux gibt es keine vergleichbare Schicht im OS-Kernel oder dem X-
	(Bildschirm-Darstellungs) Server. Jede Anwendung ist für sich selbst verantwortlich, um ihre
	Druckausgabe zu erzeugen. Zum Glück verwenden die meisten Postscript und das gibt zumindest etwas
	gemeinsame Grundlagen. Unglücklicherweise gibt es viele verschiedene Qualitätsstufen für Postscript.
	Und noch schlechter, es gibt einen riesigen Unterschied (und keinen gemeinsamen Ursprung) zwischen
	der Darstellung desselben Dokuments auf dem Bildschirm und wie dieses Dokument auf Papier
	dargestellt wird. WYSIWYG ist schwieriger zu erreichen. Dies stammt aus der Zeit, Jahrzehnte zurück,
	als die Vorläufer von X.org beim Entwurf der UNIX-Grundlagen und -Protokolle für GUIs, die
	Verantwortung für <quote>Papierausgabe</quote> ablehnten, und sich auf <quote>nur on-screen</quote>
	beschränkten. (Seit einigen Jahren ist das Projekt <quote>Xprint</quote> in Entwicklung, man versucht,
	Druckunterstützung in das X-Framework zu integrieren, inklusive eines PostScript- und eines PCL-Treibers,
	aber dieses Projekt ist noch nicht bereit für die Anwendung.) Sie können diese unangenehme Erbe bis heute
	sehen, wenn Sie sich die verschiedenen <quote>font</quote>-Verzeichnisse auf Ihrem System ansehen;
	es gibt eigene Schriften für X-Darstellung und andere für den Druck auf Papier.
	</para>

	<formalpara>
	<title>Hintergrund</title>


	<para>
	<indexterm><primary>PostScript</primary></indexterm>
	Die Programmiersprache PostScript ist eine <quote>Erfindung</quote> von Adobe Inc., aber ihre
	Spezifikationen wurden vollständig veröffentlicht. Ihre Stärke liegt in den mächtigen Fähigkeiten,
	graphische Objekte zu beschreiben (Schriften, Formen, Muster, Linien, Kurven, und Punkte), deren
	Attribute (Farbe, Strichstärke), und die Art, diese zu manipulieren (Skalieren, Verzerren, Rotieren,
	Verschieben). Wegen der offenen Spezifikation kann jeder mit entsprechenden Fähigkeiten damit beginnen,
	seine eigene Implementation eines PostScript-Interpreters zu schreiben, und diesen zu verwenden, um
	PostScript-Dateien auf dem Schirm oder auf Papier darzustellen. Die meisten grafischen Ausgabegeräte
	basieren auf dem Konzept von <quote>Raster-Bildern</quote> oder <quote>Pixeln</quote> (eine zu erwähnende
	Ausnahme bilden Stift-Plotter). Natürlich können Sie eine PostScript-Datei in seiner Text-Form betrachten
	und ihren PostScript-Code lesen, die Sprach-Befehle, die von einem Rasterizer interpretiert werden
	müssen. Rasterizer erzeugen Pixel-Bilder, welche von einem Viewer auf dem Schirm dargestellt werden
	können, oder von einem Drucker auf dem Papier.
	</para>
	</formalpara>
	</sect2>

	<sect2 id="post-and-ghost">
	<title>PostScript und Ghostscript</title>

	<para>
	<indexterm><primary>PostScript</primary></indexterm>
	<indexterm><primary>GhostScript</primary><seealso>PostScript</seealso></indexterm>
	<indexterm><primary>PostScript</primary><secondary>RIP</secondary></indexterm>
	Also fehlt UNIX eine gemeinsame Basis für Druck und Bildschirmdarstellung. Trotz diesem ungünstigen
	Erbe, ist grundsätzlich Drucken ziemlich einfach, wenn Sie PostScript-Drucker zur Verfügung haben.
	Der Grund dafür ist, daß diese Drucker einen eingebauten PostScript-<quote>Interpreter</quote>
	besitzen, auch genannt, einen Raster Image Processor (RIP) (der sie auch teurer als andere Drucker sein
	läßt); wenn Sie diesen Druckern PostScript schicken, werden diese sie auch drucken. Ihr RIP macht all
	die harte Arbeit des Umwandelns von PostScript-Zeichenbefehlen in ein Bitmap-Bild, wie Sie es auf
	Papier sehen, in einer Auflösung, wie Sie von Ihrem Drucker unterstützt wird. Dies entspricht dem
	PostScript-Druck einer Datei aus Windows.
	</para>

	<note><para>
	<indexterm><primary>PPD</primary></indexterm>
	Traditionelle UNIX-Programme und -Druck-Systeme &smbmdash; bei Verwendung von PostScript &smbmdash;
	sind nicht PPD-fähig. PPDs sind <quote>PostScript Printer Description</quote>-Dateien. Sie ermöglichen
	es Ihnen, alle Optionen, die ein Drucker kennt, anzugeben und zu kontrollieren: Duplexdruck, Stapeln
	und Lochen. Daher konnten UNIX-Anwender lange Zeit viele der unterstützten Geräte- und Auftrags-Optionen
	nicht nutzen, im Unterschied zu Windows- und Apple-Anwendern. Aber jetzt gibt es CUPS.
	</para>
	</note>

	<para>
	<image><imagedescription>Drucken auf einen PostScript-Drucker.</imagedescription>
			<imagefile>2small</imagefile></image>
	</para>


	<para>
	<indexterm><primary>PDL</primary></indexterm>
	Jedoch gibt es auch andere Drucker-Typen da draussen. Diese Typen wissen nicht, wie man PostScript
	druckt. Sie verwenden ihre eigene Page Description Language (PDL, oft proprietär). Das Drucken auf
	diesen Geräten stellt höhere Anforderungen. Da Ihre UNIX-Anwendungen meistens PostScript erzeugen,
	und da diese Geräte kein PostScript verstehen, müssen Sie die Druckdateien auf dem host in ein
	für Ihren Drucker passendes Format konvertieren, bevor Sie diese an den Drucker senden können.
	</para>
	</sect2>

	<sect2>
	<title>Ghostscript &smbmdash; der Software RIP für Nicht-PostScript-fähige Drucker</title>


	<para>
	<indexterm><primary>GhostScript</primary></indexterm>
	Hier betritt Ghostscript das Geschehen. Ghostscript ist der traditionelle (und ziemlich mächtige)
	PostScript-Interpreter, der auf UNIX-Plattformen verwendet wird. Es ist ein RIP als Software, imstande,
	<emphasis>viele</emphasis> Datei-Konvertierungen für ein sehr grosses Spektrum von Hardware-Geräten bzw.
	Software-Dateiformaten durchzuführen. Ghostscript-Technologie und -Treiber ermöglichen PostScript-Druck
	auf Nicht-PostScript-fähige Hardware.
	</para>

	<para>
	<image><imagedescription>Ghostscript als RIP für Nicht-PostScript-fähige Drucker.</imagedescription>
		<imagefile>3small</imagefile>
	</image>
	</para>

	<tip><para>
	Verwenden Sie den Befehl <quote>gs -h</quote>, um alle eingebauten <quote>devices</quote> Ihrer
	Ghostscript-Version anzusehen. Wenn Sie den Parameter <parameter>-sDEVICE=png256</parameter> auf
	Ihrer Ghostscript-Befehlszeile angeben, teilen Sie Ghostscript mit, den Input in eine PNG-Datei
	zu konvertieren. Ein <quote>device</quote> auf der Befehlszeile anzugeben, ist der wichtigste
	Parameter, um Ghostscript exakt mitzuteilen, wie es den Input darstellen soll. Neue Versionen von
	Ghostscript werden in ziemlich regelmässigen Intervallen veröffentlicht, mittlerweile von
	artofcode LLC. Diese Versionen werden ursprünglich unter die Lizenz <quote>AFPL</quote> gestellt,
	aber dann unter der GNU GPL wiederveröffentlicht, sobald die nächste AFPL-Version erscheint.
	GNU Ghostscript ist wahrscheinlich die auf den meisten Samba-Systemen installierte Version. Aber
	es hat einige Mängel.
	<indexterm><primary>Ghostscript</primary><secondary>ESP</secondary><see>ESP GhostScript</see></indexterm>
	Daher wurde ESP Ghostscript als eine Erweiterung zu GNU Ghostscript entwickelt, mit vielen Bug-fixes,
	zusätzlichen Geräten und Erweiterungen. Es wird gemeinsam von Entwicklern von CUPS, Gimp-Print,
	MandrakeSoft, SuSE, Red Hat, und Debian verwaltet und entwickelt. Es beinhaltet das Gerät
	<quote>cups</quote> (essentiell wichtig, um von CUPS aus auf Nicht-PS-Drucker zu drucken).
	</para></tip>
	</sect2>

	<sect2>
	<title>Spezifikation der PostScript Printer Description (PPD)</title>


	<para>
	<indexterm><primary>PPD</primary></indexterm>
	Während PostScript im Kern eine Seiten-Beschreibungs-Sprache (PDL) ist, um das Layout einer Seite auf
	eine geräte-unabhängige Art darzustellen, werden in der Praxis Druckaufträge schlußendlich immer von
	Hardware mit geräteabhängigen Eigenschaften ausgegeben. Um all die Unterschiede in der Hardware zu
	berücksichtigen und Innovation zu ermöglichen, hat Adobe eine Syntax und ein Dateiformat für
	PostScript Printer Description (PPD) Dateien bestimmt. Jeder PostScript-Drucker wird mit einer dieser
	Dateien geliefert.
	</para>

	<para>
	PPDs enthalten all die Informationen über generelle und spezifische Eigenschaften des jeweiligen
	Drucker-Modells: Welche verschiedenen Auflösungen kann es verarbeiten? Hat es eine Duplex-Einheit?
	Wieviele Papierschächte gibt es? Welche Arten von Medien und deren Formate kann es verarbeiten? Für
	jeden Punkt benennen PPDs auch die spezielle Befehlsfolge, die man zu dessen Aktivierung an den
	Drucker (meist innerhalb der PostScript-Datei) senden muß.
	</para>

	<para>
	Die Information in diesen PPDs ist dafür bestimmt, von den Druckertreibern berücksichtigt zu werden.
	Daher wird als Teil des für einen bestimmten Drucker installierten Windows PostScript Treibers die
	PPD des Druckers installiert. Wo es Sinn macht, werden die PPD-Features in den UI-Dialogen des Treibers
	dargestellt, um dem Benutzer eine Auswahl von Druck-Optionen zu geben. Schlußendlich wird die Auswahl des
	Benutzers in die vom Drucker erstellte PostScript-Datei geschrieben (in der Form spezieller PostScript,
	PJL, JCL oder hersteller-spezifischer Befehle).
	</para>

	<warning><para>
	<indexterm><primary>PDF</primary></indexterm>
	Eine PostScript-Datei, die angelegt wurde, um geräte-spezifische Befehle zum Erreichen einer bestimmten
	Druckausgabe (z.B. Duplexdruck, Stapeldruck oder Faltungen) auf einem bestimmten Ausgabegerät zu
	enthalten, kann möglicherweise nicht so drucken, wie erwartet, oder auf anderen Druckermodellen gar
	nicht zu drucken sein; es kann auch sein, daß diese Datei nicht mehr für weitere Verarbeitung durch
	Software geeignet ist (z.B. durch ein PDF-distilling Programm).
	</para></warning>
	</sect2>

	<sect2>
	<title>Verwendung von Windows-formatierten Hersteller-PPDs</title>

	<para>
	CUPS kann mit allen spezifikations-gemässen PPDs ungehen, wie sie von Herstellern für ihre
	PostScript-Modelle bereitgestellt werden. Sogar wenn ein Hersteller unser Lieblings-Betriebssystem
	nicht in seinen Handbüchern und Broschüren erwähnt hat, können Sie sich sicher darauf verlassen:
	<emphasis>Wenn Sie die Windows NT Version der PPD erhalten, können Sie diese unverändert mit CUPS
	verwenden</emphasis> und daher die volle Leistungsfähigkeit Ihres Druckers nutzen, genauso wie ein
	Windows NT Benutzer es könnte!
	</para>

	<tip><para>
	Um die Spezifikations-Entsprechung einer beliebigen PPD online zu prüfen, gehen Sie auf
	<ulink noescape="1" url="http://www.cups.org/testppd.php">http://www.cups.org/testppd.php</ulink>
	und laden Sie Ihre PPD. Sie sehen das Ergebnis sofort. CUPS hat seit der Version 1.1.19 ein weitaus
	strikteres internes PPD-Parsing und eine Code-Prüfung aktiviert; im Fall von Druckerproblemen sollte
	diese Online-Ressource einer Ihrer ersten Anlaufstellen sein.
	</para></tip>

	<warning><para>
	<indexterm><primary>foomatic</primary></indexterm>
	<indexterm><primary>cupsomatic</primary></indexterm>
	Für tatsächliche PostScript-Drucker verwenden Sie <emphasis>nicht</emphasis> die
	<emphasis>Foomatic</emphasis> oder <emphasis>cupsomatic</emphasis> PPDs von Linuxprinting.org. Mit diesen
	Geräten sind immer die vom Hersteller bereitgestellten PPDs erste Wahl!
	</para></warning>

	<tip><para>
	Wenn Sie nach einem Original-Hersteller-PPD eines spezifischen Geräts suchen, und Sie wissen, daß eine
	NT4-Box (oder irgendeine andere Windows-Box) in Ihrem LAN den PostScript-Treiber installiert hat,
	verwenden Sie einfach <command>smbclient //NT4-box/print\$ -U username</command>, um auf das
	Windows-Verzeichnis zuzugreifen, in dem alle Druckertreiber-Dateien gespeichert sind. Durchsuchen Sie
	zuerst das Unterverzeichnis <filename>W32X86/2</filename> nach den gesuchten PPDs.
	</para></tip>
	</sect2>

	<sect2>
	<title>CUPS verwendet auch PPDs für Nicht-PostScript-Drucker</title>

	<para>
	CUPS verwendet auch spezielle PPDs, um mit Nicht-PostScript-Druckern umzugehen. Diese PPDs sind
	üblicherweise nicht von den Herstellern verfügbar (und, nein, Sie können nicht einfach das die PPD
	eines PostScript-Druckers mit demselben Modellnamen verwenden und hoffen, daß diese auch mit der
	Nicht-PostScript-Version funktioniert). Um zu verstehen, wie diese PPDs funktionieren, müssen wir
	zuerst tief in die Architektur der CUPS-Filter und -Dateiwandlung eintauchen. Bleiben Sie dran.
	</para>
	</sect2>
</sect1>

<title>Die CUPS Filter-Architektur</title>

<para>
Der Kern des CUPS-Filter-Systems beruht auf Ghostscript. Zusätzlich dazu verwendet CUPS einige andere eigene
Filter. Sie (oder der Hersteller Ihres Betriebssystems) können sogar noch mehr Filter hinzugefügt haben.
CUPS behandelt alle Dateiformate unter der Zuordnung verschiedener MIME-Typen. Jede einlangende Druckdatei
wird einem initialen Auto-Typing zugeführt. Dieses Auto-Typing bestimmt den MIME-Typ der Druckdatei. Ein
bestimmter MIME-Typ bedingt null keine oder mehrere mögliche Filter-Ketten, die für den gewählten Zieldrucker
relevant sind. Dieser Abschnitt behandelt, wie die Erkennungs- und Umwandlungs-Regeln von MIME-Typen
zusammenarbeiten. Sie werden von CUPS dazu verwendet, um automatisch eine funktionierende Filterkette für
jedes beliebige Eingabe-Datenformat zu bilden.
</para>

<para>
Wenn CUPS eine PostScript-Datei in ein Bitmap rastert, passiert dies in 2 Stufen:
</para>

<itemizedlist>
	<listitem><para>Die erste Stufe verwendet ein Ghostscript-device namens <quote>cups</quote>
	(dies seit Version 1.1.15), und erzeugt ein generisches Raster-Format namens
	<quote>CUPS raster</quote>.
</para></listitem>

<listitem><para>Die zweite Stufe verwendet einen <quote>raster driver</quote>, der das generische
	<quote>CUPS raster</quote> in ein geräte-spezifisches Raster konvertiert.</para></listitem>
</itemizedlist>

<para>
Stellen Sie sicher, daß Ihre Ghostscript-Version das Gerät <quote>cups</quote> einkompiliert hat
(Überprüfung mittels <command>gs -h | grep cups</command>). Ansonsten könnten Sie das gefürchtete
<computeroutput>Unable to convert file 0</computeroutput> in Ihrer CUPS error_log Datei vorfinden. Um
<quote>cups</quote> als GErät in Ihrem Ghostscript zu haben, müssen Sie entweder GNU Ghostscript patchen und
neu kompilieren, oder Sie verwenden
<indexterm><primary>ESP</primary><secondary>Ghostscript</secondary>
</indexterm><ulink
url="http://www.cups.org/ghostscript.php">ESP Ghostscript</ulink>.
Die bessere Alternative ist ESP Ghostscript. Es unterstützt nicht nur CUPS, sondern auch 300 andere Geräte
(während GNU Ghostscript nur ungefähr 180 Geräte unterstützt). Wegen dieser breiten Unterstützung von
Ausgabegeräten ist ESP Ghostscript auch die erste Wahl für nicht-CUPS-Spooler. Es wird mittlerweile von
Linuxprinting.org für alle Spooler empfohlen.
</para>

<para>
<indexterm><primary>cupsomatic</primary></indexterm>
<indexterm><primary>foomatic</primary></indexterm>
CUPS-Drucker können zur Verwendung externer Darstellungs-Pfade. Einer der gängigsten ist das
Konzept Foomatic/cupsomatic von <ulink url="http://www.linuxprinting.org/">Linuxprinting.org.</ulink>
Dieses verwendet den klassischen Ghostscript-Ansatz, alles auf einmal zu tun. Es verwendet nicht das Gerät
<quote>cups</quote>, sondern eines der vielen anderen.
<indexterm><primary>ESP</primary><secondary>Ghostscript</secondary></indexterm>
Jedoch erzielt man auch bei Verwendung von
Foomatic/cupsomatic das beste Ergebnis und die breiteste Drucker-Modell-Unterstützung mit ESP Ghostscript
(mehr zu cupsomatic/Foomatic, im Speziellen zur neuen Version, die jetzt <emphasis>foomatic-rip</emphasis>
heißt, weiter unten).
</para>

<sect2>
<title>MIME-Typen und CUPS-Filter</title>


<para>
<indexterm><primary>MIME</primary><secondary>Filter</secondary></indexterm>
	<indexterm><primary>MIME</primary></indexterm>
CUPS liest die Datei <filename>/etc/cups/mime.types</filename> (und alle anderen Dateien mit einem Suffix
<filename>*.types</filename> im selben Verzeichnis) beim Start. Diese Dateien enthalten die
MIME-Typ-Erkennungs-Regeln, die angewendet werden, wenn CUPS seine Auto-Typing-Routinen ausführt.
Die Regel-Syntax wird in der manpage von <filename>mime.types</filename> erklärt und in dem
Abschnitt "comments" in der Datei <filename>mime.types</filename> selbst. Eine einfache Regel sieht so aus:

<indexterm><primary>application/pdf</primary></indexterm>
<filterline>
 application/pdf         pdf string(0,%PDF)
</filterline>

Das bedeutet, daß wenn ein Dateiname den Suffix <filename>.pdf</filename> hat oder der magische String
<emphasis>%PDF</emphasis> exakt am Beginn der Datei selbst (Offset 0 vom Start) steht, ist dies eine
PDF-Datei ((<parameter>application/pdf</parameter>). Eine weitere Regel ist:

<filterline>
 application/postscript  ai eps ps string(0,%!) string(0,&lt;04&gt;%!)
</filterline>

Wenn der Dateiname einen der Suffixes <filename>.ai</filename>, <filename>.eps</filename>,
<filename>.ps</filename> hat, oder die Datei selbst mit einem der Strings
<emphasis>%!</emphasis> oder <emphasis><![CDATA[<04>%!]]></emphasis> beginnt, ist es eine generische
PostScript-Datei (<parameter>application/postscript</parameter>).
</para>

<warning><para>
Verwechseln Sie nicht die anderen mime.types Dateien, die Ihr System verwendet, mit denen im Verzeichnis
<filename>/etc/cups/</filename>.
</para></warning>

<note><para>
Es gibt einen wichtigen Unterschied zwischen zwei ähnlichen MIME-Typen in CUPS: einer ist
<parameter>application/postscript</parameter>, der andere ist
<parameter>application/vnd.cups-postscript</parameter>. Während <parameter>application/postscript</parameter>
geräte-unabhängig sein soll (Auftrags-Optionen sind immer noch außerhalb des PS-Datei-Inhalts,
von CUPS eingebettet in der Befehlszeile oder Umgebungsvariablen), kann
<parameter>application/vnd.cups-postscript</parameter> die Auftrags-Optionen in die Postscript-Daten selbst
eingefügt erhalten (wo anwendbar). Die Transformation des generischen PostScript-Formats
(<parameter>application/postscript</parameter>) zu geräte-spezifischem PostScript
(<parameter>application/vnd.cups-postscript</parameter>) ist die Aufgabe des CUPS-Filters
<parameter>pstops</parameter>. pstops verwendet Informationen aus dem PPD, um die Transformation durchzuführen.
</para></note>

<para>
CUPS kann mit seinen Filtern folgende Formate und ihre zugehörigen MIME-Typen handhaben:
ASCII text, HP-GL, PDF, PostScript, DVI, und viele Bild-Formate (GIF. PNG, TIFF, JPEG, Photo-CD, SUN-Raster,
PNM, PBM, SGI-RGB, und noch mehr).
</para>
</sect2>

<sect2>
<title>MIME Typ Umwandlungs-Regeln</title>


<para>
<indexterm><primary>MIME</primary></indexterm>
<indexterm><primary>application/pdf</primary></indexterm>
CUPS liest die Datei <filename>/etc/cups/mime.convs</filename> (und alle anderen Dateien mit der Endung
<filename>*.convs</filename> im selben Verzeichnis) beim Starten. Diese Dateien enthalten Zeilen, diese
benennen einen Eingabe-MIME-Typus, einen Ausgabe-MIME-Typus, einen Format-Wandlungs-Filter, der den
Ausgabe-Typus aus dem Eingabe-Typus erzeugen kann, sowie virtuelle Kosten, die mit dieser Wandlung verbunden
sind. Ein Beispiel für eine solche Zeile ist dies:

<filterline>
 application/pdf         application/postscript   33   pdftops
</filterline>

Das bedeutet, daß der Filter <parameter>pdftops</parameter> den Typ <parameter>application/pdf</parameter> als
Eingabe verwenden und daraus <parameter>application/postscript</parameter> als Ausgabe erzeugen wird; die
virtuellen Kosten dieser Operation sind 33 CUPS-$. Der nächste Filter ist teurer, er kostet 66 CUPS-$:

<indexterm><primary>pdf</primary></indexterm>

<filterline>
 application/vnd.hp-HPGL application/postscript   66   hpgltops
</filterline>

Dies ist der Filter <parameter>hpgltops</parameter>, der HP-GL Plotter-Dateien in PostScript umwandelt.

<indexterm><primary>application/octet-stream</primary></indexterm>

<filterline>
 application/octet-stream
</filterline>

Hier zwei weitere Beispiele:

<indexterm><primary>text/plain</primary></indexterm>

<filterline>
 application/x-shell     application/postscript   33    texttops
 text/plain              application/postscript   33    texttops
</filterline>

Die letzten beiden Beispiele lassen den Filter <parameter>texttops</parameter> sowohl an
<parameter>text/plain</parameter>, wie auch an <parameter>application/x-shell</parameter> arbeiten.
(Hinweis: Diese Unterscheidung wird für das Syntax-Highlighting von <parameter>texttops</parameter>
benötigt).
</para>
</sect2>

<sect2>
<title>Überblick über das Filtern</title>


<para>
<indexterm><primary>MIME</primary></indexterm>
Es gibt viel mehr Kombinationen in <filename>mime.convs</filename>. Sie sind jedoch nicht darauf beschränkt,
die hier vordefinierten Kombinationen zu verwenden. Sie können jeden Filter, den Sie wollen, in das
CUPS-Grundgerüst einsetzen. Es muß einigen minimalen Erfordernissen entsprechen, oder dazu gebracht werden.
Wenn Sie irgend einen coolen Filter finden (oder schreiben), stellen Sie sicher, daß er dem entspricht, was CUPS
braucht, und daß Sie die richtigen Zeilen in die Dateien <filename>mime.types</filename> und
<filename>mime.convs</filename> einfügen, dann wird er nahtlos innerhalb CUPS arbeiten.
</para>

<sect3>
<title>Filter Erfordernisse</title>
<para>
Die erwähnten <quote>CUPS Erfordernisse</quote> für Filter sind simpel. Nehmen Sie Dateinamen oder
<filename>stdin</filename> als Input und schreiben Sie diesen auf <filename>stdout</filename>. Die Filter
sollten diese 5-6 Argumente verstehen:
<emphasis>printer job user title copies options [filename]</emphasis>
</para>

<variablelist>
<varlistentry><term>printer </term>
<listitem><para>
Der Name der Drucker-Queue (normalerweise ist dies der Name des ausgeführten Filters).</para></listitem>
</varlistentry>

<varlistentry><term>job </term>
<listitem><para>Die numerische Auftrags-ID des gerade gedruckten Auftrags.</para></listitem>
</varlistentry>

<varlistentry><term>user </term>
<listitem><para>Der String aus dem Attribut originating-user-name.</para></listitem>
</varlistentry>

<varlistentry><term>title </term>
<listitem><para>Der String aus dem Attribut job-name.</para></listitem>
</varlistentry>

<varlistentry><term>copies </term>
<listitem><para>Der numerische Wert des Attributs number-copies.</para></listitem>
</varlistentry>

<varlistentry><term>options </term>
<listitem><para>Die Auftrags-Optionen.</para></listitem>
</varlistentry>

<varlistentry><term>filename </term>
<listitem><para>(Optional) Die Datei der Druckanfrage (wenn dies fehlt, erwarten die Filter, die Daten
über <filename>stdin</filename> geliefert zu bekommen).
In den meisten Fällen ist es einfach, ein einfaches Wrapper-Skript um Filter zu schreiben, um sie mit
CUPS arbeiten zu lassen.</para></listitem>
</varlistentry>
</variablelist>
</sect3>
</sect2>

<sect2>
<title>Vorfilter ("Prefilters")</title>


<para>
<indexterm><primary>PostScript</primary></indexterm>
Wie zuvor bemerkt, ist PostScript das zentrale Dateiformat für jedes UNIX-basierende Drucksystem. Von
PostScript aus generiert CUPS Rasterdaten zur Lieferung an Nicht-PostScript-Drucker.
</para>

<para>
Aber was passiert, wenn Sie eines der unterstützten Nicht-PS-Formate in den Druck schicken? Dann verwendet
CUPS <quote>pre-filters</quote> auf diese Eingabeformate, um als erstes PostScript zu erzeugen. Es gibt solche
Vorfilter, um PS aus ASCII text, PDF, DVI, oder HP-GL zu erzeugen. Die Ausgabe dieser Filter ist immer vom
MIME Typ <parameter>application/postscript</parameter> (das bedeutet, daß jegliche geräte-spezifische
Druckoptionen noch nicht von CUPS ins PS eingebettet werden, und daß der nächste aufzurufende Filter
pstops ist). Ein weiterer Vorfilter läuft über alle unterstützten Bildformate, der Filter
<parameter>imagetops</parameter>. Seine Ausgabe ist immer vom MIME Typ
<parameter>application/vnd.cups-postscript</parameter> (nicht application/postscript), was bedeutet, daß sie
die Druckoptionen bereits in der Datei eingebettet hat.
</para>

<para>
	<image scale="25"><imagedescription>Das Vorfiltern in CUPS, um PostScript zu erzeugen.</imagedescription>
	<imagefile>4small</imagefile>
</image>
</para>
</sect2>

<sect2>
<title>pstops</title>

<para>
<emphasis>pstops</emphasis> ist der Filter, um
<parameter>application/postscript</parameter> auf <?latex \linebreak ?>
<parameter>application/vnd.cups-postscript</parameter> zu wandeln. Es wurde bereits oben erwähnt, daß dieser
Filter alle geräte-spezifischen Druckoptionen (Befehle an den Drucker, um Duplexdruck, Stapeln und Lochen zu
veranlassen, usw.) in die PostScript-Datei einbindet.
</para>

<para>
	<image scale="25"><imagedescription>Das Hinzufügen von geräte-spezifischen Druckoptionen.</imagedescription>
		<imagefile>5small</imagefile>
	</image>
</para>

<para>
Das ist nicht alles. Andere ausgeführte Aufgaben sind:
</para>

<itemizedlist>
<listitem><para>
Die Auswahl der zu druckenden Seiten (wenn Sie nur die Seiten <quote>3, 6, 8-11, 16, 19-21</quote> drucken
wollen, oder nur die ungeraden Seiten).
</para></listitem>

<listitem><para>
Zwei oder mehr logische Seiten auf ein Blatt Papier drucken (die sogenannte <quote>number-up</quote> Funktion).
</para></listitem>

<listitem><para>
Das Zählen der Seiten des Auftrags, um die Abrechnungs-Information in die Datei
<filename>/var/log/cups/page_log</filename> zu schreiben.
</para></listitem>
</itemizedlist>
</sect2>

<sect2>
<title>pstoraster</title>

<para>
<parameter>pstoraster</parameter> ist im Kern des CUPS-Filtersystems. Er ist verantwortlich für die erste Stufe
des Raster-Prozesses. Sein Input ist vom MIME-Typ application/vnd.cups-postscript; seine Ausgabe ist
application/vnd.cups-raster. Dieses Ausgabeformat ist noch nicht zum Drucken gedacht, die Aufgabe ist, als
allgemeines Input-Format für spezialisierte <emphasis>Raster-Treiber</emphasis> gedacht, die imstande sind,
geräte-spezifische Druckerdaten zu generieren.
</para>

<para>
	<image scale="25"><imagedescription>PostScript auf Übergangs-Raster-Format.</imagedescription><imagefile>6small</imagefile></image>
</para>

<para>
CUPS-Raster ist ein generisches Rasterformat mit mächtigen Eigenschaften. Es ist imstande, Informationen zu
einzelnen Seiten, Farbprofile, und mehr zu inkludieren, um diese Informationen nachfolgenden Raster-Treibern
zu übergeben. Sein MIME-Typ ist bei IANA registriert und seine Spezifikation ist, natürlich, völlig offen.
Es ist entworfen, um es Herstellern zu ermöglichen, ziemlich einfach und günstig Raster-Treiber für Linux
und UNIX zu entwickeln, wenn diese es möchten. CUPS übernimmt immer die erste Stufe des Rasterns, so daß
Hersteller sich nicht um die Ghostscript-Komplikationen kümmern müssen (tatsächlich gibt es derzeit mehr als
nur einen Hersteller, der die Entwicklung von CUPS-Raster-Treibern finanziert).
</para>

<para>
	<image><imagedescription>CUPS-Raster Erzeugung mittels Ghostscript.</imagedescription>
		<imagefile>7small</imagefile>
	</image>
</para>

<para>
CUPS-Versionen vor Version 1.1.15 beinhalteten einen binären (oder source code) Standalone-Filter namens
<parameter>pstoraster</parameter>. <parameter>pstoraster</parameter> wurde von GNU Ghostscript 5.50
abgeleitet, und konnte neben oder zusätzlich zu einem beliebigen GNU oder AFPL Ghostscript-Paket
installiert werden, ohne Konflikte zu verursachen.
</para>

<para>
Mit Version 1.1.15 hat sich dies geändert. Die dafür benötigten Funktionen wurden zurück in Ghostscript
integriert (nun basierend auf GNU Ghostscript Version 7.05). Der <parameter>pstoraster</parameter>-Filter
ist nun ein einfaches Shell-Skript, das <command>gs</command> mit dem Parameter <command>-sDEVICE=cups</command>
aufruft. Wenn Ihr Ghostscript nicht erfolgreich auf <command>gs -h |grep cups</command> antwortet, könnte es
sein, daß Sie nicht drucken können. Aktualisieren Sie Ihr Ghostscript.
</para>
</sect2>

<sect2>
<title>imagetops und imagetoraster</title>

<para>
Im Abschnitt über Vorfilter haben wir den Vorfilter erwähnt, der PostScript aus Bildformaten erzeugt. Der
Filter <parameter>imagetoraster</parameter> wird verwendet, um Bilder direkt auf Raster zu konvertieren, ohne
die Zwischenstufe PostScript. Er wird öfter als die oben erwähnten Vorfilter verwendet. Wir fassen das
Filtern von Bilddateien im <link linkend="small8">nächsten Bild</link> zusammen.
</para>

<para>
	<image id="small8"><imagedescription>Konvertierung von Bildformaten zu CUPS-Raster-Format.</imagedescription>
		<imagefile>8small</imagefile>
	</image>
</para>

</sect2>

<sect2>
<title>rasterto [druckerspezifisch]</title>

<para>
CUPS wird mit ziemlich verschiedenen Rastertreibern geliefert, die CUPS-Raster verarbeiten. Auf meinem System
finde ich in /usr/lib/cups/filter/ diese:
<parameter>rastertoalps</parameter>, <parameter>rastertobj</parameter>, <parameter>rastertoepson</parameter>, <parameter>rastertoescp</parameter>,
<parameter>rastertopcl</parameter>, <parameter>rastertoturboprint</parameter>, <parameter>rastertoapdk</parameter>, <parameter>rastertodymo</parameter>,
<parameter>rastertoescp</parameter>, <parameter>rastertohp</parameter>, und
<parameter>rastertoprinter</parameter>.
Keine Sorge, wenn Sie weniger Filter vorfinden; manche von diesen wurden von kommerziellen CUPS-Erweiterungen
installiert (wie <parameter>rastertoturboprint</parameter>), andere (wie <parameter>rastertoprinter</parameter>)
von sogenannten "third-party" Treiber-Entwicklungs-Projekten (wie Gimp-Print), um möglichst eng mit CUPS
zusammen zu arbeiten.
</para>

<para>
	<image id="small9"><imagedescription>Raster auf druckerspezifische Formate.</imagedescription>
		<imagefile>9small</imagefile>
	</image>
</para>
</sect2>

<sect2>
<title>CUPS Backends</title>

<para>
Der letzte Teil jeder CUPS-Filterkette ist ein Backend. Backends sind spezielle Programme, die das druckfertige
Programm schlußendlich an das Gerät senden. Es gibt ein separates Backend-Programm für jedes Transfer-Protokoll,
um Druckaufträge über das Netzwerk zu senden, oder für jedes lokales Interface. Jede CUPS-Druckwarteschlange
braucht eine CUPS <quote>device-URI</quote>, mit dem es assoziiert wird. Die device URI ist eine Art, das
Backend enkodiert anzugeben, das verwendet wird, um den Auftrag an seinen Bestimmungsort zu senden.
Netzwerk device-URIs verwenden zwei Schrägstriche in ihrer Syntax, lokale device-URIs nur einen, wie Sie der
folgenden Liste entnehmen können. Bitte denken Sie daran, daß die Namen der lokalen Interfaces stark von
den hier angegebenen Beispielen abweichen können, wenn Ihr Betriebssystem nicht Linux ist:
</para>

<variablelist>
	<varlistentry><term>usb </term>
	<listitem><para>
	Dieses Backend sendet Druckdateien auf mittels USB angeschlossene Drucker. Ein Beispiel für die
	CUPS device-URI ist:
	<filename>usb:/dev/usb/lp0</filename>.
	</para></listitem></varlistentry>

	<varlistentry><term>serial </term>
	<listitem><para>
	Dieses Backend sendet Druckdateien auf seriell angeschlossene Drucker. Ein Beispiel für die
        CUPS device-URI ist:
	<filename>serial:/dev/ttyS0?baud=11500</filename>.
	</para></listitem></varlistentry>

	<varlistentry><term>parallel </term>
	<listitem><para>
	Dieses Backend sendet Druckdateien auf an Parallel-Ports angeschlossene Drucker. Ein Beispiel für die
        CUPS device-URI ist:
	<filename>parallel:/dev/lp0</filename>.
	</para></listitem></varlistentry>

	<varlistentry><term>SCSI </term>
	<listitem><para>
	Dieses Backend sendet Druckdateien auf an das SCSI-Interface angeschlossene Drucker. Ein Beispiel für die
        CUPS device-URI ist:
	<filename>scsi:/dev/sr1</filename>.
	</para></listitem></varlistentry>

	<varlistentry><term>lpd </term>
	<listitem><para>
	Dieses Backend sendet Druckdateien auf über LPR/LPD angeschlossene Netzwerk-Drucker. Ein Beispiel für die
        CUPS device-URI ist:
	<filename>lpd://remote_host_name/remote_queue_name</filename>.
	</para></listitem></varlistentry>

	<varlistentry><term>AppSocket/HP JetDirect </term>
	<listitem><para>
	Dieses Backend sendet Druckdateien an mittels AppSocket (a.k.a. "HP JetDirect") angeschlossene
	Netzwerk-Drucker. Ein Beispiel für die
        CUPS device-URI ist:
	<filename>socket://10.11.12.13:9100</filename>.
	</para></listitem></varlistentry>

	<varlistentry><term>ipp </term>
	<listitem><para>
	Dieses Backend sendet Druckdateien an mittels IPP angeschlossene Netzwerk-Drucker. Ein Beispiel für die
        CUPS device-URI ist:
	<filename>ipp:://192.193.194.195/ipp</filename>
	(für viele HP-Drucker) oder
	<filename>ipp://remote_cups_server/printers/remote_printer_name</filename>.
	</para></listitem></varlistentry>

	<varlistentry><term>http </term>
	<listitem><para>
	Dieses Backend sendet Druckdateien an mittels HTTP angeschlossene Drucker.
	(Das http:// CUPS-Backend ist nur ein symlink auf das ipp:// Backend.)
	Beispiele für die CUPS device-URIs sind:
	<filename>http:://192.193.194.195:631/ipp</filename>
	(für viele HP-Drucker) oder
	<filename>http://remote_cups_server:631/printers/remote_printer_name</filename>.
	</para></listitem></varlistentry>

	<varlistentry><term>smb </term>
	<listitem><para>
	Dieses Backend sendet Druckdateien an Windows-Druckerfreigaben.
	Ein Beispiel für die CUPS device-URI ist:
	</para>

	<para>
	<simplelist>
	<member><filename>smb://workgroup/server/printersharename</filename></member>
	<member><filename>smb://server/printersharename</filename></member>
	<member><filename>smb://username:password@workgroup/server/printersharename</filename></member>
	<member><filename>smb://username:password@server/printersharename</filename></member>
	</simplelist>
	</para>

	<para>
	Das smb:// Backend ist ein Symlink auf das Samba-Werkzeug <parameter>smbspool</parameter> (nicht in
	CUPS inkludiert). Wenn der Symlink in Ihrem CUPS-Backend-Verzeichnis nicht vorhanden ist, können Sie
	es mittels root-Benutzer anlegen (lassen): <command>ln -s `which smbspool'
        /usr/lib/cups/backend/smb</command>.
	</para></listitem></varlistentry>
</variablelist>

<para>
Es ist einfach, Ihre eigenen Backends als Shell- oder Perl-Skripts zu schreiben, wenn Sie irgendeine Änderung
oder Erweiterung zum CUPS-Druck-System brauchen. Ein Grund könnte sein, daß Sie <quote>spezielle</quote>
Drucker anlegen wollen, die Druckaufträge per email senden (durch das <quote>mailto:/</quote> Backend), diese
in PDF wandeln (durch das <quote>pdfgen:/</quote> Backend), oder sie mittels <quote>/dev/null</quote> entsorgen.
(Tatsächlich habe ich den systemweiten Standard-Drucker so installiert, daß mit einem devnull:/ Backend verbunden
ist; es gibt einfach zu viele Leute, die Aufträge ohne Angabe eines Druckers senden, oder Skripts und Programme,
die keinen Drucker angeben. Der systemweite Standard löscht den Auftrag und sendet eine höfliche Email zurück
an den $USER, in der er gebeten wird, immer den richtigen Druckernamen anzugeben.)
</para>

<para>
Nicht alle erwähnten Backends müssen auf Ihrem System vorhanden oder verwendbar sein (abhängig von der
Hardware-Konfiguration). Ein Test für alle verfügbaren CUPS-Backends ist mit dem Werkzeug
<emphasis>lpinfo</emphasis> möglich. Mit der Option <option>-v</option> listet es alle verfügbaren Backends:
</para>

<para><screen>
&prompt;<userinput>lpinfo -v</userinput>
</screen></para>
</sect2>

<sect2>
<title>Die Rolle von <parameter>cupsomatic/foomatic</parameter></title>

<para>
<indexterm><primary>cupsomatic</primary></indexterm>
<indexterm><primary>foomatic</primary></indexterm>
<parameter>cupsomatic</parameter>-Filter sind wahrscheinlich die meist verwendeten Filter in CUPS-Installationen.
Seien sich im Klaren darüber, daß diese Filter nicht von den CUPS-Leuten entwickelt wurden. Es sind "third party"
Erweiterungen für CUPS. Sie verwenden die traditionellen Ghostscript devices, um Aufträge für CUPS darzustellen.
Bei der Fehlersuche sollten Sie über den Unterschied Bescheid wissen. Hier findet der gesamte Darstellungsprozess
in einem Schritt statt, innerhalb von Ghostscript, unter Verwendung eines passenden device für den Ziel-Drucker.
<parameter>cupsomatic</parameter> verwendet PPDs, die aus der Foomatic Drucker &amp; Treiber Datenbank auf
Linuxprinting.org generiert werden.
</para>

<para>
Sie erkennen diese PPDs an der Zeile, die den <parameter>cupsomatic</parameter> Filter aufruft:

<filterline>
 *cupsFilter: "application/vnd.cups-postscript  0  cupsomatic"
</filterline>

Sie finden diese Zeile unter den ersten 40 (oder ähnlich) Zeilen der PPD-Datei. Wenn Sie ein solches PPD
installiert haben, scheint der Drucker im CUPS Web Interface mit der Erwähnung <parameter>foomatic</parameter>
in der Treiberbeschreibung auf. <parameter>cupsomatic</parameter> ist ein Perl-Skript, das Ghostscript mit all
den komplizierten Befehlszeilen-Optionen aufruft, automatisch generiert aus dem gewählten PPD und den
Befehlszeilen-Optionen, die dem Druckauftrag mitgegeben wurden.
</para>

<para>
<indexterm><primary>point 'n' print</primary></indexterm>
Jedoch ist <parameter>cupsomatic</parameter> mittlerweile veraltet. Seine PPDs (besonders deren erste Generation,
immer noch in regem Gebrauch da draussen) entsprechen nicht den Adobe Spezifikationen. Sie könnten
Schwierigkeiten damit haben, wenn Sie sie mittels <quote>Point'n'Print</quote> auf Windows-Clients downloaden
wollen. Ein besserer und leistungsfähigerer Nachfolge ist nun in einer stabilen Beta-Version verfügbar:
er heisst <parameter>foomatic-rip</parameter>. Um <parameter>foomatic-rip</parameter> als Filter mit CUPS zu
verwenden, brauchen Sie die PPDs von neueren Typ. Diese haben eine ähnliche, jedoch andere Zeile:

<filterline>
 *cupsFilter: "application/vnd.cups-postscript  0  foomatic-rip"
</filterline>

Der Mechanismus auf Linuxprinting.org, der PPDs generiert, wurde umgestaltet. Die neuen PPDs entsprechen den
Adobe Spezifikationen. Zuoberst stellen Sie eine neue Art bereit, um verschiedene Qualitätsstufen anzugeben
(hochauflösende Fotos, normale Farbe, Graustufen und Entwurf), mit einem einzelnen Click, wo Sie zuvor fünf
oder mehr verschiedene Auswahlen treffen mußten (Medientyp, Auflösung, Tintenart und Dithering-Algorithmus).
Es gibt Unterstützung für individuelle Mediengrössen. Es gibt Unterstützung für das Umschalten von Optionen
zwischen einzelnen Seiten eines Druckauftrags. Und das Beste ist, daß der neue foomatic-rip nun nahtlos mit
allen klassischen Spoolern zusammenarbeitet (wie LPRng, BSD-LPD, PDQ, PPR usw.), was diesen Spoolern die
Verwendung von PPDs eröffnet.
</para>
</sect2>

<sect2>
<title>Das gesamte Bild</title>

<para>
Wenn Sie einen Überblick über all die Filter sehen wollen, und wie sie sich zueinander verhalten, finden Sie
das gesamte Bild dieses Puzzles am Ende dieses Dokuments.
</para>
</sect2>

<sect2>
<title><filename>mime.convs</filename></title>

<para>
CUPS bildet automatisch alle möglichen Filterketten für jeden beliebigen MIME-Typ, und jeden installierten
Drucker. Aber wie entscheidet es für oder gegen eine bestimmte Alternative? (Es kann oft Fälle geben, in denen
es zwei oder mehr Filterketten für denselben Ziel-Drucker gibt.) Einfach. Sie haben vielleicht die Zahlen in der
dritten Spalte der Datei mime.convs bemerkt. Diese repräsentieren virtuelle Kosten, die dem jeweiligen Filter
zugeordnet sind. Jede mögliche Filterkette ergibt eine Summe von <quote>Filter-Kosten.</quote>CUPS entscheidet
zugunsten der <quote>günstigsten</quote> Route.
</para>

<tip><para>
Die Einstellung von <parameter>FilterLimit 1000</parameter> in <filename>cupsd.conf</filename> erlaubt es nicht,
mehr Filter gleichzeitig auszuführen, als solche, die insgesamt 1000 virtuelle Filter-Kosten verbrauchen. Dies
ist eine effiziente Art, die Last eines CUPS-Servers zu begrenzen, indem man einen passenden Wert für
<quote>FilterLimit</quote> setzt. Ein FilterLimit von 200 erlaubt nur ungefähr einen Auftrag zur gleichen Zeit,
während ein FilterLimit von 1000 ungefähr 5 Aufträge gleichzeitig erlaubt.
</para></tip>
</sect2>

<sect2>
	<title><quote>Raw</quote> Druck</title>

<para>
Sie können CUPS (so ziemlich) jede Datei <quote>raw</quote> drucken lassen. <quote>Raw</quote> bedeutet, daß sie
nicht gefiltert wird. CUPS sendet die Datei an den Drucker <quote>wie sie ist</quote>, ohne sich darum zu
kümmern, ob der Drucker imstande ist, diese Datei zu <quote>verdauen</quote>. Die Benutzer müssen sich selbst
darum kümmern, daß sie nur sinnvolle Datenformate senden. Raw-Druck kann in jeder Warteschlange passieren, wenn
die Option <quote><parameter>-o raw</parameter></quote> auf der Befehlszeile angegeben wird. Sie können auch
nur-raw-Queues anlegen, indem Sie einfach keinerlei PPD mit einer Queue assoziieren. Dieser Befehl:
</para>

<para><screen>
&prompt;<userinput>lpadmin -P rawprinter -v socket://11.12.13.14:9100 -E</userinput>
</screen></para>

<para>
installiert eine Queue namens <quote>rawprinter</quote>, verbunden mittels dem Protokoll <quote>socket</quote>
(a.k.a. <quote>HP JetDirect</quote>) mit dem Gerät auf IP-Adresse 11.12.1.3.14, Port 9100. (Wenn Sie ein PPD
mit <command>-P /path/to/PPD</command> der Befehlszeile hinzugefügt hätten, hätten Sie eine
<quote>normale</quote> Druck-Queue installiert.)
</para>

<para>
CUPS behandelt automatisch jeden Auftrag, der an eine Queue gesendet wird, als <quote>raw</quote>, wenn es keine
mit der Queue assoziierte PPD vorfindet. Jedoch wird CUPS nur bekannte MIME-Typen senden (wie in seiner eigenen
Datei mime.types definiert) und andere ablehnen.
</para>
</sect2>

<sect2>
<title>application/octet-stream Druck</title>

<para>
Jeder MIME-Typ ohne Regel in der Datei <filename>/etc/cups/mime.types</filename> wird als unbekannt oder als
<parameter>application/octet-stream</parameter> betrachtet und nicht gesendet. Weil CUPS per Standard ablehnt,
unbekannte MIME-Typen zu drucken, haben Sie vielleicht schon einmal erlebt, daß Druckaufträge von Windows-Clients
nicht gedruckt wurden. Sie haben vielleicht eine Fehlermeldung in Ihren CUPS-Logdateien gefunden, die lautet wie:
</para>

<para><computeroutput>
 Unable to convert file 0 to printable format for job
</computeroutput></para>

<para>
Um das Drucken von Dateien des Typs <parameter>application/octet-stream</parameter> zu ermöglichen, müssen Sie
zwei Dateien editieren:
</para>

<itemizedlist>
<listitem><para><filename>/etc/cups/mime.convs</filename></para></listitem>

<listitem><para><filename>/etc/cups/mime.types</filename></para></listitem>
</itemizedlist>

<para>
Both contain entries (at the end of the respective files) which must
be uncommented to allow RAW mode operation for
<parameter>application/octet-stream</parameter>. In <filename>/etc/cups/mime.types</filename>
make sure this line is present:

<indexterm><primary>application/octet-stream</primary></indexterm>

<filterline>
application/octet-stream
</filterline>

This line (with no specific auto-typing rule set) makes all files
not otherwise auto-typed a member of <parameter>application/octet-stream</parameter>. In
<filename>/etc/cups/mime.convs</filename>, have this
line:

<filterline>
application/octet-stream   application/vnd.cups-raw   0   -
</filterline>

<indexterm><primary>MIME</primary></indexterm>

Diese Zeile weist CUPS an, für den MIME-Typen <parameter>application/octet-stream</parameter> den
<emphasis>Null Filter</emphasis> zu verwenden (markiert mit <quote>-</quote>, tut gar nichts), und das Resultat
als <parameter>application/vnd.cups-raw</parameter> zu kennzeichnen. Dies ist immer ein grünes Licht für den
CUPS-Scheduler, um die Datei an das Backend zu übergeben, das sich dann zum Drucker verbindet und die Datei
sendet.
</para>

<note><para>Das Editieren von <filename>mime.convs</filename> und <filename>mime.types</filename>
 <emphasis>erzwingt</emphasis> den <quote>raw</quote>-Druck nicht, es <emphasis>erlaubt</emphasis> ihn nur.
</para></note>

<formalpara>
<title>Hintergrund</title>

<para>
Da CUPS ein mehr sicherheitsbewußtes Drucksystem ist als die traditionellen Systeme, erlaubt es
in der Voreinstellung nicht, daß ein Benutzer beliebige (möglicherweise binäre) Daten an
Druck-Geräte sendet. (Dies könnte leicht dazu benutzt werden, um einen <quote>Denial of Service</quote>-Angriff
auf Ihre(n) Drucker zu starten, was zumindest den Verlust von einer Menge Papier und Tinte nach sich ziehen
würde.)
<quote>Unbekannte</quote> Daten werden von CUPS als <emphasis>MIME-Typ</emphasis>
<emphasis>application/octet-stream</emphasis> behandelt. Während Sie Daten <quote>raw</quote> senden
<emphasis>können</emphasis>, muß der MIME-Typ dafür einer sein, der CUPS bekannt ist, und erlaubt ist. Die Datei
<filename>/etc/cups/mime.types</filename> legt die Regeln fest, wie CUPS MIME-Typen erkennt. Die Datei
<filename>/etc/cups/mime.convs</filename> entscheidet, welche Wandlungs-Filter auf welche MIME-Typen angewandt
werden können.
</para>
</formalpara>
</sect2>

<sect2>
<title>PostScript Printer Descriptions (PPDs) für Nicht-PS-Drucker</title>


<para>
<indexterm><primary>PPD</primary></indexterm>
Ursprünglich waren PPDs nur zur Verwendung mit PostScript-Drucker gedacht. Hier helfen sie dabei,
geräte-spezifische Befehle und Einstellungen an den RIP zu senden, der die Auftragsdatei verarbeitet. CUPS hat
die Reichweite von PPDs erweitert, um auch Nicht-PS-Drucker abzudecken. Dies war nicht schwierig, da es ein
standardisiertes Dateiformat ist. Auf eine gewisse Art war es auch logisch: CUPS verarbeitet PostScript und
verwendet einen PostScript RIP (Ghostscript), um die Auftragsdateien zu verarbeiten. Der einzige Unterschied ist:
Ein PostScript-Drucker hat den RIP eingebaut, für die anderen Arten von Drucker läuft der Ghostscript RIP auf
dem Druck-Server.
</para>

<para>
PPDs für einen Nicht-PS-Drucker beinhalten ein paar Zeilen, die einzigartig für CUPS sind. Die wichtigste sieht
ungefähr so aus:

<indexterm><primary>application/vnd.cups-raster</primary></indexterm>

<filterline>
 *cupsFilter: application/vnd.cups-raster  66   rastertoprinter
</filterline>

Dies ist das letzte Stück im CUPS-Filter-Puzzle. Diese Zeile weist den CUPS-Daemon an, als letzten Filter
<parameter>rastertoprinter</parameter> zu verwenden. Dieser Filter sollte als Input eine Datei vom MIME-Typ
<parameter>application/vnd.cups-raster</parameter> serviert bekommen. Daher sollte CUPS automatisch eine
Filterkette konstruieren, die als letzte Ausgabe den angegebenen MIME-Typ liefert. Diese wird dann als Input
für den erwähnten Filter <parameter>rastertoprinter</parameter> verwendet. Nachdem der letzte Filter seine Arbeit
getan hat (<parameter>rastertoprinter</parameter> ist ein Gimp-Print-Filter), sollte die Datei an das Backend
gesendet werden, welches in weiterer Folge an das Ausgabe-Gerät sendet.
</para>

<para>
CUPS liefert standardmässig nur ein paar generische PPDs, aber diese sind verwendbar für ein paar hundert
Drucker-Modelle. Es kann sein, daß Sie damit nicht verschiedene Papierschächte verwalten könne, oder daß Sie
breitere Druckränder erhalten, als Ihr spezielles Modell unterstützt. Sehen Sie
<link linkend="cups-ppds">Mit CUPS gelieferte PPDs</link> für eine Zusammenfassung.
</para>

<table frame="all" id="cups-ppds">
	<title>Mit CUPS gelieferte PPDs</title>
	<tgroup cols="2" align="left">
		<colspec align="left"/>
		<colspec align="justify" width="1*"/>
		<thead><row><entry>PPD Datei</entry><entry>Drucker-Typ</entry></row></thead>
		<tbody>
		<row><entry>deskjet.ppd</entry><entry>ältere HP Inkjet Drucker und Kompatible</entry></row>

		<row><entry>deskjet2.ppd</entry> <entry>neuere HP Inkjet Drucker und Kompatible</entry> </row>

		<row><entry>dymo.ppd</entry> <entry>Label-Drucker</entry> </row>

		<row><entry>epson9.ppd</entry> <entry>Epson 9pin Nadeldrucker und Kompatible</entry> </row>

		<row><entry>epson24.ppd</entry> <entry>Epson 24pin Nadeldrucker und Kompatible</entry> </row>

		<row><entry>okidata9.ppd</entry> <entry>Okidata 9pin Nadeldrucker und Kompatible</entry> </row>

		<row><entry>okidat24.ppd</entry> <entry>Okidata 24pin Nadeldrucker und Kompatible</entry> </row>

		<row><entry>stcolor.ppd</entry> <entry>ältere Epson Stylus Color Drucker</entry> </row>

		<row><entry>stcolor2.ppd</entry> <entry>neuere Epson Stylus Color Drucker</entry> </row>

		<row><entry>stphoto.ppd</entry> <entry>ältere Epson Stylus Photo Drucker</entry> </row>

		<row><entry>stphoto2.ppd</entry> <entry>neuere Epson Stylus Photo Drucker</entry> </row>

		<row><entry>laserjet.ppd</entry> <entry>alle PCL Drucker. Weiter unten finden Sie mehr über
		einige andere Treiber/PPD-Pakete, die für die Verwendung mit CUPS geeignet sind.</entry> </row>

		</tbody>
	</tgroup>
</table>

</sect2>

<sect2>
<title><emphasis>cupsomatic/foomatic-rip</emphasis> versus <emphasis>nativer CUPS</emphasis>-Druck</title>


<para>
<indexterm><primary>cupsomatic</primary></indexterm>
<indexterm><primary>foomatic-rip</primary></indexterm>
Natives CUPS-Rastern arbeitet in zwei Schritten:
</para>

<itemizedlist>
<listitem><para>
Zuerst kommt der Schritt <parameter>pstoraster</parameter>. Dies verwendet das spezielle CUPS-device
<indexterm><primary>ESP</primary><secondary>Ghostscript</secondary></indexterm>
aus ESP Ghostscript 7.05.x als Werkzeug.
</para></listitem>

<listitem><para>
Als zweites kommt der Schritt <parameter>rasterdriver</parameter>. Er verwendet geräte-spezifische Filter; es
gibt einige Hersteller, die Filter guter Qualität für diesen Schritt zur Verfügung stellen. Manche sind freie
Software, andere Shareware/nicht-frei, manche proprietär.</para></listitem>
</itemizedlist>

<para>
Oft erzeugt dies bessere Qualität (und hat einige Vorteile mehr) als andere Methoden.
</para>

<para>
	<image id="cupsomatic-dia"><imagedescription>cupsomatic/foomatic Verarbeitung versus nativem CUPS.</imagedescription>
		<imagefile>10small</imagefile>
	</image>
</para>

<para>
Eine andere Methode ist der Weg über <parameter>cupsomatic/foomatic-rip</parameter>. Beachten Sie, daß
<parameter>cupsomatic</parameter> <emphasis>nicht</emphasis> von den CUPS-Leuten geschrieben wird. Dies ist ein
unabhängiger Beitrag zur Entwicklung des Druckens von den Leuten von Linuxprinting.org <footnote>sehen Sie auch
<ulink noescape="1" url="http://www.cups.org/cups-help.html">http://www.cups.org/cups-help.html</ulink></footnote>.
<parameter>cupsomatic</parameter> wird nicht mehr entwickelt, gewartet oder unterstützt. Es wurde ersetzt durch
<parameter>foomatic-rip</parameter>. <parameter>foomatic-rip</parameter> ist eine komplette Neufassung der alten
Idee von <parameter>cupsomatic</parameter>, aber sehr stark verbessert und generalisiert, um andere (Nicht-CUPS)
Spooler zu unterstützen. Ein Upgrade auf foomatic-rip ist wärmstens empfohlen, besonders wenn Sie auf eine
aktuelle Version von CUPS aktualisieren.
</para>

<para>
	<indexterm><primary>cupsomatic</primary></indexterm>
	<indexterm><primary>foomatic</primary></indexterm>
Sowohl die Methode <parameter>cupsomatic</parameter> (alt) und die Methode <parameter>foomatic-rip</parameter>
(neu) von Linuxprinting.org verwenden die traditionelle Ghostscript-Verarbeitung von Druckdateien, die alles
in einem Schritt erledigt. Dies hängt davon ab, daß all die anderen Geräte bereits in Ghostscript eingebaut
sind. Die Qualität ist so gut (oder schlecht), wie Ghostscript-Darstellung in anderen Spoolern ist. Der
Vorteil ist, daß diese Methode viele Drucker-Modelle unterstützt, die (noch) nicht von der moderneren
CUPS-Methode unterstützt werden.
</para>

<para>
Natürlich können Sie beide Methoden nebeneinander auf einem System einsetzen (und sogar auf einem Drucker, wenn
Sie verschiedene Queues installieren) und herausfinden, welche am Besten für Sie funktioniert.
</para>

<para>
<parameter>cupsomatic</parameter> "kidnappt" die Druckdatei nach der Stufe
<parameter>application/vnd.cups-postscript</parameter> und lenkt es um durch die CUPS-externe, systemweite
Ghostscript-Installation. Daher umgeht die Druckdatei den Filter <parameter>pstoraster</parameter> (und umgeht
auch die CUPS-Raster-Treiber <parameter>rastertosomething</parameter>). Nachdem Ghostscript sein Rastern beendet
hat, übergibt <parameter>cupsomatic</parameter> die dargestellte Datei direkt an das CUPS-Backend. Das
Flußdiagramm in <link linkend="cupsomatic-dia">cupsomatic/foomatic Verarbeitung versus Nativem CUPS</link>
illustriert den Unterschied zwischen nativer CUPS-Darstellung und der
<parameter>Foomatic/cupsomatic</parameter>-Methode.
</para>
</sect2>

<sect2>
<title>Beispiele für Filterketten</title>

<para>
Hier ein paar Beispiele für gängige Filterketten, um die Funktion von CUPS zu illustrieren.
</para>

<para>
Nehmen wir an, Sie wollen eine PDF-Datei auf einem per HP JetDirect angeschlossenen PostScript-Drucker drucken,
aber Sie wollen nur die Seiten 3-5, 7, 11-13 drucken, und das mit <quote>two-up</quote> und <quote>Duplex</quote>:
</para>

<itemizedlist>
<listitem><para>Ihre Druck-Optionen (Seitenauswahl, two-up, Duplex) werden an CUPS per Befehlszeile
weitergegeben.</para></listitem>

<listitem><para>Die (komplette) PDF-Datei wird an CUPS gesendet und automatisch als
<parameter>application/pdf</parameter> typisiert.</para></listitem>

<listitem><para>Die Datei muß daher zuerst den Vorfilter <parameter>pdftops</parameter> passieren,
der den PostScript MIME-Typ <parameter>application/postscript</parameter> erzeugt (eine Vorschau an dieser
Stelle würde immer noch alle Seiten des originalen PDFs zeigen).</para></listitem>

<listitem><para>Die Datei passiert sodann den Filter <parameter>pstops</parameter>, der die
Befehlszeilen-Optionen anwendet: er wählt die Seiten 3-5, 7, und 11-13, legt ein Layout mit
<quote>2 Seiten pro Blatt</quote> an, und fügt den korrekten Befehl für <quote>Duplex</quote> (wie
im PPD des Druckers definiert) in die PostScript-Datei ein; die Datei ist jetzt vom PostScript MIME-Typ
<parameter>application/vnd.cups-postscript</parameter>.</para></listitem>

<listitem><para>Die Datei geht jetzt ans <parameter>socket</parameter>-Backend, das den Auftrag an die
Drucker weiterleitet.</para></listitem>
</itemizedlist>

<para>
Die daraus resultierende Filterkette ist in <link linkend="pdftosocket">Filterkette PDF auf socket</link>
dargestellt.
<image id="pdftosocket"><imagefile>pdftosocket</imagefile><imagedescription>Filterkette PDF auf socket</imagedescription></image>
</para>

<para>
Nehmen wir an, Sie wollen aus dem selben Filter auf einen an USB angeschlossenen Epson Stylus Photo
Drucker drucken, der mittels dem CUPS-PPD <filename>stphoto2.ppd</filename> installiert wurde. Die
ersten paar Filter-Stufen sind fast die selben:
</para>

<itemizedlist>
<listitem><para>Ihre Druck-Optionen (Seitenauswahl, two-up, Duplex) werden an CUPS per Befehlszeile
weitergegeben.</para></listitem>

<listitem><para>Die (komplette) PDF-Datei wird an CUPS gesendet und automatisch als
<parameter>application/pdf</parameter> typisiert.</para></listitem>

<listitem><para>Die Datei muß daher zuerst den Vorfilter <parameter>pdftops</parameter> passieren,
der den PostScript MIME-Typ <parameter>application/postscript</parameter> erzeugt (eine Vorschau an dieser
Stelle würde immer noch alle Seiten des originalen PDFs zeigen).</para></listitem>

<listitem><para>Die Datei passiert sodann den Filter <parameter>pstops</parameter>, der die
Befehlszeilen-Optionen anwendet: er wählt die Seiten 3-5, 7, und 11-13, legt ein Layout mit
<quote>2 Seiten pro Blatt</quote> an, und fügt den korrekten Befehl für <quote>Duplex</quote> ...
(Oops &smbmdash; dieser Drucker und diese PPD unterstützen gar keinen Duplex-Druck &smbmdash; also wird
diese Option ignoriert) in die PostScript-Datei ein; die Datei ist jetzt vom PostScript MIME-Typ
<parameter>application/vnd.cups-postscript</parameter>.</para></listitem>

<listitem><para>Die Datei passiert jetzt die Filter-Stufe <parameter>pstoraster</parameter> und wird
zum MIME-Typ <parameter>application/cups-raster</parameter>.</para></listitem>

<listitem><para>Zuletzt tut der Filter <parameter>rastertoepson</parameter> seine Arbeit (wie in der PPD
des Druckers angezeigt), legt die drucker-spezifischen Rasterdaten an, und bettet alle vom Benutzer
gewählten Druck-Optionen in die Druckdaten ein.</para></listitem>

<listitem><para>Die Datei geht an das Backend <parameter>usb</parameter>, das es an die Drucker
weiterleitet.</para></listitem>
</itemizedlist>

<para>
Die daraus resultierende Filterkette ist in <link linkend="pdftoepsonusb">diesem Bild</link> dargestellt.
</para>

<image id="pdftoepsonusb"><imagefile>pdftoepsonusb</imagefile><imagedescription>Filterkette PDF auf USB.</imagedescription></image>
</sect2>

<sect2>
<title>Quellen für CUPS Treiber/PPDs</title>

<para>
Im Internet finden Sie viele tausend CUPS-PPD-Dateien (mit ihren begleitenden Filtern), in vielen Landessprachen
und mit Unterstützung für über tausend nicht-PostScript-Modelle.
</para>

<itemizedlist>
<indexterm><primary>ESP</primary><secondary>Print Pro</secondary></indexterm>
<indexterm><primary>PrintPro</primary><see>ESP Print Pro</see></indexterm>
<listitem><para><ulink url="http://wwwl.easysw.com/printpro/">ESP
PrintPro</ulink> (kommerziell, nicht frei) wird mit mehr als 3000 PPDs gebündelt, fertig zur erfolgreichen
Anwendung <quote>out of the box</quote> auf Linux, Mac OS X, IBM-AIX, HP-UX, Sun-Solaris, SGI-IRIX,
Compaq Tru64, Digital UNIX, und noch einigen kommerziellen Unices (es wurde von den CUPS-Entwicklern selbst
geschrieben und sein Verkauf hilft dabei, die weitere Entwicklung von CUPS zu finanzieren, genauso, wie es
dessen Schöpfer ernährt).</para></listitem>

<listitem><para>Das <ulink
url="http://gimp-print.sourceforge.net/">Gimp-Print-Project
</ulink> (GPL, freie Software) bietet ungefähr 140 PPDs (mit Unterstützung von fast 400 Druckern, viele davon
bis zu Foto-Qualität), zur Nutzung neben den Gimp-Print CUPS Filtern.</para></listitem>

<listitem><para><ulink url="http://www.turboprint.com/">TurboPrint
</ulink> (Shareware, nicht frei) unterstützt ungefähr die selbe Anzahl von Druckern in exzellenter Qualität.
</para></listitem>

<listitem><para><ulink
url="http://www-124.ibm.com/developerworks/oss/linux/projects/omni/">OMNI
</ulink>
(LPGL, frei) ist ein Package von IBM, das mittlerweile Unterstützung für mehr als 400 Drucker enthält,
aus dem Erbe von IBM OS/2 Know-How, portiert auf Linux (CUPS Unterstützung ist derzeit im Beta-Stadium).
</para></listitem>

<listitem><para><ulink url="http://hpinkjet.sourceforge.net/">HPIJS
</ulink> (BSD-artige Lizenz, frei) unterstützt ungefähr 150 Drucker von HP und bietet nun auch exzellente
Druckqualität (derzeit nur über den Foomatic-Pfad verfügbar).</para></listitem>

<listitem><para><ulink url="http://www.linuxprinting.org/">Foomatic/cupsomatic
</ulink> (LPGL, frei) von Linuxprinting.org bietet PPDs für praktisch jeden auf der Welt bekannten
Ghostscript-Filter (einschließlich Omni, Gimp-Print und HPIJS).</para></listitem>
</itemizedlist>

</sect2>

<sect2>
<title>Das Drucken mit Interface Scripts</title>

<para>
CUPS unterstützt auch die Verwendung von <quote>interface scripts</quote>, wie man sie von System V AT&amp;T
Druck-Systemen kennt. Diese werden oft für PCL-Drucker verwendet, von Anwendungen, die PCL-Druckaufträge
erzeugen. Interface scripts sind spezifisch für einzelne Drucker-Modelle. Sie haben eine ähnliche Rolle wie
PPDs für PostScript-Drucker. Interface scripts können die benötigten Escape-Sequenzen in den Druck-Datenstrom
einfügen, wenn der Benutzer einen bestimmten Papierschacht gewählt hat, oder Landscape-Druck, oder A3-Papier,
etc. Interface scripts sind praktisch unbekannt in der Linux-Welt. Auf HP-UX Plattformen werden sie öfter
verwendet. Sie können jedes funktionierende interface script auch mit CUPS verwenden. Installieren Sie einfach
den Drucker mit der Option <command>-i</command>:
</para>

<para><screen>
&rootprompt;<userinput>lpadmin -p pclprinter -v socket://11.12.13.14:9100 \
  -i /path/to/interface-script</userinput>
</screen></para>

<para>
Interface scripts sind vielleicht das <quote>unbekannte Tier</quote> für viele. Nichtsdestotrotz bieten sie mit
CUPS den einfachsten Weg, Ihr eigenes selbstgeschriebenes Filter-Skript oder -Programm in eine bestimmte
Drucker-Queue einzufügen (einige Informationen über die herkömmliche Verwendung von Interface Scripts kann unter
<ulink noescape="1" url="http://playground.sun.com/printing/documentation/interface.html">http://playground.sun.com/printing/documentation/interface.html</ulink> gefunden werden.
</para>
</sect2>

<sect1>
	<title>Netzwerk-Druck (Ausschließlich Windows)</title>

<para>
Netzwerk-Druck umfasst ein weites Feld. Um zu verstehen, was genau mit Samba passiert, wenn es im Auftrag seiner
Windows-Clients druckt, lassen Sie uns zuerst einen Blick auf ein <quote>reines Windows</quote> Setup werfen:
Windows clients mit einem Windows NT Druck-Server.
</para>

<sect2>
<title>Von Windows Clients auf einen NT Druck-Server</title>

<para>
Windows clients, die auf einen NT-basierenden Druck-Server drucken, haben zwei Möglichkeiten. Sie können:
<indexterm><primary>GDI</primary></indexterm>
<indexterm><primary>EMF</primary></indexterm>
</para>


<itemizedlist>
	<listitem><para>den Treiber lokal ausführen und die GDI-Ausgabe (EMF) selbst im Drucker-spezifischen
			Format darstellen.
	</para></listitem>

	<listitem><para>die GDI-Ausgabe (EMF) an den Server senden, wo der Treiber ausgeführt wird, um die
			Drucker-spezifische Ausgabe darzustellen.
	</para></listitem>
</itemizedlist>

<para>
Die beiden Druck-Möglichkeiten werden in den Flußdiagrammen
<link linkend="small11">Treiberausführung auf dem Client</link>
und <link linkend="small12">Treiberausführung auf dem Server</link> gezeigt.
</para>
</sect2>

<sect2>
<title>Treiberausführung auf dem Client</title>

<para>
Im ersten Fall muß der Druck-Server die Datei als raw behandeln, das bedeutet, es sollte die Auftragsdatei nicht
anrühren oder in irgendeiner Art zu konvertieren versuchen. Dies ist, was ein herkömmlicher UNIX-basierender
Druck-Server auch tun kann, und das bei besserer Performance und stabiler als ein NT Druck-Server. Damit
sind wohl die meisten Samba-Administratoren vertraut. Ein Vorteil dieses Setups ist, daß dieser
<quote>spooling-only</quote> Druck-Server sogar verwendet werden kann, wenn kein(e) Treiber für UNIX
verfügbar sind, es genügt, die Windows-Treiber zur Verfügung und auf den Clients installiert zu haben.
</para>

<para>
	<image id="small11"><imagedescription>Treiberausführung auf dem Client.</imagedescription>
		<imagefile>11small</imagefile>
	</image>
</para>
</sect2>

<sect2>
<title>Treiberausführung auf dem Server</title>


<para>
<indexterm><primary>PostScript</primary></indexterm>
<indexterm><primary>PCL</primary></indexterm>
<indexterm><primary>ESC/P</primary></indexterm>
<indexterm><primary>EMF</primary></indexterm>
<indexterm><primary>GDI</primary></indexterm>
Der andere Pfad führt den Drucker-Treiber auf dem Server aus. Der Client übermittelt Druckdateien im EMF-Format
an den Server. Der Server verwendet den PostScript, PCL, ESC/P oder einen anderen Treiber, um die EMF-Datei in
die drucker-spezifische Sprache zu konvertieren. Es ist UNIX nicht möglich, dasselbe zu tun. Derzeit gibt es
kein Programm und keine Methode, um die GDI-Ausgabe eines Windows-Clients auf einem UNIX-Server auf etwas zu
wandeln, das ein Drucker verstehen könnte.
</para>

<para>
	<image id="small12"><imagedescription>Treiberausführung auf dem Server.</imagedescription>
		<imagefile>12small</imagefile>
	</image>
</para>

<para>
Jedoch ist etwas Ähnliches mit CUPS möglich. Lesen Sie weiter.
</para>
</sect2>
</sect1>

<sect1>
<title>Netzwerk-Druck (Windows Clients &smbmdash; UNIX/Samba Druck-Server)</title>

<para>
Da UNIX Server den Win32 Programm-Code <emphasis>NICHT</emphasis> auf ihrer Plattform ausführen können, ist
die Sache etwas anders. Dies schränkt jedoch Ihre Möglichkeiten nicht allzu sehr ein. Im Gegenteil, Sie haben
hier die Möglichkeit, Druckoptionen zu implementieren, die anderswo nicht möglich sind.
</para>

<sect2>
<title>Von Windows Clients auf einen CUPS/Samba Druck-Server</title>

<para>
Hier ist ein einfaches Rezept, das zeigt, wie Sie Vorteile aus den mächtigen Eigenschaften von CUPS ziehen, zum
Nutzen Ihrer druckenden Windows Clients:
</para>

<itemizedlist>

<listitem><para>Lassen Sie die Windows Clients PostScript an den CUPS Server senden.</para></listitem>

<listitem><para>Lassen Sie den CUPS Server das PostScript in ein geräte-spezifisches Format wandeln.</para></listitem>
</itemizedlist>

<para>
Dies erfordert, daß die Clients einen PostScript-Treiber verwenden (sogar wenn der Drucker kein PostScript-Modell
ist). Es erfordert auch, daß Sie einen Treiber auf dem CUPS-Server haben.
</para>

<para>
Zuerst, um CUPS-basierendes Drucken per Samba zu aktivieren, sollten folgende Optionen im Abschitt
[global] Ihrer Datei &smb.conf; gesetzt werden:
</para>

<smbconfblock>
<smbconfoption><name>printing</name><value>cups</value></smbconfoption>
<smbconfoption><name>printcap</name><value>cups</value></smbconfoption>
</smbconfblock>

<para>
Wenn diese Parameter angegeben werden, werden alle manuell gesetzten Druck-Anweisungen (wie
<smbconfoption><name>print command</name></smbconfoption> oder
<smbconfoption><name>lppause command</name></smbconfoption>) in &smb.conf; (genauso wie in Samba selbst)
ignoriert. Stattdessen arbeitet Samba direkt mit CUPS zusammen, unter Verwendung dessen
"application program interface" (API), sofern Samba mit Unterstützung der CUPS-Bibliothek (libcups) kompiliert
wurde. Wenn Samba nicht mit CUPS-Unterstützung kompiliert wurde, und wenn keine anderen Druckbefehle gesetzt
sind, wird der Druck den <emphasis>System V</emphasis> AT&amp;T Befehlssatz verwenden, mit der automatisch
gesetzten Option -oraw, womit Druckaufträge einfach weitergegeben werden (wenn Sie Ihre selbstdefinierten
Druckbefehle mit einem Samba-Server, der CUPS-Unterstützung einkompiliert hat, verwenden wollen, verwenden Sie
einfach <smbconfoption><name>printing</name><value>sysv</value></smbconfoption>).
</para>

<para>
<image><imagedescription>Drucken über einen CUPS/Samba Server.</imagedescription>
	<imagefile>13small</imagefile>
</image>
</para>
</sect2>

<sect2>
<title>Samba empfängt Aufträge und gibt sie an CUPS weiter</title>

<para>
Samba <emphasis>muss</emphasis> sein eigenes Spooling-Verzeichnis verwenden (es wird mit einer Zeile wie
<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption> im Abschnitt
<smbconfsection>[printers]</smbconfsection> oder <smbconfsection>[printername]</smbconfsection> von
&smb.conf; gesetzt). Samba empfängt den Auftrag in seinem eigenen Spooling-Verzeichnis und gibt ihn weiter ins
Spooling-Verzeichnis von CUPS (das CUPS-Spooling-Verzeichnis wird gesetzt mittels der Anweisung
<parameter>RequestRoot</parameter>, in einer Zeile die voreingestellt
<parameter>RequestRoot /var/spool/cups</parameter> lautet). CUPS prüft die Zugriffsrechte und setzt diese auf
vernünftige Werte, bei jedem Neustart. Wir haben schon ziemlich viele Leute gesehen, die ein gemeinsames
Spooling-Verzeichnis verwendet haben, und wochenlang mit diesem <quote>Problem</quote> zu kämpfen hatten.
</para>

<para>
Ein Windows-Benutzer authentifiziert sich nur gegen Samba (mittels dessen, was konfiguriert wurde). Wenn Samba
auf demselben Host wie CUPS läuft, brauchen Sie nur dem Rechner <quote>localhost</quote> zu erlauben, zu drucken.
Wenn sie auf verschiedenen Maschinen laufen, müssen Sie sicherstellen, daß der Samba-Host Zugriff auf das Drucken
auf CUPS hat.
</para>
</sect2>
</sect1>

<sect1>
<title>Netzwerk PostScript RIP</title>

<para>
Dieser Abschnitt behandelt die Verwendung von CUPS-Filtern auf der Server &smbmdash; Konfiguration, in der
Clients einen PostScript-Treiber mit CUPS-PPDs verwenden.
</para>


<para>
<indexterm><primary>PostScript</primary></indexterm>
<indexterm><primary>PCL</primary></indexterm>
<indexterm><primary>PJL</primary></indexterm>
PPDs können alle Optionen des Drucker-Geräts kontrollieren. Sie werden üblicherweise vom Hersteller
bereitgestellt, wenn Sie einen PostScript-Drucker besitzen. PPD-Dateien ((PostScript Printer Descriptions)
sind immer Bestandteil der Druckertreiber auf MS Windows oder Apple Mac OS Systemen. Es sind ASCII-Dateien,
die vom Benutzer wählbare Druckoptionen enthalten, sowie deren Zuweisung auf die enstprechenden PostScript, PCL
oder PJL Befehle für das Ziel-Gerät. Die GUI-Dialoge der Druckertreiber übersetzen diese Optionen
<quote>on-the-fly</quote> in Schaltflächen und Auswahllisten, um dem Benutzer eine Auswahl anzubieten.
</para>

<para>
CUPS kann ohne jede Umwandlung PPD-Dateien von jedem Windows-PS-Treiber (NT wird empfohlen) und dessen Optionen
verarbeiten. Es gibt ein Web-Interface zu den Druck-Optionen (gehen Sie auf
<ulink noescape="1" url="http://localhost:631/printers/">http://localhost:631/printers/</ulink> und klicken Sie
auf eine <guibutton>Configure Printer</guibutton>-Schaltfläche) oder ein Befehlszeilen-Interface (sehen Sie dazu
<command>man lpoptions</command> oder prüfen Sie, ob Sie <command>lphelp</command> auf Ihrem System haben). Es
gibt auch ein paar verschiedene GUI Front-ends für Linux/UNIX, die PPD-Optionen darstellen können. PPD-Optionen
sind normalerweise zur Interpretation durch den PostScript RIP auf dem PostScript-Drucker gedacht.
</para>

<sect2>
<title>PPDs für Nicht-PS-Drucker auf UNIX</title>


<para>
<indexterm><primary>PPD</primary></indexterm>
CUPS beschränkt sich nicht auf <quote>wirkliche</quote> PostScript-Drucker in seiner Verwendung von PPDs. Die
CUPS-Entwickler haben die Reichweite des PPD-Konzepts erweitert, um auch verfügbare Geräte- und Treiber-Optionen
von Nicht-PS-Druckern durch CUPS-PPDs zu beschreiben.
</para>

<para>
Dies ist nur logisch, da CUPS einen voll ausgestatteten PostScript Interpreter (RIP) umfaßt. Dieser RIP basiert
auf Ghostscript. Er kann alles empfangene PostScript (und zusätzlich viele weitere Dateiformate) verarbeiten.
Alle CUPS-PPDs für Nicht-PS-Drucker enthalten eine zusätzliche Zeile, die mit dem Schlüsselwort
<parameter>*cupsFilter</parameter> beginnt. Diese Zeile teilt dem CUPS-Druck-Systemmit, welcher
drucker-spezifische Filter zur Interpretation der PostScript-Daten verwendet werden soll. Daher läßt CUPS
alle seine Drucker für die Clients als PostScript-Drucker erscheinen, weil es als PostScript RIP für diese
Drucker arbeiten kann.
</para>
</sect2>

<sect2>
<title>PPDs für Nicht-PS-Drucker auf Windows</title>

<para>
<indexterm><primary>PPD</primary></indexterm>
CUPS-PPDs können auch auf Windows-Clients verwendet werden, am <quote>Rücken</quote> eines <quote>core</quote>
PostScript-Treibers (derzeit wird der "CUPS PostScript Driver for Windows NT/200x/XP" empfohlen; Sie können auch
den von Adobe verwenden, mit Einschränkungen). Dieses Feature ermöglicht es CUPS, einige Tricks zu beherrschen,
die kein anderer Spooler kann:
</para>

<itemizedlist>

<listitem><para>Das Arbeiten als ein vernetzter PostScript RIP (Raster Image Processor),
der Druckdateien von allen Client-Plattformen in einer einheitlichen Weise handhabt.
</para></listitem>

<listitem><para>Das Arbeiten als zentraler Ab- und Verrechnungs-Server, da alle Dateien durch den pstops-Filter
laufen und daher in der CUPS-Datei <filename>page_log</filename> protokolliert werden.
<emphasis>Anmerkung:</emphasis>Dies kann nicht für <quote>raw</quote> Druckaufträge erfolgen, da diese ja per
definitionem ungefiltert bleiben.</para></listitem>

<listitem><para>Das Ermöglichen einer Einigung und Festlegung eines einzelnen PostScript-Treibers für die
Clients, sogar für viele verschiedene Ziel-Drucker.</para></listitem>
</itemizedlist>

<para>
Die Verwendung von CUPS PPDs auf Windows-Clients ermöglicht es diesen, alle Druckauftrags-Einstellungen so
zu kontrollieren, wie es ein UNIX-Client kann.
</para>
</sect2>
</sect1>

<sect1>
<title>Windows Terminal Server (WTS) als CUPS Clients</title>

<para>
Dieses Setup wird für diejenigen interessant sein, die grosse Probleme in WTS-Umgebungen haben. WTS braucht oft
eine Vielzahl von Nicht-PS-Treibern installiert, um die Vielfalt der verschiedenen Druckermodelle der CLients
zu unterstützen. Dies bringt oft eine stark erhöhte Instabilität mit sich.
</para>

<sect2>
<title>Drucker-Treiber, die im <quote>Kernel Modus</quote> laufen, verursachen viele Probleme</title>

<para>
In Windows NT bringen Drucker-Treiber, die im <quote>Kernel Modus</quote> laufen, ein hohes Risiko für die
Stabilität des Systems mit sich, wenn der Treiber nicht wirklich stabil und gut getestet ist. Und es gibt eine
Menge schlechte Treiber! Speziell berüchtigt ist das Beispiel des PCL-Drucker-Treibers, der ein zusätzliches
Sound-Modul ausführte, das die Benutzer via Soundkarte über ihre abgeschlossenen Druckaufträgen informierte.
Muß ich wirklich erwähnen, daß dies genauso verlässlich <quote>blue screens of death</quote> verursachte?
</para>

<para>
PostScript-Treiber sind im Allgemeinen gut getestet. Sie sind nicht dafür bekannt, irgendwelche Probleme zu
verursachen, sogar trotzdem sie auch im Kernel-Modus ausgeführt werden. Das kann daher kommen, daß es bislang
nur zwei verschiedene PostScript-Treiber gab: die von Adobe und den von Microsoft. Beide sind gut getestet und
so stabil, wie es unter Windows eben geht. Der CUPS-Treiber ist von dem MS-Treiber abgeleitet.
</para>
</sect2>

<sect2>
<title>Workarounds bringen massive Einschränkungen</title>

<para>
In vielen Fällen haben Administratoren, in dem Bestreben, dieses Problem zu umgehen, dazu gegriffen, die
erlaubten Druckertreiber auf ihrem WTS auf einen generischen PCL- und einen PostScript-Treiber einzuschränken.
Dies schränkt jedoch die Clients im Umfang der ihnen zur Verfügung stehenden Druckoptionen ein. Oft bekommen
sie nicht mehr als Simplex-Druck aus einem Standard-Papierschacht, während ihre Geräte bei weitem mehr könnten,
wenn sie von einem besseren Treiber angesteuert würden!
</para>
</sect2>

<sect2>
<title>CUPS: Ein <quote>Zauberstein</quote>?</title>


<para>
<indexterm><primary>PPD</primary></indexterm>
<indexterm><primary>PostScript</primary></indexterm>
Das Verwenden eines Postscript-Treibers, aktiviert mit einem CUPS-PPD, scheint eine sehr elegante Art zu sein,
all diese Mängel zu überbrücken. Es gibt, je nach der von Ihnen verwendeten Windows-Version, bis zu drei
verschiedene verfügbare Postscript-Treiber: Adobe, Microsoft und CUPS Postscript-Treiber. Keiner der drei
ist bekannt dafür, grössere Instabilitäten auf WTS zu verursachen (auch nicht, wenn viele verschiedene PPDs
verwendet werden). Die Clients werden (wieder) imstande dazu sein, Papierschächte auszuwählen, Duplexdruck
und andere Einstellungen. Es gibt jedoch auch einen Preis dafür: ein CUPS-Server, der als PostScript RIP für
seine Clients arbeitet, erfordert mehr CPU und RAM als wenn er nur als <quote>raw spooling</quote> Server
arbeitet. Weiters ist dieses Setup noch nicht ausführlich getestet, wobei die ersten Rückmeldungen sehr
vielversprechend aussehen.
</para>
</sect2>

<sect2>
<title>PostScript-Treiber ohne grössere Probleme &smbmdash; sogar im Kernel-Modus</title>

<para>
<indexterm><primary>DDK</primary></indexterm>
Aktuellere Drucker-Treiber unter W200x und XP laufen nicht mehr im Kernel-Modus (anders als unter Windows NT).
Beide Betriebssysteme können jedoch die NT-Treiber verwenden, die im Kernel-Modus laufen (Sie können grob
bestimmen, welcher Treiber zu welchem System gehört, da die Treiber im Unterverzeichnis <quote>2</quote> des
Verzeichnisses <quote>W32X86</quote> die <quote>alten</quote> sind). Wie zuvor gesagt wurde, sind weder die
Adobe-Treiber noch die von MS dafür bekannt, irgendwelche Stabilitätsprobleme zu verursachen. Der CUPS-Treiber
wurde vom MS-Treiber abgeleitet. Es gibt einen einfachen Grund dafür: Das MS DDK ((Device Development Kit) für
Windows NT (welches für Lizenznehmer von Visual Studio ohne Kosten verfügbar war) beinhaltet den Quelltext
des MS-Treibers, und die Lizenznehmer von Visual Studio dürfen diesen verwenden und ihn zu für eigene
Treiber-Entwicklungen modifizieren. Das haben die CUPS-Entwickler getan. Die Lizenz erlaubt ihnen nicht, den
gesamten Quelltext zu veröffentlichen, sie haben jedoch das <quote>diff</quote> unter der GPL veröffentlicht,
und wenn Sie Besitzer eines <quote>MS DDK for Windows NT</quote> sind, können Sie den Treiber selbst prüfen.
</para>
</sect2>
</sect1>

<sect1>
<title>Das Konfigurieren von CUPS für den Download von Treibern</title>

<para>
Wie wir zuvor erwähnt haben, funktionieren alle bekannten Methoden, um Client-Drucker-Treiber auf dem
Samba-Server vorzubereiten (und damit die Vorzüge von Point'n'Print zu geniessen) auch mit CUPS. Diese
Methoden wurden im vorigen Kapitel beschrieben. In Wirklichkeit ist dies eine reine Samba-Angelegenheit, und
hängt nur mit dem Verhältnis Samba/Windows-Client zusammen.
</para>

<sect2>
<title><emphasis>cupsaddsmb</emphasis>: Das unbekannte Hilfsmittel</title>


<para>
<indexterm><primary>cupsaddsmb</primary></indexterm>
Das Werkzeug <command>cupsaddsmb</command> (mit allen aktuellen CUPS-Versionen ausgeliefert) ist eine
alternative Methode, um Drucker-Treiber in die Samba-Freigabe <smbconfsection>[print$]</smbconfsection> zu
transferieren. Zur Erinnerung, diese Freigabe ist der Ort, an dem Clients nach hinterlegten und konfigurierten
Treibern suchen, um diese herunterzuladen und zu installieren. Dies macht das Verteilen von jeglichen
(oder allen) installierten CUPS-Druckern ziemlich einfach. <command>cupsaddsmb</command> kann den Adobe
PostScript-Treiber genauso verwenden wie den neu entwickelten CUPS PostScript-Treiber für Windows NT/200x/XP.
<parameter>cupsaddsmb</parameter> funktioniert <emphasis>NICHT</emphasis> mit beliebigen Drucker-Treibern,
sondern nur mit <emphasis>exakt</emphasis> den Treiber-Dateien, die in seiner man-page angegeben sind.
</para>

<para>
Der CUPS Drucker-Treiber ist auf der CUPS-Download-Seite verfügbar. Sein Paketname ist
<filename>cups-samba-[version].tar.gz</filename>. Er wird den Adobe-Treibern vorgezogen, da er einige Vorteile
hat:
</para>

<itemizedlist>
<listitem><para>Er unterstützt ein genauere Seiten-Abrechnung.</para></listitem>

<listitem><para>Er unterstützt Banner-Seiten, und Seiten-Labels auf allen Druckern.</para></listitem>

<listitem><para>Er unterstützt das Setzen von einigen IPP-Auftrags-Attributen (wie Auftrags-Priorität,
Seiten-Label, und Auftrags-Verrechnung).</para></listitem>
</itemizedlist>

<para>
Derzeit werden jedoch nur Windows NT, 2000 und XP von den CUPS-Treibern unterstützt. Sie brauchen auch die
entsprechenden Teile des Adobe-Treibers, wenn Sie Windows 95, 98 und ME Clients unterstützen müssen.
</para>
</sect2>

<sect2>
	<title>Bereiten Sie Ihre &smb.conf; für <command>cupsaddsmb</command> vor</title>

<para>
Vor dem Ausführen von <command>cupsaddsmb</command> müssen Sie die Einstellungen in &smb.conf; wie im
<link linkend="cupsadd-ex">nächsten Beispiel</link> setzen:
</para>

<para><smbconfexample id="cupsadd-ex">
<title>smb.conf für die Verwendung von cupsaddsmb</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>load printers</name><value>yes</value></smbconfoption>
<smbconfoption><name>printing</name><value>cups</value></smbconfoption>
<smbconfoption><name>printcap name</name><value>cups</value></smbconfoption>

<smbconfsection>[printers]</smbconfsection>
<smbconfoption><name>comment</name><value>Alle Drucker</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption>
<smbconfoption><name>browseable</name><value>no</value></smbconfoption>
<smbconfoption><name>public</name><value>yes</value></smbconfoption>
<smbconfcomment>Einstellung ist abhängig von Ihren Erfordernissen</smbconfcomment>
<smbconfoption><name>guest ok</name><value>yes</value></smbconfoption>
<smbconfoption><name>writable</name><value>no</value></smbconfoption>
<smbconfoption><name>printable</name><value>yes</value></smbconfoption>
<smbconfoption><name>printer admin</name><value>root</value></smbconfoption>
 <smbconfsection>[print$]</smbconfsection>
<smbconfoption><name>comment</name><value>Drucker-Treiber</value></smbconfoption>
<smbconfoption><name>path</name><value>/etc/samba/drivers</value></smbconfoption>
<smbconfoption><name>browseable</name><value>yes</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>no</value></smbconfoption>
<smbconfoption><name>read only</name><value>yes</value></smbconfoption>
<smbconfoption><name>write list</name><value>root</value></smbconfoption>
</smbconfexample></para>
</sect2>

<sect2>
<title>CUPS <quote>PostScript-Treiber für Windows NT/200x/XP</quote></title>

<para>
<indexterm><primary>PostScript</primary></indexterm>
CUPS-Anwender können die genau gleichen Pakete von <ulink
noescape="1" url="http://www.cups.org/software.html">http://www.cups.org/software.html</ulink> beziehen.
Dies ist ein separates Paket von CUPS-Software-Dateien, bezeichnet als
CUPS 5.0rc3 Windows NT/200x/XP Printer Driver for Samba. Der Dateiname für den Download ist
<filename>cups-samba-5.0rc3.tar.gz</filename>. Nach dem untar und unzip zeigen sich folgende Dateien:
</para>

<para><screen>
&rootprompt;<userinput>tar xvzf cups-samba-5.0rc3.tar.gz</userinput>
cups-samba.install
cups-samba.license
cups-samba.readme
cups-samba.remove
cups-samba.ss
</screen></para>

<para>
<indexterm><primary>ESP</primary><secondary>meta packager</secondary></indexterm>
<indexterm><primary>EPM</primary><see>ESP meta packager</see></indexterm>
Diese Dateien wurden mit der ESP-Meta-Packer-Software EPM gepackt. Die Dateien <filename>*.install</filename>
und <filename>*.remove</filename> sind einfache Shell-Skripts, die die Datei <filename>*.ss</filename> entpacken
(die Datei <filename>*.ss</filename> ist nichts als ein tar-Archiv, das auch mit <quote>tar</quote> entpackt
werden kann). Dann kopiert es deren Inhalt in <filename>/usr/share/cups/drivers/</filename>. Dieser Inhalt
enthält drei Dateien:
</para>

<para><screen>
&rootprompt;<userinput>tar tv cups-samba.ss</userinput>
cupsdrvr.dll
cupsui.dll
cups.hlp
</screen></para>

<para>
Das <parameter>cups-samba.install</parameter> Shell-Skript ist einfach anzuwenden:
</para>

<para><screen>
&rootprompt;<userinput>./cups-samba.install</userinput>
[....]
Installing software...
Updating file permissions...
Running post-install commands...
Installation is complete.     
</screen></para>

<para>
Das Skript sollte die Treiber-Dateien automatisch ins Verzeichnis <filename>/usr/share/cups/drivers/</filename>
kopieren.
</para>

<warning><para>
Wegen eines Fehlers kopiert eine ältere CUPS-Release die Datei <filename>cups.hlp</filename> ins Verzeichnis
<filename>/usr/share/drivers/</filename> anstatt in <filename>/usr/share/cups/drivers/</filename>. Um das zu
beheben, kopieren/verschieben Sie diese Datei einfach manuell ins richtige Verzeichnis, nachdem Sie das
Install-Skript ausgeführt haben.
</para></warning>

<para><screen>
&rootprompt;<userinput>cp /usr/share/drivers/cups.hlp /usr/share/cups/drivers/</userinput>
</screen></para>


<para>
<indexterm><primary>DDK</primary></indexterm>
Dieser neue CUPS PostScript-Treiber ist derzeit nur binär verfügbar, aber ohne Kosten. Es wird (noch) kein
vollständiger Quelltext zur Verfügung gestellt. Der Grund ist, daß er mit Hilfe des Microsoft Driver Developer
Kits (DDK) entwickelt und mit Microsoft Visual Studio 6 kompiliert wurde. Die Treiber-Entwickler dürfen nicht
den gesamten Quelltext als freie Software vertreiben. Die CUPS-Entwickler haben jedoch das <quote>diff</quote>
unter der GPL veröffentlicht, somit kann jeder mit einer Lizenz für Visual Studio und einem DDK den Treiber
selbst kompilieren.
</para>
</sect2>

<sect2>
<title>Das Erkennen verschiedener Treiber-Dateien</title>

<para>
Die CUPS-Treiber unterstützen die älteren Systeme Windows 95/98/Me nicht, nur die Client-Systeme
Windows NT/2000/XP.
</para>

<para>Windows NT, 2000 und XP werden unterstützt von:</para>

<para>
	<itemizedlist>
		<listitem>cups.hlp</listitem>
		<listitem>cupsdrvr.dll</listitem>
		<listitem>cupsui.dll</listitem>
	</itemizedlist>
</para>

<para>
Adobe-Treiber sind für die älteren Systeme Windows 95/98/Me genauso verfügbar wie für Windows NT/2000/XP.
Die Dateien sind für die einzelnen Plattformen verschieden.
</para>

<para>Windows 95, 98 und ME werden unterstützt von:</para>

<para>
	<itemizedlist>
	<listitem>ADFONTS.MFM</listitem>
	<listitem>ADOBEPS4.DRV</listitem>
	<listitem>ADOBEPS4.HLP</listitem>
	<listitem>DEFPRTR2.PPD</listitem>
	<listitem>ICONLIB.DLL</listitem>
	<listitem>PSMON.DLL</listitem>
</itemizedlist>
</para>

<para>Windows NT, 2000 und XP werden unterstützt von:</para>

<para>
<itemizedlist>
	<listitem>ADOBEPS5.DLL</listitem>
	<listitem>ADOBEPSU.DLL</listitem>
	<listitem>ADOBEPSU.HLP</listitem>
</itemizedlist>

</para>

<note><para>
Wenn sowohl die Adobe-Treiber-Dateien wie auch die CUPS-Treiber-Dateien zur Unterstützung von Windows NT/200x/XP
vorhanden sind, werden die Adobe-Dateien ignoriert und die CUPS-Dateien verwendet. Wenn Sie &smbmdash; aus
irgendeinem Grund&smbmdash; nur Adobe-Treiber verwenden wollen, entfernen Sie einfach die drei CUPS-Dateien. Die
Windows 9x/Me clients verwenden in jedem Fall die Adobe-Treiber.
</para></note>
</sect2>

<sect2>
<title>Das Beschaffen der Adobe-Treiber-Dateien</title>

<para>
Das Beschaffen der Adobe-Treiber-Dateien scheint für viele Anwender unerwartet schwierig zu sein. Sie sind nicht
als einzelne Dateien auf der Adobe-Website erhältlich und das selbst-entpackende und/oder selbst-installierende
Windows-.exe ist auch nicht einfach zu finden. Möglicherweise müssen Sie den enthaltenen Installer verwenden
und die Installation einmal auf einem Client durchführen. Dies installiert die Treiber (und einen generischen
PostScript-Drucker) lokal auf dem Client. Wenn diese installiert sind, geben Sie den generischen
PostScript-Drucker frei. Danach enthält die Freigabe <smbconfsection>[print$]</smbconfsection> des Clients die
Adobe-Dateien, von wo aus Sie sie mittels smbclient auf den CUPS-Host holen können.
</para>
</sect2>

<sect2>
<title>ESP Print Pro PostScript Treiber für Windows NT/200x/XP</title>

<para>
<indexterm><primary>ESP</primary><secondary>Print Pro</secondary></indexterm>
Die Anwender der Software ESP Print Pro können ihr Samba-Treiber-Paket für diesen Zweck ohne Probleme
installieren. Beziehen Sie die Treiber-Dateien aus dem normalen Download-Bereich der ESP Print Pro Software
unter <ulink noescape="1" url="http://www.easysw.com/software.html">http://www.easysw.com/software.html</ulink>.
Sie müssen den Link namens <quote>SAMBA</quote> unter
<guilabel>Download Printer Drivers for ESP Print Pro 4.x</guilabel> finden, und das Package herunterladen.
Sobald es instaliert ist, können Sie jeden Treiber vorbereiten, in dem Sie einfach den Drucker im
Drucker-Manager-GUI markieren und die Funktion <guilabel>Export Driver...</guilabel> aus dem Menü wählen.
Natürlich müssen Sie Samba zuerst für den Umgang mit den Treiber-Dateien vorbereitet haben; also die Freigabe
<smbconfsection>[print$]</smbconfsection> angelegt haben und so weiter. Das Paket ESP Print Pro beinhaltet
die CUPS-Treiber-Dateien genauso wie ein (lizenziertes) Set von Adobe-Treibern für die Windows 95/98/Me
Client-Familie.
</para>
</sect2>

<sect2>
<title>Vorbehalte, die zu berücksichtigen sind</title>

<para>
<indexterm><primary>cupsaddsmb</primary></indexterm>
Sobald Sie das Install-Skript ausgeführt haben (und eventuell die Datei <filename>cups.hlp</filename> manuell
nach <filename>/usr/share/cups/drivers/</filename> verschoben haben), ist der Treiber bereit, um in die
Samba-Freigabe <smbconfsection>[print$]</smbconfsection> gelegt zu werden (welche oft auf das Verzeichnis
<filename>/etc/samba/drivers/</filename> zeigt und einen Unterverzeichnis-Baum mit den Verzeichnissen
<emphasis>WIN40</emphasis> und <emphasis>W32X86</emphasis> enthält). Sie tun dies, indem Sie
<command>cupsaddsmb</command> ausführen (sehen Sie dazu auch <command>man cupsaddsmb</command>, für alle
CUPS-Releases seit 1.1.16).
</para>

<tip><para>
<indexterm><primary>Single Sign On</primary></indexterm>
Es kann sein, daß Sie root in die Datei smbpasswd aufnehmen müssen, indem Sie <command>smbpasswd</command>
ausführen; dies ist besonders wichtig, wenn Sie diese ganze Prozedur zum ersten Mal ausführen, und nicht in
einer Umgebung arbeiten, in der alles für <emphasis>single sign on</emphasis> an einem Windows Domänen-Controller
konfiguriert ist.
</para></tip>

<para>
Sobald die Treiber-Dateien in der Freigabe <smbconfsection>[print$]</smbconfsection> liegen und initialisiert
sind, sind Sie bereit, um von den Windows NT/200x/XP Clients heruntergeladen und installiert zu werden.
</para>

<note><para>
Win 9x/Me Clients funktionieren nicht mit dem CUPS PostScript Treiber. Für diese Clients brauchen Sie nach wie
vor die <filename>ADOBE*.*</filename> Treiber, wie oben erwähnt.
</para></note>

<note>
<para>
Es macht nichts, wenn Sie immer noch die <filename>ADOBE*.*</filename> Treiber-Dateien aus älteren Installationen
im Verzeichnis <filename>/usr/share/cups/drivers/</filename> liegen haben. Das neue <command>cupsaddsmb</command>
(ab 1.1.16) bevorzugt automatisch die eigenen Treiber, wenn es beide vorfindet.
</para></note>

<note><para>
<indexterm><primary>"Printers" folder</primary></indexterm>
Sollten Ihre Windows-Clients die alten <filename>ADOBE*.*</filename> Treiber-Dateien installiert haben, wird
der Download des neuen CUPS PostScript Treibers zuerst scheitern. Sie müssen den alten Treiber zuerst von den
Clients löschen. Es reicht nicht aus, den Drucker zu <quote>löschen</quote>, da die Treiber-Dateien nach wie vor
von den Clients bereitgestellt und wiederverwendet werden, wenn Sie versuchen, den Drucker neu zu installieren.
Um die Adobe-Treiber auf den Clients völlig los zu werden, öffnen Sie den Ordner <guilabel>Drucker</guilabel>
(evtl. via <guilabel>Start > Systemsteuerung > Drucker und Faxgeräte</guilabel>), klicken rechts auf den
Ordner-Hintergrund und wählen <guimenuitem>Servereigenschaften</guimenuitem>. Wenn sich der neue Dialog öffnet,
wählen Sie den Reiter <guilabel>Treiber</guilabel>. In der Liste wählen Sie den Treiber, den Sie löschen
wollen und klicken auf <guilabel>Entfernen</guilabel>. Dies funktioniert nur, wenn kein einziger Drucker mehr
übrig ist, der diesen Treiber verwendet. Sie müssen zuerst alle Drucker im Ordner <guilabel>Drucker</guilabel>
<quote>löschen</quote>, die diesen Treiber verwenden. Sie brauchen Administrator-Rechte, um dies zu tun.
</para></note>

<note><para>
<indexterm><primary>rpcclient</primary><secondary>setdriver</secondary></indexterm>
Sobald Sie erfolgreich den CUPS PostScript Treiber auf einen Client geladen haben, können Sie leicht alle Drucker
auf diesen Treiber umstellen, indem Sie so vorgehen, wie in
<link linkend="printing">Classical Printing Support</link> beschrieben. Entweder ändern Sie den Treiber für einen
vorhandenen Drucker, indem Sie den Dialog <guilabel>Drucker-Eigenschaften</guilabel> verwenden, oder Sie
benutzen den Befehl <command>rpcclient</command> mit der Option <command>setdriver</command>.
</para></note>
</sect2>

<sect2>
<title>Windows CUPS-PostScript-Treiber versus Adobe-Treiber</title>

<para>
Interessiert Sie ein Vergleich des CUPS- und des Adobe-Treibers? Für unsere Zwecke sind dies die wichtigsten
Punkte, die für den CUPS-Treiber sprechen:
</para>

<itemizedlist>
<listitem><para>Keine Probleme mit der Adobe EULA.</para></listitem>

<listitem><para>Keine Probleme mit der Frage <quote>Wo kriege ich die Adobe Treiber-Dateien her?
</quote></para></listitem>

<listitem><para>
<indexterm><primary>PJL</primary></indexterm>
Die Adobe-Treiber (auf Anfrage der zugeordneten PPD-Datei) fügen oft einen PJL-Header vor dem Haupt-PS-Teil der
Druck-Datei ein. Daher beginnt die Druck-Datei mit <parameter>&lt;1B &gt;%-12345X</parameter> oder
<parameter>&lt;escape&gt;%-12345X</parameter> anstatt von <parameter>%!PS</parameter>. Das führt dazu, daß der
CUPS-Daemon die eintreffende Datei automatisch als druckfertig kennzeichnet, und sie nicht durch den Filter
<parameter>pstops</parameter> schickt (technisch ausgedrückt, wird die Datei nicht als der generische
MIME-Typ <indexterm><primary>application/postscript</primary></indexterm>
<parameter>application/postscript</parameter>, sondern als MIME-Typ
<indexterm><primary>application/cups.vnd-postscript</primary></indexterm>
<parameter>application/cups.vnd-postscript</parameter> eingestuft), was daher auch dazu führt, daß die
Seitenzählung in <parameter>/var/log/cups/page_log</parameter> nicht die exakte Seitenanzahl erhält; stattdessen
wird die Dummy-Seitenzahl <quote>1</quote> in einem Standard-Setup protokolliert).</para></listitem>

<listitem><para>
Der Adobe-Treiber hat mehr Optionen, um das von ihm generierte PostScript falsch zu konfigurieren (wie z.B. es
versehentlich auf <guilabel>Optimize for Speed</guilabel> anstatt auf
<guilabel>Optimize for Portability</guilabel> zu setzen, was dazu führen kann, daß CUPS es nicht mehr
verarbeiten kann).</para></listitem>

<listitem><para>
Die Ausgabe des CUPS-PostScript-Treibers, der von Windows-Clients an den CUPS-Server gesendet wird, wird
garantiert als generischer MIME-Typ <parameter>application/postscript</parameter> typisiert, daher auch
zuverlässig durch den Filter <parameter>pstops</parameter> geschickt, was die korrekte Seitenzahl in
<filename>page_log</filename> ergibt, für Abrechnungs- und Quota-Zwecke.
</para></listitem>

<listitem><para>
Der CUPS-PostScript-Treiber unterstützt das Senden von zusätzlichen Standard-Druck-Optionen (IPP) durch
Windows NT/200x/XP-Clients. Solche zusätzlichen Druck-Optionen sind: das Benennen der Standard-CUPS
<emphasis>Banner Seiten</emphasis> (oder der benutzerdefinierten, sollten sie zum Zeitpunkt des Treiber-Downloads
installiert sein), unter Verwendung der CUPS-Option page-label, das Setzen einer Auftragspriorität, und das
Setzen einer Ausführungszeit des Drucks (mit der Option, daß zukünftig noch weitere IPP-Auftrags-Attribute
unterstützt werden).</para></listitem>

<listitem><para>
Der CUPS-PostScript-Treiber unterstützt das Einschliessen von neuen
<parameter>*cupsJobTicket</parameter>-Parametern am Anfang der PostScript-Datei (welche in Zukunft für
alle möglichen nützlichen Erweiterungen auf CUPS-Seite verwendet werden können, aber keinerlei andere
Anwendungen stören werden, da diese sie einfach als Kommentar betrachten und ignorieren werden).</para></listitem>

<listitem><para>
Der CUPS-PostScript-Treiber wird das Herzstück des voll ausgewachsenen CUPS-IPP-Clients für Windows NT/200x/XP
sein, der bald veröffentlicht werden soll (möglicherweise parallel zur ersten Beta-Release von CUPS 1.2).
</para></listitem>
</itemizedlist>

</sect2>

<sect2>
<title>Das Ausführen von cupsaddsmb (im Quiet Mode)</title>


<para>
<indexterm><primary>cupsaddsmb</primary></indexterm>
<indexterm><primary>point 'n' print</primary></indexterm>
Der Befehl <command>cupsaddsmb</command> kopiert die benötigten Dateien in Ihre Freigabe
<smbconfsection>[print$]</smbconfsection>. Zusätzlich wird das mit dem Drucker assoziierte PPD von
<filename>/etc/cups/ppd/</filename> in <smbconfsection>[print$]</smbconfsection> kopiert. Dort warten diese
Dateien auf praktische Windows-Client-Installationen via Point'n'Print. Bevor wir den Befehl erfolgreich
ausführen können, müssen wir sicher sein, daß wir uns am Samba-Server authentifizieren können. Wenn Sie ein
kleines Netzwerk haben, verwenden Sie möglicherweise user-level-Sicherheit
(<smbconfoption><name>security</name><value>user</value></smbconfoption>).
</para>

<para>
Hier ein Beispiel für ein erfolgreich ausgeführtes <command>cupsaddsmb</command>:
</para>

<para><screen>
&rootprompt;<userinput>cupsaddsmb -U root infotec_IS2027</userinput>
Password for root required to access localhost via Samba: <userinput>['secret']</userinput>
</screen></para>

<para>
Um <emphasis>alle</emphasis> Drucker und Treiber freizugeben, verwenden Sie den Parameter <option>-a</option>
anstatt des Drucker-Namens. Da <command>cupsaddsmb</command> die Druckertreiber an Samba
<quote>exportiert</quote>, sollte es offensichlich sein, daß es nur für Queues funktioniert, mit denen ein
CUPS-Treiber assoziiert ist.
</para>
</sect2>

<sect2>
<title>Das Auführen von cupsaddsmb mit "Verbose Output"</title>


<para>
<indexterm><primary>cupsaddsmb</primary></indexterm>
Vielleicht wollen Sie ja sehen, was passiert. Verwenden Sie den Parameter <option>-v</option>, um einen
vollständigeren Report über das Geschehene zu erhalten. Das folgende Beispiel wurde für bessere Lesbarkeit
editiert; alle <quote>\</quote> an den Zeilenenden zeigen an, daß ich einen zusätzlichen Zeilenumbruch samt
Einrückung hinzugefügt habe:
</para>

<warning><para>
Sie werden das root-Passwort für das Samba-Konto am Bildschirm angezeigt bekommen.
</para></warning>

<para>
	
<indexterm><primary>rpcclient</primary><secondary>adddriver</secondary></indexterm>
<indexterm><primary>rpcclient</primary><secondary>setdriver</secondary></indexterm>
	<screen>
&rootprompt;<userinput>cupsaddsmb -U root -v infotec_2105</userinput>
Password for root required to access localhost via &example.server.samba;:
Running command: smbclient //localhost/print\$ -N -U'root%secret' \
    -c 'mkdir W32X86; \
    put /var/spool/cups/tmp/3e98bf2d333b5 W32X86/infotec_2105.ppd; \
	put /usr/share/cups/drivers/cupsdrvr.dll W32X86/cupsdrvr.dll; \
    put /usr/share/cups/drivers/cupsui.dll W32X86/cupsui.dll; \
    put /usr/share/cups/drivers/cups.hlp W32X86/cups.hlp'
added interface ip=10.160.51.60 bcast=10.160.51.255 nmask=255.255.252.0
Domain=[CUPS-PRINT] OS=[UNIX] Server=[Samba 2.2.7a]
NT_STATUS_OBJECT_NAME_COLLISION making remote directory \W32X86
putting file /var/spool/cups/tmp/3e98bf2d333b5 as \W32X86/infotec_2105.ppd
putting file /usr/share/cups/drivers/cupsdrvr.dll as \W32X86/cupsdrvr.dll
putting file /usr/share/cups/drivers/cupsui.dll as \W32X86/cupsui.dll
putting file /usr/share/cups/drivers/cups.hlp as \W32X86/cups.hlp

Running command: rpcclient localhost -N -U'root%secret'
   -c 'adddriver "Windows NT x86"   \
   "infotec_2105:cupsdrvr.dll:infotec_2105.ppd:cupsui.dll:cups.hlp:NULL: \
    RAW:NULL"'
cmd = adddriver "Windows NT x86" \
   "infotec_2105:cupsdrvr.dll:infotec_2105.ppd:cupsui.dll:cups.hlp:NULL: \
	RAW:NULL"
Printer Driver infotec_2105 successfully installed.

Running command: smbclient //localhost/print\$ -N -U'root%secret' \
-c 'mkdir WIN40; \
    put /var/spool/cups/tmp/3e98bf2d333b5 WIN40/infotec_2105.PPD; \
	put /usr/share/cups/drivers/ADFONTS.MFM WIN40/ADFONTS.MFM;   \
    put /usr/share/cups/drivers/ADOBEPS4.DRV WIN40/ADOBEPS4.DRV; \
    put /usr/share/cups/drivers/ADOBEPS4.HLP WIN40/ADOBEPS4.HLP; \
    put /usr/share/cups/drivers/DEFPRTR2.PPD WIN40/DEFPRTR2.PPD; \
	put /usr/share/cups/drivers/ICONLIB.DLL WIN40/ICONLIB.DLL; \
	put /usr/share/cups/drivers/PSMON.DLL WIN40/PSMON.DLL;'
  added interface ip=10.160.51.60 bcast=10.160.51.255 nmask=255.255.252.0
  Domain=[CUPS-PRINT] OS=[UNIX] Server=[Samba 2.2.7a]
  NT_STATUS_OBJECT_NAME_COLLISION making remote directory \WIN40
  putting file /var/spool/cups/tmp/3e98bf2d333b5 as \WIN40/infotec_2105.PPD
  putting file /usr/share/cups/drivers/ADFONTS.MFM as \WIN40/ADFONTS.MFM
  putting file /usr/share/cups/drivers/ADOBEPS4.DRV as \WIN40/ADOBEPS4.DRV
  putting file /usr/share/cups/drivers/ADOBEPS4.HLP as \WIN40/ADOBEPS4.HLP
  putting file /usr/share/cups/drivers/DEFPRTR2.PPD as \WIN40/DEFPRTR2.PPD
  putting file /usr/share/cups/drivers/ICONLIB.DLL as \WIN40/ICONLIB.DLL
  putting file /usr/share/cups/drivers/PSMON.DLL as \WIN40/PSMON.DLL

  Running command: rpcclient localhost -N -U'root%secret' \
   -c 'adddriver "Windows 4.0"      \
   "infotec_2105:ADOBEPS4.DRV:infotec_2105.PPD:NULL:ADOBEPS4.HLP: \
   PSMON.DLL:RAW:ADOBEPS4.DRV,infotec_2105.PPD,ADOBEPS4.HLP,PSMON.DLL, \
    ADFONTS.MFM,DEFPRTR2.PPD,ICONLIB.DLL"'
	cmd = adddriver "Windows 4.0" "infotec_2105:ADOBEPS4.DRV:\
	infotec_2105.PPD:NULL:ADOBEPS4.HLP:PSMON.DLL:RAW:ADOBEPS4.DRV,\
	infotec_2105.PPD,ADOBEPS4.HLP,PSMON.DLL,ADFONTS.MFM,DEFPRTR2.PPD,\
	ICONLIB.DLL"
  Printer Driver infotec_2105 successfully installed.

  Running command: rpcclient localhost -N -U'root%secret'  \
   -c 'setdriver infotec_2105 infotec_2105'
  cmd = setdriver infotec_2105 infotec_2105
  Successfully set infotec_2105 to driver infotec_2105.

</screen></para>

<para>
Wenn Sie genau hinsehen, werden Sie entdecken, daß Ihr root-Passwort unverschlüsselt übers Netz übertragen wurde,
also geben Sie Acht! Wenn Sie weiter lesen, entdecken Sie Fehlermeldungen wie
<?latex \linebreak ?>NT_STATUS_OBJECT_NAME_COLLISION . Diese treten auf, weil die Verzeichnisse WIN40 und W32X86
bereits in der Freigabe <smbconfsection>[print$]</smbconfsection> existiert haben (von einer früheren
Treiber-Installation). Diese Meldungen sind in diesem Zusammenhang harmlos.
</para>
</sect2>

<sect2>
<title>cupsaddsmb verstehen</title>


<para>
<indexterm><primary>cupsaddsmb</primary></indexterm>
Was ist passiert? Was hat <command>cupsaddsmb</command> gemacht? Es gibt fünf Stufen in dieser Prozedur:
</para>

<orderedlist>
	<listitem><para>
	<indexterm><primary>IPP</primary></indexterm>
	Rufe den CUPS-Server via IPP und frage die Treiber-Dateien und die PPD-Datei für den angegebenen
	Drucker ab.</para></listitem>

	<listitem><para>Speichere die Dateien temporär im lokalen TEMPDIR (wie in <filename>cupsd.conf</filename>
	angegeben).</para></listitem>

	<listitem><para>Verbinde Dich mittels smbclient mit der Freigabe
	<smbconfsection>[print$]</smbconfsection> auf dem Samba-Server und kopiere die Dateien in das dortige
	Unterverzeichnis WIN40/ (für Windows 9x/Me) bzw. W32X86/ (für Windows NT/200x/XP).</para></listitem>

	<listitem><para>
	<indexterm><primary>rpcclient</primary><secondary>adddriver</secondary></indexterm>
	Verbinde Dich via rpcclient mit dem Samba-Server und führe den Befehl <command>adddriver</command> mit
	den korrekten Parametern aus.</para></listitem>

	<listitem><para>
	<indexterm><primary>rpcclient</primary><secondary>setdriver</secondary></indexterm>
	Verbinde Dich ein zweites Mal via rpcclient mit dem Samba-Server und führe den Befehl
	<command>setdriver</command> aus.</para></listitem>
</orderedlist>

<note>
<para>
Sie können das Werkzeug <command>cupsaddsmb</command> auch mit Parametern ausführen, um einen Host als
Samba-Host und einen zweiten Host als CUPS-Host anzugeben. Besonders wenn Sie ein weitergehendes Verständnis
aufbauen wollen, ist es sinnvoll, dies zu versuchen, und klar zu sehen, was passiert (obwohl in der Praxis
die meisten Installationen Samba- und CUPS-Server auf derselben Maschine haben werden):
</para>

<para><screen>
&rootprompt;<userinput>cupsaddsmb -H sambaserver -h cupsserver -v drucker</userinput>
</screen></para>
</note>
</sect2>

<sect2>
<title>Wie man erkennt, daß cupsaddsmb erfolgreich war</title>

<para>
Sie <emphasis>müssen</emphasis> immer überprüfen, daß das Werkzeug in allen Bereichen erfolgreich gearbeitet hat.
Sie brauchen zumindest diese drei Meldungen in der Ausgabe von cupsaddsmb:
</para>

<orderedlist>

<listitem><para><emphasis>Printer Driver infotec_2105 successfully
installed.</emphasis> # (für die W32X86 == Windows NT/200x/XP Architektur).</para></listitem>

<listitem><para><emphasis>Printer Driver infotec_2105 successfully
installed.</emphasis> # (für die WIN40 == Windows 9x/Me Architektur).</para></listitem>

<listitem><para><emphasis>Successfully set [printerXPZ] to driver
[printerXYZ].</emphasis></para></listitem>
</orderedlist>

<para>
Diese Meldungen sind eventuell nicht ganz leicht in der gesamten Ausgabe zu erkennen. Wenn Sie
<command>cupsaddsmb</command> mit dem Parameter <option>-a</option> ausführen (der versucht,
<emphasis>alle</emphasis> aktiven CUPS-Drucker-Treiber für den Download vorzubereiten), könnten Sie übersehen,
daß einzelne Druckertreiber Probleme bei der Installation hatten. Hier hilft eine Umleitung der Ausgabe bei der
nachträglichen Analyse der Ergebnisse.
</para>

<para>
Wenn Sie das erhalten:
<screen>
SetPrinter call failed!
result was WERR_ACCESS_DENIED
</screen>
bedeutet das, daß Sie eventuell <smbconfoption><name>use client driver</name><value>yes</value></smbconfoption>
für diesen Drucker gesetzt haben. Setzen Sie dies auf <quote>no</quote>, das wird das Problem lösen.
Sehen Sie man samba(5) für die Erklärung des Parameters <parameter>use client driver</parameter>.
</para>

<note><para>
Es ist unmöglich, irgendeine Ausgabe zu sehen, wenn Sie <command>cupsaddsmb</command> nicht im "verbose mode"
ausführen. Daher empfehlen wir ausdrücklich, den voreingestellten "quiet mode" nicht zu verwenden. Dieser
verbirgt alle eventuell auftretenden Probleme vor Ihnen.
</para></note>
</sect2>

<sect2>
<title>cupsaddsmb mit einem Samba PDC</title>

<para>
<indexterm><primary>cupsaddsmb</primary></indexterm>
Schaffen Sie es nicht, den Standard-Befehl <command>cupsaddsmb</command> auf einem Samba-PDC erfolgreich
auszuführen? Werden Sie immer und immer wieder nach dem Passwort gefragt, und der Befehl wird nicht einmal
gestartet? Versuchen Sie eine dieser Varianten:
</para>

<para><screen>
&rootprompt;<userinput>cupsaddsmb -U &example.workgroup;\\root -v druckername</userinput>
&rootprompt;<userinput>cupsaddsmb -H &example.pdc.samba; -U &example.workgroup;\\root -v druckername</userinput>
&rootprompt;<userinput>cupsaddsmb -H &example.pdc.samba; -U &example.workgroup;\\root -h cups-server -v druckername</userinput>
</screen></para>

<para>
(Beachten Sie die zwei Backslashes: der erste wird benötigt, um das <quote>escaping</quote> des zweiten zu
bewirken).
</para>
</sect2>

<sect2>
<title>Flußdiagramm für cupsaddsmb </title>

<para>
<indexterm><primary>cupsaddsmb</primary></indexterm>
<link linkend="small14">cupsaddsmb Flußdiagramm.</link> zeigt eine grafische Darstellung der Abläufe, Befehlsketten,
und Datenflüsse des Befehls <command>cupaddsmb</command>. Nochmals zur Erinnerung: cupsaddsmb ist nicht gedacht
für und arbeitet nicht mit Raw-Queues!
</para>

<para>
	<image id="small14"><imagedescription>cupsaddsmb Flußdiagramm.</imagedescription>
		<imagefile>14small</imagefile></image>
</para>
</sect2>

<sect2>
<title>Das Installieren des PostScript-Treibers auf einem Client</title>

<para>
<indexterm><primary>point 'n' print</primary></indexterm>
Nachdem <command>cupsaddsmb</command> beendet wurde, ist Ihr Treiber vorbereitet, um von den Clients verwendet
zu werden. Hier sind die Schritte, die Sie durchführen müssen, um den Treiber via Point'n'Print herunterzuladen
und zu installieren. Auf dem Windows-Client wählen Sie den CUPS/Samba-Server:
</para>

<itemizedlist>

<listitem><para>
<indexterm><primary>"Printers" folder</primary></indexterm>
Öffnen Sie die Freigabe <guilabel>Drucker und Faxgeräte</guilabel> von Samba in der Netzwerkumgebung.
</para></listitem>

<listitem><para>Klicken Sie mit der rechten Maustaste auf den gewünschten Drucker.
</para></listitem>

<listitem><para>Im sich öffnenden Kontext-Menü wählen Sie
<guimenuitem>Installieren...</guimenuitem> oder
<guimenuitem>Verbinden...</guimenuitem> (abhängig von der verwendeten Windows-Version).
</para></listitem>
</itemizedlist>

<para>
Ein paar Sekunden später sollte es einen neuen Drucker im <emphasis>lokalen</emphasis> Ordner
<guilabel>Drucker und Faxgeräte</guilabel> Ihres Clients geben. Unter Windows XP wird er der Namenskonvention
von <emphasis>DruckerName auf SambaServer</emphasis> entsprechen. (In meinem momentanen Fall ist es
"infotec_2105 auf kde-bitshop"). Wenn Sie diesen Drucker testen wollen, und Ihren ersten Auftrag aus einer
Anwendung wie Winword senden wollen, erscheint der neue Drucker als Eintrag #
<filename>\\SambaServer\DruckerName</filename> im DropDown-Menü der verfügbaren Drucker.
</para>

<para>
<indexterm><primary>PPD</primary></indexterm>
<command>cupsaddsmb</command> arbeitet nur zuverlässig mit CUPS-Versionen ab 1.1.15 und Samba-Versionen ab 2.2.4.
Wenn es nicht funktioniert, oder wenn der automatische Drucker-Download auf die Clients nicht erfolgreich
verläuft, können Sie den CUPS-Treiber immer noch manuell über den Adobe-PostScript-Treiber auf den Clients
installieren. Dann lassen Sie die Queue auf die Samba-Freigabe zeigen, um eine UNC-Verbindung zu erreichen:
</para>

<para><screen>
&dosprompt;<userinput>net use lpt1: \\sambaserver\druckerfreigabe /user:ntadmin</userinput>
</screen></para>

<para>
wenn Sie die CUPS Netzwerk-RIP-Funktionalitäten nutzen möchten. (Beachten Sie, daß der Benutzer
<quote>ntadmin</quote> ein gültiger Samba-Benutzer mit den erforderlichen Rechten sein muß.) Dies installiert
die Druckerverbindung in klassischer <emphasis>LanMan</emphasis>-Weise (und verwendet dabei kein MS-RPC).
</para>
</sect2>

<sect2>
<title>Das Vermeiden von kritischen PostScript-Treiber-Einstellungen auf dem Client</title>

<para>
Das Drucken funktioniert, aber es gibt immer noch Probleme. Die meisten Aufträge drucken sehr gut, aber einige
drucken gar nicht. Manche Aufträge haben Problem mit den Schriftarten, die nicht besonders gut aussehen.
Manche Aufträge drucken schnell, manche sind unglaublich langsam. Viele dieser Probleme können minimiert oder
überhaupt komplett beseitigt werden, wenn Sie ein paar Richtlinien befolgen. Erinnern Sie sich, wenn Ihr
Drucker nicht PostScript-befähigt ist, beschicken Sie Ihre Ghostscript-Installation auf Ihrem CUPS-Host mit dem
Output, die die Einstellungen des Treibers auf Ihrem Client erzeugen. Behandeln Sie Ghostscript gut:
</para>

<itemizedlist>
<listitem><para>Vermeiden Sie die PostScript-Option: Optimize for Speed. Verwenden Sie stattdessen die
Einstellung Optimize for Portability (Adobe PostScript-Treiber).</para></listitem>

<listitem><para>Verwenden Sie nicht die Einstellung Page Independence: NO. Verwenden Sie stattdessen die
Einstellung Page Independence: YES (CUPS PostScript-Treiber).</para></listitem>

<listitem><para>Empfohlen wird die True Type Font Downloading Option: Native True Type statt Automatic and
Outline; Sie sollten unter allen Umständen die Option: Bitmap vermeiden (Adobe PostScript-Treiber).
</para></listitem>

<listitem><para>Wählen Sie True Type Font: Download as Softfont into Printer anstatt des voreingestellten
Replace by Device Font (für ausgefallene Schriftarten kann es sein, daß Sie es wieder umstellen müssen, um
überhaupt einen Ausdruck zu erhalten) (Adobe).</para></listitem>

<listitem><para>Manchmal können Sie das PostScript Language Level wählen: Bei Problemen können Sie 2 anstatt von
3 versuchen (das neueste ESP Ghostscript kann sehr gut mit Level 3 PostScript umgehen) (Adobe).</para></listitem>

<listitem><para>Sagen Sie Yes zum PostScript Error Handler (Adobe).</para></listitem>
</itemizedlist>
</sect2>
</sect1>

<sect1>
<title>Das manuelle Installieren von PostScript-Treiber-Dateien mittels rpcclient</title>

<para>
Natürlich können Sie alle in cupsaddsmb eingebetteten Befehle selbst ausführen, einen nach dem anderen, und damit
die Treiber-Dateien hochladen und für zukünftige Downloads vorbereiten.
</para>

<orderedlist>
<listitem><para>Bereiten Sie Samba vor (Eine CUPS-Queue mit dem Namen des Druckers sollte bereits existieren,
wir stellen hier nur den Treiber zur Verfügung).
</para></listitem>

<listitem><para>Kopieren Sie alle Dateien nach
		<smbconfsection>[print$]</smbconfsection>.</para></listitem>

<listitem><para>
<indexterm><primary>rpcclient</primary><secondary>adddriver</secondary></indexterm>
Führen Sie <command>rpcclient adddriver</command> aus
(für jede Client-Architektur, die Sie unterstützen wollen).</para></listitem>

<listitem><para>
<indexterm><primary>rpcclient</primary><secondary>setdriver</secondary></indexterm>
Führen Sie <command>rpcclient
setdriver</command> aus.</para></listitem>
</orderedlist>

<para>
<indexterm><primary>rpcclient</primary><secondary>enumports</secondary></indexterm>
<indexterm><primary>rpcclient</primary><secondary>enumprinters</secondary></indexterm>
<indexterm><primary>rpcclient</primary><secondary>enumdrivers</secondary></indexterm>
<indexterm><primary>rpcclient</primary><secondary>setdriver</secondary></indexterm>
<indexterm><primary>rpcclient</primary><secondary>adddriver</secondary></indexterm>
Wir werden das jetzt tun. Lesen Sie zuerst die manpage zu <parameter>rpcclient</parameter>, um eine erste
Vorstellung zu erhalten. Sehen Sie sich die druckbezogenen Sub-Befehle an.
<command>enumprinters</command>,
<command>enumdrivers</command>, <command>enumports</command>,
<command>adddriver</command>, <command>setdriver</command> sind unter den interessantesten davon.
<parameter>rpcclient</parameter> implementiert einen wichtigen Teil des MS-RPC-Protokolls. Sie können es
verwenden, um einen Windows NT (oder 200x/XP) PC abzufragen und zu steuern. MS-RPC wird von Windows-Clients
verwendet (neben anderen Dingen), um die Point'n'Print-Features zu nutzen. Samba kann dies mittlerweile auch
"nachahmen".
</para>

<sect2>
<title>Ein Blick in die man-page zu rpcclient</title>

<para>
Lassen Sie uns zuerst die man-page zu <parameter>rpcclient</parameter> prüfen. Hier sind zwei relevante
Abschnitte:
</para>

<para>
<command>adddriver &lt;arch&gt; &lt;config&gt;</command> Führe ein
<command>AddPrinterDriver()</command> RPC aus, um den Druckertreiber auf dem Server zu installieren.
Die Treiber sollten bereits im Verzeichnis, das von <command>getdriverdir</command> zurückgegeben wird,
existieren. Mögliche Werte für <parameter>arch</parameter> sind dieselben wie für
<command>getdriverdir</command>. Der Parameter <parameter>config</parameter> ist wie folgt definiert:
</para>
		
<para><screen>
Long Printer Name:\
Driver File Name:\
Data File Name:\
Config File Name:\
Help File Name:\
Language Monitor Name:\
Default Data Type:\
Comma Separated list of Files
</screen></para>

<para>Alle leeren Felder sollten als String <quote>NULL</quote> angegeben werden. </para>

<para>Samba muß das Konzept der Druck-Monitore nicht unterstützen, da dieses nur auf lokale Drucker anzuwenden
ist, deren Treiber eine bi-direktionale Verbindung zur Kommunikation mit dem Drucker nutzen können. Dieses
Feld sollte <quote>NULL</quote> sein. Auf einem entfernten NT-Druck-Server muß der Druck-Monitor für einen
Treiber bereits installiert sein, bevor man den Treiber hinzufügt, oder das RPC wird scheitern.
</para>

<para>
<command>setdriver &lt;printername&gt; &lt;drivername&gt;</command>
Führe einen Befehl <command>SetPrinter()</command> aus, um den mit einem Drucker assoziierten Treiber zu
aktualisieren. Der Druckertreiber muß bereits korrekt auf dem Druck-Server installiert sein.
</para>

<para>Beachten Sie auch die Befehle <command>enumprinters</command> und <command>enumdrivers</command>
für das Abfragen einer Liste von installierten Druckern und Treibern.
</para>

</sect2>

<sect2>
<title>Die rpcclient man-page verstehen</title>

<para>
Das <emphasis>exakte</emphasis> Format wird nicht allzu klar von der man-page beschrieben, da Sie mit einigen
Parametern umgehen müssen, die Leerzeichen enthalten. Hier ist eine bessere Beschreibung dafür. Wir haben
den Befehl mit Zeilenumbrüchen versehen, und die Umbrüche mit <quote>\</quote> gekennzeichnet. Üblicherweise
würden Sie diesen Befehl in einer Zeile eingeben, ohne die Umbrüche:
<indexterm><primary>rpcclient</primary><secondary>adddriver</secondary></indexterm>
</para>

<para><screen>
 adddriver "Architecture" \
           "LongPrinterName:DriverFile:DataFile:ConfigFile:HelpFile:\
           LanguageMonitorFile:DataType:ListOfFiles,Comma-separated"
</screen></para>

<para>
Was die man-page als ein simples <parameter>&lt;config&gt;</parameter>-Schlüsselwort bezeichnet, besteht in
Wirklichkeit aus acht durch Doppelpunkte getrennten Feldern. Das letzte Feld kann mehrere (in manchen sehr
ausgefallenen Fällen bis zu 20 zusätzliche) Dateinamen enthalten. Dies mag anfangs sehr verwirrend klingen.
Was die man-pages als <quote>LongPrinterName</quote> bezeichnen, sollte in der Realität als
<quote>Driver Name</quote> bezeichnet werden. Sie können es bezeichnen, wie Sie wollen, solange Sie diesen
Namen später im Befehl <command>rpcclient ... setdriver</command> wieder verwenden. Aus praktischen Gründen
empfiehlt es sich, den Treiber so zu benennen wie den Drucker.
</para>

<para>
Es ist überhaupt nicht einfach. Ich höre Sie fragen:
<quote>Wie weiß ich, welche Dateien Driver File</quote>, <quote>Data File</quote>, <quote>Config File</quote>,
<quote>Help File</quote> und <quote>Language Monitor File" im jeweiligen Fall sind?</quote>
&smbmdash; Um eine Antwort zu finden, können Sie sich ja mal ansehen, wie eine Windows NT Box mit einem
freigegebenen Drucker uns diese Dateien anbietet. Erinnern Sie sich, daß diese ganze Prozedur vom Samba-Team
durch Abhören des Verkehrs, der von Windows-Computern im Netzwerk verursacht wird, entwickelt werden muß. Wir
können uns nun genauso einer Windows Box zuwenden und auf sie von einer UNIX-Workstation aus zugreifen. Wir
werden sie mittels <command>rpcclient</command> abfragen, um zu sehen, was sie uns erzählt und versuchen, die
man-page klarer zu verstehen, die wir gerade gelesen haben.
</para>
</sect2>

<sect2>
<title>Ein Beispiel durch Abfragen einer Windows Box erstellen</title>

<para>
	<indexterm><primary>rpcclient</primary><secondary>getdriver</secondary></indexterm>
	<indexterm><primary>rpcclient</primary><secondary>getprinter</secondary></indexterm>
Wir könnten <command>rpcclient</command> mit einem
<command>getdriver</command> oder <command>getprinter</command> Sub-Befehl (in level 3 Ausführlichkeit)
an die Windows Box absetzen. Setzen Sie sich einfach an eine UNIX oder Linux Workstation mit installierten
Samba-Werkzeugen und tippen folgenden Befehl:
</para>

<para><screen>
&rootprompt;<userinput>rpcclient -U'user%secret' NT-SERVER -c 'getdriver printername 3'</userinput>
</screen></para>

<para>
Aus dem Ergebnis sollte klarwerden, welche Detai welche ist. Hier ein Beispiel aus meiner Installation:
</para>

<para>
<indexterm><primary>rpcclient</primary><secondary>getdriver</secondary></indexterm>
	<screen>
&rootprompt;<userinput>rpcclient -U'Danka%xxxx' W200xSERVER \
	-c'getdriver "DANKA InfoStream Virtual Printer" 3'</userinput>
 cmd = getdriver "DANKA InfoStream Virtual Printer" 3

 [Windows NT x86]
 Printer Driver Info 3:
         Version: [2]
         Driver Name: [DANKA InfoStream]
         Architecture: [Windows NT x86]
         Driver Path: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\PSCRIPT.DLL]
         Datafile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\INFOSTRM.PPD]
         Configfile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\PSCRPTUI.DLL]
         Helpfile: [C:\WINNT\System32\spool\DRIVERS\W32X86\2\PSCRIPT.HLP]

         Dependentfiles: []
         Dependentfiles: []
         Dependentfiles: []
         Dependentfiles: []
         Dependentfiles: []
         Dependentfiles: []
         Dependentfiles: []

         Monitorname: []
         Defaultdatatype: []

</screen></para>

<para>
Manche Druckertreiber listen zusätzliche Dateien unter der Bezeichnung
<parameter>Dependentfiles</parameter> und diese würden im letzten Feld
<parameter>ListOfFiles,Comma-separated</parameter> angeführt werden. Für den CUPS-PostScript-Treiber brauchen
wir keine (und auch für die Adobe-Treiber würden wir keine brauchen), daher erhält dieses Feld den Eintrag
<quote>NULL</quote>.
</para>
</sect2>

<sect2>
<title>Erfordernisse für erfolgreiches Ausführen von adddriver und setdriver</title>

<para>
>Aus der man-page (und der oben zitierten Ausgabe von <command>cupsaddsmb</command>) wird klar, daß Sie bestimmte
Bedingungen erfüllen müssen, um das manuelle Hochladen und Initialisieren von Treibern erfolgreich zu
ermöglichen. Die beiden Sub-Befehle <command>rpcclient</command> und
<indexterm><primary>rpcclient</primary><secondary>adddriver</secondary></indexterm> (<command>adddriver</command>
und <command>setdriver</command>) müssen folgende Bedingungen erfüllen, um erfolgreich abzuschliessen:
</para>
<itemizedlist>

<listitem><para>Sie sind als <smbconfoption><name>printer admin</name></smbconfoption> oder root verbunden
(dies ist <emphasis>nicht</emphasis> die Gruppe <quote>Printer Operators</quote> in NT, sondern die Gruppe
<emphasis>printer admin</emphasis>, wie sie im Abschnitt
<smbconfsection>[global]</smbconfsection> von &smb.conf; definiert wurde).</para></listitem>

<listitem><para>Kopieren Sie alle erforderlichen Treiber-Dateien nach
<filename>\\SAMBA\print$\w32x86</filename> und
<filename>\\SAMBA\print$\win40</filename>. Diese werden später in den Unterverzeichnissen
<quote>0</quote> respektive <quote>2</quote> landen. Für den Moment geben Sie sie <emphasis>nicht</emphasis>
dorthin, sie werden automatisch vom Sub-Befehl <command>adddriver</command> verwendet. (Wenn Sie
<command>smbclient</command> dazu verwenden, die Treiber-Dateien in die Freigabe zu plazieren, beachten Sie, daß
Sie das Zeichen <quote>$</quote> <quote>escapen</quote>:
<command>smbclient //sambaserver/print\$ -U root.</command>)</para></listitem>

<listitem><para>Der Benutzer, als der Sie sich verbinden, muß schreibberechtigt für die Freigabe
<smbconfsection>[print$]</smbconfsection> sein und dort Verzeichnisse anlegen dürfen.
</para></listitem>

<listitem><para>Der Drucker, für den Sie die Windows-Clients vorbereiten wollen, muß bereits in CUPS installiert
sein.
</para></listitem>

<listitem><para>
	<indexterm><primary>rpcclient</primary><secondary>setdriver</secondary></indexterm>
	<indexterm><primary>rpcclient</primary><secondary>enumprinters</secondary></indexterm>
Der CUPS-Drucker muß Samba bekannt sein, andernfalls scheitert der Sub-Befehl <command>setdriver</command>
mit dem Fehler NT_STATUS_UNSUCCESSFUL. Um zu prüfen, ob der Drucker Samba bekannt ist, können Sie den
Sub-Befehl <command>enumprinters</command> von <command>rpcclient</command> verwenden. Ein seit langem
vorhandener Bug verhinderte ein sauberes Update der Drucker-Liste, bis jeder smbd-Prozess ein SIGHUP empfangen
hatte oder neu gestartet wurde. Erinnern Sie sich daran, falls Sie den CUPS-Drucker gerade erst angelegt haben
und auf Probleme stossen: Versuchen Sie, Samba neu zu starten.
</para></listitem>
</itemizedlist>
</sect2>

<sect2>
<title>Manuelle Treiber-Installation in 15 Schritten</title>

<para>
Wir werden jetzt einen Drucker-Treiber installieren, indem wir manuell alle erforderlichen Befehle ausführen.
Da dies zuerst als ziemlich komplizierter Prozess erscheinen mag, gehen wir die Prozedur Schritt für Schritt
durch, und erklären jede einzelne Aktion, die vorkommt.
</para>

<procedure>
	<title>Manuelle Treiber-Installation</title>

<step>
<title>Den Drucker in CUPS installieren.</title>

<para><screen>
&rootprompt;<userinput>lpadmin -p mysmbtstprn -v socket://10.160.51.131:9100 -E \
			-P canonIR85.ppd</userinput>
</screen></para>

<para>
Dies installiert den Drucker mit dem Namen <parameter>mysmbtstprn</parameter> im CUPS-System. Der Drucker wird
über eine Socket-Verbindung (auch als JetDirect oder Direct TCP/IP bekannt) angesprochen. Sie müssen für diesen
Schritt root sein.
</para>
</step>

<step>
<title>(Optional) Prüfen, ob der Drucker von Samba erkannt wird.</title>

<para>
<indexterm><primary>rpcclient</primary><secondary>enumprinters</secondary></indexterm>
<screen>
	&rootprompt;<userinput>rpcclient -Uroot%xxxx -c 'enumprinters' localhost \
  | grep -C2 mysmbtstprn</userinput>
flags:[0x800000]
name:[\\kde-bitshop\mysmbtstprn]
description:[\\kde-bitshop\mysmbtstprn,,mysmbtstprn]
comment:[mysmbtstprn]
</screen></para>

<para>
Dies sollte den Drucker in der Liste anzeigen. Wenn nicht, stoppen Sie den Samba-Daemon (smbd) und starten Sie
ihn neu, oder senden Sie ein HUP-Signal:
<screen>
&rootprompt;<userinput>kill -HUP `pidof smbd`</userinput>
</screen>
Prüfen Sie nochmals. Korrigieren Sie und wiederholen Sie dies, bis zum Erfolg. Beachten Sie das
<quote>leere</quote> Feld zwischen den beiden Kommas in der Zeile <quote>description</quote>. Der Treibername
würde hier aufscheinen, wenn es bereits einen gäbe. Sie müssen das Samba-Passwort von root kennen (wie es vom
Befehl <command>smbpasswd</command> gesetzt wurde), um diesen Schritt und die meisten der folgenden Schritte
ausführen zu können. Alternativ dazu können Sie sich als einer der Benutzer authentifizieren, die in der
<quote>write list</quote> für <smbconfsection>[print$]</smbconfsection> in &smb.conf; definiert sind.
</para>
</step>

<step>
<title>(Optional) Prüfen, ob Samba einen Treiber für den Drucker kennt.</title>

<para>
	<indexterm><primary>rpcclient</primary><secondary>getprinter</secondary></indexterm>
	<indexterm><primary>rpcclient</primary><secondary>getdriver</secondary></indexterm>
	<screen>
&rootprompt;<userinput>rpcclient -Uroot%xxxx -c 'getprinter mysmbtstprn 2' localhost \
			| grep driver </userinput>
drivername:[]

&rootprompt;<userinput>rpcclient -Uroot%xxxx -c 'getprinter mysmbtstprn 2' localhost \
	| grep -C4 driv</userinput>
servername:[\\kde-bitshop]
printername:[\\kde-bitshop\mysmbtstprn]
sharename:[mysmbtstprn]
portname:[Samba Printer Port]
drivername:[]
comment:[mysmbtstprn]
location:[]
sepfile:[]
printprocessor:[winprint]

&rootprompt;<userinput>rpcclient -U root%xxxx -c 'getdriver mysmbtstprn' localhost</userinput>
 result was WERR_UNKNOWN_PRINTER_DRIVER

</screen></para>

<para>
Keiner der drei oben gezeigten Befehle sollte einen Treiber anzeigen. Dieser Schritt wurde nur ausgeführt, um
diese Bedingung zu demonstrieren. Ein Versuch, sich in diesem Stadium mit dem Drucker zu verbinden, sollte
die Nachricht zeigen: <quote>Der Server hat nicht die erforderlichen Treiber installiert.</quote>
</para>
</step>

<step>
<title>Stellen Sie alle erforderlichen Treiberdateien in die Samba-Freigabe
[print$].</title>

<para><screen>
&rootprompt;<userinput>smbclient //localhost/print\$ -U 'root%xxxx' \
	-c 'cd W32X86; \
	put /etc/cups/ppd/mysmbtstprn.ppd mysmbtstprn.PPD; \
	put /usr/share/cups/drivers/cupsui.dll cupsui.dll; \
	put /usr/share/cups/drivers/cupsdrvr.dll cupsdrvr.dll; \
	put /usr/share/cups/drivers/cups.hlp cups.hlp'</userinput>
</screen></para>

<para>
(Dieser Befehl sollte in einer einzelnen langen Zeile eingegeben werden, die durch <quote>\</quote> angezeigten
Zeilenumbrüche wurden zur Erhöhung der Lesbarkeit eingefügt. Dieser Schritt ist
<emphasis>erforderlich</emphasis>, damit der darauffolgende Schritt erfolgreich durchgeführt werden kann.
Er macht die Dateien physisch in der Freigabe <smbconfsection>[print$]</smbconfsection> verfügbar. Die Clients
wären jedoch nach wie vor nicht in der Lage, diese Treiber zu installieren, da Samba sie noch nicht als
Treiberdateien behandelt. Ein Client, der diesen Treiber abfragt, würde nach wie vor mit einer Meldung wie
<quote>nicht installiert</quote> konfrontiert.
</para>
</step>

<step>
<title>Prüfen, wo sich die Treiberdateien jetzt befinden.</title>

<para><screen>
&rootprompt;<userinput>ls -l /etc/samba/drivers/W32X86/</userinput>
total 669
drwxr-sr-x    2 root     ntadmin       532 May 25 23:08 2
drwxr-sr-x    2 root     ntadmin       670 May 16 03:15 3
-rwxr--r--    1 root     ntadmin     14234 May 25 23:21 cups.hlp
-rwxr--r--    1 root     ntadmin    278380 May 25 23:21 cupsdrvr.dll
-rwxr--r--    1 root     ntadmin    215848 May 25 23:21 cupsui.dll
-rwxr--r--    1 root     ntadmin    169458 May 25 23:21 mysmbtstprn.PPD
</screen></para>

<para>
Die Treiberdateien sind jetzt im <quote>Wurzelverzeichnis</quote> der Freigabe
<smbconfsection>[print$]</smbconfsection>.
</para>
</step>

<step>
<title>Samba mitteilen, daß diese Dateien Treiberdateien sind (<command>adddriver</command>).</title>

<para>
<indexterm><primary>rpcclient</primary><secondary>adddriver</secondary></indexterm>
<screen>
&rootprompt;<userinput>rpcclient -Uroot%xxxx -c 'adddriver "Windows NT x86" \
	"mydrivername:cupsdrvr.dll:mysmbtstprn.PPD: \
  cupsui.dll:cups.hlp:NULL:RAW:NULL"' \
  localhost</userinput>
Printer Driver mydrivername successfully installed.
</screen></para>

<para>
Sie können diesen Schritt nicht wiederholen, wenn er scheitert. Er könnte sogar infolge eines simplen Tippfehlers
scheitern. Meist hat der Befehl dann bereits einen Teil der Treiberdateien in das Unterverzeichnis
<quote>2</quote> verschoben. Wenn dieser Schritt scheitert, müssen Sie zum vierten Schritt zurückgehen und ihn
wiederholen, bevor Sie den fünften Schritt von neuem versuchen können. In diesem Schritt müssen Sie einen Namen
für Ihren Treiber auswählen. Es ist normalerweise eine gute Idee, denselben Namen zu verwenden, wie er für den
Druckernamen verwendet wird; in grossen Installationen werden Sie jedoch diesen Treiber für eine grössere Anzahl
von Druckern verwenden, die natürlich verschiedene Namen haben, daher ist der Name des Treibers nicht fixiert.
</para>
</step>

<step>
<title>Prüfen, wo sich die Treiberdateien jetzt befinden.</title>

<para><screen>
&rootprompt;<userinput>ls -l /etc/samba/drivers/W32X86/</userinput>
total 1
drwxr-sr-x    2 root     ntadmin       532 May 25 23:22 2
drwxr-sr-x    2 root     ntadmin       670 May 16 03:15 3

&rootprompt;<userinput>ls -l /etc/samba/drivers/W32X86/2</userinput>
total 5039
[....]
-rwxr--r--    1 root     ntadmin     14234 May 25 23:21 cups.hlp
-rwxr--r--    1 root     ntadmin    278380 May 13 13:53 cupsdrvr.dll
-rwxr--r--    1 root     ntadmin    215848 May 13 13:53 cupsui.dll
-rwxr--r--    1 root     ntadmin    169458 May 25 23:21 mysmbtstprn.PPD
</screen></para>

<para>
Beachten Sie, wie der Schritt 6 auch die Treiberdateien in das entsprechende Unterverzeichnis verschoben hat.
Vergleichen Sie dies mit der Situation nach dem Schritt 5.
</para>
</step>

<step>
<title>(Optional) Prüfen, ob Samba jetzt den Treiber erkennt.</title>

<para>
<indexterm><primary>rpcclient</primary><secondary>enumdrivers</secondary></indexterm>
<screen>
&rootprompt;<userinput>rpcclient -Uroot%xxxx -c 'enumdrivers 3' \
	localhost | grep -B2 -A5 mydrivername</userinput>
Printer Driver Info 3:
Version: [2]
Driver Name: [mydrivername]
Architecture: [Windows NT x86]
Driver Path: [\\kde-bitshop\print$\W32X86\2\cupsdrvr.dll]
Datafile: [\\kde-bitshop\print$\W32X86\2\mysmbtstprn.PPD]
Configfile: [\\kde-bitshop\print$\W32X86\2\cupsui.dll]
Helpfile: [\\kde-bitshop\print$\W32X86\2\cups.hlp]
</screen></para>

<para>
Erinnern Sie sich, dieser Befehl führt ein <quote>grep</quote> nach dem Namen aus, den Sie im Schritt 6 für den
Treiber gewählt haben. Dieser Befehl muß erfolgreich abschliessen, bevor Sie fortschreiten können.
</para>
</step>

<step>
<para>Samba mitteilen, welcher Drucker diese Treiberdateien verwenden soll (<command>setdriver</command>).</para>

<para>
<indexterm><primary>rpcclient</primary><secondary>setdriver</secondary></indexterm>
<screen>
&rootprompt;<userinput>rpcclient -Uroot%xxxx -c 'setdriver mysmbtstprn mydrivername' \
	localhost</userinput>
Successfully set mysmbtstprn to driver mydrivername
</screen></para>

<para>
Da Sie jeden Druckernamen (Drucker-Queue) an jeden Treiber binden können, ist dies eine praktische Möglichkeit,
viele Queues zu konfigurieren, die denselben Treiber verwenden. Sie brauchen all die vorhergehenden Schritte
nicht zu wiederholen, damit der Befehl setdriver Erfolg hat. Die einzigen Vorbedingungen sind:
<command>enumdrivers</command> muß den Treiber finden und <command>enumprinters</command> muß den Drucker finden.
</para>
</step>

<step>
	<title>(Optional) Prüfen, ob Samba diese Zuordnung erkannt hat.</title>

<para>
<indexterm><primary>rpcclient</primary><secondary>getprinter</secondary></indexterm>
<indexterm><primary>rpcclient</primary><secondary>getdriver</secondary></indexterm>
<indexterm><primary>rpcclient</primary><secondary>enumprinters</secondary></indexterm>
<screen>
&rootprompt;<userinput>rpcclient -Uroot%xxxx -c 'getprinter mysmbtstprn 2' localhost \
  | grep driver</userinput>
drivername:[mydrivername]

&rootprompt;<userinput>rpcclient -Uroot%xxxx -c 'getprinter mysmbtstprn 2' localhost \
  | grep -C4 driv</userinput>
servername:[\\kde-bitshop]
printername:[\\kde-bitshop\mysmbtstprn]
sharename:[mysmbtstprn]
portname:[Done]
drivername:[mydrivername]
comment:[mysmbtstprn]
location:[]
sepfile:[]
printprocessor:[winprint]

&rootprompt;<userinput>rpcclient -U root%xxxx -c 'getdriver mysmbtstprn' localhost</userinput>
[Windows NT x86]
Printer Driver Info 3:
     Version: [2]
     Driver Name: [mydrivername]
     Architecture: [Windows NT x86]
     Driver Path: [\\kde-bitshop\print$\W32X86\2\cupsdrvr.dll]
     Datafile: [\\kde-bitshop\print$\W32X86\2\mysmbtstprn.PPD]
     Configfile: [\\kde-bitshop\print$\W32X86\2\cupsui.dll]
     Helpfile: [\\kde-bitshop\print$\W32X86\2\cups.hlp]
     Monitorname: []
     Defaultdatatype: [RAW]
     Monitorname: []
     Defaultdatatype: [RAW]

&rootprompt;<userinput>rpcclient -Uroot%xxxx -c 'enumprinters' localhost \
	| grep mysmbtstprn</userinput>
     name:[\\kde-bitshop\mysmbtstprn]
     description:[\\kde-bitshop\mysmbtstprn,mydrivername,mysmbtstprn]
     comment:[mysmbtstprn]

</screen></para>

<para>
<indexterm><primary>rpcclient</primary><secondary>enumprinters</secondary></indexterm>
Vergleichen Sie diese Resultate mit denen aus den Schritten 2 und 3. Jeder dieser Befehle zeigt, daß der Treiber
installiert ist. Sogar der Befehl <command>enumprinters</command> führt jetzt den Treiber in der Zeile
<quote>description</quote> an.
</para>
</step>

<step>
<title>(Optional) Den Treiber in den korrekten Gerätemodus <quote>kitzeln</quote>.
</title>

<para>
<indexterm><primary>"Printers" folder</primary></indexterm>
Sie wissen sicherlich, wie man den Treiber auf dem Client installiert. Für den Fall, daß Sie nicht besonders
vertraut mit Windows sind, hier ein Schnell-Rezept:
Durchblättern Sie die Netzwerkumgebung, gehen Sie auf den Samba-Server, und sehen Sie nach den Freigaben. Sie
sollten hier alle freigegebenen Samba-Drucker sehen. Klicken Sie doppelt auf den gewünschten Drucker. Der
Treiber sollte installiert und die Netzwerkverbindung hergestellt werden. Eine weitere Möglichkeit ist, den
Ordner <guilabel>Drucker und Faxgeräte</guilabel> zu öffnen, den betreffenden Drucker mit der rechten
Maustaste anzuklicken und entweder <guilabel>Verbinden</guilabel> oder <guilabel>Installieren</guilabel> zu
wählen. Das Ergebnis sollte sein, daß ein neuer Drucker in dem lokalen Ordner
<guilabel>Drucker und Faxgeräte</guilabel> Ihres Clients erscheint, mit einem Namen wie
<guilabel>Druckerfreigabename auf SambaServerName</guilabel>.
</para>

<para>
Es ist wichtig, daß Sie diesen Schritt als ein Samba-Drucker-Administrator (printer admin, definiert in
&smb.conf;) ausführen. Hier eine andere Methode, dies in Windows XP zu tun. Diese Methode verwendet eine
Befehlszeile, welche Sie in der <quote>DOS box</quote> eingeben (tippen Sie das smbpassword von root, wenn
erfordert):
</para>

<para><screen>
&dosprompt;<userinput>runas /netonly /user:root "rundll32 printui.dll,PrintUIEntry \
	/in /n \\sambaserver\mysmbtstprn"</userinput>
</screen></para>

<para>
Ändern Sie irgendeine Druckereinstellung einmal (wie z.B. den Parameter <emphasis><guilabel>portrait</guilabel>
auf <guilabel>landscape</guilabel></emphasis>), klicken Sie <guibutton>Übernehmen</guibutton>; ändern Sie die
Einstellung wieder zurück.
</para>
</step>

<step>
<title>Den Drucker auf einem Client installieren (Point'n'Print).</title>

<para>
<indexterm significance="preferred"><primary>point 'n' print</primary></indexterm>
	<screen>
&dosprompt;<userinput>rundll32 printui.dll,PrintUIEntry /in /n <quote>\\sambaserver\mysmbtstprn</quote></userinput>
</screen></para>

<para>
Wenn dies nicht funktioniert, könnte dies ein Berechtigungsproblem mit der Freigabe
<smbconfsection>[print$]</smbconfsection> sein.
</para>
</step>

<step>
<title>(Optional) Eine Testseite drucken.</title>

<para><screen>
&dosprompt;<userinput>rundll32 printui.dll,PrintUIEntry /p /n "\\sambaserver\mysmbtstprn"</userinput>
</screen></para>

<para>
Dann drücken Sie fünfmal [TAB], zweimal [ENTER], einmal [TAB] und nochmals [ENTER]
und marschieren zum Drucker.
</para>
</step>

<step>
<title>(Empfohlen) Studieren Sie die Testseite.</title>

<para>
Hmmm.... ich scherze nur! Mittlerweile wissen Sie alles über Drucker-Installationen und brauchen kein Wort mehr
davon zu lesen. Stecken Sie die Seite in einen Rahmen und nageln Sie den an die Wand, mit der Überschrift
"MEIN ERSTER MIT RPCCLIENT INSTALLIERTER DRUCKER" &smbmdash; warum es nicht einfach wegwerfen!
</para>
</step>

<step>
<title>(Obligatorisch) Geniessen Sie es. Springen Sie. Feiern Sie Ihren Erfolg.
</title>

<para><screen>
&rootprompt;<userinput>echo "Cheeeeerioooooo! Erfolg ..." &gt;&gt; /var/log/samba/log.smbd</userinput>
</screen></para>
</step>
</procedure>
</sect2>

<sect2>
<title>Wiedersehen mit dem Troubleshooting</title>

<para>
Der Befehl setdriver wird scheitern, wenn in Samba's <quote>Bewußtsein</quote> die Queue noch nicht
vorhanden ist. Sie hatten vielversprechende Meldungen wie:
</para>

<para><screen>
 Printer Driver ABC successfully installed.
</screen></para>

<para>
nach dem Abschnitt mit <command>adddriver</command>? Aber Sie sehen auch eine enttäuschende Meldung wie
diese hier?
</para>

<para><computeroutput>
 result was NT_STATUS_UNSUCCESSFUL
</computeroutput></para>

<para>
<indexterm><primary>lpstat</primary></indexterm>
Es ist nicht gut genug, daß Sie die Queue in CUPS sehen können, mit dem Befehl
<command>lpstat -p ir85wm</command>. Ein Bug in den neueren Versionen von Samba verhindert ein
ordnungsgemässes Update der Queue-Liste. Die Erkennung von neu installierten CUPS-Druckern scheitert, bis
Sie Samba neu starten oder ein HUP an alle smbd-Prozesse senden. Um zu prüfen, ob dies der Grund dafür ist,
daß Samba den Befehl <command>setdriver</command> nicht erfolgreich ausführt, prüfen Sie, ob Samba den
Drucker <quote>sieht</quote>:
</para>

<para>
<indexterm><primary>rpcclient</primary><secondary>enumprinters</secondary></indexterm>
	<screen>
&rootprompt;<userinput>rpcclient transmeta -N -U'root%xxxx' -c 'enumprinters 0'|grep ir85wm</userinput>
        printername:[ir85wm]
</screen></para>

<para>
Ein anderer Befehl könnte der hier sein:
</para>

<para>
<indexterm><primary>rpcclient</primary><secondary>getprinter</secondary></indexterm>
	<screen>
&rootprompt;<userinput>rpcclient transmeta -N -U'root%secret' -c 'getprinter ir85wm' </userinput>
        cmd = getprinter ir85wm
        flags:[0x800000]
        name:[\\transmeta\ir85wm]
        description:[\\transmeta\ir85wm,ir85wm,DPD]
        comment:[CUPS PostScript-Treiber for Windows NT/200x/XP]
</screen></para>

<para>
Übrigens, Sie können diese Befehle, sowie einige weitere, natürlich auch dazu verwenden, Treiber auf
entfernten Windows-NT-Druckservern zu installieren!
</para>
</sect2>
</sect1>

<sect1>
<title>Die <filename>*.tdb</filename>-Dateien für das Drucken</title>

<para>
<indexterm><primary>TDB</primary></indexterm>
<indexterm><primary>connections.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>printing.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>share_info.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>ntdrivers.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>unexpected.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>brlock.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>locking.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>ntforms.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>messages.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>ntprinters.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>sessionid.tdb</primary><seealso>TDB</seealso></indexterm>
<indexterm><primary>secrets.tdb</primary><seealso>TDB</seealso></indexterm>
Einige Mysterien ranken sich um die Gruppe der Dateien mit dem Suffix tdb, die in jeder Samba-Installation
auftauchen. Diese sind
<filename>connections.tdb</filename>,
<filename>printing.tdb</filename>,
<filename>share_info.tdb</filename>,
<filename>ntdrivers.tdb</filename>,
<filename>unexpected.tdb</filename>,
<filename>brlock.tdb</filename>,
<filename>locking.tdb</filename>,
<filename>ntforms.tdb</filename>,
<filename>messages.tdb</filename> ,
<filename>ntprinters.tdb</filename>,
<filename>sessionid.tdb</filename> und
<filename>secrets.tdb</filename>. Was ist ihr Zweck?
</para>

<sect2>
<title>Triviale Datenbank-Dateien</title>

<para>
<indexterm><primary>TDB</primary></indexterm>
Ein Windows NT (Druck-) Server führt Buch über alle benötigten Informationen, die er zur Erfüllung seiner
Pflichten gegenüber den Clients benötigt, indem er Einträge in der Windows-Registrierung speichert.
Client-Anfragen werden beantwortet, indem aus der Registrierung gelesen wird, Administrator- oder
Benutzer-Konfigurations-Einstellungen werden gespeichert, indem in die Registrierung geschrieben wird.
Samba und UNIX haben natürlich keine solche Registrierung. Samba führt stattdessen Buch über alle
Client-bezogene Information, indem es eine Reihe von <filename>*.tdb</filename> Dateien verwendet.
(TDB = Trivial Data Base). Diese sind oft in <filename>/var/lib/samba/</filename> oder
<filename>/var/lock/samba/</filename> abgelegt. Die druck-bezogenen Dateien sind
<filename>ntprinters.tdb</filename>,
<filename>printing.tdb</filename>,<filename>ntforms.tdb</filename> und <filename>ntdrivers.tdb</filename>.
</para>
</sect2>

<sect2>
<title>Binär-Format</title>

<para>
<filename>*.tdb</filename>-Dateien sind nicht für den Menschen lesbar. Sie sind in einem binären Format
geschrieben. <quote>Warum nicht ASCII?</quote>, könnten Sie fragen. <quote>ASCII-Dateien sind doch eine
gute und bewährte Tradition unter UNIX.</quote>
Der Grund für diese Design-Entscheidung ist hauptsächlich die Performance. Samba muß schnell laufen; es
führt für jede Client-Verbindung einen separaten <command>smbd</command>-Prozess aus, in manchen
Umgebungen viele tausende davon. Manche smbds könnten Schreibzugriff auf dieselbe
<filename>*.tdb</filename>-Datei <emphasis>zur gleichen Zeit</emphasis> brauchen. Das Dateiformat der
<filename>*.tdb</filename>-Dateien von Samba erlaubt dies, viele smbd-Prozesse können gleichzeitig in die
selbe <filename>*.tdb</filename>-Datei schreiben. Dies wäre mit reinen ASCII-Dateien nicht möglich.
</para>
</sect2>

<sect2>
<title><filename>*.tdb</filename>-Dateien verlieren</title>

<para>
Es ist sehr wichtig, daß alle <filename>*.tdb</filename>-Dateien konsistent über alle Lese- und
Schreibzugriffe bleiben. Es kann jedoch passieren, daß diese Dateien beschädigt <emphasis>werden</emphasis>.
(Ein <command>kill -9 `pidof smbd'</command> während eines Schreibzugriffs könnte genauso gut dafür
verantwortlich sein, wie ein Stromausfall etc.). Im Falle von Schwierigkeiten kann das Löschen der alten
druckbezogenen <filename>*.tdb</filename>-Dateien die einzige Möglichkeit sein. Danach müssen Sie alle
druckbezogenen Einstellungen wieder herstellen oder Sie haben rechtzeitig ein Backup der relevanten
Dateien erstellt.
</para>
</sect2>

<sect2>
<title>Das Verwenden von <command>tdbbackup</command></title>


<para>
<indexterm><primary>TDB</primary><secondary>sichern</secondary><see>tdbbackup</see></indexterm>
<indexterm><primary>tdbbackup</primary></indexterm>
Samba enthält ein kleines Hilfsmittel, das dem root-Benutzer Ihres Systems hilft, die
<filename>*.tdb</filename>-Dateien zu sichern. Wenn Sie es ohne Argumente ausführen, gibt es Auskunft über
seine Verwendung:
</para>

<para><screen>
&rootprompt;<userinput>tdbbackup</userinput>
 Usage: tdbbackup [options] &lt;fname...&gt;

 Version:3.0a
   -h            this help message
   -s suffix     set the backup suffix
   -v            verify mode (restore if corrupt)

</screen></para>

<para>
Hier sehen Sie, wie ich meine Datei <filename>printing.tdb</filename> gesichert habe:
</para>

<para><screen>
&rootprompt;<userinput>ls</userinput>
.              browse.dat     locking.tdb     ntdrivers.tdb printing.tdb
..             share_info.tdb connections.tdb messages.tdb  ntforms.tdb
printing.tdbkp unexpected.tdb brlock.tdb      gmon.out      namelist.debug
ntprinters.tdb sessionid.tdb

&rootprompt;<userinput>tdbbackup -s .bak printing.tdb</userinput>
 printing.tdb : 135 records

&rootprompt;<userinput>ls -l printing.tdb*</userinput>
 -rw-------    1 root     root        40960 May  2 03:44 printing.tdb
 -rw-------    1 root     root        40960 May  2 03:44 printing.tdb.bak

</screen></para>
</sect2>
</sect1>

<sect1>
<title>CUPS Drucker-Treiber von Linuxprinting.org</title>

<para>
<indexterm><primary>Linuxprinting.org</primary></indexterm>
CUPS kommt mit guter Unterstützung für Drucker vom Typ HP LaserJet. Sie können den generischen Treiber
wie folgt installieren:
</para>


<para>
<indexterm><primary>lpadmin</primary></indexterm>
	<screen>
&rootprompt;<userinput>lpadmin -p laserjet4plus -v parallel:/dev/lp0 -E -m laserjet.ppd</userinput>
</screen></para>

<para>
Die Option <option>-m</option> wird die Datei <filename>laserjet.ppd</filename> aus dem Standard-Repository
für noch-nicht-installierte-PPDs beziehen, das CUPS üblicherweise in
<filename>/usr/share/cups/model</filename> speichert. Alternativ dazu können Sie
<option>-P /pfad/zu/ihrer.ppd</option> benutzen.
</para>

<para>
Das generische <filename>laserjet.ppd</filename> unterstützt jedoch nicht jede spezielle Option für jedes
LaserJet-kompatibles Modell. Es stellt eine Art <quote>kleinster gemeinsamer Nenner</quote> aller Modelle
dar. Wenn Sie aus irgendeinem Grund für die kommerziell verfügbaren ESP Print Pro Treiber bezahlen
müssen, sollte Ihr erster Schritt sein, die Datenbank auf der Website
<ulink noescape="1" url="http://www.linuxprinting.org/printer_list.cgi">Linuxprinting</ulink> zu befragen.
Linuxprinting.org gibt exzellente Empfehlungen darüber ab, welcher Treiber am besten für welchen Drucker zu
verwenden ist. Die dortige Datenbank wird von der unermüdlichen Arbeit von Till Kamppeter von MandrakeSoft
aktuell gehalten, der auch der Haupt-Autor des Werkzeugs <command>foomatic-rip</command> ist.
</para>

<note><para>
<indexterm><primary>foomatic-rip</primary></indexterm>
Das frühere Konzept <command>cupsomatic</command> wird nun von seinem neuen Nachfolger, dem weitaus
mächtigeren <command>foomatic-rip</command> ersetzt. <command>cupsomatic</command> wird nicht mehr weiter
instand gehalten. Hier ist die neue URL zur neuen
<ulink noescape="1" url="http://www.linuxprinting.org/driver_list.cgi">Foomatic-3.0</ulink>-Datenbank.
Wenn Sie ein Upgrade auf <command>foomatic-rip</command> durchführen wollen, vergessen Sie nicht, auch
das Upgrade auf die neuartigen PPDs für Ihre Foomatic-betriebenen Drucker durchzuführen. foomatic-rip
arbeitet nicht mit PPDs, die für das alte <command>cupsomatic</command> generiert wurden. Die neuen PPDs
entsprechen zu 100% der Adobe PPD-Spezifikation. Sie sind auch dazu gedacht, mit Samba und dem
cupsaddsmb-Werkzeug verwendet zu werden, um die Treiber für die Windows-Clients bereitzustellen!
</para></note>

<sect2>
<title>Erklärungen zu foomatic-rip und Foomatic</title>


<para>
<indexterm significance="preferred"><primary>foomatic</primary></indexterm>
<indexterm significance="preferred"><primary>foomatic-rip</primary></indexterm>
Heutzutage verwenden die meisten Linux-Distributionen die Werkzeuge von Linuxprinting.org, um ihre
drucker-spezifische Software aufzubauen (welche übrigens auch auf allen UNICes und auch auf Mac OS X oder
Darwin läuft). Es ist nicht so bekannt, wie es sollte, daß es auch ein sehr benutzerfreundliches Interface
hat, das einfache Updates von Treibern und PPDs erlaubt, für alle unterstützten Drucker, alle Spooler,
alle Betriebssysteme und alle Paketformate (weil es keines gibt). Seine Geschichte geht schon einige Jahre
zurück.
</para>

<para>
Erst unlängst hat Foomatic den erstaunlichen Meilenstein von <ulink
url="http://www.linuxprinting.org/printer_list.cgi?make=Anyone">1000 gelisteten</ulink> Druckermodellen
geschafft. Linuxprinting.org speichert alle wichtigen Fakten über Druckertreiber und unterstützte Modelle
zur Verfügung, sowie Informationen darüber, welche Optionen für die verschiedenen Treiber/Drucker-Kombinationen
verfügbar sind, in seiner <ulink
url="http://www.linuxprinting.org/foomatic.html">Foomatic</ulink>-Datenbank. Momentan gibt es
<ulink
url="http://www.linuxprinting.org/driver_list.cgi">245 Treiber</ulink> in der Datenbank. Viele Treiber
unterstützen verschiedene Modelle, und viele Modelle können mit verschiedenen Treibern betrieben werden
&smbmdash; es ist Ihre Wahl!
</para>

<sect3>
<title>690 <quote>Perfekte</quote> Drucker</title>

<para>
Zur Zeit gibt es 690 Geräte, die mit <quote>arbeitet perfekt</quote> bezeichnet werden, 181 arbeiten
größtenteils, 96 teilweise, und 46 sind Briefbeschwerer. Wenn man bedenkt, daß die meisten dieser Drucker
Nicht-PostScript-Modelle sind (PostScript-Drucker werden von CUPS automatisch perfekt unterstützt, durch die
Verwendung ihrer eigenen, vom Hersteller bereitgestellten Windows-PPD), und daß ein multi-funktionales Gerät
nie als perfekt-arbeitend abschließt, solange es nicht auch unter GNU/Linux &smbmdash; scannt und faxt und
kopiert, ist dies eine wirklich erstaunliche Errungenschaft! Vor drei Jahren war die Anzahl nicht grösser als
500, und Linux- oder UNIX-Druck war zu der Zeit nicht einmal annähernd dort, wo es jetzt steht.
</para>
</sect3>

<sect3>
<title>Wie das Druck-HOWTO alles begründete</title>

<para>
Vor ein paar Jahren startete <ulink url="http://www2.picante.com:81/~gtaylor/">Grant Taylor</ulink> all das.
Die Wurzeln des heutigen Linuxprinting.org liegen in dem ersten
<ulink url="http://www.linuxprinting.org/foomatic2.9/howto/">Linux Printing HOWTO</ulink>, das er verfaßt hat.
Als Nebenprojekt zu diesem Dokument, das viele Linux-Anwender und -Administratoren auf ihren ersten
Schritten in diesem komplizierten und delikaten Setup führte (für einen Wissenschaftler ist Drucken
<quote>das Auftragen einer strukturierten Ablagerung von verschiedenen Mustern aus Tinten- oder Toner-Partikeln
auf Papier-Substrate</quote>), startete er eine kleine Postgres-Datenbank mit Informationen über den Hardware-
und Treiber-Zoo, aus dem das damalige Linux-Drucken bestand. Diese Datenbank wurde zur Kern-Komponente der
heutigen Foomatic-Samllung von Werkzeugen und Daten. In der Zwischenzeit wurde auf eine XML-Struktur gewechselt.
</para>
</sect3>

<sect3>
<title>Foomatic's seltsamer Name</title>


<para>
<indexterm><primary>foomatic</primary></indexterm>
<quote>Warum der lustige Name?</quote> fragen Sie.
Als es wirklich losging, im Frühling 2000, war CUPS bei weitem nicht so populär, wie es heute ist, und die
meisten Systeme benutzten LPD, LPRng oder sogar PDQ. CUPS kam nur mit ein paar generischen Treibern (genug für
ein paar hundert verschiedene Druckermodelle). Diese unterstützten nicht soviele gerätespezifischen Optionen.
CUPS kam auch mit seinem eigenen eingebauten Raster-Filter (<parameter>pstoraster</parameter>, abgeleitet von
Ghostscript). Auf der anderen Seite bot CUPS brilliante Unterstützung für das <emphasis>controlling</emphasis>
aller Drucker-Optionen durch standardisierte und wohldefinierte PPD-Dateien. Und CUPS war dafür entworfen,
einfach erweiterbar zu sein.
</para>

<para>
Taylor hatte in seiner Datenbank bereits eine beachtliche Sammlung von Fakten über viel mehr Drucker und die
Ghostscript <quote>Treiber</quote>, mit denen sie liefen. Seine Idee, PPDs aus der Datenbank-Information zu
generieren, und diese dazu zu benutzen, um Standard-Ghostscript-Filter in CUPS zum Funktionieren zu bringen,
funktionierte sehr gut. Sie erschlug außerdem mehrere Fliegen mit einer Klappe:
</para>

<itemizedlist>
<listitem><para>Sie machte alle aktuellen und zukünftigen Ghostscript Filter-Entwicklungen für CUPS verfügbar.
</para></listitem>

<listitem><para>Sie machte eine Vielzahl von zusätzlichen Druckermodellen für CUPS-Anwender verfügbar (weil oft
der traditionelle Weg über Ghostscript der einzige verfügbare war).
</para></listitem>

<listitem><para>Sie brachte all den Benutzern, die Ghostscript-Filter benutzen wollten (oder mussten), die
vielen erweiterten Optionen von CUPS (Web-Interface, GUI-Treiber-Konfiguration).
</para></listitem>
</itemizedlist>
</sect3>

<sect3>
<title>cupsomatic, pdqomatic, lpdomatic, directomatic</title>


<para>
<indexterm><primary>cupsomatic</primary></indexterm>
<indexterm><primary>CUPS-PPD</primary></indexterm>
<indexterm><primary>PPD</primary><secondary>CUPS</secondary><see>CUPS-PPD</see></indexterm>
CUPS arbeitete mit einem schnell zusammen-gehackten Filter-Skript namens
<ulink url="http://www.linuxprinting.org/download.cgi?filename=cupsomatic&amp;show=0">cupsomatic.</ulink>
cupsomatic schleuste die Druckdatei durch Ghostscript, wobei es automatisch den ziemlich komplizierten Befehl
konstruierte, der dazu benötigt wurde. Es mußte nur noch ins CUPS-System kopiert werden, um das funktionieren
zu lassen. Um zu konfigurieren, wie cupsomatic den Ghostscript-Darstellungs-Prozess kontrolliert, braucht es
eine CUPS-PPD. Diese PPD wird direkt aus den Inhalten der Datenbank generiert. Für CUPS und die entsprechende
Drucker/Filter-Kombination erledigte ein anderes Perl-Skript die PPD-Generation. Nachdem das funktionierte,
implementierte Taylor innerhalb weniger Tage eine ähnliche Lösung für 2 andere Spooler. Die Namen, die für
diese Konfigurations-Generatoren gewählt wurden, waren
<ulink url="http://www.linuxprinting.org/download.cgi?filename=lpdomatic&amp;show=0">PDQ-O-Matic</ulink> (für PDQ)
und
<ulink url="http://www.linuxprinting.org/download.cgi?filename=lpdomatic&amp;show=0">LPD-O-Matic</ulink>
(für &smbmdash; Sie haben es erraten &smbmdash; LPD); die Konfiguration verwendete hier keine PPDs, sondern
andere spooler-spezifische Dateien.
</para>

<para>
Im Spätsommer jenes Jahres begann <ulink url="http://www.linuxprinting.org/till/">Till Kamppeter</ulink>, seine
Arbeit in die Datenbank einfliessen zu lassen. Kamppeter war von
<ulink url="http://www.mandrakesoft.com/">MandrakeSoft</ulink> angestellt worden, um deren Drucksystem auf CUPS
umzustellen, nachdem sie sein auf <ulink url="http://www.fltk.org/">FLTK</ulink> basierendes
<ulink url="http://cups.sourceforge.net/xpp/">XPP</ulink> gesehen hatten (ein GUI Frontend für den CUPS
lp-Befehl). Er fügte viele Informationen und neuen Druckern hinzu, entwickelte auch die Unterstützung für andere
Spooler, wie <ulink url="http://ppr.sourceforge.net/">PPR</ulink> (via ppromatic),
<ulink url="http://sourceforge.net/projects/lpr/">GNUlpr</ulink> und
<ulink url="http://www.lprng.org/">LPRng</ulink> (beide via eines erweiterten lpdomatic) und Spooler-loses
Drucken
(<ulink url="http://www.linuxprinting.org/download.cgi?filename=directomatic&amp;show=0">directomatic</ulink>).
</para>

<para>
Also, zur Beantwortung der Frage: <quote>Foomatic</quote> ist der allgemeine Namen für all den überlappenden
Code und die Daten hinter den <quote>*omatic</quote>-Skripts. Foomatic brauchte bis zur Version 2.0.x (hässliche)
Perl-Datenstrukturen, die an die CUPS-PPDs von Linuxprinting.org angehängt wurden. Es gabe verschiedene
<quote>*omatic</quote>-Skripts für jeden Spooler, genauso wie verschiedene Drucker-Konfigurations-Dateien.
</para>
</sect3>

<sect3>
<title>Die <emphasis>Grosse Vereinheitlichung</emphasis> ist erreicht</title>


<para>
<indexterm><primary>foomatic-rip</primary></indexterm>
Dies änderte sich alles mit Foomatic 2.9 (beta) und der <quote>stable release</quote> 3.0. Es wurde nunmehr
eine Annäherung aller *omatic-Skripts erreicht und wird nun <ulink
url="http://www.linuxprinting.org/foomatic2.9/download.cgi?filename=foomatic-rip&amp;show=0">foomatic-rip.</ulink>
genannt. Dieses einzelne Skript ist die Vereinheitlichung der davor verschiedenen spooler-spezifischen
*omatic-Skripts. foomatic-rip wird von all den verschiedenen Spoolern gleicherweise benutzt, und da es PPDs
lesen kann (sowohl die originalen PostScript-Drucker-PPDs wie auch die von Linuxprinting.org generierten), haben
plötzlich alle unterstützten Spooler die mächtigen Features der PPDs zur Verfügung. DIe Benutzer brauchen nur
foomatic-rip in ihr System stöpseln. Für die Benutzer gibt es erweiterte Unterstützung für Medien-Typen und
-Zufuhr &smbmdash; Papier-Grössen und -Schächte sind einfacher zu konfigurieren.
</para>

<para>
Weiters enthält die neue Generation der Linuxprinting.org-PPDs keine Perl-Datenstrukturen mehr. Wenn Sie der
Verwalter einer Distribution sind, und die vorhergehende Version von Foomatic verwendet haben, möchten Sie
vielleicht die neue Version ausprobieren, aber vergessen Sie nicht, einen neuen Satz von PPDs zu generieren,
mittels der neuen <ulink
url="http://www.linuxprinting.org/download/foomatic/foomatic-db-engine-3.0.0beta1.tar.gz">Datenbank-Engine!</ulink>
Privat-Anwender brauchen nur ein einzelnes neues PPD zu generieren, das spezifisch für ihren Drucker ist, unter
Befolgung <ulink
url="http://www.linuxprinting.org/kpfeifle/LinuxKongress2002/Tutorial/II.Foomatic-User/II.tutorial-handout-foomatic-user.html">dieser Schritte</ulink>, die im Foomatic-Tutorial oder in diesem Kapitel beschrieben sind. Diese
neuen Entwicklungen sind wirklich erstaunlich.
</para>

<para>
foomatic-rip ist ein sehr cleverer "Wrapper" um die Anforderung, Ghostscript mit verschiedener Syntax,
verschiedenen Optionen, Geräte-Auswahl, und/oder Filtern für jeden verschiedenen Drucker oder Spooler
auszuführen. Zur selben Zeit kann es die PPD, die einer Drucker-Queue zugeordnet ist, lesen, und den Druckauftrag
entsprechend der Benutzer-Auswahl modifizieren. Dazu kommt die 100% Übereinstimmung der Foomatic-PPDs mit der
Adobe-Spezifikation. Einige innovative Features des Foomatic-Konzepts werden die Benutzer überraschen. Es
unterstützt benutzerdefinierte Papiergrössen für viele Drucker und den Druck auf Medien aus verschiedenen
Schächten innerhalb desselben Auftrags (in beiden Fällen sogar dann, wenn es dafür keine Unterstützung von
Windows-basierenden Hersteller-Treibern gibt).
</para>
</sect3>

<sect3>
<title>Externe Treiberentwicklung</title>

<para>
Der Großteil der Treiberentwicklung passiert nicht innerhalb Linuxprinting.org. Die Treiber werden von
unabhängigen Maintainern geschrieben. Linuxprinting.org sammelt nur all die Information und speichert sie in
seiner Datenbank. Zusätzlich stellt es den <quote>Leim</quote> von Foomatic zur Verfügung, um die vielen Treiber
in jegliches moderne (oder alte) Drucksystem zu integrieren.
</para>

<para>
Wenn wir von den verschiedenen Treiber-Entwickler-Gruppen sprechen, die meiste Arbeit wird derzeit in drei
Projekten erledigt. Diese sind:
</para>

<itemizedlist>
<listitem><para><ulink
url="http://www-124.ibm.com/developerworks/oss/linux/projects/omni/">Omni</ulink>
&smbmdash; ein freies Software-Projekt von IBM, das versucht, deren Drucker-Treiber-Wissen aus den guten alten
OS/2-Zeiten in eine moderne, modulare, universelle Treiber-Architektur für Linux/UNIX zu konvertieren (immer
noch im Beta-Stadium). Dieses Projekt unterstützt derzeit 437 Modelle.</para></listitem>

<listitem><para><ulink url="http://hpinkjet.sf.net/">HPIJS</ulink> &smbmdash;
ein freies Software-Projekt von HP, um Unterstützung für deren eigene Modelle anzubieten (sehr ausgereift, der
Druck ist in den meisten Fällen perfekt und bietet volle Photo-Qualität). Dieses Projekt unterstützt derzeit
369 Modelle.</para></listitem>

<listitem><para><ulink
url="http://gimp-print.sf.net/">Gimp-Print</ulink> &smbmdash; ein freies Software-Projekt, gestartet von
Michael Sweet (auch ein führender CUPS-Entwickler), jetzt geleitet von Robert Krawitz, der ein erstaunliches
Level von Photo-Druck-QUalität erreicht hat (viele Epson-Anwender schwören, daß die Qualität besser ist als die
der Epson-Treiber für Microsoft-Plattformen). Dieses Projekt unterstützt derzeit 522 Modelle.</para></listitem>
</itemizedlist>
</sect3>

<sect3>
<title>Forums, Downloads, Tutorials, Howtos &smbmdash; auch für Mac OS X und kommerzielles UNIX</title>

<para>
Linuxprinting.org ist heute der One-Stop-Shop, um Druckertreiber herunterzuladen. Sehen Sie nach
Drucker-Informationen und <ulink
url="http://www.linuxprinting.org//kpfeifle/LinuxKongress2002/Tutorial/">Tutorials</ulink> oder lösen Sie
Probleme in den populären <ulink
url="http://www.linuxprinting.org/newsportal/">Foren.</ulink> Dieses Forum ist nicht nur für GNU/Linux-Anwender,
sondern auch für Admins <ulink
url="http://www.linuxprinting.org/macosx/">kommerzieller UNIX-Systeme</ulink>, und das ziemlich neue <ulink
url="http://www.linuxprinting.org/newsportal/thread.php3?name=linuxprinting.macosx.general">Mac
OS X Forum</ulink> wurde innerhalb einiger weniger Wochen zu einem der meist-frequentierten Foren.
</para>

<para>
Linuxprinting.org und die Foomatic-Treiber-Wrapper um Ghostscript sind nunmehr eine Standard Werkzeug-Kette für
das Drucken in allen wichtigen Distributionen. Die meisten haben auch CUPS darunter integriert. Während in den
letzten Jahren die meisten Drucker-Daten von Kamppeter (der für Mandrake arbeitet) hinzugefügt wurden, kamen
viele andere Beiträge von Leuten bei SuSE, Red Hat, Conectiva, Debian, und anderen. Hersteller-Neutralität ist
ein wichtiges Ziel des Foomatic-Projekts.
</para>

<note><para>
Till Kamppeter von MandrakeSoft leistet in seiner Freizeit hervorragende Arbeit, um Linuxprinting.org und
Foomatic zu pflegen. Wenn Sie diese oft nutzen, bitte senden Sie ihm doch eine kleine Mail, um Ihre Anerkennung
zu zeigen.
</para></note>
</sect3>

<sect3>
<title>Foomatic Datenbank-generierte PPDs</title>

<para>
Die Foomatic Datenbank ist selbst ein erstaunliches Stück Raffiniertheit. Sie enthält nicht nur die
Drucker- und Treiber-Informationen, sondern ist auf eine Art organisiert, daß sie PPD-Dateien ad hoc aus ihren
internen, auf XML basierenden Datensätzen generieren kann. Während diese PPDs der Adobe-Spezifikation für
PostScript Printer Descriptions (PPDs) entsprechen, betreiben Linuxprinting.org/Foomatic-PPDs normalerweise
keine PostScript-Drucker. Sie werden verwendet, um all die Features zu beschreiben, die Sie auf jedem beliebigen
Gerät verwenden können. Der hauptsächliche Trick ist eine zusätzliche Zeile, die nicht von der
Adobe-Spezifikation beachtet wird und mit dem Schlüsselwort <parameter>*cupsFilter</parameter> beginnt.
Sie teilt dem CUPS-Daemon mit, wie er mit der PostScript-Druckdatei weiter verfahren soll (ältere Foomatic-PPDs
benannten das cupsomatic-Filter-Skript, während die neueren PPDs foomatic-rip aufrufen). Dieses Filter-Skript
ruft Ghostscript auf dem Host-System auf (die empfohlene Variante ist ESP Ghostscript), um die erforderliche
Arbeit zu tun. foomatic-rip weiß, welchen Filter oder welche interne Geräte-Einstellung es von Ghostscript
verlangen muß, um den PostScript-Druckauftrag in ein Rasterformat zu wandeln, das passend für das Zielgerät ist.
Diese Verwendung von PPDs, um die Optionen von Nicht-PS-Druckern zu beschreiben, war eine Erfindung der
CUPS-Entwickler. Der Rest ist einfach. GUI-Werkzeuge (wie KDE's wunderbares <ulink
url="http://printing.kde.org/overview/kprinter.phtml">kprinter,</ulink> oder <ulink
url="http://gtklp.sourceforge.net/">gtklp</ulink> von GNOME, xpp und das CUPS-Web-Interface) lesen das PPD
genauso, und verwenden diese Information, um die verfügbaren Einstellungen dem Benutzer anzubieten, genauso wie
eine intuitive Menü-Auswahl.
</para>
</sect3>
</sect2>

<sect2>
<title>foomatic-rip und Foomatic-PPD Download und Installation</title>

<para>
Hier sind die erforderlichen Schritte, um einen von foomatic-rip betriebenen LaserJet 4 Plus-kompatiblen
Drucker in CUPS zu installieren (beachten Sie, daß aktuelle Distributionen von SuSE, UnitedLinux und Mandrake
möglicherweise mit einem kompletten Package von Foomatic-PPDs geliefert werden, plus dem Werkzeug
<command>foomatic-rip</command>. Der Besuch von Linuxprinting.org stellt sicher, daß Sie die aktuellsten
Treiber und PPD-Dateien haben):
</para>

<itemizedlist>
<listitem><para>Öffnen Sie Ihren Browser und besuchen Sie die Linuxprinting.org Druckerlisten-<ulink url="http://www.linuxprinting.org/printer_list.cgi">Seite.</ulink>
</para></listitem>

<listitem><para>Sehen Sie die komplette Liste von Druckern in der
<ulink url="http://www.linuxprinting.org/printer_list.cgi?make=Anyone">Datenbank.</ulink>.
</para></listitem>

<listitem><para>Wählen Sie Ihr Modell und klicken Sie auf den Link.
</para></listitem>

<listitem><para>Sie landen auf einer Seite, die alle funktionierenden Treiber für dieses Modell auflistet (es
gibt für alle Drucker zumindest <emphasis>einen</emphasis> empfohlenen Treiber. Probieren Sie den als erstes).
</para></listitem>

<listitem><para>In unserem Fall (HP LaserJet 4 Plus) landen wir beim Standard-Treiber für den
<ulink url="http://www.linuxprinting.org/show_printer.cgi?recnum=HP-LaserJet_4_Plus">HP-LaserJet 4 Plus.</ulink>
</para></listitem>

<listitem><para>Der empfohlene Treiber ist ljet4.</para></listitem>

<listitem><para>Verschiedene Links werden hier angeboten. Sie sollten sie alle besuchen, falls Sie noch nicht mit
der Linuxprinting.org-Datenbank vertraut sind.
</para></listitem>

<listitem><para>Es gibt einen Link auf die Datanbank-Seite für
<ulink url="http://www.linuxprinting.org/show_driver.cgi?driver=ljet4">ljet4.</ulink>
Auf der Seite des Treibers finden Sie wichtige und detaillierte Information, wie Sie den Treiber mit den
verschiedenen Spoolern verwenden können.
</para></listitem>

<listitem><para>Ein weiterer Link führt Sie auf die Homepage des Treibers oder dessen Autors.
</para></listitem>

<listitem><para>Wichtige Links sind diejenigen, die Ihnen Hinweise und Anleitungen zu
<ulink noescape="1" url="http://www.linuxprinting.org/cups-doc.html">CUPS</ulink>,
<ulink url="http://www.linuxprinting.org/pdq-doc.html">PDQ</ulink>,
<ulink url="http://www.linuxprinting.org/lpd-doc.html">LPD, LPRng und GNUlpr</ulink> geben,
genauso wie zu <ulink url="http://www.linuxprinting.org/ppr-doc.html">PPR</ulink>
oder <quote>spooler-freiem</quote> <ulink url="http://www.linuxprinting.org/direct-doc.html">Drucken.</ulink>
</para></listitem>

<listitem><para>Sie können das PPD in Ihrem Browser ansehen, mit diesem Link:
<ulink noescape="1" url="http://www.linuxprinting.org/ppd-o-matic.cgi?driver=ljet4&amp;printer=HP-LaserJet_4_Plus&amp;show=1">http://www.linuxprinting.org/ppd-o-matic.cgi?driver=ljet4&amp;printer=HP-LaserJet_4_Plus&amp;show=1</ulink>
</para></listitem> <listitem><para>Und das Wichtigste, Sie können das
<ulink url="http://www.linuxprinting.org/ppd-o-matic.cgi?driver=ljet4&amp;printer=HP-LaserJet_4_Plus&amp;show=0">PPD</ulink> auch generieren und herunterladen.
</para></listitem>

<listitem><para>Das PPD enthält all die Informationen, um unseren Drucker und den Treiber zu verwenden; sobald
es installiert ist, arbeitet es transparent für den Anwenden. Sie brauchen später nur noch Auflösung,
Papierformat, usw. aus dem Web-basierenden Menü, dem Druck-GUI-Dialog oder auf der Befehlszeile auswählen.
</para></listitem>

<listitem><para>Wenn Sie auf der Treiber-
<ulink url="http://www.linuxprinting.org/show_driver.cgi?driver=ljet4">Seite</ulink> angelangt sind,
können Sie den <quote>PPD-O-Matic</quote> Online-PPD-Generator verwenden.</para></listitem>

<listitem><para>Wählen Sie das genaue Modell aus, wählen Sie <guilabel>Download</guilabel> oder
<guilabel>Display PPD file</guilabel> und klicken Sie <guilabel>Generate PPD file</guilabel>.</para></listitem>

<listitem><para>Wenn Sie die PPD-Datei aus der Broswer-Ansicht speichern, verwenden Sie bitte nicht
Cut and Paste (da dies eventuell die Zeilenenden und Tabulatoren beschädigt, was das PPD eventuell in seiner
Pflichterfüllung hindert), sondern verwenden Sie <guimenuitem>Speichern unter...</guimenuitem> aus dem
Menü Ihres Browsers. (Am besten ist die Verwendung der Option <guilabel>Download</guilabel> direkt auf der
Web-Seite).</para></listitem>

<listitem><para>Ein weiterer interessanter Teil jeder Treiber-Seite ist der Button
<guimenuitem>Show execution details</guimenuitem>. Wenn Sie Ihr Druckermodell wählen und diesen Button klicken,
wird eine komplette Ghostscript-Befehlszeile angezeigt, die alle verfügbaren Optionen für diese
Drucker/Treiber-Kombination aufzählt. Dies ist eine gute Möglichkeit, <quote>Ghostscript durch Anwendung zu
erlernen</quote>. Es ist weiters ein hervorragender Schummelzettel für alle erfahrenen Anwender, die eine
gute Befehlszeile für irgendein verdammtes Druck-Skript rekonstruieren müssen, sich aber nicht mehr an die
exakte Syntax erinnern.</para></listitem>

<listitem><para>Irgendwann während Ihres Besuchs auf Linuxprinting.org speichern Sie Ihre PPD-Datei unter einem
passenden Platz auf Ihrer Festplatte, sagen wir <filename>/pfad/zu/ihrer.ppd</filename> (wenn Sie es vorziehen,
Ihre Drucker unter Verwendung des CUPS-Web-Interface zu installieren, speichern Sie das PPD in
<filename>/usr/share/cups/model/</filename> und starten CUPS neu).</para></listitem>

<listitem><para>Dann installieren Sie den Drucker mit einer entsprechenden Befehlszeile, wie dieser:
</para>

<para><screen>
&rootprompt;<userinput>lpadmin -p laserjet4plus -v parallel:/dev/lp0 -E \
	-P pfad/zu/mein-drucker.ppd</userinput>
</screen></para></listitem>

<listitem><para>Für alle neuartigen <quote>Foomatic-PPDs</quote> von Linuxprinting.org brauchen Sie auch den
speziellen CUPS-Filter namens foomatic-rip.
</para></listitem>

<listitem><para>Das foomatic-rip Perl-Skript selbst gibt ziemlich interessanten
<ulink url="http://www.linuxprinting.org/foomatic2.9/download.cgi?filename=foomatic-rip&amp;show=1">Lesestoff</ulink>
ab, da es durch Kamppeter's Inline-Kommentare gut dokumentiert ist (sogar Nicht-Perl-Hacker werden einiges über Drucken lernen, wenn sie es lesen).</para></listitem>

<listitem><para>Speichern Sie foomatic-rip entweder direkt in
<filename>/usr/lib/cups/filter/foomatic-rip</filename> oder sonstwo in Ihren  $PATH (und vergessen Sie nicht, es
für alle ausführbar zu setzen). Verwenden Sie auch hier nicht Cut and Paste, sondern verwenden Sie den
entsprechenden Link oder den Menü-Eintrag <guimenuitem>Speichern unter ...</guimenuitem> Ihres Browsers.
</para></listitem>

<listitem><para>Wenn Sie foomatic-rip in Ihrem $PATH speichern, legen Sie einen Symlink an:
<screen>
&rootprompt;<userinput>cd /usr/lib/cups/filter/ ; ln -s `which foomatic-rip'</userinput>
</screen>
</para>

<para>
CUPS wird diesen neu verfügbaren Filter beim Neustart von cupsd entdecken.
</para></listitem>
</itemizedlist>

<para>
Sobald Sie auf eine Queue drucken, die mit dem Foomatic-PPD installiert wurde, fügt CUPS die entsprechenden
Befehle und Kommentare in die resultierende PostScript-Datei ein. foomatic-rip kann diese lesen und mit ihnen
umgehen, und verwendet einige speziell codierte Foomatic-Kommentare, die in die Auftragsdatei eingebettet sind.
Diese werden wiederum dazu verwendet (transparent für Sie, den Anwender), um die komplizierte
Ghostscript-Befehlszeile zu konstruieren, die dem Druckertreiber exakt mitteilt, wie die ausgegebenen Rasterdaten
auszusehen haben, und welche Druckerbefehle in den Datenstrom einzubetten sind. Sie brauchen:
</para>

<itemizedlist>

<listitem><para>Eine <quote>foomatic+irgendwas</quote> PPD &smbmdash; aber das ist nicht genug, um mit CUPS zu
drucken (es ist nur <emphasis>eine</emphasis> wichtige Komponente).
</para></listitem>

<listitem><para>Das <parameter>foomatic-rip</parameter> Filter-Skript (Perl) in
<filename>/usr/lib/cups/filters/</filename>.</para></listitem>

<listitem><para>Perl, damit foomatic-rip laufen kann.</para></listitem>

<listitem><para>Ghostscript (weil es die Hauptarbeit macht, kontrolliert von der Kombination
PPD/foomatic-rip), um die passenden Rasterdaten für Ihr Druckermodell zu produzieren.
</para></listitem>

<listitem><para>Ghostscript <emphasis>muss</emphasis> (abhängig von Ihrem Treiber/Modell) Unterstützung für
ein bestimmtes Gerät mitbringen, das den gewählten Treiber für Ihr Modell repräsentiert (wie von
<command>gs -h</command> gezeigt).</para></listitem>

<listitem><para>foomatic-rip braucht eine neue Version PPDs (PPD-Versionen für cupsomatic funktionieren nicht
mit foomatic-rip).</para></listitem>
</itemizedlist>
</sect2>
</sect1>

<sect1>
<title>Seitenabrechnung mit CUPS</title>

<para>
<indexterm><primary>CUPS</primary><secondary>Seitenabrechnung</secondary></indexterm>
Es gibt oft Nachfragen bezüglich Druck-Quotas, wo Samba-Benutzer (also Windows-Clients) nicht mehr als eine
bestimmte Anzahl von Seiten oder Datenmenge pro Tag, Woche oder Monat drucken dürfen sollen. Dieses Feature
hängt vom eingesetzten Drucksystem ab. Samba's Teil ist es, die Druckaufträge von den Clients zu empfangen
(gefiltert <emphasis>oder</emphasis> ungefiltert) und diese an das Drucksystem weiterzugeben.
</para>

<para>
Natürlich könnte man sich sowas mit seinen eigenen Skripts zusammenbauen. Aber es gibt CUPS. CUPS unterstützt
Quotas, die basierend auf der Auftragsgrösse, der Anzahl der Seiten oder beidem festgelegt werden können, und
jede zeitliche Periode umspannen können, die Sie wollen.
</para>

<sect2>
<title>Quotas einrichten</title>

<para>
<indexterm><primary>CUPS</primary><secondary>quotas</secondary></indexterm>
Dies ist ein Beispiel, wie root ein Druck-Quota in CUPS einrichten könnte, unter der Annahme, daß es einen
Drucker namens <quote>quotadrucker</quote> gibt:

</para>


<para>
<indexterm><primary>lpadmin</primary></indexterm>
	<screen>
&rootprompt;<userinput>lpadmin -p quotadrucker -o job-quota-period=604800 \
	-o job-k-limit=1024 -o job-page-limit=100</userinput>
</screen></para>

<para>
Dies würde jeden einzelnen Benutzer darauf beschränken, 100 Seiten oder 1024 KB (was auch immer zuerst eintrifft)
innerhalb der letzten 604800 Sekunden (entspricht einer Woche) zu drucken.
</para>
</sect2>

<sect2>
<title>Korrektes und inkorrektes Abrechnen</title>

<para>
Damit CUPS richtig zählt, muß die Druckdatei durch den CUPS-pstops-Filter, ansonsten verwendet es einen
Ersatzwert von <quote>eins</quote>. Manche Druckdateien passieren diesen Filter nicht (z.B. Bilddateien), jedoch
sind diese ohnehin meist einseitige Aufträge. Das bedeutet, Aufträge von proprietären Treibern für den
Zieldrucker, die auf den Clients laufen, die von CUPS/Samba als <quote>raw</quote> weitergegeben werden (also ohne
Filterung) werden auch als einseitige Aufträge gezählt!
</para>

<para>
You need to send PostScript from the clients (i.e., run a PostScript
driver there) to have the chance to get accounting done. If the
printer is a non-PostScript model, you need to let CUPS do the job to
convert the file to a print-ready format for the target printer. This
is currently working for about a thousand different printer models.
Linuxprinting has a driver
<ulink url="http://www.linuxprinting.org/printer_list.cgi">list.</ulink>
</para>
</sect2>

<sect2>
<title>Adobe and CUPS PostScript Drivers for Windows Clients</title>

<para>
Before CUPS 1.1.16, your only option was to use the Adobe PostScript
Driver on the Windows clients. The output of this driver was not
always passed through the <command>pstops</command> filter on the CUPS/Samba side, and
therefore was not counted correctly (the reason is that it often,
depending on the PPD being used, wrote a PJL-header in front of
the real PostScript which caused CUPS to skip <command>pstops</command> and go directly
to the <command>pstoraster</command> stage).
</para>

<para>
From CUPS 1.1.16 onward, you can use the CUPS PostScript Driver for
Windows <?latex \linebreak ?>NT/200x/XP clients (which is tagged in the download area of
<filename>http://www.cups.org/</filename> as the <filename>cups-samba-1.1.16.tar.gz</filename>
package). It does <emphasis>not</emphasis> work for Windows 9x/ME clients, but it guarantees:
</para>

<itemizedlist>

<listitem><para> <indexterm><primary>PJL</primary></indexterm> To not write a PJL-header.</para></listitem>

<listitem><para>To still read and support all PJL-options named in the
driver PPD with its own means.</para></listitem>

<listitem><para>That the file will pass through the <command>pstops</command> filter
on the CUPS/Samba server.</para></listitem>

<listitem><para>To page-count correctly the print file.</para></listitem>
</itemizedlist>

<para>
You can read more about the setup of this combination in the man page
for <command>cupsaddsmb</command> (which is only present with CUPS installed, and only
current from CUPS 1.1.16).
</para>
</sect2>

<sect2>
<title>The page_log File Syntax</title>

<para>
<indexterm><primary>page_log</primary></indexterm>
These are the items CUPS logs in the <filename>page_log</filename> for every
page of a job:
</para>

<itemizedlist>
<listitem><para>Printer name</para></listitem>

<listitem><para>User name</para></listitem>

<listitem><para>Job ID</para></listitem>

<listitem><para>Time of printing</para></listitem>

<listitem><para>The page number</para></listitem>

<listitem><para>The number of copies</para></listitem>

<listitem><para>A billing information string (optional)</para></listitem>

<listitem><para>The host that sent the job (included since version 1.1.19)</para></listitem>
</itemizedlist>

<para>
Here is an extract of my CUPS server's <filename>page_log</filename> file to illustrate the
format and included items:
</para>

<para><screen>
tec_IS2027 kurt 401 [22/Apr/2003:10:28:43 +0100] 1 3 #marketing 10.160.50.13
tec_IS2027 kurt 401 [22/Apr/2003:10:28:43 +0100] 2 3 #marketing 10.160.50.13
tec_IS2027 kurt 401 [22/Apr/2003:10:28:43 +0100] 3 3 #marketing 10.160.50.13
tec_IS2027 kurt 401 [22/Apr/2003:10:28:43 +0100] 4 3 #marketing 10.160.50.13
Dig9110 boss 402 [22/Apr/2003:10:33:22 +0100] 1 440 finance-dep 10.160.51.33
</screen></para>

<para>
This was job ID <parameter>401</parameter>, printed on <parameter>tec_IS2027</parameter>
by user <parameter>kurt</parameter>, a 64-page job printed in three copies and billed to
<parameter>#marketing</parameter>, sent from IP address <constant>10.160.50.13.</constant>
 The next job had ID <parameter>402</parameter>, was sent by user <parameter>boss</parameter>
from IP address <constant>10.160.51.33</constant>, printed from one page 440 copies and
is set to be billed to <parameter>finance-dep</parameter>.
</para>
</sect2>

<sect2>
<title>Possible Shortcomings</title>

<para>
What flaws or shortcomings are there with this quota system?
</para>

<itemizedlist>
<listitem><para>The ones named above (wrongly logged job in case of
printer hardware failure, and so on).</para></listitem>

<listitem><para>In reality, CUPS counts the job pages that are being
processed in <emphasis>software</emphasis> (that is, going through the
RIP) rather than the physical sheets successfully leaving the
printing device. Thus if there is a jam while printing the fifth sheet out
of a thousand and the job is aborted by the printer, the page count will
still show the figure of a thousand for that job.</para></listitem>

<listitem><para>All quotas are the same for all users (no flexibility
to give the boss a higher quota than the clerk) and no support for
groups.</para></listitem>

<listitem><para>No means to read out the current balance or the
<quote>used-up</quote> number of current quota.</para></listitem>

<listitem><para>A user having used up 99 sheets of a 100 quota will
still be able to send and print a thousand sheet job.</para></listitem>

<listitem><para>A user being denied a job because of a filled-up quota
does not get a meaningful error message from CUPS other than
<quote>client-error-not-possible</quote>.</para></listitem>
</itemizedlist>
</sect2>

<sect2>
<title>Future Developments</title>

<para>
This is the best system currently available, and there are huge
improvements under development for CUPS 1.2:
</para>

<itemizedlist>
<listitem><para>Page counting will go into the backends (these talk
directly to the printer and will increase the count in sync with the
actual printing process; thus, a jam at the fifth sheet will lead to a
stop in the counting).</para></listitem>

<listitem><para>Quotas will be handled more flexibly.</para></listitem>

<listitem><para>Probably there will be support for users to inquire
about their accounts in advance.</para></listitem>

<listitem><para>Probably there will be support for some other tools
around this topic.</para></listitem>
</itemizedlist>
</sect2>

<!-- FIXME
<sect2>
<title>Other Accounting Tools</title>

<para>
PrintAnalyzer, pyKota, printbill, LogReport.
</para>
</sect2>
-->
</sect1>

<sect1>
<title>Additional Material</title>

<para>
A printer queue with <emphasis>no</emphasis> PPD associated to it is a
<quote>raw</quote> printer and all files will go directly there as received by the
spooler. The exceptions are file types <parameter>application/octet-stream</parameter>
that need pass-through feature enabled. <quote>Raw</quote> queues do not do any
filtering at all, they hand the file directly to the CUPS backend.
This backend is responsible for sending the data to the device
(as in the <quote>device URI</quote> notation: <filename>lpd://, socket://,
smb://, ipp://, http://, parallel:/, serial:/, usb:/</filename>, and so on).
</para>

<para>
cupsomatic/Foomatic are <emphasis>not</emphasis> native CUPS drivers
and they do not ship with CUPS. They are a third party add-on
developed at Linuxprinting.org. As such, they are a brilliant hack to
make all models (driven by Ghostscript drivers/filters in traditional
spoolers) also work via CUPS, with the same (good or bad!) quality as
in these other spoolers. <parameter>cupsomatic</parameter> is only a vehicle to execute a
Ghostscript command-line at that stage in the CUPS filtering chain,
where normally the native CUPS <parameter>pstoraster</parameter> filter would kick
in. cupsomatic bypasses pstoraster, kidnaps the printfile from CUPS
away and redirects it to go through Ghostscript. CUPS accepts this,
because the associated cupsomatic/foomatic-PPD specifies:

<filterline>
  *cupsFilter:  "application/vnd.cups-postscript 0 cupsomatic"
</filterline>

This line persuades CUPS to hand the file to cupsomatic, once it has
successfully converted it to the MIME type
<parameter>application/vnd.cups-postscript</parameter>. This conversion will not happen for
Jobs arriving from Windows that are auto-typed
<parameter>application/octet-stream</parameter>, with the according changes in
<filename>/etc/cups/mime.types</filename> in place.
</para>

<para>
CUPS is widely configurable and flexible, even regarding its filtering
mechanism. Another workaround in some situations would be to have in
<filename>/etc/cups/mime.types</filename> entries as follows:

<filterline>
 application/postscript           application/vnd.cups-raw  0  -
 application/vnd.cups-postscript  application/vnd.cups-raw  0  -
</filterline>

This would prevent all PostScript files from being filtered (rather,
they will through the virtual <emphasis>nullfilter</emphasis>
denoted with <quote>-</quote>). This could only be useful for PS printers. If you
want to print PS code on non-PS printers (provided they support ASCII
text printing), an entry as follows could be useful:

<filterline>
 */*           application/vnd.cups-raw  0  -
</filterline>

and would effectively send <emphasis>all</emphasis> files to the
backend without further processing.
</para>

<para>
You could have the following entry:

<filterline>
application/vnd.cups-postscript application/vnd.cups-raw 0 \
	my_PJL_stripping_filter
</filterline>

You will need to write a <parameter>my_PJL_stripping_filter</parameter>
(which could be a shell script) that parses the PostScript and removes the
unwanted PJL. This needs to conform to CUPS filter design
(mainly, receive and pass the parameters printername, job-id,
username, jobtitle, copies, print options and possibly the
filename). It is installed as world executable into
<filename>/usr/lib/cups/filters/</filename> and is called by CUPS
if it encounters a MIME type <parameter>application/vnd.cups-postscript</parameter>.
</para>

<para>
CUPS can handle <parameter>-o job-hold-until=indefinite</parameter>.
This keeps the job in the queue on hold. It will only be printed
upon manual release by the printer operator. This is a requirement in
many central reproduction departments, where a few operators manage
the jobs of hundreds of users on some big machine, where no user is
allowed to have direct access (such as when the operators often need
to load the proper paper type before running the 10,000 page job
requested by marketing for the mailing, and so on).
</para>
</sect1>

<sect1>
<title>Auto-Deletion or Preservation of CUPS Spool Files</title>

<para>
Samba print files pass through two spool directories. One is the
incoming directory managed by Samba, (set in the
<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption>
directive in the <smbconfsection>[printers]</smbconfsection> section of
&smb.conf;). The other is the spool directory of
your UNIX print subsystem. For CUPS it is normally
<filename>/var/spool/cups/</filename>, as set by the <filename>cupsd.conf</filename>
directive <filename>RequestRoot /var/spool/cups</filename>.
</para>

<sect2>
<title>CUPS Configuration Settings Explained</title>

<para>
Some important parameter settings in the CUPS configuration file
<filename>cupsd.conf</filename> are:
</para>

<variablelist>

<varlistentry><term>PreserveJobHistory Yes</term>
<listitem><para>
This keeps some details of jobs in cupsd's mind (well it keeps the
c12345, c12346, and so on, files in the CUPS spool directory, which do a
similar job as the old-fashioned BSD-LPD control files). This is set
to <quote>Yes</quote> as a default.
</para></listitem></varlistentry>

<varlistentry><term>PreserveJobFiles Yes</term>
<listitem><para>
This keeps the job files themselves in cupsd's mind
(it keeps the d12345, d12346 etc. files in the CUPS spool
directory). This is set to <quote>No</quote> as the CUPS
default.
</para></listitem></varlistentry>

<varlistentry><term><emphasis><quote>MaxJobs 500</quote></emphasis></term>
<listitem><para>
This directive controls the maximum number of jobs
that are kept in memory. Once the number of jobs reaches the limit,
the oldest completed job is automatically purged from the system to
make room for the new one. If all of the known jobs are still
pending or active, then the new job will be rejected. Setting the
maximum to 0 disables this functionality. The default setting is
0.
</para></listitem></varlistentry>
</variablelist>

<para>
(There are also additional settings for <parameter>MaxJobsPerUser</parameter> and
<parameter>MaxJobsPerPrinter</parameter>...)
</para>
</sect2>

<sect2>
<title>Pre-Conditions</title>

<para>
For everything to work as announced, you need to have three
things:
</para>

<itemizedlist>
<listitem><para>A Samba-smbd that is compiled against <filename>libcups</filename> (check
on Linux by running <userinput>ldd `which smbd'</userinput>).</para></listitem>

<listitem><para>A Samba-&smb.conf; setting of
		<smbconfoption><name>printing</name><value>cups</value></smbconfoption>.</para></listitem>

<listitem><para>Another Samba-&smb.conf; setting of
		<smbconfoption><name>printcap</name><value>cups</value></smbconfoption>.</para></listitem>
</itemizedlist>

<note><para>
In this case, all other manually set printing-related commands (like
<smbconfoption><name>print command</name></smbconfoption>,
<smbconfoption><name>lpq command</name></smbconfoption>,
<smbconfoption><name>lprm command</name></smbconfoption>,
<smbconfoption><name>lppause command</name></smbconfoption> or
<smbconfoption><name>lpresume command</name></smbconfoption>) are ignored and they should normally have no
influence whatsoever on your printing.
</para></note>
</sect2>

<sect2>
<title>Manual Configuration</title>

<para>
If you want to do things manually, replace the <smbconfoption><name>printing</name><value>cups</value></smbconfoption>
by <smbconfoption><name>printing</name><value>bsd</value></smbconfoption>. Then your manually set commands may work
(I haven't tested this), and a <smbconfoption><name>print command</name><value>lp -d %P %s; rm %s"</value></smbconfoption>
may do what you need.
</para>
</sect2>
</sect1>

<sect1>
<title>Printing from CUPS to Windows Attached Printers</title>

<para>
>From time to time the question arises, how can you print
<emphasis>to</emphasis> a Windows attached printer
<emphasis>from</emphasis> Samba? Normally the local connection
from Windows host to printer would be done by USB or parallel
cable, but this does not matter to Samba. From here only an SMB
connection needs to be opened to the Windows host. Of course, this
printer must be shared first. As you have learned by now, CUPS uses
<emphasis>backends</emphasis> to talk to printers and other
servers. To talk to Windows shared printers, you need to use the
<filename>smb</filename> (surprise, surprise!) backend. Check if this
is in the CUPS backend directory. This usually resides in
<filename>/usr/lib/cups/backend/</filename>. You need to find an <filename>smb</filename>
file there. It should be a symlink to <filename>smbspool</filename>
and the file must exist and be executable:
</para>

<para><screen>
&rootprompt;<userinput>ls -l /usr/lib/cups/backend/</userinput>
total 253
drwxr-xr-x    3 root   root     720 Apr 30 19:04 .
drwxr-xr-x    6 root   root     125 Dec 19 17:13 ..
-rwxr-xr-x    1 root   root   10692 Feb 16 21:29 canon
-rwxr-xr-x    1 root   root   10692 Feb 16 21:29 epson
lrwxrwxrwx    1 root   root       3 Apr 17 22:50 http -&gt; ipp
-rwxr-xr-x    1 root   root   17316 Apr 17 22:50 ipp
-rwxr-xr-x    1 root   root   15420 Apr 20 17:01 lpd
-rwxr-xr-x    1 root   root    8656 Apr 20 17:01 parallel
-rwxr-xr-x    1 root   root    2162 Mar 31 23:15 pdfdistiller
lrwxrwxrwx    1 root   root      25 Apr 30 19:04 ptal -&gt; /usr/sbin/ptal-cups
-rwxr-xr-x    1 root   root    6284 Apr 20 17:01 scsi
lrwxrwxrwx    1 root   root      17 Apr  2 03:11 smb -&gt; /usr/bin/smbspool
-rwxr-xr-x    1 root   root    7912 Apr 20 17:01 socket
-rwxr-xr-x    1 root   root    9012 Apr 20 17:01 usb

&rootprompt;<userinput>ls -l `which smbspool`</userinput>
-rwxr-xr-x    1 root   root  563245 Dec 28 14:49 /usr/bin/smbspool
</screen></para>

<para>
If this symlink does not exist, create it:
</para>

<para><screen>
&rootprompt;<userinput>ln -s `which smbspool` /usr/lib/cups/backend/smb</userinput>
</screen></para>

<para>
<command>smbspool</command> has been written by Mike Sweet from the CUPS folks. It is
included and ships with Samba. It may also be used with print
subsystems other than CUPS, to spool jobs to Windows printer shares. To
set up printer <replaceable>winprinter</replaceable> on CUPS, you need to have a driver for
it. Essentially this means to convert the print data on the CUPS/Samba
host to a format that the printer can digest (the Windows host is
unable to convert any files you may send). This also means you should
be able to print to the printer if it were hooked directly at your
Samba/CUPS host. For troubleshooting purposes, this is what you
should do to determine if that part of the process chain is in
order. Then proceed to fix the network connection/authentication to
the Windows host, and so on.
</para>

<para>
To install a printer with the <parameter>smb</parameter> backend on CUPS, use this command:
</para>

<para><screen>
&rootprompt;<userinput>lpadmin -p winprinter -v smb://WINDOWSNETBIOSNAME/printersharename \
  -P /path/to/PPD</userinput>
</screen></para>

<para>
The PPD must be able to direct CUPS to generate
the print data for the target model. For PostScript printers, just use
the PPD that would be used with the Windows NT PostScript driver. But
what can you do if the printer is only accessible with a password? Or
if the printer's host is part of another workgroup? This is provided
for: You can include the required parameters as part of the
<filename>smb://</filename> device-URI like this:
</para>

<itemizedlist>
	<listitem><filename>smb://WORKGROUP/WINDOWSNETBIOSNAME/printersharename</filename></listitem>
	<listitem><filename>smb://username:password@WORKGROUP/WINDOWSNETBIOSNAME/printersharename</filename></listitem>
	<listitem><filename>smb://username:password@WINDOWSNETBIOSNAME/printersharename</filename></listitem>
</itemizedlist>

<para>
Note that the device-URI will be visible in the process list of the
Samba server (e.g., when someone uses the <command>ps -aux</command>
command on Linux), even if the username and passwords are sanitized
before they get written into the log files. So this is an inherently
insecure option, however, it is the only one. Don't use it if you want
to protect your passwords. Better share the printer in a way that
does not require a password! Printing will only work if you have a
working netbios name resolution up and running. Note that this is a
feature of CUPS and you do not necessarily need to have smbd running.

</para>
</sect1>

<sect1>
<title>More CUPS-Filtering Chains</title>

<para>
The following diagrams reveal how CUPS handles print jobs.
</para>

<image id="cups1"><imagefile>cups1</imagefile><imagedescription>Filtering chain 1.</imagedescription></image>

<image id="cups2"><imagefile>cups2</imagefile><imagedescription>Filtering chain with cupsomatic</imagedescription></image>

</sect1>

<sect1>
	<title>Common Errors</title>

	<sect2>
		<title>Windows 9x/ME Client Can't Install Driver</title>

		<para>For Windows 9x/ME, clients require the printer names to be eight
characters (or <quote>8 plus 3 chars suffix</quote>) max; otherwise, the driver files
will not get transferred when you want to download them from
Samba.</para>

	</sect2>

	<sect2>
		<title><quote>cupsaddsmb</quote> Keeps Asking for Root Password in Never-ending Loop</title>

		<para>Have you <smbconfoption><name>security</name><value>user</value></smbconfoption>? Have
		you used <command>smbpasswd</command> to give root a Samba account?
		You can do two things: open another terminal and execute
		<command>smbpasswd -a root</command> to create the account and
		continue entering the password into the first terminal. Or break
		out of the loop by pressing ENTER twice (without trying to type a
		password).</para>

		<para>
		If the error is: <quote>tree connect failed: NT_STATUS_BAD_NETWORK_NAME</quote>,
		you may have forgotten to create the <filename>/etc/samba/drivers</filename> directory.
		</para>

	</sect2>

	<sect2>
		<title><quote>cupsaddsmb</quote> Errors</title>

		<para>
		The use of <quote>cupsaddsmb</quote> gives <quote>No PPD file for printer...</quote>
		Message While PPD File Is Present.  What might the problem be?
		</para>

		<para>Have you enabled printer sharing on CUPS? This means:
		Do you have a <parameter>&lt;Location
		/printers&gt;....&lt;/Location&gt;</parameter> section in CUPS
		server's <filename>cupsd.conf</filename> that does not deny access to
		the host you run <quote>cupsaddsmb</quote> from?  It <emphasis>could</emphasis> be
		an issue if you use cupsaddsmb remotely, or if you use it with a
		<option>-h</option> parameter: <userinput>cupsaddsmb -H
		sambaserver -h cupsserver -v printername</userinput>.
		</para>

		<para>Is your <parameter>TempDir</parameter> directive in
		<filename>cupsd.conf</filename> set to a valid value and is it writable?
		</para>

	</sect2>

	<sect2>
		<title>Client Can't Connect to Samba Printer</title>

	<para>Use <command>smbstatus</command> to check which user
	you are from Samba's point of view. Do you have the privileges to
	write into the <smbconfsection>[print$]</smbconfsection>
	share?</para>

	</sect2>

	<sect2>
	<title>New Account Reconnection from Windows 200x/XP Troubles</title>

<para>Once you are connected as the wrong user (for
example, as <constant>nobody</constant>, which often occurs if you have
<smbconfoption><name>map to guest</name><value>bad user</value></smbconfoption>), Windows Explorer will not accept an
attempt to connect again as a different user. There will not be any byte
transfered on the wire to Samba, but still you'll see a stupid error
message that makes you think Samba has denied access. Use
<command>smbstatus</command> to check for active connections. Kill the
PIDs. You still can't re-connect and you get the dreaded
<computeroutput>You can't connect with a second account from the same
machine</computeroutput> message, as soon as you are trying. And you
do not see any single byte arriving at Samba (see logs; use <quote>ethereal</quote>)
indicating a renewed connection attempt. Shut all Explorer Windows.
This makes Windows forget what it has cached in its memory as
established connections. Then reconnect as the right user. The best
method is to use a DOS terminal window and <emphasis>first</emphasis>
do <userinput>net use z: \\&example.server.samba;\print$ /user:root</userinput>. Check
with <command>smbstatus</command> that you are connected under a
different account. Now open the <guilabel>Printers</guilabel> folder (on the Samba server
in the <guilabel>Network Neighborhood</guilabel>), right-click on the
printer in question and select
<guibutton>Connect...</guibutton></para></sect2>

<sect2>
<title>Avoid Being Connected to the Samba Server as the Wrong User</title>
	
<para>You see per <command>smbstatus</command> that you are
connected as user nobody; while you want to be root or
printer admin. This is probably due to
<smbconfoption><name>map to guest</name><value>bad user</value></smbconfoption>, which silently connects you under the guest account
when you gave (maybe by accident) an incorrect username. Remove
<smbconfoption><name>map to guest</name></smbconfoption>, if you want to prevent
this.</para></sect2>

<sect2>
<title>Upgrading to CUPS Drivers from Adobe Drivers</title>

<para>
This information came from a mailing list posting regarding problems experienced when
upgrading from Adobe drivers to CUPS drivers on Microsoft Windows NT/200x/XP Clients.
</para>

<para>First delete all old Adobe-using printers. Then
delete all old Adobe drivers. (On Windows 200x/XP, right-click in
the background of <guilabel>Printers</guilabel> folder, select <guimenuitem>Server Properties...</guimenuitem>, select
tab <guilabel>Drivers</guilabel> and delete here).</para></sect2>

<sect2><title>Can't Use <quote>cupsaddsmb</quote> on Samba Server Which Is a PDC</title>
<para>Do you use the <quote>naked</quote> root user name? Try to do it
this way: <userinput>cupsaddsmb -U <replaceable>DOMAINNAME</replaceable>\\root -v
<replaceable>printername</replaceable></userinput>> (note the two backslashes: the first one is
required to <quote>escape</quote> the second one).</para></sect2>

<sect2><title>Deleted Windows 200x Printer Driver Is Still Shown</title>
<para>Deleting a printer on the client will not delete the
driver too (to verify, right-click on the white background of the
<guilabel>Printers</guilabel> folder, select <guimenuitem>Server Properties</guimenuitem> and click on the
<guilabel>Drivers</guilabel> tab). These same old drivers will be re-used when you try to
install a printer with the same name. If you want to update to a new
driver, delete the old ones first. Deletion is only possible if no
other printer uses the same driver.</para></sect2>

<sect2><title>Windows 200x/XP "Local Security Policies"</title>
<para>Local Security Policies may not
allow the installation of unsigned drivers. <quote>Local Security Policies</quote>
may not allow the installation of printer drivers at
all.</para></sect2>

<sect2><title>Administrator Cannot Install Printers for All Local Users</title>
<para>Windows XP handles SMB printers on a <quote>per-user</quote> basis.
This means every user needs to install the printer himself. To have a
printer available for everybody, you might want to use the built-in
IPP client capabilities of Win XP. Add a printer with the print path of
<parameter>http://cupsserver:631/printers/printername</parameter>.
We're still looking into this one. Maybe a logon script could
automatically install printers for all
users.</para></sect2>

<sect2><title>Print Change Notify Functions on NT-clients</title>
<para>For print change, notify functions on NT++ clients.
These need to run the <command>Server</command> service first (renamed to
<command>File &amp; Print Sharing for MS Networks</command> in
XP).</para></sect2>

<sect2>
<title>Win XP-SP1</title>

<para>Win XP-SP1 introduced a Point and Print Restriction Policy (this restriction does not apply to
<quote>Administrator</quote> or <quote>Power User</quote> groups of users). In Group Policy
Object Editor, go to <guimenu>User Configuration -> Administrative Templates ->
 Control Panel -> Printers</guimenu>. The policy is automatically set to
<constant>Enabled</constant> and the <constant>Users can only Point
and Print to machines in their Forest</constant> . You probably need
to change it to <constant>Disabled</constant> or <constant>Users can
only Point and Print to these servers</constant> to make
driver downloads from Samba possible.
</para>
</sect2>

<sect2>
<title>Print Options for All Users Can't Be Set on Windows 200x/XP</title>

<para>How are you doing it? I bet the wrong way (it is not
easy to find out, though). There are three different ways to bring
you to a dialog that <emphasis>seems</emphasis> to set everything. All
three dialogs <emphasis>look</emphasis> the same, yet only one of them
does what you intend. You need to be
Administrator or Print Administrator to do this for all users. Here
is how I do in on XP:
</para>

<orderedlist numeration="upperalpha">

<listitem><para>The first wrong way:

<orderedlist>
<listitem><para>Open the <guilabel>Printers</guilabel>
folder.</para></listitem>

<listitem><para>Right-click on the printer
(<guilabel>remoteprinter on cupshost</guilabel>) and
select in context menu <guimenuitem>Printing
Preferences...</guimenuitem></para></listitem>

<listitem><para>Look at this dialog closely and remember what it looks
like.</para></listitem>
</orderedlist>
</para>
</listitem>

<listitem><para>The second wrong way:

<orderedlist>
<listitem><para>Open the <guilabel>Printers</guilabel>
folder.</para></listitem>

<listitem><para>Right-click on the printer (<guilabel>remoteprinter on
cupshost</guilabel>) and select the context menu
<guimenuitem>Properties</guimenuitem>.</para></listitem>

<listitem><para>Click on the <guilabel>General</guilabel>
tab.</para></listitem>

<listitem><para>Click on the button <guibutton>Printing
Preferences...</guibutton></para></listitem>

<listitem><para>A new dialog opens. Keep this dialog open and go back
to the parent dialog.</para></listitem>
</orderedlist>
</para>
</listitem>

<listitem><para>The third, and the correct way:

<orderedlist>

<listitem><para>Open the <guilabel>Printers</guilabel>
folder.</para></listitem>

<listitem><para>Click on the <guilabel>Advanced</guilabel>
tab. (If everything is <quote>grayed out,</quote> then you are not logged
in as a user with enough privileges).</para></listitem>

<listitem><para>Click on the <guibutton>Printing
Defaults...</guibutton> button.</para></listitem>

<listitem><para>On any of the two new tabs, click on the
<guibutton>Advanced...</guibutton>
button.</para></listitem>

<listitem><para>A new dialog opens. Compare this one to the other
identical looking one from <quote>B.5</quote> or A.3".</para></listitem>
</orderedlist>
</para>
</listitem>
</orderedlist>

<para>
Do you see any difference? I don't either. However, only the last
one, which you arrived at with steps <quote>C.1.-6.</quote>, will save any settings
permanently and be the defaults for new users. If you want all clients
to get the same defaults, you need to conduct these steps <emphasis>as
Administrator</emphasis> (<smbconfoption><name>printer admin</name></smbconfoption> in
&smb.conf;) <emphasis>before</emphasis> a client
downloads the driver (the clients can later set their own
<emphasis>per-user defaults</emphasis> by following the
procedures <emphasis>A</emphasis> or <emphasis>B</emphasis>
above).</para></sect2>

<sect2><title>Most Common Blunders in Driver Settings on Windows Clients</title>
<para>Don't use <parameter>Optimize for
Speed</parameter>, but use <parameter>Optimize for
Portability</parameter> instead (Adobe PS Driver). Don't use
<parameter>Page Independence: No</parameter>: always
settle with  <parameter>Page Independence:
Yes</parameter> (Microsoft PS Driver and CUPS PS Driver for
Windows NT/200x/XP). If there are problems with fonts, use
<parameter>Download as Softfont into
printer</parameter> (Adobe PS Driver). For
<guilabel>TrueType Download Options</guilabel>
choose <constant>Outline</constant>. Use PostScript
Level 2, if you are having trouble with a non-PS printer and if
there is a choice.</para></sect2>

<sect2><title><command>cupsaddsmb</command> Does Not Work with Newly Installed Printer</title>
<para>Symptom: The last command of
<command>cupsaddsmb</command> does not complete successfully:
<command>cmd = setdriver printername printername</command> result was
NT_STATUS_UNSUCCESSFUL then possibly the printer was not yet
recognized by Samba. Did it show up in Network
Neighborhood? Did it show up i n <command>rpcclient
hostname -c `enumprinters'</command>? Restart smbd (or send a
<command>kill -HUP</command> to all processes listed by
<command>smbstatus</command> and try
again.</para></sect2>

<sect2>
<title>Permissions on <filename>/var/spool/samba/</filename> Get Reset After Each Reboot</title>
<para>Have you ever by accident set the CUPS spool directory to
the same location? (<parameter>RequestRoot /var/spool/samba/</parameter> in <filename>cupsd.conf</filename> or
the other way round: <filename>/var/spool/cups/</filename> is set as
<smbconfoption><name>path</name></smbconfoption>> in the <smbconfsection>[printers]</smbconfsection>
section). These <parameter>must</parameter> be different. Set
<!--FIXME-->
<parameter>RequestRoot /var/spool/cups/</parameter> in
<filename>cupsd.conf</filename> and <smbconfoption><name>path</name><value>
/var/spool/samba</value></smbconfoption> in the <smbconfsection>[printers]</smbconfsection>
section of &smb.conf;. Otherwise cupsd will
sanitize permissions to its spool directory with each restart and
printing will not work reliably.</para></sect2>

<sect2>
<title>Print Queue Called <quote>lp</quote> Mis-handles Print Jobs</title>

<para>
In this case a print queue called <quote>lp</quote> intermittently swallows jobs and
spits out completely different ones from what was sent.
</para>

<para>It is a bad idea to name any printer <quote>lp</quote>. This
is the traditional UNIX name for the default printer. CUPS may be set
up to do an automatic creation of Implicit Classes. This means, to
group all printers with the same name to a pool of devices, and
load-balancing the jobs across them in a round-robin fashion. Chances
are high that someone else has a printer named <quote>lp</quote> too. You may
receive his jobs and send your own to his device unwittingly. To have
tight control over the printer names, set <parameter>BrowseShortNames
No</parameter>. It will present any printer as <replaceable>printername@cupshost</replaceable>
and then gives you better control over what may happen in a large
networked environment.</para></sect2>

<sect2><title>Location of Adobe PostScript Driver Files for <quote>cupsaddsmb</quote></title>
<para>Use <command>smbclient</command> to connect to any
Windows box with a shared PostScript printer: <command>smbclient
//windowsbox/print\$ -U guest</command>. You can navigate to the
<filename>W32X86/2</filename> subdir to <command>mget ADOBE*</command>
and other files or to <filename>WIN40/0</filename> to do the same.
Another option is to download the <filename>*.exe</filename> packaged
files from the Adobe Web site.</para></sect2>

</sect1>

<sect1>
<title>Overview of the CUPS Printing Processes</title>

<para>A complete overview of the CUPS printing processes can be found in <link linkend="a_small">the next flowchart</link>.</para>

<image id="a_small"><imagedescription>CUPS printing overview.</imagedescription>
	<imagefile>a_small</imagefile>
</image>
</sect1>

</chapter>













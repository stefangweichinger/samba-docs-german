<?xml version="1.0" encoding="ISO-8859-1"?>
<chapter id="FastStart">
<chapterinfo>
	&author.jht;
	<pubdate>April 3 2003</pubdate>
        <author>&author.luft;<contrib>Deutsche Übersetzung</contrib></author>

</chapterinfo>

<title>Schnellstart: Allheilmittel für Ungeduldige</title>

<para>
Als wir erstmalig nach Vorschlägen für die Aufnahme in die Samba HOWTO Dokumentation fragten,
fragte gleich jemand nach Beispielkonfigurationen &smbmdash; und vieles mehr davon. Dies ist 
ausdrücklich schwierig zu erfüllen, ohne einen Wertverlust zu bekommen, wenn man von einem
Produktionssystem nur Teile herausnimmt. Dies ist es, was der Rest dieses Dokumentes macht.
Es wird dies dadurch erfüllen, indem es ausführliche Beschreibungen der Konfigurationsmöglichkeiten
innerhalb des Kontextes des betroffenen Kapitels zeigt. Wir hoffen, dass dieses Kapitel die verlangte
Medizin ist.
</para>

<sect1>
<title>Eigenschaften und Vorzüge</title>

<para>
Samba braucht sehr wenig Konfiguration um ein arbeitsfähiges Basissystem zu erzeugen.
In diesem Kapitel gehen wir vom einfachen zum komplexen vor, für jeden stellen wir alle
Schritte und Konfigurationsdateien vor, die benötigt werden um es zum Laufen zu bekommen.
Bitte beachten Sie, dass ein umfassend konfiguriertes System wahrscheinlich zusätzliche
praktische Möglichkeiten ergeben. Die zusätzlichen Möglichkeiten werden im Rest dieses
Dokumentes behandelt.
</para>

<para>
Die Beispiele, die hier benutzt werden, wurden von Leuten genomen, die
Anfragen zu Beispielkonfigurationen gestellt hatten. Alle Identitäten wurden zu deren
Schutz verschleiert, die Ähnlichkeit zu unrealistischen und nicht existierenden Seiten
ist beabsichtigt.
</para>

</sect1>

<sect1>
<title>Beschreibung von Beispiel-Seiten</title>

<para>
Im ersten Fall von Konfigurationsbeispielen gehen wir vom Fall einer äusserst einfachen
Systemvoraussetzung aus. Es gibt manchmal das wirkliche Bestreben, etwas zu kompliziert
zu machen, als so einfach wie möglich mit geringstem Aufwand .
</para>

<para>
<link linkend="anon-ro"></link> dokumentiert den Servertyp, der vielleicht der richtige ist für CD-ROM Freigaben
oder der auf Dokumente für Netzwerk-Benutzer verweist. Diese Konfiguration wird ebenfalls in 
<link linkend="StandAloneServer"></link>, <link linkend="RefDocServer"></link> diskutiert.
Der Zweck dieser Konfiguration ist es, ein Freigabe-Laufwerk zur Verfügung zu stellen, welches von jedem, auch von Gästen,
lesend zugegriffen werden kann.
</para>

<para>
Das zweite Beispiel zeigt eine Minimal-Konfiguration eines Druckserver, sodass jedermann drucken kann, der die richtigen
Druckertreiber auf seinem Rechner installiert hat. Dies ist ein Abbild des System welches in
 <link linkend="StandAloneServer"></link>, <link linkend="SimplePrintServer"></link> beschrieben ist.
</para>

<para>
Das nächste Beispiel ist das eines gesicherten Datei- und Druckservers in einer Büroumgebung, welcher nur von Benutzern
genutzt werden kann, die ein Konto auf diesem System haben. Dieser Server ist absichtlich als ein Arbeitsgruppen-
Datei- und Druckserver ausgelegt, ist aber wesentlich sicherer als ein anonymer Dateiserver.
Diese Art von System wird typischerweise die Bedürfnisse eines kleinen Büros abdecken. Der Server bietet keine Netzwerk-
Anmelde-Möglichkeiten, keinen Domänencontroller, ist also nur ein Netzwerk Attached Storage (NAS) Device und Druckserver.
</para>

<para>
Schlussendlich betrachten wir noch ein etwas komplexeres System, welches sowohl in ein Microsoft Windows Netzwerk integriert 
ist als auch dieses komplett ersetzen kann. 
Die zur Verfügung gestellten Beispiele decken sowohl Domänen-Mitgliedsserver ab
als auch Samba Domänencontroller (PDC/BDC) und schlussendlich beschreiben Sie detailliert ein grosses verteiltes Netzwerk
mit Aussenstellen in Filialen.
</para>

</sect1>

<sect1>
<title>Arbeitsbeispiele</title>

<para>
Die Konfigurationsbeispiele sind so angelegt, dass sie alles enthalten um Samba zum Laufen zu bekommen.
Sie beinhalten keine grundlegenden Konfigurationen von Betriebsystemplattformen, welche ausserhalb des Rahmens
dieses Textes ist.
</para>

<para>
Es wird des weiteren davon ausgegangen, dass Samba korrekt installiert wurde, entweder durch Wege von Installationspaketen,
welche vom Betriebssystem-Provider zur Verfügung gestellt wurden oder durch andere.
</para>

	<sect2>
	<title>Stand-alone Server</title>

	<para>
	<indexterm><primary>Server Type</primary><secondary>Stand-alone</secondary></indexterm>
	Ein Stand-alone Server beinhaltet nichts anderes, als die Tatsache, dass es sich nicht um einen Domänen-Controller
	handelt und nicht in einer Domänenkontrolle teilhält. Es kann ein sehr einfacher Arbeitsgruppen-ähnlicher Server
	sein oder es kann auch ein etwas komplexerer Server als Mitglied eines Domänensicherheits-Kontextes sein.
	</para>

		<sect3 id="anon-ro">
		<title>Anonymer Nur-Lese Dokumenten-Server</title>

		<para>
		<indexterm><primary>Nur-Lese</primary><secondary>Server</secondary></indexterm>
		Das Ziel dieses Servertyps ist es, jedem Benutzer jedes Dokument oder jede Datei
		zugänglich zu machen, welche auf den Freigaberesourcen liegen. Die Freigaberesourcen
		können dabei ein CD-ROM Laufwerk, ein CD-ROM Image oder eine Dateispeicherebene sein.
		storage area.
		</para>

		<para>
		Als die Beispiele entwickelt wurden, wurde Wert darauf gelegt, dass das System
		wachsen und mehr Möglichkeiten bieten wird, so als wie es im echten Arbeitsalltag 
		passiert, wenn das Geschäft in seiner Grösse und Bedürfnissen wächst und Veränderung
		braucht.
		</para>

		<para>Die Konfigurationsdatei:</para>

		<para><smbconfexample id="anon-example">
				<title>Konfiguration Anonymer Nur-Lese Server</title>
		<smbconfcomment>Global parameters</smbconfcomment>
		<smbconfsection>[global]</smbconfsection>
		<smbconfoption><name>workgroup</name><value>MIDEARTH</value></smbconfoption>
		<smbconfoption><name>netbios name</name><value>HOBBIT</value></smbconfoption>
		<smbconfoption><name>security</name><value>share</value></smbconfoption>

		<smbconfsection>[data]</smbconfsection>
		<smbconfoption><name>comment</name><value>Data</value></smbconfoption>
		<smbconfoption><name>path</name><value>/export</value></smbconfoption>
		<smbconfoption><name>read only</name><value>Yes</value></smbconfoption>
		<smbconfoption><name>guest ok</name><value>Yes</value></smbconfoption>
		</smbconfexample>
		</para>

		<itemizedlist>
			<listitem><para>
			Der Dateisystem Freigabepunkt wird <filename>/export</filename> sein.
			</para></listitem>

			<listitem><para>
			Alle Dateien werden von einem Benutzer namens Jack Baumbach gehalten.
			Jack's loginname wird <emphasis>jackb</emphasis> sein. Sein Passwort wird
			<emphasis>m0r3pa1n</emphasis> &smbmdash; sein, natürlich ist das nur das
			Beispiel wleches wir benutzen; benutzen Sie es nicht in einer Produktionsumgebung,
			da alle Leser dieses Dokumentes dieses wissen werden.
			</para></listitem>
		</itemizedlist>

		<procedure>
		<title>Installationsprozedur &smbmdash; Nur-Lese Server</title>
			<step><para>
			Fügen Sie den Benutzer dem System zu (mit Erzeugung des Benutzer Homeverzeichnisses):
<screen>
&rootprompt;<userinput>useradd -c "Jack Baumbach" -m -g users -p m0r3pa1n jackb</userinput>
</screen>
			</para></step>

			<step><para>
			Erzeugen Sie das Verezichnis und setzen Sie die Rechte und Mitgliedschaft:
<screen>
&rootprompt;<userinput>mkdir /export</userinput>
&rootprompt;<userinput>chmod u+rwx,g+rx,o+rx /export</userinput>
&rootprompt;<userinput>chown jackb.users /export</userinput>
</screen>
			</para></step>

			<step><para>
			Kopieren Sie die Dateien, welche freigegeben werden sollen nach <filename>/export</filename>.
			</para></step>

			<step><para>
			Installieren Sie die Samba Konfigurationsdatei (<filename>/etc/samba/smb.conf</filename>)
			wie gezeigt.
			</para></step>

			<step><para>
			Testen der Konfigurationsdatei:
<screen>
&rootprompt;<userinput>testparm</userinput>
</screen>
			Beachten Sie alle Fehlermeldungen, welche evtl. angezeigt werden. Fahren Sie nicht fort,
			bevor Sie nicht eine fehlerfreie Rückmeldung erhalten. Ein Beispiel der Rückmeldungen mit
			der folgenden Datei wird die Datei anzeigen.
<screen>
Load smb config files from /etc/samba/smb.conf
Processing section "[data]"
Loaded services file OK.
Server role: ROLE_STANDALONE
Press enter to see a dump of your service definitions
<userinput>[Press enter]</userinput>

# Global parameters
[global]
	workgroup = MIDEARTH
	netbios name = HOBBIT
	security = share

[data]
	comment = Data
	path = /export
	read only = Yes
	guest only = Yes
</screen>
			</para></step>

			<step><para>
			Starten Sie Samba mit der für Ihr Betriebssystem-Plattform möglichen Methode.
			</para></step>

			<step><para>
			Konfigurieren Sie Ihren Microsoft Windows Client für die Arbeitsgruppe
			<emphasis>MIDEARTH</emphasis>, setzen Sie den Maschinennamen auf ROBBINS, sterten
			Sie den PC neu und warten Sie ein paar (2 - 5) Minuten, dann öffnen Sie den Windows Explorer
			und betrachten Sie die Netzwerkumgebung.
			Die Maschine HOBBIT sollte sichtbar sein. Wenn Sie auf das Icon dieser Maschine klicken
			sollte es sich öffnen und Zugriff auf die <emphasis>data</emphasis> Freigabe ermöglichen.
			Danach klicken Sie auf diese Freigabe und es sollte sich der Zugriff auf die Dateien, die 
			wir vorher im <filename>/export</filename> Verzeichnis abgelegt hatten, ermöglichen.
			</para></step>
		</procedure>

		<para>
		Die vormals genannten Informationen (die nachstehenden #Global Parameter) stellen den kompletten
		Inhalt der <filename>/etc/samba/smb.conf</filename> Datei zur Verfügung.
		</para>

		</sect3>

		<sect3>
		<title>Anonymer Schreib-Lese Dokumenten Server</title>

		<para>
		<indexterm><primary>anonymer</primary><secondary>Schreib-Lese server</secondary></indexterm>
		Wir sollten diese Konfiguration als eine Erweiterung des vorstehenden Beispiels ansehen.
		Der Unterschied ist, dass der Freigabezugriff nun mit der Benutzeridentität von jackb und der
		primären Gruppe, welcher jackb angehört, zusammenhängt. Eine weitere Verbesserung, die wir machen
		können ist den Benutzer <emphasis>jackb</emphasis> zu der <filename>smbpasswd</filename> Datei
		hinzuzufügen.
		Um dies zu erledigen machen Sie folgendes:
<screen>
&rootprompt;<userinput>smbpasswd -a jackb</userinput>
New SMB password: <userinput>m0r3pa1n</userinput>
Retype new SMB password: <userinput>m0r3pa1n</userinput>
Added user jackb.
</screen>
		Das Hinzufügen dieses Benutzers zu der <filename>smbpasswd</filename> Datei erlaubt es, dass
		alle Dateien, die in den Explorereigenschaften angezeigt werden, als zu <emphasis>jackb</emphasis>
		angehörend angezeigt werden, anstatt Sie mit <emphasis>Unbekannter Benutzer</emphasis> anzuzeigen.
		</para>

		<para>
		Die komplette geänderte &smb.conf; Datei wird in <link linkend="anon-rw"/> dargestellt.
		</para>

		<para>
<smbconfexample id="anon-rw"><title>Geänderte anonyme Schreib-Lese smb.conf</title>
<smbconfcomment>Globale Parameter</smbconfcomment>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>workgroup</name><value>MIDEARTH</value></smbconfoption>
<smbconfoption><name>netbios name</name><value>HOBBIT</value></smbconfoption>
<smbconfoption><name>security</name><value>SHARE</value></smbconfoption>

<smbconfsection>[data]</smbconfsection>
<smbconfoption><name>comment</name><value>Data</value></smbconfoption>
<smbconfoption><name>path</name><value>/export</value></smbconfoption>
<smbconfoption><name>force user</name><value>jackb</value></smbconfoption>
<smbconfoption><name>force group</name><value>users</value></smbconfoption>
<smbconfoption><name>read only</name><value>No</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>Yes</value></smbconfoption>
</smbconfexample>
		</para>

		</sect3>

		<sect3>
		<title>Anonymer Druck-Server</title>

		<para>
		<indexterm><primary>anonymer</primary><secondary>Druckserver</secondary></indexterm>
		Ein anonymer Druckserver bietet zwei Vorteile:
		</para>

		<itemizedlist>
			<listitem><para>
			Erlaubt das Drucken auf allen Druckern von einer einzigen Stelle aus.
			</para></listitem>

			<listitem><para>
			Reduziert den Netzwerkverkehr dadurch, dass viele Benutzer nur eine beschänkte
			Anzahl von Druckern nutzen können.
			</para></listitem>
		</itemizedlist>

		<para>
		In der einfachsten Form von anonymen Druckservern ist es allgemein so, dass die korrekte
		Installation von Druckertreibern auf Windows Arbeitsstationen verlangt wird.
		In diesem Fall wird der Druckserver so ausgelegt, dass er Druckaufträge einfach zum Spooler
		durchreicht und der Spooler sollte auf raw pass-through für den Drucker konfiguriert sein.
		In anderen Worten: der Drucker-Spooler darf keinen Filter benutzen oder den Datenstrom zum 
		Drucker	in irgendeiner Form verarbeiten.
		</para>

		<para>
		In dieser Konfiguration ist es nicht gewünscht, den Druckerwizard anzuzeigen und wir
		wollen auch keinen automatischen Treiberdownload haben, also werden wir dies in der
		folgenden Konfiguration auch abschalten.
		<link linkend="anon-print"></link> ist die daraus entstandene &smb.conf; Datei.
		</para>

		<para>
<smbconfexample id="anon-print"><title>Anonymer Druckserver smb.conf</title>
<smbconfcomment>Globale Parameter</smbconfcomment>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>workgroup</name><value>MIDEARTH</value></smbconfoption>
<smbconfoption><name>netbios name</name><value>LUTHIEN</value></smbconfoption>
<smbconfoption><name>security</name><value>share</value></smbconfoption>
<smbconfoption><name>printcap name</name><value>cups</value></smbconfoption>
<smbconfoption><name>disable spoolss</name><value>Yes</value></smbconfoption>
<smbconfoption><name>show add printer wizard</name><value>No</value></smbconfoption>
<smbconfoption><name>printing</name><value>cups</value></smbconfoption>

<smbconfsection>[printers]</smbconfsection>
<smbconfoption><name>comment</name><value>All Printers</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>Yes</value></smbconfoption>
<smbconfoption><name>printable</name><value>Yes</value></smbconfoption>
<smbconfoption><name>use client driver</name><value>Yes</value></smbconfoption>
<smbconfoption><name>browseable</name><value>No</value></smbconfoption>
</smbconfexample>
		</para>

		<para>
		Die vorangegangene Konfiguration ist nicht ideal. Sie benutzt keine angenehmen Funktionen und 
		und stellt absichtlich keine elegante Lösung dar. Dennoch ist sie grundlegend und sie druckt.
		</para>

		<note><para>
		Windowsbenutzer müssen einen lokalen Drucker installieren und dann die Ausgabeschnittstelle
		zum Drucker ändern, nachdem Sie die Treiber installiert haben. Die Ausgabeschnittstelle kann dann
		auf den Netzwerkdrucker dieser Maschine gesetzt werden.
		</para></note>

		<para>
		Stellen Sie sicher, dass das Verzeichnis <filename>/var/spool/samba</filename> wie gewünscht verwendet
		werden kann. Die folgenden Schritte stellen dies sicher:
		</para>

		<itemizedlist>
			<listitem><para>
			Das Verzeichnis muss durch den superuser (root) Benutzer und die Gruppe gehalten werden:
<screen>
&rootprompt;<userinput>chown root.root /var/spool/samba</userinput>
</screen>
			</para></listitem>

			<listitem><para>
			Die Verzeichnis-Rechte müssen für öffentlichen Lese-Schreibzugriff mit dem sticky-bit 
			wie gezeigt gesetzt werden:
<screen>
&rootprompt;<userinput>chmod a+rw TX /var/spool/samba</userinput>
</screen>
			</para></listitem>
		</itemizedlist>


		<note><para>
		<indexterm><primary>MIME</primary><secondary>raw</secondary></indexterm>
		<indexterm><primary>raw printing</primary></indexterm>
		Auf CUPS-aktivierten Systemen gibt es eine Möglichkeit, raw-Daten direkt auf den Drucker auszugeben, ohne
		diese durch CUPS Druckerfilter hindurch zu leiten. An Stellen, an denen diese Methode gewünscht ist, muss
		ein sogenanntes raw-printing Device konfiguriert sein.
		Es ist ausserdem notwendig, den raw mime-Handler in den Dateien <filename>/etc/mime.conv</filename> und 
		<filename>/etc/mime.types</filename> einzuschalten. Sehen Sie nach auf <link linkend="cups-raw"></link>.
		</para></note>

		</sect3>

		<sect3>
		<title>Sichere Lese-Schreib Datei- und Druck-Server</title>

		<para>
		Wir schreiten nun von einem einfachen System zu einem etwas komplexeren Server fort.
		</para>

		<para>
		Unser neuer Server wird einen öffentlichen Bereich zur Dateiablage verlangen, welcher nur
		von authentifizierten Benutzern (z.B. solche mit einem lokalen Konto) beschrieben werden kann 
		und enthält ausserdem ein Home-Verzeichnis.
		Es wird einen Drucker geben, der für alle verfüg- und nutzbar sein wird.
		</para>

		<para>
		Diese kontruierte Umgebung (es wurde keine Spionage zur Erlangung der Daten durchgeführt) zeigt eine
		sehr einfache Umgebung, welche <emphasis>sicher genug</emphasis> aber nicht zu kompliziert ist.
		</para>

		<para>
		Die Benutzer werden sein: Jack Baumbach, Mary Orville und Amed Sehkah. Jeder wird ein Passwort haben
		(werden in weiteren Beispielen dann nicht nochmals aufgeführt). 
		Mary wird der Druckeradministrator sein und wird alle Dateien in dem öffentlichen Bereich innehalten.
		</para>

		<para>
		
		Diese Konfiguration wird auf der <emphasis>User Level Security</emphasis> basieren,
		welche den Standard darstellt und die standardmässig Microsoft Windows-kompatible
		verschlüsselte Passwörter in einer Datei <filename>/etc/samba/smbpasswd</filename> ablegen.
		Der Standard &smb.conf; Eintrag, der dies ermöglicht ist:
		<smbconfoption><name>passdb backend</name><value>smbpasswd, guest</value></smbconfoption>. 
		Da dies der Standard ist, ist es nicht notwendig ihn in die Konfigurationsdatei zu schreiben.
		Beachten Sie dabei bitte, dass der Gast-Backend automatisch in die Liste der aktiven passdb backends
		eingetragen wird, egal ob dies in der Samba Konfigurationsdatei direkt aufgeführt wird oder nicht.
		</para>


		<procedure>
		<title>Installieren des Secure Office Servers</title>
			<step><para>
		<indexterm><primary>office server</primary></indexterm>
			Fügen Sie alle Benutzer zum Betriebssystem hinzu:
<screen>
&rootprompt;<userinput>useradd -c "Jack Baumbach" -m -g users -p m0r3pa1n jackb</userinput>
&rootprompt;<userinput>useradd -c "Mary Orville" -m -g users -p secret maryo</userinput>
&rootprompt;<userinput>useradd -c "Amed Sehkah" -m -g users -p secret ameds</userinput>
</screen>
			</para></step>

			<step><para>
			Konfigurieren Sie die Samba &smb.conf; Datei wie in <link linkend="OfficeServer"/> beschrieben.
<smbconfexample id="OfficeServer">
<title>Secure Office Server smb.conf</title>
<smbconfcomment>Globale Parameter</smbconfcomment>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>workgroup</name><value>MIDEARTH</value></smbconfoption>
<smbconfoption><name>netbios name</name><value>OLORIN</value></smbconfoption>
<smbconfoption><name>printcap name</name><value>cups</value></smbconfoption>
<smbconfoption><name>disable spoolss</name><value>Yes</value></smbconfoption>
<smbconfoption><name>show add printer wizard</name><value>No</value></smbconfoption>
<smbconfoption><name>printing</name><value>cups</value></smbconfoption>

<smbconfsection>[homes]</smbconfsection>
<smbconfoption><name>comment</name><value>Home-Verzeichnisse</value></smbconfoption>
<smbconfoption><name>valid users</name><value>%S</value></smbconfoption>
<smbconfoption><name>read only</name><value>No</value></smbconfoption>
<smbconfoption><name>browseable</name><value>No</value></smbconfoption>

<smbconfsection>[public]</smbconfsection>
<smbconfoption><name>comment</name><value>Daten</value></smbconfoption>
<smbconfoption><name>path</name><value>/export</value></smbconfoption>
<smbconfoption><name>force user</name><value>maryo</value></smbconfoption>
<smbconfoption><name>force group</name><value>users</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>Yes</value></smbconfoption>

<smbconfsection>[printers]</smbconfsection>
<smbconfoption><name>comment</name><value>Alle Drucker</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption>
<smbconfoption><name>printer admin</name><value>root, maryo</value></smbconfoption>
<smbconfoption><name>create mask</name><value>0600</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>Yes</value></smbconfoption>
<smbconfoption><name>printable</name><value>Yes</value></smbconfoption>
<smbconfoption><name>use client driver</name><value>Yes</value></smbconfoption>
<smbconfoption><name>browseable</name><value>No</value></smbconfoption>
			</smbconfexample>
			</para></step>

			<step><para>
			Initialisieren der Microsoft Windows Passwort Datenbank mit den neuen Benutzern:
<screen>
&rootprompt;<userinput>smbpasswd -a root</userinput>
New SMB password: <userinput>bigsecret</userinput>
Reenter smb password: <userinput>bigsecret</userinput>
Added user root.

&rootprompt;<userinput>smbpasswd -a jackb</userinput>
New SMB password: <userinput>m0r3pa1n</userinput>
Retype new SMB password: <userinput>m0r3pa1n</userinput>
Added user jackb.

&rootprompt;<userinput>smbpasswd -a maryo</userinput>
New SMB password: <userinput>secret</userinput>
Reenter smb password: <userinput>secret</userinput>
Added user maryo.

&rootprompt;<userinput>smbpasswd -a ameds</userinput>
New SMB password: <userinput>mysecret</userinput>
Reenter smb password: <userinput>mysecret</userinput>
Added user ameds.
</screen>
			</para></step>

			<step><para>
			Installieren der Drucker durch Nutzung des CUPS Web interface. 
			Stellen Sie sicher, dass alle Drucker, welche mit mit Microsoft Windows clients
			freigegeben sind, als raw printing devices installiert sind.
			</para></step>

			<step><para>
			Starten Sie Samba durch Nutzung des betriebssystemeigenen Administratiions-Interfaces.
			Alternativ kann dies manuell getan werden:
			<indexterm><primary>smbd</primary></indexterm>
			<indexterm><primary>nmbd</primary></indexterm>
			<indexterm><primary>starting samba</primary><secondary>smbd</secondary></indexterm>
			<indexterm><primary>starting samba</primary><secondary>nmbd</secondary></indexterm>
<screen>
&rootprompt;<userinput> nmbd; smbd;</userinput>
</screen>
			</para></step>

			<step><para>
			Konfigurieren Sie das <filename>/export</filename> Verzeicnis:
<screen>
&rootprompt;<userinput>mkdir /export</userinput>
&rootprompt;<userinput>chown maryo.users /export</userinput>
&rootprompt;<userinput>chmod u=rwx,g=rwx,o-rwx /export</userinput>
</screen>
			</para></step>

			<step><para>
			Überprüfen Sie, dass Samba korrekt läuft:
<screen>
&rootprompt;<userinput>smbclient -L localhost -U%</userinput>
Domain=[MIDEARTH] OS=[UNIX] Server=[Samba-3.0.0]

Sharename      Type      Comment
---------      ----      -------
public         Disk      Data
IPC$           IPC       IPC Service (Samba-3.0.0)
ADMIN$         IPC       IPC Service (Samba-3.0.0)
hplj4          Printer   hplj4

Server               Comment
---------            -------
OLORIN               Samba-3.0.0

Workgroup            Master
---------            -------
MIDEARTH             OLORIN
</screen>
			</para></step>

			<step><para>
			Verbinden Sie sich zu OLORIN als maryo:
<screen>
&rootprompt;<userinput>smbclient //olorin/maryo -Umaryo%secret</userinput>
OS=[UNIX] Server=[Samba-3.0.0]
smb: \> <userinput>dir</userinput>
.                             D        0  Sat Jun 21 10:58:16 2003
..                            D        0  Sat Jun 21 10:54:32 2003
Documents                      D        0  Fri Apr 25 13:23:58 2003
DOCWORK                        D        0  Sat Jun 14 15:40:34 2003
OpenOffice.org                 D        0  Fri Apr 25 13:55:16 2003
.bashrc                        H     1286  Fri Apr 25 13:23:58 2003
.netscape6                    DH        0  Fri Apr 25 13:55:13 2003
.mozilla                      DH        0  Wed Mar  5 11:50:50 2003
.kermrc                        H      164  Fri Apr 25 13:23:58 2003
.acrobat                      DH        0  Fri Apr 25 15:41:02 2003

		55817 blocks of size 524288. 34725 blocks available
smb: \> <userinput>q</userinput>
</screen>
			</para></step>
		</procedure>

		</sect3>

	<para>
	Bis hierher sollten Sie die Konfigurationsgrundlagen mitbekommen haben. Ehrlich, jetzt ist es 
	an der Zeit, etwas komplexere Beispiele zu erfahren. Für den Rest dieses Kapitels werden wir
	die Anleitungen abkürzen, da sie vorher bereits behandelt wurden.
	</para>

	</sect2>

	<sect2>
	<title>Domänen Mitglieds-Server</title>


	<para>
	<indexterm><primary>Servertyp</primary><secondary>Domänen-Mitglied</secondary></indexterm>
	In dieser Abhandlung werden wir uns die einfachstmögliche Serverkonfiguration ausdenken, die
	man erstellen kann um ein Vertriebsbüro glücklich zu machen. Seien Sie gewarnt, die Anwender
	sind Vetriebsleute und haben demenstprechend schlimme Anforderungen. Es gibt ein Budget für nur
	einen Server für diese Einrichtung.
	</para>

	<para>
	Das Netzwerk wird durch eine interne Information Services Group (ISG) verwaltet zu welcher wir gehören.
	Interne Regeln sind typisch für eine mittelständische Organisation; die Menschen sind der Meinung, dass
	Sie die ISG deshalb bezahlen, weil diese ständig Benutzer hinzufügen oder löschen.
	Desweiteren müssen die Abteilungsleiter zähnefletschend kämpfen, damit Sie einen Netzwerkzugang erhalten
	für Ihre Mannschaft. Der Vertrieb ist natürlich ebenfalls wieder anders, Sie bekommen stets was Sie brauchen.
	Dies also soll unser Schema sein.
	</para>

	<para>
	Wir werden die Benutzer aus dem letzten Beispiel nehmen. Der Vertrieb hat einen eigenen zentralen
	Drucker, welchen alle Vertriebsleute nutzen können. Es gibt auch noch einen Scheckdrucker, den aber 
	nur die Person nutzen darf, die authorosert ist Schecks zu drucken. Der Chefbuchhalter (CFO) möchte,
	dass dieser Drucker vollständig geschützt ist und deshalb auch in seinem eigenen privaten Teil des
	Büros aufgebaut ist. Deshalb muss es ein Netzwerkdrucker sein.
	</para>

	<para>
	Die Vertriebsstelle benutzt eine Vertriebssoftware namens <emphasis>SpytFull</emphasis> welche
	von einem zentralen Applikationssserver aus läuft. Die Software ist für einen Server lizenzsiert,
	es gibt keine Arbeitsplatzkomponenten und sie wird von einer gemappten Freigabe aus gestartet.
	Die Datenablage erfolgt in einem Unix-basierenden SQL-Backend. Die UNUX Gurus schauen danach, es ist
	also nicht unser Problem.
	</para>

	<para>
	Die Vertriebsmanagerin (maryo) möchte ein allgemein zugängliches Dateisystem und zusätzlich
	eine getrennte Dateiablage für Formbriefe (nastygrams). Der Bereich für die Formbriefe soll für
	alle Vertriebsmitarbeiter ausser der Managerin selbst nur lesbar sein. Das allgemein zugängliche 
	Dateisystem muss ein strukturiertes Layout haben, sowohl mit einem zentralen Bereich für alle
	Mitarbeiter um allgemeine Dokumente zu speichern, als auch einen getrennten Bereich für den jeweiligen
	Mitarbeiter selbst, in dem er private Dinge ablegen kann, aber Sie möchte auf alle diese Bereiche
	vollen Zugriff haben. Die Benutzer haben ein privates Home-Verzeichnis für persönliche Dateien, die
	arbeitsgebunden sind und für Materialien, die nichts mit Ihrer Arbeit zu tun haben.
	</para>
	
		<sect3>
		<title>Beispielkonfiguration</title>
		
		<para>
		Der Server <emphasis>valinor</emphasis> wird ein Mitglied der Firmendomäne sein.
		Die Vetriebsleute haben nur einen lokalen Server. Benutzerkonten werden auf dem Domänen Controller
		liegen, genauso wie die Arbeitsplatzprofile und alle Netzwerk-Richtliniendateien.
		</para>

		<procedure>
			<step><para>
			Fügen Sie keine Benutzer zu den UNIX/Linux Servern hinzu, dies wird auf der
			zentralen Domäne gemacht.
			</para></step>

			<step><para>
			Konfigurieren Sie &smb.conf; wie in <link linkend="fast-member-server"/>
			und <link linkend="fast-memberserver-shares"></link> beschrieben.
			</para>

			<para>
			<smbconfexample id="fast-member-server">
			<title>Mitglieds-Server server smb.conf (globales)</title>
<smbconfcomment>Globale Parameter</smbconfcomment>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>workgroup</name><value>MIDEARTH</value></smbconfoption>
<smbconfoption><name>netbios name</name><value>VALINOR</value></smbconfoption>
<smbconfoption><name>security</name><value>DOMAIN</value></smbconfoption>
<smbconfoption><name>printcap name</name><value>cups</value></smbconfoption>
<smbconfoption><name>disable spoolss</name><value>Yes</value></smbconfoption>
<smbconfoption><name>show add printer wizard</name><value>No</value></smbconfoption>
<smbconfoption><name>idmap uid</name><value>15000-20000</value></smbconfoption>
<smbconfoption><name>idmap gid</name><value>15000-20000</value></smbconfoption>
<smbconfoption><name>winbind separator</name><value>+</value></smbconfoption>
<smbconfoption><name>winbind use default domain</name><value>Yes</value></smbconfoption>
<smbconfoption><name>use sendfile</name><value>Yes</value></smbconfoption>
<smbconfoption><name>printing</name><value>cups</value></smbconfoption>
			</smbconfexample></para>

			<para>
			<smbconfexample id="fast-memberserver-shares">
			<title>Mitgleids-Server smb.conf (Freigaben und Dienste)</title>
<smbconfsection>[homes]</smbconfsection>
<smbconfoption><name>comment</name><value>Home-Verzeichnisse</value></smbconfoption>
<smbconfoption><name>valid users</name><value>%S</value></smbconfoption>
<smbconfoption><name>read only</name><value>No</value></smbconfoption>
<smbconfoption><name>browseable</name><value>No</value></smbconfoption>

<smbconfsection>[spytfull]</smbconfsection>
<smbconfoption><name>comment</name><value>Nur für Vertriebsanwendungen</value></smbconfoption>
<smbconfoption><name>path</name><value>/export/spytfull</value></smbconfoption>
<smbconfoption><name>valid users</name><value>@Accounts</value></smbconfoption>
<smbconfoption><name>admin users</name><value>maryo</value></smbconfoption>
<smbconfoption><name>read only</name><value>Yes</value></smbconfoption>

<smbconfsection>[public]</smbconfsection>
<smbconfoption><name>comment</name><value>Daten</value></smbconfoption>
<smbconfoption><name>path</name><value>/export/public</value></smbconfoption>
<smbconfoption><name>read only</name><value>No</value></smbconfoption>

<smbconfsection>[printers]</smbconfsection>
<smbconfoption><name>comment</name><value>Alle Drucker</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption>
<smbconfoption><name>printer admin</name><value>root, maryo</value></smbconfoption>
<smbconfoption><name>create mask</name><value>0600</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>Yes</value></smbconfoption>
<smbconfoption><name>printable</name><value>Yes</value></smbconfoption>
<smbconfoption><name>use client driver</name><value>Yes</value></smbconfoption>
<smbconfoption><name>browseable</name><value>No</value></smbconfoption>
			</smbconfexample>
			</para></step>


			<step><para>
<indexterm><primary>net</primary><secondary>rpc</secondary></indexterm>
			Der Domäne beitreten. Beachte: Starten Sie Samba nicht, bevor dieser Schritt abgeschlossen ist!
<screen>
&rootprompt;<userinput>net rpc join -Uroot%'bigsecret'</userinput>
Joined domain MIDEARTH.
</screen>
			</para></step>

			<step><para>
			Stellen Sie unbedingt sicher, dass der <command>nscd</command> Daemon auf allen Systemen
			auf welchen <command>winbind</command> lauffähig konfiguriert ist, abgeschaltet oder
			heruntergefahren ist.
			</para></step>

			<step><para>
			Starten Sie Samba mit der für Ihre Betriebssystem-Plattform vorgegebenen Methode.
			Sie können dies als root auch manuell ausführen:
			<indexterm><primary>smbd</primary></indexterm>
			<indexterm><primary>nmbd</primary></indexterm>
			<indexterm><primary>winbindd</primary></indexterm>
			<indexterm><primary>starting samba</primary><secondary>smbd</secondary></indexterm>
			<indexterm><primary>starting samba</primary><secondary>nmbd</secondary></indexterm>
			<indexterm><primary>starting samba</primary><secondary>winbindd</secondary></indexterm>
<screen>
&rootprompt;<userinput>nmbd; smbd; winbindd;</userinput>
</screen>
			</para></step>

			<step><para>
			Konfigurieren Sie die Nameservice Switchcontrol Datei auf Ihrem System um Benutzer- und
			Gruppennamen durch winbind aufzulösen. Ändern Sie die folgenden Zeilen in <filename>/etc/nsswitch.conf</filename>:
<programlisting>
passwd: files winbind
group:  files winbind
hosts:  files dns winbind
</programlisting>
			</para></step>

			<step><para>
			Setzen Sie das Passwort um <command>wbinfo</command> nutzen zu können:
<screen>
&rootprompt;<userinput>wbinfo --set-auth-user=root%'bigsecret'</userinput>
</screen>
			</para></step>

			<step><para>
			Überprüfen Sie, dass Domänenbenutzer und Gruppenzugehörigkeiten korrekt aufgelöst werden
			können, indem Sie das folgende ausführen:

<screen>
&rootprompt;<userinput>wbinfo -u</userinput>
MIDEARTH+maryo
MIDEARTH+jackb
MIDEARTH+ameds
...
MIDEARTH+root

&rootprompt;<userinput>wbinfo -g</userinput>
MIDEARTH+Domain Users
MIDEARTH+Domain Admins
MIDEARTH+Domain Guests
...
MIDEARTH+Accounts
</screen>
			</para></step>

			<step><para>
			Überpürfen Sie, dass <command>winbind</command> läuft. Das folgende demonstriert die
			korrekte Auflösung des Benutzernamens durch das <command>getent</command> System-Dienstprogramm:
<screen>
&rootprompt;<userinput>getent passwd maryo</userinput>
maryo:x:15000:15003:Mary Orville:/home/MIDEARTH/maryo:/bin/false
</screen>
			</para></step>

			<step><para>
			Ein abschliessender Test, ob wir dies auch unter Kontrolle haben, versichert uns dann:
<screen>
&rootprompt;<userinput>touch /export/a_file</userinput>
&rootprompt;<userinput>chown maryo /export/a_file</userinput>
&rootprompt;<userinput>ls -al /export/a_file</userinput>
...
-rw-r--r--    1 maryo    users       11234 Jun 21 15:32 a_file
...

&rootprompt;<userinput>rm /export/a_file</userinput>
</screen>
			</para></step>

			<step><para>
			Die Konfiguration ist nahezu fertig, sodass dies ein günstiger Zeitpunkt für das Anlegen
			der Verzeichnisstruktur für diese Einrichtung ist:
<screen>
&rootprompt;<userinput>mkdir -p /export/{spytfull,public}</userinput>
&rootprompt;<userinput>chmod ug=rwxS,o=x /export/{spytfull,public}</userinput>
&rootprompt;<userinput>chown maryo.Accounts /export/{spytfull,public}</userinput>
</screen>
			</para></step>
		</procedure>

		</sect3>

	</sect2>

	<sect2>
	<title>Domänen Controller</title>


	<para>
	<indexterm><primary>Servertyp</primary><secondary>Domänen Controller</secondary></indexterm>
	Für den Rest dieses Kapitels liegt der Fokus auf der Konfiguration der Domänenkontrolle.
	Die folgenden Beispiele sind für zwei Implementierungsstrategien ausgelegt. Erinnern Sie sich:
	unsere Aufgabe ist eine einfache aber funktionerende Lösung. Der Rest dieses Buches soll helfen,
	die Gelegenheit für grössere Funktionalität und deren einhergehende Komplexität zu beleuchten.
	</para>

	<para>
	Eine Domänen Controller Konfiguration kann druch eine einfache Konfiguration durch Nutzung der neuen
	tdbsam password backend erreicht werden. Dieser Konfigurationstyp ist gut für kleine Büros, hat aber
	eine beschränkte Skalierungsmöglichkeit (Replizierung geht nicht) und die Performance kann vermutlich
	fallen, wenn die Grösse und Komplexität der Domäne steigt.
	</para>

	<para>
	Die Nutzung von tdbsam ist am besten auf Einrichtungen beschränkt, die nicht mehr als einen primären
	Domänencontroller (PDC) benötigen. Wenn die Grösse einer Domäne anwächst, komt der WUnsch nach einem
	zusätzlichen Domänencontroller auf. Versuchen Sie nicht, eine Microsoft Windows-Netzwerkumgebung zu klein
	auszulegen; Domänencontroller stellen lebenswichtige Authentifizierungsdienst zur Verfügung.
	Das folgende sind Symptome einer zu klein ausgelegten Domänencontroller-Umgebung:
	</para>

	<itemizedlist>	
		<listitem><para>
		 Domänen-Anmeldungen schlagen sporadisch fehl.
		</para></listitem>

		<listitem><para>
		Dateizugriffe auf einen Domänen-Mitgliedsserver schlagen sporadisch fehl, es kommt zu
		Fehlermeldungen mit Zugriffsverweigerungen.
		</para></listitem>
	</itemizedlist>

	<para>
	EIne besser skalierende Option für Domänencontroller Authentifizierungsbackends mag 
	Microsoft Active Directory oder ein LDAP-basierendes backend nutzen. Samba-3 stellt dies für beide
	Optionen als ein Domänen-Mitgleidsserver zur Verfügung. Als ein PDC ist Samba-3 nicht in der Lage
	eine genaue Alternative der Funktionalitäten zur Verfügung zu stellen, die Active Directory bietet.
	Samba-3 kann eine skalierende LDAP-basierende PDC/BDC Lösung zur Verfügung stellen.
	</para>

	<para>
	Der tdbsam Authentifizierungs-Backend stellt keine Funktion zum Replizieren der Datenbankinhalte, ausser
	für externe Wege, zur Verfügung (z.B. gibt es kein autarkes Protokoll in Samba-3 für die Security Account
	Manager (SAM) Datenbank-Replikation). 
	</para>

	<note><para>
	Falls Sie also mehr als einen Domänencontroller benötigen, so benutzen Sie kein tdbsam Authentifizierungs-Backend. 
	</para></note>

		<sect3>
		<title>Beispiel: Ingenieur-Büro</title>

		<para>
		Den Netzwerkserver des Ingenierubüros, welchen wir hier präsentieren, ist dazu gedacht, den neuen
		tdbsam Passwort-Backend zu demonstrieren. Die tdbsam Funktion ist neu in Samba-3. Sie wurde  
		dazu desinged, viele Benutzer- und Maschinenkonten zur Verfügung zu stellen, die mit Microsoft Windows NT4
		möglich sind. Es ist sicher, dies in kleineren Netzwerken zu benutzen.
		</para>

		<procedure>
			<step><para>
			Eine PDC Konfiguration in Produktion, welche das tdbsam Passwort-Backend benutzt, können Sie
			zusammen mit <link linkend="fast-engoffice-shares"></link> hier sehen
			<link linkend="fast-engoffice-shares"></link>:
			</para>
			
			<para>
<indexterm><primary>pdbedit</primary></indexterm>
			<smbconfexample id="fast-engoffice-global">
			<title>Ingenieurbüro smb.conf (Globales)</title>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>workgroup</name><value>MIDEARTH</value></smbconfoption>
<smbconfoption><name>netbios name</name><value>FRODO</value></smbconfoption>
<smbconfoption><name>passdb backend</name><value>tdbsam</value></smbconfoption>
<smbconfoption><name>printcap name</name><value>cups</value></smbconfoption>
<smbconfoption><name>add user script</name><value>/usr/sbin/useradd -m %u</value></smbconfoption>
<smbconfoption><name>delete user script</name><value>/usr/sbin/userdel -r %u</value></smbconfoption>
<smbconfoption><name>add group script</name><value>/usr/sbin/groupadd %g</value></smbconfoption>
<smbconfoption><name>delete group script</name><value>/usr/sbin/groupdel %g</value></smbconfoption>
<smbconfoption><name>add user to group script</name><value>/usr/sbin/usermod -G %g %u</value></smbconfoption>
<smbconfoption><name>add machine script</name><value>/usr/sbin/useradd -s /bin/false \</value></smbconfoption>
<member><parameter>        -d /dev/null %u</parameter></member>
<smbconfcomment>Hinweis: Das folgende spezifiziert den Standard Logon Skript.</smbconfcomment>
<smbconfcomment>Pro Benutzer Logonskripte können im Benutzerkonto spezifiziert werden durch pdbedit </smbconfcomment>
<smbconfoption><name>logon script</name><value>scripts\logon.bat</value></smbconfoption>
<smbconfcomment>Dies setzt den Standard-Profilpfad. Setzen Sie Pro Benutzerpfade mit pdbedit</smbconfcomment>
<smbconfoption><name>logon path</name><value>\\%L\Profiles\%U</value></smbconfoption>
<smbconfoption><name>logon drive</name><value>H:</value></smbconfoption>
<smbconfoption><name>logon home</name><value>\\%L\%U</value></smbconfoption>
<smbconfoption><name>domain logons</name><value>Yes</value></smbconfoption>
<smbconfoption><name>os level</name><value>35</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>Yes</value></smbconfoption>
<smbconfoption><name>domain master</name><value>Yes</value></smbconfoption>
<smbconfoption><name>idmap uid</name><value>15000-20000</value></smbconfoption>
<smbconfoption><name>idmap gid</name><value>15000-20000</value></smbconfoption>
<smbconfoption><name>printing</name><value>cups</value></smbconfoption>
			</smbconfexample>

			<smbconfexample id="fast-engoffice-shares">
			<title>Ingenieurbüro smb.conf (Freigaben und Dienste)</title>
<smbconfsection>[homes]</smbconfsection>
<smbconfoption><name>comment</name><value>Home-Verzeichnisse</value></smbconfoption>
<smbconfoption><name>valid users</name><value>%S</value></smbconfoption>
<smbconfoption><name>read only</name><value>No</value></smbconfoption>
<smbconfoption><name>browseable</name><value>No</value></smbconfoption>

<smbconfcomment>Drucker Auto-Share (stellt Drucker durch CUPS zur Verfügung)</smbconfcomment>
<smbconfsection>[printers]</smbconfsection>
<smbconfoption><name>comment</name><value>Alle Drucker</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/spool/samba</value></smbconfoption>
<smbconfoption><name>printer admin</name><value>root, maryo</value></smbconfoption>
<smbconfoption><name>create mask</name><value>0600</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>Yes</value></smbconfoption>
<smbconfoption><name>printable</name><value>Yes</value></smbconfoption>
<smbconfoption><name>browseable</name><value>No</value></smbconfoption>

<smbconfsection>[print$]</smbconfsection>
<smbconfoption><name>comment</name><value>Druckertreiber Share</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/lib/samba/drivers</value></smbconfoption>
<smbconfoption><name>write list</name><value>maryo, root</value></smbconfoption>
<smbconfoption><name>printer admin</name><value>maryo, root</value></smbconfoption>

<smbconfcomment>Wird für Domänen-Anmeldungen benötigt</smbconfcomment>
<smbconfsection>[netlogon]</smbconfsection>
<smbconfoption><name>comment</name><value>Netzwerk-Anmeldedienst</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/lib/samba/netlogon</value></smbconfoption>
<smbconfoption><name>admin users</name><value>root, maryo</value></smbconfoption>
<smbconfoption><name>guest ok</name><value>Yes</value></smbconfoption>
<smbconfoption><name>browseable</name><value>No</value></smbconfoption>

<smbconfcomment>Für Profile, erstellt ein Benutzerverzeichnis unterhalb des Pfades</smbconfcomment>
<smbconfcomment> z.B.: mkdir -p /var/lib/samba/profiles/maryo</smbconfcomment>
<smbconfsection>[Profiles]</smbconfsection>
<smbconfoption><name>comment</name><value>Roaming Profile Share (wandernde Benutzerprofile)</value></smbconfoption>
<smbconfoption><name>path</name><value>/var/lib/samba/profiles</value></smbconfoption>
<smbconfoption><name>read only</name><value>No</value></smbconfoption>
<smbconfoption><name>profile acls</name><value>Yes</value></smbconfoption>

<smbconfcomment>Andere Resourcen (Freigaben/Drucker) folgen weiter unten.</smbconfcomment>
<member>...</member>
			</smbconfexample>
			</para></step>

			<step><para>
			Erstellen Sie die benötigten UNIX Gruppenkonten mit Ihrem betriebssystem-spezifischen Werkzeug:
			<screen>
&rootprompt;<userinput>groupadd ntadmins</userinput>
&rootprompt;<userinput>groupadd designers</userinput>
&rootprompt;<userinput>groupadd engineers</userinput>
&rootprompt;<userinput>groupadd qateam</userinput>
</screen>
			</para></step>

			<step><para>
			Erstellen Sie Benutzerkonten auf dem System mit Ihrem betriebssystem-spezifischen Werkzeug.
			Stellen Sie sicher, dass die Benutzer Home-Verzeichnisse ebenfalls erzeugt wurden. Fügen 
			Sie den Gruppen die Benutzer zu, die Sie für die Zugriffskontrolle auf die Dateien, Verzeichnisse,
			Drucker und, wie in Ihrer Samba-Umgebung gewünscht, benötigt werden.
			</para></step>


			<step><para>
<indexterm><primary>net</primary><secondary>groupmap</secondary></indexterm>
<indexterm><primary>initGroups.sh</primary></indexterm>
			Weisen Sie jeder UNIX-Gruppe die NT-Gruppe zu:
			(Vielleicht ist es hilfreich, diesen Text in ein kleines Shell-Skript zu kopieren namens
			<filename>initGroups.sh</filename>.)
			<smbfile name="initGroups.sh">
				<title>Shell-Skript zur Initialisierung der Gruppen-Zuweisungen</title>
			<programlisting>
#!/bin/bash
#### Shell-Skript für spätere Verwendung aufbewahren
			
# Als erstes weisen wir bekannte Gruppen zu:
net groupmap modify ntgroup="Domain Admins" unixgroup=ntadmins rid=512
net groupmap modify ntgroup="Domain Users"  unixgroup=users    rid=513
net groupmap modify ntgroup="Domain Guests" unixgroup=nobody   rid=514

# Dann für unsere eigenen Domänen-Gruppen
net groupmap add ntgroup="Designers" unixgroup=designers type=d rid=1112
net groupmap add ntgroup="Engineers" unixgroup=engineers type=d rid=1113
net groupmap add ntgroup="QA Team"   unixgroup=qateam    type=d rid=1114
</programlisting>
</smbfile>
			</para></step>

			<step><para>
			Erzeugen des Verzeichnisses <filename>scripts</filename> zur Nutzung in der 
			<smbconfsection>[NETLOGON]</smbconfsection> Freigabe:
<screen>
&rootprompt;<userinput>mkdir -p /var/lib/samba/netlogon/scripts</userinput>
</screen>
			Ablageort derAnmelde-Skripte (Batch- oder cmd-Skripte) die in diesem Verzeichnis benutzt werden.
			</para></step>
		</procedure>

		<para>
		Die vorige Konfiguration stellt einen voll funktionierenden Primären Domänencontroller (PDC)
		zur Verfügung, zu welchem noch die gewünschten Dateifreigaben und Drucker hinzugefügt werden müssen.
		</para>

		</sect3>

		<sect3>
		<title>Eine grosse Organisation</title>

		<para>
		In diesem Kapitel wollen wir kurz einen Überblick über eine Samba-3 Konfiguration bekommen,
		welchen einen Light Weight Directory Access (LDAP)-basierenden Authentifizierungs-Backend nutzt.
		Die Hauptgründe für diese Wahl waren, die Möglichkeit einen primären und Backup Domaincontroller 
		(BDC) zur Verfügung zu stellen, genauso wie ein grösseres Mass an Skalierbarkeit um den Anforderungen
		an eine sehr verteilte Umgebung gerecht zu werden.
		</para>

			<sect4>
			<title>Der Primäre Domänencontroller</title>

			<para>
			Dies ist ein Beispiel einer Minimalkonfiguration, um einen Samba-3 PDC mit einem 
			LDAP Authentifizierungs-Backend zu nutzen. Es wird vorausgesetzt, dass das Betriebssystem
			korrekt konfiguriert wurde.
			</para>

			<para>
			Die Idealx Skripte (oder gleichwertige) werden benötigt, um LDAP basierende Posix und/oder
			SambaSamAccounts zu verwalten.
			Die Idealx Skripte können von dieser <ulink url="http://www.idealx.org">
			Idealx</ulink> Webseite heruntergeladen werden. Sie können ebenfalls vom Samba tarball genommen
			werden. Linux-Distributionen installieren die Idealx Skripte meist in dem Verzeichnis
			<filename>/usr/share/doc/packages/sambaXXXXXX/examples/LDAP/smbldap-tools</filename>.
			Idealx Skriptversionen <constant>smbldap-tools-0.8.2</constant> sind bekanntermassen eine gute
			Arbeitsgrundlage.
			</para>

			<procedure>
				<step><para>
				Nehmen Sie aus den Samba-Quellen <filename>~/examples/LDAP/samba.schema</filename>
				und kopieren Sie dies in das Verzeichnis <filename>/etc/openldap/schema/</filename>.
				</para></step>

				<step><para>
				Setzen Sie den LDAP Server auf. Dieses Beispiel passt zu OpenLDAP 2.1.x.
				Die <filename>/etc/openldap/slapd.conf</filename> Datei:
<indexterm><primary>/etc/openldap/slapd.conf</primary></indexterm>
<smbfile name="slapd.conf"><title>Beispieldatei slapd.conf</title>
<programlisting>
# Hinweis: auskommentierte Zeilen wurden entfernt
include         /etc/openldap/schema/core.schema
include         /etc/openldap/schema/cosine.schema
include         /etc/openldap/schema/inetorgperson.schema
include         /etc/openldap/schema/nis.schema
include         /etc/openldap/schema/samba.schema

pidfile         /var/run/slapd/slapd.pid
argsfile        /var/run/slapd/slapd.args

database        bdb
suffix          "dc=quenya,dc=org"
rootdn          "cn=Manager,dc=quenya,dc=org"
rootpw          {SSHA}06qDkonA8hk6W6SSnRzWj0/pBcU3m0/P
# Das obige Passwort ist 'nastyon3'

directory     /var/lib/ldap

index   objectClass     eq
index cn                      pres,sub,eq
index sn                      pres,sub,eq
index uid                     pres,sub,eq
index displayName             pres,sub,eq
index uidNumber               eq
index gidNumber               eq
index memberUid               eq
index   sambaSID              eq
index   sambaPrimaryGroupSID  eq
index   sambaDomainName       eq
index   default               sub
</programlisting>
</smbfile>
				</para></step>

				<step><para>
				Erzeugen Sie die folgende Datei <filename>samba-ldap-init.ldif</filename>:
				<indexterm><primary>samba-ldap-init.ldif</primary></indexterm>
				<smbfile name="samba-ldap-init.ldif">
<programlisting>
# Organisation für SambaXP Demo
dn: dc=quenya,dc=org
objectclass: dcObject
objectclass: organization
dc: quenya
o: SambaXP Demo
description: Der SambaXP Demo LDAP Tree

# Organizational Role for Directory Management
dn: cn=Manager,dc=quenya,dc=org
objectclass: organizationalRole
cn: Manager
description: Directory Manager

# Aufsetzen der Container für die Benutzer
dn: ou=People, dc=quenya, dc=org
objectclass: top
objectclass: organizationalUnit
ou: People

# Aufsetzen eines Administrator-Handles für die People OU
dn: cn=admin, ou=People, dc=quenya, dc=org
cn: admin
objectclass: top
objectclass: organizationalRole
objectclass: simpleSecurityObject
userPassword: {SSHA}0jBHgQ1vp4EDX2rEMMfIudvRMJoGwjVb
# Das vorige Passwort ist 'mordonL8'
</programlisting>
</smbfile>
				</para></step>

				<step><para>
				Laden der vorigen Initialdaten in die LDAP Datenbank:
<screen>
&rootprompt;<userinput>slapadd -v -l initdb.ldif</userinput>
</screen>
				</para></step>

				<step><para>
				Starten des LDAP Servers durch das für Ihre Betriebssystem-Plattform bevorzugte
				Werkzeug oder Methode auf welcher dies installiert wurde.
				</para></step>

				<step><para>
				Installieren der Idealx Skriptdateien im Verzeichnis <filename>/usr/local/sbin</filename>,
				dann Konfigurieren der Datei smbldap_conf.pm um Ihre Systemkonfiguration anzupassen.
				</para></step>

				<step><para>
				Die &smb.conf; Datei, die diesen Backend steuert, ist beispielhaft hier <link linkend="fast-ldap"/>.
				</para>

				<para>
<smbconfexample id="fast-ldap">
<title>LDAP Backend smb.conf für einen PDC</title>
<smbconfcomment>Globale Parameter</smbconfcomment>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>workgroup</name><value>MIDEARTH</value></smbconfoption>
<smbconfoption><name>netbios name</name><value>FRODO</value></smbconfoption>
<smbconfoption><name>passdb backend</name><value>ldapsam:ldap://localhost</value></smbconfoption>
<smbconfoption><name>username map</name><value>/etc/samba/smbusers</value></smbconfoption>
<smbconfoption><name>printcap name</name><value>cups</value></smbconfoption>
<smbconfoption><name>add user script</name><value>/usr/local/sbin/smbldap-useradd.pl -m '%u'</value></smbconfoption>
<smbconfoption><name>delete user script</name><value>/usr/local/sbin/smbldap-userdel.pl %u</value></smbconfoption>
<smbconfoption><name>add group script</name><value>/usr/local/sbin/smbldap-groupadd.pl -p '%g'</value></smbconfoption>
<smbconfoption><name>delete group script</name><value>/usr/local/sbin/smbldap-groupdel.pl '%g'</value></smbconfoption>
<smbconfoption><name>add user to group script</name><value>/usr/local/sbin/ \</value></smbconfoption>
<member><parameter>smbldap-groupmod.pl -m '%g' '%u'</parameter></member>
<smbconfoption><name>delete user from group script</name><value>/usr/local/sbin/ \</value></smbconfoption>
<member><parameter>smbldap-groupmod.pl -x '%g' '%u'</parameter></member>
<smbconfoption><name>set primary group script</name><value>/usr/local/sbin/ \</value></smbconfoption>
<member><parameter>smbldap-usermod.pl -g '%g' '%u'</parameter></member>
<smbconfoption><name>add machine script</name><value>/usr/local/sbin/smbldap-useradd.pl -w '%u'</value></smbconfoption>
<smbconfoption><name>logon script</name><value>scripts\logon.bat</value></smbconfoption>
<smbconfoption><name>logon path</name><value>\\%L\Profiles\%U</value></smbconfoption>
<smbconfoption><name>logon drive</name><value>H:</value></smbconfoption>
<smbconfoption><name>logon home</name><value>\\%L\%U</value></smbconfoption>
<smbconfoption><name>domain logons</name><value>Yes</value></smbconfoption>
<smbconfoption><name>os level</name><value>35</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>Yes</value></smbconfoption>
<smbconfoption><name>domain master</name><value>Yes</value></smbconfoption>
<smbconfoption><name>ldap suffix</name><value>dc=quenya,dc=org</value></smbconfoption>
<smbconfoption><name>ldap machine suffix</name><value>ou=People</value></smbconfoption>
<smbconfoption><name>ldap user suffix</name><value>ou=People</value></smbconfoption>
<smbconfoption><name>ldap group suffix</name><value>ou=People</value></smbconfoption>
<smbconfoption><name>ldap idmap suffix</name><value>ou=People</value></smbconfoption>
<smbconfoption><name>ldap admin dn</name><value>cn=Manager</value></smbconfoption>
<smbconfoption><name>ldap ssl</name><value>no</value></smbconfoption>
<smbconfoption><name>ldap passwd sync</name><value>Yes</value></smbconfoption>
<smbconfoption><name>idmap uid</name><value>15000-20000</value></smbconfoption>
<smbconfoption><name>idmap gid</name><value>15000-20000</value></smbconfoption>
<smbconfoption><name>winbind separator</name><value>+</value></smbconfoption>
<smbconfoption><name>printing</name><value>cups</value></smbconfoption>
<member>...</member>
</smbconfexample>
				</para></step>

				<step><para>
				Fügen Sie das LDAP Passwort zu der Datei <filename>secrets.tdc</filename> hinzu, 
				sodass Samba die LDAP Datenbank aktualisieren kann:
<screen>
&rootprompt;<userinput>smbpasswd -w mordonL8</userinput>
</screen>
				</para></step>

				<step><para>
				Fügen Sie Benutzer und Gruppen wie benötigt hinzu. Benutzer und Gruppen,
				die über Samba-Werkzeuge hinzugefügt wurden, werden automatisch sowohl dem LDAP
				Backend als auch dem Betriebssystem hinzugefügt.
				</para></step>

			</procedure>

			</sect4>

			<sect4>
			<title>Backup Domänencontroller</title>

			<para>
			<link linkend="fast-bdc"/> zeigt die Beispielkonfiguration für den BDC.
			</para>

			<procedure>
				<step><para>
				Entscheiden Sie, ob der BDC seinen eigenen LDAP Server haben soll oder nicht.
				Falls der BDC auch der LDAP Server ist, ändern Sie die folgende &smb.conf; 
				wie angezeigt. Die Standardkonfiguration in <link linkend="fast-bdc"/> benutzt
				einen zentralen LDAP Server.
<smbconfexample id="fast-bdc">
<title>Remote LDAP BDC smb.conf</title>
<smbconfcomment>Globale Parameter</smbconfcomment>
<smbconfsection>[global]</smbconfsection>
<smbconfoption><name>workgroup</name><value>MIDEARTH</value></smbconfoption>
<smbconfoption><name>netbios name</name><value>GANDALF</value></smbconfoption>
<smbconfoption><name>passdb backend</name><value>ldapsam:ldap://frodo.quenya.org</value></smbconfoption>
<smbconfoption><name>username map</name><value>/etc/samba/smbusers</value></smbconfoption>
<smbconfoption><name>printcap name</name><value>cups</value></smbconfoption>
<smbconfoption><name>logon script</name><value>scripts\logon.bat</value></smbconfoption>
<smbconfoption><name>logon path</name><value>\\%L\Profiles\%U</value></smbconfoption>
<smbconfoption><name>logon drive</name><value>H:</value></smbconfoption>
<smbconfoption><name>logon home</name><value>\\%L\%U</value></smbconfoption>
<smbconfoption><name>domain logons</name><value>Yes</value></smbconfoption>
<smbconfoption><name>os level</name><value>33</value></smbconfoption>
<smbconfoption><name>preferred master</name><value>Yes</value></smbconfoption>
<smbconfoption><name>domain master</name><value>No</value></smbconfoption>
<smbconfoption><name>ldap suffix</name><value>dc=quenya,dc=org</value></smbconfoption>
<smbconfoption><name>ldap machine suffix</name><value>ou=People</value></smbconfoption>
<smbconfoption><name>ldap user suffix</name><value>ou=People</value></smbconfoption>
<smbconfoption><name>ldap group suffix</name><value>ou=People</value></smbconfoption>
<smbconfoption><name>ldap idmap suffix</name><value>ou=People</value></smbconfoption>
<smbconfoption><name>ldap admin dn</name><value>cn=Manager</value></smbconfoption>
<smbconfoption><name>ldap ssl</name><value>no</value></smbconfoption>
<smbconfoption><name>ldap passwd sync</name><value>Yes</value></smbconfoption>
<smbconfoption><name>idmap uid</name><value>15000-20000</value></smbconfoption>
<smbconfoption><name>idmap gid</name><value>15000-20000</value></smbconfoption>
<smbconfoption><name>winbind separator</name><value>+</value></smbconfoption>
<smbconfoption><name>printing</name><value>cups</value></smbconfoption>
<member>...</member>
</smbconfexample>
				</para></step>

				<step><para>
				Konfigurieren Sie die NETLOGON und PROFILES Verzeichnisse für den PDC wie hier <link linkend="fast-bdc"/>.
				</para></step>
			</procedure>

			</sect4>

		</sect3>

	</sect2>

</sect1>

</chapter>
